(function(){const Y=document.createElement("link").relList;if(Y&&Y.supports&&Y.supports("modulepreload"))return;for(const ue of document.querySelectorAll('link[rel="modulepreload"]'))Ee(ue);new MutationObserver(ue=>{for(const _e of ue)if(_e.type==="childList")for(const be of _e.addedNodes)be.tagName==="LINK"&&be.rel==="modulepreload"&&Ee(be)}).observe(document,{childList:!0,subtree:!0});function Z(ue){const _e={};return ue.integrity&&(_e.integrity=ue.integrity),ue.referrerPolicy&&(_e.referrerPolicy=ue.referrerPolicy),ue.crossOrigin==="use-credentials"?_e.credentials="include":ue.crossOrigin==="anonymous"?_e.credentials="omit":_e.credentials="same-origin",_e}function Ee(ue){if(ue.ep)return;ue.ep=!0;const _e=Z(ue);fetch(ue.href,_e)}})();var ug=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rb(L){return L&&L.__esModule&&Object.prototype.hasOwnProperty.call(L,"default")?L.default:L}var j_={exports:{}},tm={},U_={exports:{}},Cn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zx;function LS(){if(Zx)return Cn;Zx=1;var L=Symbol.for("react.element"),Y=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),Ee=Symbol.for("react.strict_mode"),ue=Symbol.for("react.profiler"),_e=Symbol.for("react.provider"),be=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),ne=Symbol.for("react.suspense"),F=Symbol.for("react.memo"),fe=Symbol.for("react.lazy"),qe=Symbol.iterator;function Ne(dt){return dt===null||typeof dt!="object"?null:(dt=qe&&dt[qe]||dt["@@iterator"],typeof dt=="function"?dt:null)}var Ye={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ze=Object.assign,Xe={};function We(dt,sr,bi){this.props=dt,this.context=sr,this.refs=Xe,this.updater=bi||Ye}We.prototype.isReactComponent={},We.prototype.setState=function(dt,sr){if(typeof dt!="object"&&typeof dt!="function"&&dt!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,dt,sr,"setState")},We.prototype.forceUpdate=function(dt){this.updater.enqueueForceUpdate(this,dt,"forceUpdate")};function De(){}De.prototype=We.prototype;function Ke(dt,sr,bi){this.props=dt,this.context=sr,this.refs=Xe,this.updater=bi||Ye}var et=Ke.prototype=new De;et.constructor=Ke,ze(et,We.prototype),et.isPureReactComponent=!0;var st=Array.isArray,$e=Object.prototype.hasOwnProperty,bt={current:null},St={key:!0,ref:!0,__self:!0,__source:!0};function dr(dt,sr,bi){var Ai,qr={},Gr=null,pi=null;if(sr!=null)for(Ai in sr.ref!==void 0&&(pi=sr.ref),sr.key!==void 0&&(Gr=""+sr.key),sr)$e.call(sr,Ai)&&!St.hasOwnProperty(Ai)&&(qr[Ai]=sr[Ai]);var ji=arguments.length-2;if(ji===1)qr.children=bi;else if(1<ji){for(var jr=Array(ji),Dn=0;Dn<ji;Dn++)jr[Dn]=arguments[Dn+2];qr.children=jr}if(dt&&dt.defaultProps)for(Ai in ji=dt.defaultProps,ji)qr[Ai]===void 0&&(qr[Ai]=ji[Ai]);return{$$typeof:L,type:dt,key:Gr,ref:pi,props:qr,_owner:bt.current}}function Fr(dt,sr){return{$$typeof:L,type:dt.type,key:sr,ref:dt.ref,props:dt.props,_owner:dt._owner}}function hi(dt){return typeof dt=="object"&&dt!==null&&dt.$$typeof===L}function ht(dt){var sr={"=":"=0",":":"=2"};return"$"+dt.replace(/[=:]/g,function(bi){return sr[bi]})}var Zt=/\/+/g;function fr(dt,sr){return typeof dt=="object"&&dt!==null&&dt.key!=null?ht(""+dt.key):sr.toString(36)}function Tr(dt,sr,bi,Ai,qr){var Gr=typeof dt;(Gr==="undefined"||Gr==="boolean")&&(dt=null);var pi=!1;if(dt===null)pi=!0;else switch(Gr){case"string":case"number":pi=!0;break;case"object":switch(dt.$$typeof){case L:case Y:pi=!0}}if(pi)return pi=dt,qr=qr(pi),dt=Ai===""?"."+fr(pi,0):Ai,st(qr)?(bi="",dt!=null&&(bi=dt.replace(Zt,"$&/")+"/"),Tr(qr,sr,bi,"",function(Dn){return Dn})):qr!=null&&(hi(qr)&&(qr=Fr(qr,bi+(!qr.key||pi&&pi.key===qr.key?"":(""+qr.key).replace(Zt,"$&/")+"/")+dt)),sr.push(qr)),1;if(pi=0,Ai=Ai===""?".":Ai+":",st(dt))for(var ji=0;ji<dt.length;ji++){Gr=dt[ji];var jr=Ai+fr(Gr,ji);pi+=Tr(Gr,sr,bi,jr,qr)}else if(jr=Ne(dt),typeof jr=="function")for(dt=jr.call(dt),ji=0;!(Gr=dt.next()).done;)Gr=Gr.value,jr=Ai+fr(Gr,ji++),pi+=Tr(Gr,sr,bi,jr,qr);else if(Gr==="object")throw sr=String(dt),Error("Objects are not valid as a React child (found: "+(sr==="[object Object]"?"object with keys {"+Object.keys(dt).join(", ")+"}":sr)+"). If you meant to render a collection of children, use an array instead.");return pi}function Or(dt,sr,bi){if(dt==null)return dt;var Ai=[],qr=0;return Tr(dt,Ai,"","",function(Gr){return sr.call(bi,Gr,qr++)}),Ai}function ri(dt){if(dt._status===-1){var sr=dt._result;sr=sr(),sr.then(function(bi){(dt._status===0||dt._status===-1)&&(dt._status=1,dt._result=bi)},function(bi){(dt._status===0||dt._status===-1)&&(dt._status=2,dt._result=bi)}),dt._status===-1&&(dt._status=0,dt._result=sr)}if(dt._status===1)return dt._result.default;throw dt._result}var fi={current:null},mr={transition:null},Lr={ReactCurrentDispatcher:fi,ReactCurrentBatchConfig:mr,ReactCurrentOwner:bt};function or(){throw Error("act(...) is not supported in production builds of React.")}return Cn.Children={map:Or,forEach:function(dt,sr,bi){Or(dt,function(){sr.apply(this,arguments)},bi)},count:function(dt){var sr=0;return Or(dt,function(){sr++}),sr},toArray:function(dt){return Or(dt,function(sr){return sr})||[]},only:function(dt){if(!hi(dt))throw Error("React.Children.only expected to receive a single React element child.");return dt}},Cn.Component=We,Cn.Fragment=Z,Cn.Profiler=ue,Cn.PureComponent=Ke,Cn.StrictMode=Ee,Cn.Suspense=ne,Cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Lr,Cn.act=or,Cn.cloneElement=function(dt,sr,bi){if(dt==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+dt+".");var Ai=ze({},dt.props),qr=dt.key,Gr=dt.ref,pi=dt._owner;if(sr!=null){if(sr.ref!==void 0&&(Gr=sr.ref,pi=bt.current),sr.key!==void 0&&(qr=""+sr.key),dt.type&&dt.type.defaultProps)var ji=dt.type.defaultProps;for(jr in sr)$e.call(sr,jr)&&!St.hasOwnProperty(jr)&&(Ai[jr]=sr[jr]===void 0&&ji!==void 0?ji[jr]:sr[jr])}var jr=arguments.length-2;if(jr===1)Ai.children=bi;else if(1<jr){ji=Array(jr);for(var Dn=0;Dn<jr;Dn++)ji[Dn]=arguments[Dn+2];Ai.children=ji}return{$$typeof:L,type:dt.type,key:qr,ref:Gr,props:Ai,_owner:pi}},Cn.createContext=function(dt){return dt={$$typeof:be,_currentValue:dt,_currentValue2:dt,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},dt.Provider={$$typeof:_e,_context:dt},dt.Consumer=dt},Cn.createElement=dr,Cn.createFactory=function(dt){var sr=dr.bind(null,dt);return sr.type=dt,sr},Cn.createRef=function(){return{current:null}},Cn.forwardRef=function(dt){return{$$typeof:s,render:dt}},Cn.isValidElement=hi,Cn.lazy=function(dt){return{$$typeof:fe,_payload:{_status:-1,_result:dt},_init:ri}},Cn.memo=function(dt,sr){return{$$typeof:F,type:dt,compare:sr===void 0?null:sr}},Cn.startTransition=function(dt){var sr=mr.transition;mr.transition={};try{dt()}finally{mr.transition=sr}},Cn.unstable_act=or,Cn.useCallback=function(dt,sr){return fi.current.useCallback(dt,sr)},Cn.useContext=function(dt){return fi.current.useContext(dt)},Cn.useDebugValue=function(){},Cn.useDeferredValue=function(dt){return fi.current.useDeferredValue(dt)},Cn.useEffect=function(dt,sr){return fi.current.useEffect(dt,sr)},Cn.useId=function(){return fi.current.useId()},Cn.useImperativeHandle=function(dt,sr,bi){return fi.current.useImperativeHandle(dt,sr,bi)},Cn.useInsertionEffect=function(dt,sr){return fi.current.useInsertionEffect(dt,sr)},Cn.useLayoutEffect=function(dt,sr){return fi.current.useLayoutEffect(dt,sr)},Cn.useMemo=function(dt,sr){return fi.current.useMemo(dt,sr)},Cn.useReducer=function(dt,sr,bi){return fi.current.useReducer(dt,sr,bi)},Cn.useRef=function(dt){return fi.current.useRef(dt)},Cn.useState=function(dt){return fi.current.useState(dt)},Cn.useSyncExternalStore=function(dt,sr,bi){return fi.current.useSyncExternalStore(dt,sr,bi)},Cn.useTransition=function(){return fi.current.useTransition()},Cn.version="18.3.1",Cn}var Xx;function cp(){return Xx||(Xx=1,U_.exports=LS()),U_.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yx;function zS(){if(Yx)return tm;Yx=1;var L=cp(),Y=Symbol.for("react.element"),Z=Symbol.for("react.fragment"),Ee=Object.prototype.hasOwnProperty,ue=L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_e={key:!0,ref:!0,__self:!0,__source:!0};function be(s,ne,F){var fe,qe={},Ne=null,Ye=null;F!==void 0&&(Ne=""+F),ne.key!==void 0&&(Ne=""+ne.key),ne.ref!==void 0&&(Ye=ne.ref);for(fe in ne)Ee.call(ne,fe)&&!_e.hasOwnProperty(fe)&&(qe[fe]=ne[fe]);if(s&&s.defaultProps)for(fe in ne=s.defaultProps,ne)qe[fe]===void 0&&(qe[fe]=ne[fe]);return{$$typeof:Y,type:s,key:Ne,ref:Ye,props:qe,_owner:ue.current}}return tm.Fragment=Z,tm.jsx=be,tm.jsxs=be,tm}var Kx;function OS(){return Kx||(Kx=1,j_.exports=zS()),j_.exports}var Se=OS(),cr=cp();const FS=rb(cr);var cg={},q_={exports:{}},Ol={},G_={exports:{}},H_={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jx;function BS(){return Jx||(Jx=1,function(L){function Y(mr,Lr){var or=mr.length;mr.push(Lr);e:for(;0<or;){var dt=or-1>>>1,sr=mr[dt];if(0<ue(sr,Lr))mr[dt]=Lr,mr[or]=sr,or=dt;else break e}}function Z(mr){return mr.length===0?null:mr[0]}function Ee(mr){if(mr.length===0)return null;var Lr=mr[0],or=mr.pop();if(or!==Lr){mr[0]=or;e:for(var dt=0,sr=mr.length,bi=sr>>>1;dt<bi;){var Ai=2*(dt+1)-1,qr=mr[Ai],Gr=Ai+1,pi=mr[Gr];if(0>ue(qr,or))Gr<sr&&0>ue(pi,qr)?(mr[dt]=pi,mr[Gr]=or,dt=Gr):(mr[dt]=qr,mr[Ai]=or,dt=Ai);else if(Gr<sr&&0>ue(pi,or))mr[dt]=pi,mr[Gr]=or,dt=Gr;else break e}}return Lr}function ue(mr,Lr){var or=mr.sortIndex-Lr.sortIndex;return or!==0?or:mr.id-Lr.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _e=performance;L.unstable_now=function(){return _e.now()}}else{var be=Date,s=be.now();L.unstable_now=function(){return be.now()-s}}var ne=[],F=[],fe=1,qe=null,Ne=3,Ye=!1,ze=!1,Xe=!1,We=typeof setTimeout=="function"?setTimeout:null,De=typeof clearTimeout=="function"?clearTimeout:null,Ke=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function et(mr){for(var Lr=Z(F);Lr!==null;){if(Lr.callback===null)Ee(F);else if(Lr.startTime<=mr)Ee(F),Lr.sortIndex=Lr.expirationTime,Y(ne,Lr);else break;Lr=Z(F)}}function st(mr){if(Xe=!1,et(mr),!ze)if(Z(ne)!==null)ze=!0,ri($e);else{var Lr=Z(F);Lr!==null&&fi(st,Lr.startTime-mr)}}function $e(mr,Lr){ze=!1,Xe&&(Xe=!1,De(dr),dr=-1),Ye=!0;var or=Ne;try{for(et(Lr),qe=Z(ne);qe!==null&&(!(qe.expirationTime>Lr)||mr&&!ht());){var dt=qe.callback;if(typeof dt=="function"){qe.callback=null,Ne=qe.priorityLevel;var sr=dt(qe.expirationTime<=Lr);Lr=L.unstable_now(),typeof sr=="function"?qe.callback=sr:qe===Z(ne)&&Ee(ne),et(Lr)}else Ee(ne);qe=Z(ne)}if(qe!==null)var bi=!0;else{var Ai=Z(F);Ai!==null&&fi(st,Ai.startTime-Lr),bi=!1}return bi}finally{qe=null,Ne=or,Ye=!1}}var bt=!1,St=null,dr=-1,Fr=5,hi=-1;function ht(){return!(L.unstable_now()-hi<Fr)}function Zt(){if(St!==null){var mr=L.unstable_now();hi=mr;var Lr=!0;try{Lr=St(!0,mr)}finally{Lr?fr():(bt=!1,St=null)}}else bt=!1}var fr;if(typeof Ke=="function")fr=function(){Ke(Zt)};else if(typeof MessageChannel<"u"){var Tr=new MessageChannel,Or=Tr.port2;Tr.port1.onmessage=Zt,fr=function(){Or.postMessage(null)}}else fr=function(){We(Zt,0)};function ri(mr){St=mr,bt||(bt=!0,fr())}function fi(mr,Lr){dr=We(function(){mr(L.unstable_now())},Lr)}L.unstable_IdlePriority=5,L.unstable_ImmediatePriority=1,L.unstable_LowPriority=4,L.unstable_NormalPriority=3,L.unstable_Profiling=null,L.unstable_UserBlockingPriority=2,L.unstable_cancelCallback=function(mr){mr.callback=null},L.unstable_continueExecution=function(){ze||Ye||(ze=!0,ri($e))},L.unstable_forceFrameRate=function(mr){0>mr||125<mr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Fr=0<mr?Math.floor(1e3/mr):5},L.unstable_getCurrentPriorityLevel=function(){return Ne},L.unstable_getFirstCallbackNode=function(){return Z(ne)},L.unstable_next=function(mr){switch(Ne){case 1:case 2:case 3:var Lr=3;break;default:Lr=Ne}var or=Ne;Ne=Lr;try{return mr()}finally{Ne=or}},L.unstable_pauseExecution=function(){},L.unstable_requestPaint=function(){},L.unstable_runWithPriority=function(mr,Lr){switch(mr){case 1:case 2:case 3:case 4:case 5:break;default:mr=3}var or=Ne;Ne=mr;try{return Lr()}finally{Ne=or}},L.unstable_scheduleCallback=function(mr,Lr,or){var dt=L.unstable_now();switch(typeof or=="object"&&or!==null?(or=or.delay,or=typeof or=="number"&&0<or?dt+or:dt):or=dt,mr){case 1:var sr=-1;break;case 2:sr=250;break;case 5:sr=1073741823;break;case 4:sr=1e4;break;default:sr=5e3}return sr=or+sr,mr={id:fe++,callback:Lr,priorityLevel:mr,startTime:or,expirationTime:sr,sortIndex:-1},or>dt?(mr.sortIndex=or,Y(F,mr),Z(ne)===null&&mr===Z(F)&&(Xe?(De(dr),dr=-1):Xe=!0,fi(st,or-dt))):(mr.sortIndex=sr,Y(ne,mr),ze||Ye||(ze=!0,ri($e))),mr},L.unstable_shouldYield=ht,L.unstable_wrapCallback=function(mr){var Lr=Ne;return function(){var or=Ne;Ne=Lr;try{return mr.apply(this,arguments)}finally{Ne=or}}}}(H_)),H_}var Qx;function NS(){return Qx||(Qx=1,G_.exports=BS()),G_.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e1;function VS(){if(e1)return Ol;e1=1;var L=cp(),Y=NS();function Z(h){for(var p="https://reactjs.org/docs/error-decoder.html?invariant="+h,b=1;b<arguments.length;b++)p+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ee=new Set,ue={};function _e(h,p){be(h,p),be(h+"Capture",p)}function be(h,p){for(ue[h]=p,h=0;h<p.length;h++)Ee.add(p[h])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ne=Object.prototype.hasOwnProperty,F=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fe={},qe={};function Ne(h){return ne.call(qe,h)?!0:ne.call(fe,h)?!1:F.test(h)?qe[h]=!0:(fe[h]=!0,!1)}function Ye(h,p,b,C){if(b!==null&&b.type===0)return!1;switch(typeof p){case"function":case"symbol":return!0;case"boolean":return C?!1:b!==null?!b.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function ze(h,p,b,C){if(p===null||typeof p>"u"||Ye(h,p,b,C))return!0;if(C)return!1;if(b!==null)switch(b.type){case 3:return!p;case 4:return p===!1;case 5:return isNaN(p);case 6:return isNaN(p)||1>p}return!1}function Xe(h,p,b,C,z,H,pe){this.acceptsBooleans=p===2||p===3||p===4,this.attributeName=C,this.attributeNamespace=z,this.mustUseProperty=b,this.propertyName=h,this.type=p,this.sanitizeURL=H,this.removeEmptyString=pe}var We={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){We[h]=new Xe(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var p=h[0];We[p]=new Xe(p,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){We[h]=new Xe(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){We[h]=new Xe(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){We[h]=new Xe(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){We[h]=new Xe(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){We[h]=new Xe(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){We[h]=new Xe(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){We[h]=new Xe(h,5,!1,h.toLowerCase(),null,!1,!1)});var De=/[\-:]([a-z])/g;function Ke(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var p=h.replace(De,Ke);We[p]=new Xe(p,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var p=h.replace(De,Ke);We[p]=new Xe(p,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var p=h.replace(De,Ke);We[p]=new Xe(p,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){We[h]=new Xe(h,1,!1,h.toLowerCase(),null,!1,!1)}),We.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){We[h]=new Xe(h,1,!1,h.toLowerCase(),null,!0,!0)});function et(h,p,b,C){var z=We.hasOwnProperty(p)?We[p]:null;(z!==null?z.type!==0:C||!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(ze(p,b,z,C)&&(b=null),C||z===null?Ne(p)&&(b===null?h.removeAttribute(p):h.setAttribute(p,""+b)):z.mustUseProperty?h[z.propertyName]=b===null?z.type===3?!1:"":b:(p=z.attributeName,C=z.attributeNamespace,b===null?h.removeAttribute(p):(z=z.type,b=z===3||z===4&&b===!0?"":""+b,C?h.setAttributeNS(C,p,b):h.setAttribute(p,b))))}var st=L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$e=Symbol.for("react.element"),bt=Symbol.for("react.portal"),St=Symbol.for("react.fragment"),dr=Symbol.for("react.strict_mode"),Fr=Symbol.for("react.profiler"),hi=Symbol.for("react.provider"),ht=Symbol.for("react.context"),Zt=Symbol.for("react.forward_ref"),fr=Symbol.for("react.suspense"),Tr=Symbol.for("react.suspense_list"),Or=Symbol.for("react.memo"),ri=Symbol.for("react.lazy"),fi=Symbol.for("react.offscreen"),mr=Symbol.iterator;function Lr(h){return h===null||typeof h!="object"?null:(h=mr&&h[mr]||h["@@iterator"],typeof h=="function"?h:null)}var or=Object.assign,dt;function sr(h){if(dt===void 0)try{throw Error()}catch(b){var p=b.stack.trim().match(/\n( *(at )?)/);dt=p&&p[1]||""}return`
`+dt+h}var bi=!1;function Ai(h,p){if(!h||bi)return"";bi=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(p)if(p=function(){throw Error()},Object.defineProperty(p.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(p,[])}catch(Gt){var C=Gt}Reflect.construct(h,[],p)}else{try{p.call()}catch(Gt){C=Gt}h.call(p.prototype)}else{try{throw Error()}catch(Gt){C=Gt}h()}}catch(Gt){if(Gt&&C&&typeof Gt.stack=="string"){for(var z=Gt.stack.split(`
`),H=C.stack.split(`
`),pe=z.length-1,He=H.length-1;1<=pe&&0<=He&&z[pe]!==H[He];)He--;for(;1<=pe&&0<=He;pe--,He--)if(z[pe]!==H[He]){if(pe!==1||He!==1)do if(pe--,He--,0>He||z[pe]!==H[He]){var lt=`
`+z[pe].replace(" at new "," at ");return h.displayName&&lt.includes("<anonymous>")&&(lt=lt.replace("<anonymous>",h.displayName)),lt}while(1<=pe&&0<=He);break}}}finally{bi=!1,Error.prepareStackTrace=b}return(h=h?h.displayName||h.name:"")?sr(h):""}function qr(h){switch(h.tag){case 5:return sr(h.type);case 16:return sr("Lazy");case 13:return sr("Suspense");case 19:return sr("SuspenseList");case 0:case 2:case 15:return h=Ai(h.type,!1),h;case 11:return h=Ai(h.type.render,!1),h;case 1:return h=Ai(h.type,!0),h;default:return""}}function Gr(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case St:return"Fragment";case bt:return"Portal";case Fr:return"Profiler";case dr:return"StrictMode";case fr:return"Suspense";case Tr:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case ht:return(h.displayName||"Context")+".Consumer";case hi:return(h._context.displayName||"Context")+".Provider";case Zt:var p=h.render;return h=h.displayName,h||(h=p.displayName||p.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case Or:return p=h.displayName||null,p!==null?p:Gr(h.type)||"Memo";case ri:p=h._payload,h=h._init;try{return Gr(h(p))}catch{}}return null}function pi(h){var p=h.type;switch(h.tag){case 24:return"Cache";case 9:return(p.displayName||"Context")+".Consumer";case 10:return(p._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=p.render,h=h.displayName||h.name||"",p.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return p;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gr(p);case 8:return p===dr?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p}return null}function ji(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function jr(h){var p=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function Dn(h){var p=jr(h)?"checked":"value",b=Object.getOwnPropertyDescriptor(h.constructor.prototype,p),C=""+h[p];if(!h.hasOwnProperty(p)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var z=b.get,H=b.set;return Object.defineProperty(h,p,{configurable:!0,get:function(){return z.call(this)},set:function(pe){C=""+pe,H.call(this,pe)}}),Object.defineProperty(h,p,{enumerable:b.enumerable}),{getValue:function(){return C},setValue:function(pe){C=""+pe},stopTracking:function(){h._valueTracker=null,delete h[p]}}}}function Xn(h){h._valueTracker||(h._valueTracker=Dn(h))}function xo(h){if(!h)return!1;var p=h._valueTracker;if(!p)return!0;var b=p.getValue(),C="";return h&&(C=jr(h)?h.checked?"true":"false":h.value),h=C,h!==b?(p.setValue(h),!0):!1}function zi(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function ts(h,p){var b=p.checked;return or({},p,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??h._wrapperState.initialChecked})}function zs(h,p){var b=p.defaultValue==null?"":p.defaultValue,C=p.checked!=null?p.checked:p.defaultChecked;b=ji(p.value!=null?p.value:b),h._wrapperState={initialChecked:C,initialValue:b,controlled:p.type==="checkbox"||p.type==="radio"?p.checked!=null:p.value!=null}}function no(h,p){p=p.checked,p!=null&&et(h,"checked",p,!1)}function fs(h,p){no(h,p);var b=ji(p.value),C=p.type;if(b!=null)C==="number"?(b===0&&h.value===""||h.value!=b)&&(h.value=""+b):h.value!==""+b&&(h.value=""+b);else if(C==="submit"||C==="reset"){h.removeAttribute("value");return}p.hasOwnProperty("value")?eo(h,p.type,b):p.hasOwnProperty("defaultValue")&&eo(h,p.type,ji(p.defaultValue)),p.checked==null&&p.defaultChecked!=null&&(h.defaultChecked=!!p.defaultChecked)}function rs(h,p,b){if(p.hasOwnProperty("value")||p.hasOwnProperty("defaultValue")){var C=p.type;if(!(C!=="submit"&&C!=="reset"||p.value!==void 0&&p.value!==null))return;p=""+h._wrapperState.initialValue,b||p===h.value||(h.value=p),h.defaultValue=p}b=h.name,b!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,b!==""&&(h.name=b)}function eo(h,p,b){(p!=="number"||zi(h.ownerDocument)!==h)&&(b==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+b&&(h.defaultValue=""+b))}var po=Array.isArray;function ko(h,p,b,C){if(h=h.options,p){p={};for(var z=0;z<b.length;z++)p["$"+b[z]]=!0;for(b=0;b<h.length;b++)z=p.hasOwnProperty("$"+h[b].value),h[b].selected!==z&&(h[b].selected=z),z&&C&&(h[b].defaultSelected=!0)}else{for(b=""+ji(b),p=null,z=0;z<h.length;z++){if(h[z].value===b){h[z].selected=!0,C&&(h[z].defaultSelected=!0);return}p!==null||h[z].disabled||(p=h[z])}p!==null&&(p.selected=!0)}}function mo(h,p){if(p.dangerouslySetInnerHTML!=null)throw Error(Z(91));return or({},p,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function oo(h,p){var b=p.value;if(b==null){if(b=p.children,p=p.defaultValue,b!=null){if(p!=null)throw Error(Z(92));if(po(b)){if(1<b.length)throw Error(Z(93));b=b[0]}p=b}p==null&&(p=""),b=p}h._wrapperState={initialValue:ji(b)}}function yo(h,p){var b=ji(p.value),C=ji(p.defaultValue);b!=null&&(b=""+b,b!==h.value&&(h.value=b),p.defaultValue==null&&h.defaultValue!==b&&(h.defaultValue=b)),C!=null&&(h.defaultValue=""+C)}function Ao(h){var p=h.textContent;p===h._wrapperState.initialValue&&p!==""&&p!==null&&(h.value=p)}function Ws(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ps(h,p){return h==null||h==="http://www.w3.org/1999/xhtml"?Ws(p):h==="http://www.w3.org/2000/svg"&&p==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var Ho,is=function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(p,b,C,z){MSApp.execUnsafeLocalFunction(function(){return h(p,b,C,z)})}:h}(function(h,p){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=p;else{for(Ho=Ho||document.createElement("div"),Ho.innerHTML="<svg>"+p.valueOf().toString()+"</svg>",p=Ho.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;p.firstChild;)h.appendChild(p.firstChild)}});function Lo(h,p){if(p){var b=h.firstChild;if(b&&b===h.lastChild&&b.nodeType===3){b.nodeValue=p;return}}h.textContent=p}var co={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Os=["Webkit","ms","Moz","O"];Object.keys(co).forEach(function(h){Os.forEach(function(p){p=p+h.charAt(0).toUpperCase()+h.substring(1),co[p]=co[h]})});function ns(h,p,b){return p==null||typeof p=="boolean"||p===""?"":b||typeof p!="number"||p===0||co.hasOwnProperty(h)&&co[h]?(""+p).trim():p+"px"}function ms(h,p){h=h.style;for(var b in p)if(p.hasOwnProperty(b)){var C=b.indexOf("--")===0,z=ns(b,p[b],C);b==="float"&&(b="cssFloat"),C?h.setProperty(b,z):h[b]=z}}var ra=or({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function os(h,p){if(p){if(ra[h]&&(p.children!=null||p.dangerouslySetInnerHTML!=null))throw Error(Z(137,h));if(p.dangerouslySetInnerHTML!=null){if(p.children!=null)throw Error(Z(60));if(typeof p.dangerouslySetInnerHTML!="object"||!("__html"in p.dangerouslySetInnerHTML))throw Error(Z(61))}if(p.style!=null&&typeof p.style!="object")throw Error(Z(62))}}function ia(h,p){if(h.indexOf("-")===-1)return typeof p.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qi=null;function to(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var Es=null,so=null,xr=null;function Oi(h){if(h=qu(h)){if(typeof Es!="function")throw Error(Z(280));var p=h.stateNode;p&&(p=Dc(p),Es(h.stateNode,h.type,p))}}function un(h){so?xr?xr.push(h):xr=[h]:so=h}function Ot(){if(so){var h=so,p=xr;if(xr=so=null,Oi(h),p)for(h=0;h<p.length;h++)Oi(p[h])}}function pn(h,p){return h(p)}function gs(){}var ot=!1;function G(h,p,b){if(ot)return h(p,b);ot=!0;try{return pn(h,p,b)}finally{ot=!1,(so!==null||xr!==null)&&(gs(),Ot())}}function K(h,p){var b=h.stateNode;if(b===null)return null;var C=Dc(b);if(C===null)return null;b=C[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(h=h.type,C=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!C;break e;default:h=!1}if(h)return null;if(b&&typeof b!="function")throw Error(Z(231,p,typeof b));return b}var ge=!1;if(s)try{var Ce={};Object.defineProperty(Ce,"passive",{get:function(){ge=!0}}),window.addEventListener("test",Ce,Ce),window.removeEventListener("test",Ce,Ce)}catch{ge=!1}function Me(h,p,b,C,z,H,pe,He,lt){var Gt=Array.prototype.slice.call(arguments,3);try{p.apply(b,Gt)}catch(Ar){this.onError(Ar)}}var Re=!1,ke=null,Fe=!1,Qe=null,_t={onError:function(h){Re=!0,ke=h}};function Je(h,p,b,C,z,H,pe,He,lt){Re=!1,ke=null,Me.apply(_t,arguments)}function Ht(h,p,b,C,z,H,pe,He,lt){if(Je.apply(this,arguments),Re){if(Re){var Gt=ke;Re=!1,ke=null}else throw Error(Z(198));Fe||(Fe=!0,Qe=Gt)}}function Qt(h){var p=h,b=h;if(h.alternate)for(;p.return;)p=p.return;else{h=p;do p=h,(p.flags&4098)!==0&&(b=p.return),h=p.return;while(h)}return p.tag===3?b:null}function lr(h){if(h.tag===13){var p=h.memoizedState;if(p===null&&(h=h.alternate,h!==null&&(p=h.memoizedState)),p!==null)return p.dehydrated}return null}function Nr(h){if(Qt(h)!==h)throw Error(Z(188))}function Wr(h){var p=h.alternate;if(!p){if(p=Qt(h),p===null)throw Error(Z(188));return p!==h?null:h}for(var b=h,C=p;;){var z=b.return;if(z===null)break;var H=z.alternate;if(H===null){if(C=z.return,C!==null){b=C;continue}break}if(z.child===H.child){for(H=z.child;H;){if(H===b)return Nr(z),h;if(H===C)return Nr(z),p;H=H.sibling}throw Error(Z(188))}if(b.return!==C.return)b=z,C=H;else{for(var pe=!1,He=z.child;He;){if(He===b){pe=!0,b=z,C=H;break}if(He===C){pe=!0,C=z,b=H;break}He=He.sibling}if(!pe){for(He=H.child;He;){if(He===b){pe=!0,b=H,C=z;break}if(He===C){pe=!0,C=H,b=z;break}He=He.sibling}if(!pe)throw Error(Z(189))}}if(b.alternate!==C)throw Error(Z(190))}if(b.tag!==3)throw Error(Z(188));return b.stateNode.current===b?h:p}function Zr(h){return h=Wr(h),h!==null?Xr(h):null}function Xr(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var p=Xr(h);if(p!==null)return p;h=h.sibling}return null}var nn=Y.unstable_scheduleCallback,Jr=Y.unstable_cancelCallback,Wi=Y.unstable_shouldYield,Mi=Y.unstable_requestPaint,ii=Y.unstable_now,Pi=Y.unstable_getCurrentPriorityLevel,wn=Y.unstable_ImmediatePriority,On=Y.unstable_UserBlockingPriority,Vn=Y.unstable_NormalPriority,go=Y.unstable_LowPriority,$o=Y.unstable_IdlePriority,Gn=null,Fn=null;function Yn(h){if(Fn&&typeof Fn.onCommitFiberRoot=="function")try{Fn.onCommitFiberRoot(Gn,h,void 0,(h.current.flags&128)===128)}catch{}}var mn=Math.clz32?Math.clz32:$a,Is=Math.log,na=Math.LN2;function $a(h){return h>>>=0,h===0?32:31-(Is(h)/na|0)|0}var As=64,Sa=4194304;function Zs(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function Cs(h,p){var b=h.pendingLanes;if(b===0)return 0;var C=0,z=h.suspendedLanes,H=h.pingedLanes,pe=b&268435455;if(pe!==0){var He=pe&~z;He!==0?C=Zs(He):(H&=pe,H!==0&&(C=Zs(H)))}else pe=b&~z,pe!==0?C=Zs(pe):H!==0&&(C=Zs(H));if(C===0)return 0;if(p!==0&&p!==C&&(p&z)===0&&(z=C&-C,H=p&-p,z>=H||z===16&&(H&4194240)!==0))return p;if((C&4)!==0&&(C|=b&16),p=h.entangledLanes,p!==0)for(h=h.entanglements,p&=C;0<p;)b=31-mn(p),z=1<<b,C|=h[b],p&=~z;return C}function j(h,p){switch(h){case 1:case 2:case 4:return p+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function te(h,p){for(var b=h.suspendedLanes,C=h.pingedLanes,z=h.expirationTimes,H=h.pendingLanes;0<H;){var pe=31-mn(H),He=1<<pe,lt=z[pe];lt===-1?((He&b)===0||(He&C)!==0)&&(z[pe]=j(He,p)):lt<=p&&(h.expiredLanes|=He),H&=~He}}function we(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function Be(){var h=As;return As<<=1,(As&4194240)===0&&(As=64),h}function Ct(h){for(var p=[],b=0;31>b;b++)p.push(h);return p}function wt(h,p,b){h.pendingLanes|=p,p!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,p=31-mn(p),h[p]=b}function Yt(h,p){var b=h.pendingLanes&~p;h.pendingLanes=p,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=p,h.mutableReadLanes&=p,h.entangledLanes&=p,p=h.entanglements;var C=h.eventTimes;for(h=h.expirationTimes;0<b;){var z=31-mn(b),H=1<<z;p[z]=0,C[z]=-1,h[z]=-1,b&=~H}}function Cr(h,p){var b=h.entangledLanes|=p;for(h=h.entanglements;b;){var C=31-mn(b),z=1<<C;z&p|h[C]&p&&(h[C]|=p),b&=~z}}var kr=0;function mi(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var Vi,jn,bo,ss,as,Fs=!1,Hn=[],_s=null,Wo=null,ls=null,Bs=new Map,oa=new Map,sa=[],ki="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bl(h,p){switch(h){case"focusin":case"focusout":_s=null;break;case"dragenter":case"dragleave":Wo=null;break;case"mouseover":case"mouseout":ls=null;break;case"pointerover":case"pointerout":Bs.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":oa.delete(p.pointerId)}}function Ta(h,p,b,C,z,H){return h===null||h.nativeEvent!==H?(h={blockedOn:p,domEventName:b,eventSystemFlags:C,nativeEvent:H,targetContainers:[z]},p!==null&&(p=qu(p),p!==null&&jn(p)),h):(h.eventSystemFlags|=C,p=h.targetContainers,z!==null&&p.indexOf(z)===-1&&p.push(z),h)}function Vd(h,p,b,C,z){switch(p){case"focusin":return _s=Ta(_s,h,p,b,C,z),!0;case"dragenter":return Wo=Ta(Wo,h,p,b,C,z),!0;case"mouseover":return ls=Ta(ls,h,p,b,C,z),!0;case"pointerover":var H=z.pointerId;return Bs.set(H,Ta(Bs.get(H)||null,h,p,b,C,z)),!0;case"gotpointercapture":return H=z.pointerId,oa.set(H,Ta(oa.get(H)||null,h,p,b,C,z)),!0}return!1}function aa(h){var p=Zl(h.target);if(p!==null){var b=Qt(p);if(b!==null){if(p=b.tag,p===13){if(p=lr(b),p!==null){h.blockedOn=p,as(h.priority,function(){bo(b)});return}}else if(p===3&&b.stateNode.current.memoizedState.isDehydrated){h.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Xs(h){if(h.blockedOn!==null)return!1;for(var p=h.targetContainers;0<p.length;){var b=Ks(h.domEventName,h.eventSystemFlags,p[0],h.nativeEvent);if(b===null){b=h.nativeEvent;var C=new b.constructor(b.type,b);Qi=C,b.target.dispatchEvent(C),Qi=null}else return p=qu(b),p!==null&&jn(p),h.blockedOn=b,!1;p.shift()}return!0}function Ys(h,p,b){Xs(h)&&b.delete(p)}function Mn(){Fs=!1,_s!==null&&Xs(_s)&&(_s=null),Wo!==null&&Xs(Wo)&&(Wo=null),ls!==null&&Xs(ls)&&(ls=null),Bs.forEach(Ys),oa.forEach(Ys)}function Ea(h,p){h.blockedOn===p&&(h.blockedOn=null,Fs||(Fs=!0,Y.unstable_scheduleCallback(Y.unstable_NormalPriority,Mn)))}function Ia(h){function p(z){return Ea(z,h)}if(0<Hn.length){Ea(Hn[0],h);for(var b=1;b<Hn.length;b++){var C=Hn[b];C.blockedOn===h&&(C.blockedOn=null)}}for(_s!==null&&Ea(_s,h),Wo!==null&&Ea(Wo,h),ls!==null&&Ea(ls,h),Bs.forEach(p),oa.forEach(p),b=0;b<sa.length;b++)C=sa[b],C.blockedOn===h&&(C.blockedOn=null);for(;0<sa.length&&(b=sa[0],b.blockedOn===null);)aa(b),b.blockedOn===null&&sa.shift()}var us=st.ReactCurrentBatchConfig,ys=!0;function Wa(h,p,b,C){var z=kr,H=us.transition;us.transition=null;try{kr=1,su(h,p,b,C)}finally{kr=z,us.transition=H}}function Aa(h,p,b,C){var z=kr,H=us.transition;us.transition=null;try{kr=4,su(h,p,b,C)}finally{kr=z,us.transition=H}}function su(h,p,b,C){if(ys){var z=Ks(h,p,b,C);if(z===null)Hd(h,p,C,Co,b),Bl(h,C);else if(Vd(z,h,p,b,C))C.stopPropagation();else if(Bl(h,C),p&4&&-1<ki.indexOf(h)){for(;z!==null;){var H=qu(z);if(H!==null&&Vi(H),H=Ks(h,p,b,C),H===null&&Hd(h,p,C,Co,b),H===z)break;z=H}z!==null&&C.stopPropagation()}else Hd(h,p,C,null,b)}}var Co=null;function Ks(h,p,b,C){if(Co=null,h=to(C),h=Zl(h),h!==null)if(p=Qt(h),p===null)h=null;else if(b=p.tag,b===13){if(h=lr(p),h!==null)return h;h=null}else if(b===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;h=null}else p!==h&&(h=null);return Co=h,null}function Ou(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Pi()){case wn:return 1;case On:return 4;case Vn:case go:return 16;case $o:return 536870912;default:return 16}default:return 16}}var la=null,Nl=null,Ca=null;function vs(){if(Ca)return Ca;var h,p=Nl,b=p.length,C,z="value"in la?la.value:la.textContent,H=z.length;for(h=0;h<b&&p[h]===z[h];h++);var pe=b-h;for(C=1;C<=pe&&p[b-C]===z[H-C];C++);return Ca=z.slice(h,1<C?1-C:void 0)}function Za(h){var p=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&p===13&&(h=13)):h=p,h===10&&(h=13),32<=h||h===13?h:0}function hl(){return!0}function Xa(){return!1}function ai(h){function p(b,C,z,H,pe){this._reactName=b,this._targetInst=z,this.type=C,this.nativeEvent=H,this.target=pe,this.currentTarget=null;for(var He in h)h.hasOwnProperty(He)&&(b=h[He],this[He]=b?b(H):H[He]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?hl:Xa,this.isPropagationStopped=Xa,this}return or(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=hl)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=hl)},persist:function(){},isPersistent:hl}),p}var Vl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mr=ai(Vl),au=or({},Vl,{view:0,detail:0}),lu=ai(au),Ya,ua,Mo,ca=or({},au,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ka,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==Mo&&(Mo&&h.type==="mousemove"?(Ya=h.screenX-Mo.screenX,ua=h.screenY-Mo.screenY):ua=Ya=0,Mo=h),Ya)},movementY:function(h){return"movementY"in h?h.movementY:ua}}),Ma=ai(ca),Sr=or({},ca,{dataTransfer:0}),Hi=ai(Sr),xi=or({},au,{relatedTarget:0}),zo=ai(xi),Pa=or({},Vl,{animationName:0,elapsedTime:0,pseudoElement:0}),Ui=ai(Pa),dl=or({},Vl,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),fl=ai(dl),uu=or({},Vl,{data:0}),Oo=ai(uu),$n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_c={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yc(h){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(h):(h=cu[h])?!!p[h]:!1}function Ka(){return yc}var Ra=or({},au,{key:function(h){if(h.key){var p=$n[h.key]||h.key;if(p!=="Unidentified")return p}return h.type==="keypress"?(h=Za(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?_c[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ka,charCode:function(h){return h.type==="keypress"?Za(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?Za(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),Fu=ai(Ra),N=or({},ca,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Q=ai(N),ve=or({},au,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ka}),Oe=ai(ve),zt=or({},Vl,{propertyName:0,elapsedTime:0,pseudoElement:0}),xt=ai(zt),Xt=or({},ca,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),Ft=ai(Xt),Rt=[9,13,27,32],qi=s&&"CompositionEvent"in window,rr=null;s&&"documentMode"in document&&(rr=document.documentMode);var Pn=s&&"TextEvent"in window&&!rr,Po=s&&(!qi||rr&&8<rr&&11>=rr),Dr=" ",Ns=!1;function xs(h,p){switch(h){case"keyup":return Rt.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vc(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var ha=!1;function bs(h,p){switch(h){case"compositionend":return vc(p);case"keypress":return p.which!==32?null:(Ns=!0,Dr);case"textInput":return h=p.data,h===Dr&&Ns?null:h;default:return null}}function Ms(h,p){if(ha)return h==="compositionend"||!qi&&xs(h,p)?(h=vs(),Ca=Nl=la=null,ha=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return Po&&p.locale!=="ko"?null:p.data;default:return null}}var xc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jl(h){var p=h&&h.nodeName&&h.nodeName.toLowerCase();return p==="input"?!!xc[h.type]:p==="textarea"}function hu(h,p,b,C){un(C),p=Ac(p,"onChange"),0<p.length&&(b=new Mr("onChange","change",null,b,C),h.push({event:b,listeners:p}))}var Ja=null,Fo=null;function oh(h){Vf(h,0)}function du(h){var p=vu(h);if(xo(p))return h}function dp(h,p){if(h==="change")return p}var pl=!1;if(s){var sh;if(s){var Da="oninput"in document;if(!Da){var Xh=document.createElement("div");Xh.setAttribute("oninput","return;"),Da=typeof Xh.oninput=="function"}sh=Da}else sh=!1;pl=sh&&(!document.documentMode||9<document.documentMode)}function Ul(){Ja&&(Ja.detachEvent("onpropertychange",Of),Fo=Ja=null)}function Of(h){if(h.propertyName==="value"&&du(Fo)){var p=[];hu(p,Fo,h,to(h)),G(oh,p)}}function fp(h,p,b){h==="focusin"?(Ul(),Ja=p,Fo=b,Ja.attachEvent("onpropertychange",Of)):h==="focusout"&&Ul()}function Ff(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return du(Fo)}function Bf(h,p){if(h==="click")return du(p)}function pp(h,p){if(h==="input"||h==="change")return du(p)}function Yh(h,p){return h===p&&(h!==0||1/h===1/p)||h!==h&&p!==p}var ka=typeof Object.is=="function"?Object.is:Yh;function La(h,p){if(ka(h,p))return!0;if(typeof h!="object"||h===null||typeof p!="object"||p===null)return!1;var b=Object.keys(h),C=Object.keys(p);if(b.length!==C.length)return!1;for(C=0;C<b.length;C++){var z=b[C];if(!ne.call(p,z)||!ka(h[z],p[z]))return!1}return!0}function jd(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Ud(h,p){var b=jd(h);h=0;for(var C;b;){if(b.nodeType===3){if(C=h+b.textContent.length,h<=p&&C>=p)return{node:b,offset:p-h};h=C}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=jd(b)}}function ml(h,p){return h&&p?h===p?!0:h&&h.nodeType===3?!1:p&&p.nodeType===3?ml(h,p.parentNode):"contains"in h?h.contains(p):h.compareDocumentPosition?!!(h.compareDocumentPosition(p)&16):!1:!1}function bc(){for(var h=window,p=zi();p instanceof h.HTMLIFrameElement;){try{var b=typeof p.contentWindow.location.href=="string"}catch{b=!1}if(b)h=p.contentWindow;else break;p=zi(h.document)}return p}function ah(h){var p=h&&h.nodeName&&h.nodeName.toLowerCase();return p&&(p==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||p==="textarea"||h.contentEditable==="true")}function za(h){var p=bc(),b=h.focusedElem,C=h.selectionRange;if(p!==b&&b&&b.ownerDocument&&ml(b.ownerDocument.documentElement,b)){if(C!==null&&ah(b)){if(p=C.start,h=C.end,h===void 0&&(h=p),"selectionStart"in b)b.selectionStart=p,b.selectionEnd=Math.min(h,b.value.length);else if(h=(p=b.ownerDocument||document)&&p.defaultView||window,h.getSelection){h=h.getSelection();var z=b.textContent.length,H=Math.min(C.start,z);C=C.end===void 0?H:Math.min(C.end,z),!h.extend&&H>C&&(z=C,C=H,H=z),z=Ud(b,H);var pe=Ud(b,C);z&&pe&&(h.rangeCount!==1||h.anchorNode!==z.node||h.anchorOffset!==z.offset||h.focusNode!==pe.node||h.focusOffset!==pe.offset)&&(p=p.createRange(),p.setStart(z.node,z.offset),h.removeAllRanges(),H>C?(h.addRange(p),h.extend(pe.node,pe.offset)):(p.setEnd(pe.node,pe.offset),h.addRange(p)))}}for(p=[],h=b;h=h.parentNode;)h.nodeType===1&&p.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<p.length;b++)h=p[b],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var wc=s&&"documentMode"in document&&11>=document.documentMode,Qa=null,lh=null,fu=null,Vs=!1;function uh(h,p,b){var C=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;Vs||Qa==null||Qa!==zi(C)||(C=Qa,"selectionStart"in C&&ah(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),fu&&La(fu,C)||(fu=C,C=Ac(lh,"onSelect"),0<C.length&&(p=new Mr("onSelect","select",null,p,b),h.push({event:p,listeners:C}),p.target=Qa)))}function Wt(h,p){var b={};return b[h.toLowerCase()]=p.toLowerCase(),b["Webkit"+h]="webkit"+p,b["Moz"+h]="moz"+p,b}var pu={animationend:Wt("Animation","AnimationEnd"),animationiteration:Wt("Animation","AnimationIteration"),animationstart:Wt("Animation","AnimationStart"),transitionend:Wt("Transition","TransitionEnd")},Sc={},ch={};s&&(ch=document.createElement("div").style,"AnimationEvent"in window||(delete pu.animationend.animation,delete pu.animationiteration.animation,delete pu.animationstart.animation),"TransitionEvent"in window||delete pu.transitionend.transition);function Tc(h){if(Sc[h])return Sc[h];if(!pu[h])return h;var p=pu[h],b;for(b in p)if(p.hasOwnProperty(b)&&b in ch)return Sc[h]=p[b];return h}var mu=Tc("animationend"),da=Tc("animationiteration"),Bu=Tc("animationstart"),ql=Tc("transitionend"),Ec=new Map,gu="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fa(h,p){Ec.set(h,p),_e(p,[h])}for(var Ci=0;Ci<gu.length;Ci++){var hh=gu[Ci],mp=hh.toLowerCase(),Nf=hh[0].toUpperCase()+hh.slice(1);fa(mp,"on"+Nf)}fa(mu,"onAnimationEnd"),fa(da,"onAnimationIteration"),fa(Bu,"onAnimationStart"),fa("dblclick","onDoubleClick"),fa("focusin","onFocus"),fa("focusout","onBlur"),fa(ql,"onTransitionEnd"),be("onMouseEnter",["mouseout","mouseover"]),be("onMouseLeave",["mouseout","mouseover"]),be("onPointerEnter",["pointerout","pointerover"]),be("onPointerLeave",["pointerout","pointerover"]),_e("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),_e("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),_e("onBeforeInput",["compositionend","keypress","textInput","paste"]),_e("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),_e("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),_e("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Nu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qd=new Set("cancel close invalid load scroll toggle".split(" ").concat(Nu));function Rn(h,p,b){var C=h.type||"unknown-event";h.currentTarget=b,Ht(C,p,void 0,h),h.currentTarget=null}function Vf(h,p){p=(p&4)!==0;for(var b=0;b<h.length;b++){var C=h[b],z=C.event;C=C.listeners;e:{var H=void 0;if(p)for(var pe=C.length-1;0<=pe;pe--){var He=C[pe],lt=He.instance,Gt=He.currentTarget;if(He=He.listener,lt!==H&&z.isPropagationStopped())break e;Rn(z,He,Gt),H=lt}else for(pe=0;pe<C.length;pe++){if(He=C[pe],lt=He.instance,Gt=He.currentTarget,He=He.listener,lt!==H&&z.isPropagationStopped())break e;Rn(z,He,Gt),H=lt}}}if(Fe)throw h=Qe,Fe=!1,Qe=null,h}function ho(h,p){var b=p[mh];b===void 0&&(b=p[mh]=new Set);var C=h+"__bubble";b.has(C)||(ph(p,h,2,!1),b.add(C))}function Gd(h,p,b){var C=0;p&&(C|=4),ph(b,h,C,p)}var dh="_reactListening"+Math.random().toString(36).slice(2);function fh(h){if(!h[dh]){h[dh]=!0,Ee.forEach(function(b){b!=="selectionchange"&&(qd.has(b)||Gd(b,!1,h),Gd(b,!0,h))});var p=h.nodeType===9?h:h.ownerDocument;p===null||p[dh]||(p[dh]=!0,Gd("selectionchange",!1,p))}}function ph(h,p,b,C){switch(Ou(p)){case 1:var z=Wa;break;case 4:z=Aa;break;default:z=su}b=z.bind(null,p,b,h),z=void 0,!ge||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(z=!0),C?z!==void 0?h.addEventListener(p,b,{capture:!0,passive:z}):h.addEventListener(p,b,!0):z!==void 0?h.addEventListener(p,b,{passive:z}):h.addEventListener(p,b,!1)}function Hd(h,p,b,C,z){var H=C;if((p&1)===0&&(p&2)===0&&C!==null)e:for(;;){if(C===null)return;var pe=C.tag;if(pe===3||pe===4){var He=C.stateNode.containerInfo;if(He===z||He.nodeType===8&&He.parentNode===z)break;if(pe===4)for(pe=C.return;pe!==null;){var lt=pe.tag;if((lt===3||lt===4)&&(lt=pe.stateNode.containerInfo,lt===z||lt.nodeType===8&&lt.parentNode===z))return;pe=pe.return}for(;He!==null;){if(pe=Zl(He),pe===null)return;if(lt=pe.tag,lt===5||lt===6){C=H=pe;continue e}He=He.parentNode}}C=C.return}G(function(){var Gt=H,Ar=to(b),Rr=[];e:{var Er=Ec.get(h);if(Er!==void 0){var Yr=Mr,ui=h;switch(h){case"keypress":if(Za(b)===0)break e;case"keydown":case"keyup":Yr=Fu;break;case"focusin":ui="focus",Yr=zo;break;case"focusout":ui="blur",Yr=zo;break;case"beforeblur":case"afterblur":Yr=zo;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Yr=Ma;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Yr=Hi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Yr=Oe;break;case mu:case da:case Bu:Yr=Ui;break;case ql:Yr=xt;break;case"scroll":Yr=lu;break;case"wheel":Yr=Ft;break;case"copy":case"cut":case"paste":Yr=fl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Yr=Q}var gi=(p&4)!==0,qo=!gi&&h==="scroll",kt=gi?Er!==null?Er+"Capture":null:Er;gi=[];for(var gt=Gt,Lt;gt!==null;){Lt=gt;var br=Lt.stateNode;if(Lt.tag===5&&br!==null&&(Lt=br,kt!==null&&(br=K(gt,kt),br!=null&&gi.push(Ic(gt,br,Lt)))),qo)break;gt=gt.return}0<gi.length&&(Er=new Yr(Er,ui,null,b,Ar),Rr.push({event:Er,listeners:gi}))}}if((p&7)===0){e:{if(Er=h==="mouseover"||h==="pointerover",Yr=h==="mouseout"||h==="pointerout",Er&&b!==Qi&&(ui=b.relatedTarget||b.fromElement)&&(Zl(ui)||ui[Wl]))break e;if((Yr||Er)&&(Er=Ar.window===Ar?Ar:(Er=Ar.ownerDocument)?Er.defaultView||Er.parentWindow:window,Yr?(ui=b.relatedTarget||b.toElement,Yr=Gt,ui=ui?Zl(ui):null,ui!==null&&(qo=Qt(ui),ui!==qo||ui.tag!==5&&ui.tag!==6)&&(ui=null)):(Yr=null,ui=Gt),Yr!==ui)){if(gi=Ma,br="onMouseLeave",kt="onMouseEnter",gt="mouse",(h==="pointerout"||h==="pointerover")&&(gi=Q,br="onPointerLeave",kt="onPointerEnter",gt="pointer"),qo=Yr==null?Er:vu(Yr),Lt=ui==null?Er:vu(ui),Er=new gi(br,gt+"leave",Yr,b,Ar),Er.target=qo,Er.relatedTarget=Lt,br=null,Zl(Ar)===Gt&&(gi=new gi(kt,gt+"enter",ui,b,Ar),gi.target=Lt,gi.relatedTarget=qo,br=gi),qo=br,Yr&&ui)t:{for(gi=Yr,kt=ui,gt=0,Lt=gi;Lt;Lt=Gl(Lt))gt++;for(Lt=0,br=kt;br;br=Gl(br))Lt++;for(;0<gt-Lt;)gi=Gl(gi),gt--;for(;0<Lt-gt;)kt=Gl(kt),Lt--;for(;gt--;){if(gi===kt||kt!==null&&gi===kt.alternate)break t;gi=Gl(gi),kt=Gl(kt)}gi=null}else gi=null;Yr!==null&&Kh(Rr,Er,Yr,gi,!1),ui!==null&&qo!==null&&Kh(Rr,qo,ui,gi,!0)}}e:{if(Er=Gt?vu(Gt):window,Yr=Er.nodeName&&Er.nodeName.toLowerCase(),Yr==="select"||Yr==="input"&&Er.type==="file")var vi=dp;else if(jl(Er))if(pl)vi=pp;else{vi=Ff;var Ri=fp}else(Yr=Er.nodeName)&&Yr.toLowerCase()==="input"&&(Er.type==="checkbox"||Er.type==="radio")&&(vi=Bf);if(vi&&(vi=vi(h,Gt))){hu(Rr,vi,b,Ar);break e}Ri&&Ri(h,Er,Gt),h==="focusout"&&(Ri=Er._wrapperState)&&Ri.controlled&&Er.type==="number"&&eo(Er,"number",Er.value)}switch(Ri=Gt?vu(Gt):window,h){case"focusin":(jl(Ri)||Ri.contentEditable==="true")&&(Qa=Ri,lh=Gt,fu=null);break;case"focusout":fu=lh=Qa=null;break;case"mousedown":Vs=!0;break;case"contextmenu":case"mouseup":case"dragend":Vs=!1,uh(Rr,b,Ar);break;case"selectionchange":if(wc)break;case"keydown":case"keyup":uh(Rr,b,Ar)}var Bi;if(qi)e:{switch(h){case"compositionstart":var $i="onCompositionStart";break e;case"compositionend":$i="onCompositionEnd";break e;case"compositionupdate":$i="onCompositionUpdate";break e}$i=void 0}else ha?xs(h,b)&&($i="onCompositionEnd"):h==="keydown"&&b.keyCode===229&&($i="onCompositionStart");$i&&(Po&&b.locale!=="ko"&&(ha||$i!=="onCompositionStart"?$i==="onCompositionEnd"&&ha&&(Bi=vs()):(la=Ar,Nl="value"in la?la.value:la.textContent,ha=!0)),Ri=Ac(Gt,$i),0<Ri.length&&($i=new Oo($i,h,null,b,Ar),Rr.push({event:$i,listeners:Ri}),Bi?$i.data=Bi:(Bi=vc(b),Bi!==null&&($i.data=Bi)))),(Bi=Pn?bs(h,b):Ms(h,b))&&(Gt=Ac(Gt,"onBeforeInput"),0<Gt.length&&(Ar=new Oo("onBeforeInput","beforeinput",null,b,Ar),Rr.push({event:Ar,listeners:Gt}),Ar.data=Bi))}Vf(Rr,p)})}function Ic(h,p,b){return{instance:h,listener:p,currentTarget:b}}function Ac(h,p){for(var b=p+"Capture",C=[];h!==null;){var z=h,H=z.stateNode;z.tag===5&&H!==null&&(z=H,H=K(h,b),H!=null&&C.unshift(Ic(h,H,z)),H=K(h,p),H!=null&&C.push(Ic(h,H,z))),h=h.return}return C}function Gl(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function Kh(h,p,b,C,z){for(var H=p._reactName,pe=[];b!==null&&b!==C;){var He=b,lt=He.alternate,Gt=He.stateNode;if(lt!==null&&lt===C)break;He.tag===5&&Gt!==null&&(He=Gt,z?(lt=K(b,H),lt!=null&&pe.unshift(Ic(b,lt,He))):z||(lt=K(b,H),lt!=null&&pe.push(Ic(b,lt,He)))),b=b.return}pe.length!==0&&h.push({event:p,listeners:pe})}var Vu=/\r\n?/g,$d=/\u0000|\uFFFD/g;function Wd(h){return(typeof h=="string"?h:""+h).replace(Vu,`
`).replace($d,"")}function Hl(h,p,b){if(p=Wd(p),Wd(h)!==p&&b)throw Error(Z(425))}function _u(){}var Cc=null,Mc=null;function yu(h,p){return h==="textarea"||h==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var Pc=typeof setTimeout=="function"?setTimeout:void 0,Zd=typeof clearTimeout=="function"?clearTimeout:void 0,Xd=typeof Promise=="function"?Promise:void 0,Yd=typeof queueMicrotask=="function"?queueMicrotask:typeof Xd<"u"?function(h){return Xd.resolve(null).then(h).catch(Jh)}:Pc;function Jh(h){setTimeout(function(){throw h})}function ju(h,p){var b=p,C=0;do{var z=b.nextSibling;if(h.removeChild(b),z&&z.nodeType===8)if(b=z.data,b==="/$"){if(C===0){h.removeChild(z),Ia(p);return}C--}else b!=="$"&&b!=="$?"&&b!=="$!"||C++;b=z}while(b);Ia(p)}function $l(h){for(;h!=null;h=h.nextSibling){var p=h.nodeType;if(p===1||p===3)break;if(p===8){if(p=h.data,p==="$"||p==="$!"||p==="$?")break;if(p==="/$")return null}}return h}function Kd(h){h=h.previousSibling;for(var p=0;h;){if(h.nodeType===8){var b=h.data;if(b==="$"||b==="$!"||b==="$?"){if(p===0)return h;p--}else b==="/$"&&p++}h=h.previousSibling}return null}var Uu=Math.random().toString(36).slice(2),js="__reactFiber$"+Uu,Rc="__reactProps$"+Uu,Wl="__reactContainer$"+Uu,mh="__reactEvents$"+Uu,gp="__reactListeners$"+Uu,Qh="__reactHandles$"+Uu;function Zl(h){var p=h[js];if(p)return p;for(var b=h.parentNode;b;){if(p=b[Wl]||b[js]){if(b=p.alternate,p.child!==null||b!==null&&b.child!==null)for(h=Kd(h);h!==null;){if(b=h[js])return b;h=Kd(h)}return p}h=b,b=h.parentNode}return null}function qu(h){return h=h[js]||h[Wl],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function vu(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(Z(33))}function Dc(h){return h[Rc]||null}var gh=[],el=-1;function pa(h){return{current:h}}function Un(h){0>el||(h.current=gh[el],gh[el]=null,el--)}function ro(h,p){el++,gh[el]=h.current,h.current=p}var wo={},Bo=pa(wo),ws=pa(!1),gl=wo;function Xl(h,p){var b=h.type.contextTypes;if(!b)return wo;var C=h.stateNode;if(C&&C.__reactInternalMemoizedUnmaskedChildContext===p)return C.__reactInternalMemoizedMaskedChildContext;var z={},H;for(H in b)z[H]=p[H];return C&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=p,h.__reactInternalMemoizedMaskedChildContext=z),z}function Ss(h){return h=h.childContextTypes,h!=null}function kc(){Un(ws),Un(Bo)}function _h(h,p,b){if(Bo.current!==wo)throw Error(Z(168));ro(Bo,p),ro(ws,b)}function ed(h,p,b){var C=h.stateNode;if(p=p.childContextTypes,typeof C.getChildContext!="function")return b;C=C.getChildContext();for(var z in C)if(!(z in p))throw Error(Z(108,pi(h)||"Unknown",z));return or({},b,C)}function Gu(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||wo,gl=Bo.current,ro(Bo,h),ro(ws,ws.current),!0}function Lc(h,p,b){var C=h.stateNode;if(!C)throw Error(Z(169));b?(h=ed(h,p,gl),C.__reactInternalMemoizedMergedChildContext=h,Un(ws),Un(Bo),ro(Bo,h)):Un(ws),ro(ws,b)}var ma=null,yh=!1,Yl=!1;function jf(h){ma===null?ma=[h]:ma.push(h)}function _p(h){yh=!0,jf(h)}function Kl(){if(!Yl&&ma!==null){Yl=!0;var h=0,p=kr;try{var b=ma;for(kr=1;h<b.length;h++){var C=b[h];do C=C(!0);while(C!==null)}ma=null,yh=!1}catch(z){throw ma!==null&&(ma=ma.slice(h+1)),nn(wn,Kl),z}finally{kr=p,Yl=!1}}return null}var Hu=[],zc=0,td=null,Oc=0,Ps=[],ga=0,_a=null,_l=1,yl="";function Jl(h,p){Hu[zc++]=Oc,Hu[zc++]=td,td=h,Oc=p}function vh(h,p,b){Ps[ga++]=_l,Ps[ga++]=yl,Ps[ga++]=_a,_a=h;var C=_l;h=yl;var z=32-mn(C)-1;C&=~(1<<z),b+=1;var H=32-mn(p)+z;if(30<H){var pe=z-z%5;H=(C&(1<<pe)-1).toString(32),C>>=pe,z-=pe,_l=1<<32-mn(p)+z|b<<z|C,yl=H+h}else _l=1<<H|b<<z|C,yl=h}function vl(h){h.return!==null&&(Jl(h,1),vh(h,1,0))}function rd(h){for(;h===td;)td=Hu[--zc],Hu[zc]=null,Oc=Hu[--zc],Hu[zc]=null;for(;h===_a;)_a=Ps[--ga],Ps[ga]=null,yl=Ps[--ga],Ps[ga]=null,_l=Ps[--ga],Ps[ga]=null}var fo=null,Us=null,io=!1,Oa=null;function id(h,p){var b=Ro(5,null,null,0);b.elementType="DELETED",b.stateNode=p,b.return=h,p=h.deletions,p===null?(h.deletions=[b],h.flags|=16):p.push(b)}function xh(h,p){switch(h.tag){case 5:var b=h.type;return p=p.nodeType!==1||b.toLowerCase()!==p.nodeName.toLowerCase()?null:p,p!==null?(h.stateNode=p,fo=h,Us=$l(p.firstChild),!0):!1;case 6:return p=h.pendingProps===""||p.nodeType!==3?null:p,p!==null?(h.stateNode=p,fo=h,Us=null,!0):!1;case 13:return p=p.nodeType!==8?null:p,p!==null?(b=_a!==null?{id:_l,overflow:yl}:null,h.memoizedState={dehydrated:p,treeContext:b,retryLane:1073741824},b=Ro(18,null,null,0),b.stateNode=p,b.return=h,h.child=b,fo=h,Us=null,!0):!1;default:return!1}}function Fc(h){return(h.mode&1)!==0&&(h.flags&128)===0}function nd(h){if(io){var p=Us;if(p){var b=p;if(!xh(h,p)){if(Fc(h))throw Error(Z(418));p=$l(b.nextSibling);var C=fo;p&&xh(h,p)?id(C,b):(h.flags=h.flags&-4097|2,io=!1,fo=h)}}else{if(Fc(h))throw Error(Z(418));h.flags=h.flags&-4097|2,io=!1,fo=h}}}function bh(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;fo=h}function xl(h){if(h!==fo)return!1;if(!io)return bh(h),io=!0,!1;var p;if((p=h.tag!==3)&&!(p=h.tag!==5)&&(p=h.type,p=p!=="head"&&p!=="body"&&!yu(h.type,h.memoizedProps)),p&&(p=Us)){if(Fc(h))throw Jd(),Error(Z(418));for(;p;)id(h,p),p=$l(p.nextSibling)}if(bh(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(Z(317));e:{for(h=h.nextSibling,p=0;h;){if(h.nodeType===8){var b=h.data;if(b==="/$"){if(p===0){Us=$l(h.nextSibling);break e}p--}else b!=="$"&&b!=="$!"&&b!=="$?"||p++}h=h.nextSibling}Us=null}}else Us=fo?$l(h.stateNode.nextSibling):null;return!0}function Jd(){for(var h=Us;h;)h=$l(h.nextSibling)}function Bc(){Us=fo=null,io=!1}function tl(h){Oa===null?Oa=[h]:Oa.push(h)}var yp=st.ReactCurrentBatchConfig;function $u(h,p,b){if(h=b.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(Z(309));var C=b.stateNode}if(!C)throw Error(Z(147,h));var z=C,H=""+h;return p!==null&&p.ref!==null&&typeof p.ref=="function"&&p.ref._stringRef===H?p.ref:(p=function(pe){var He=z.refs;pe===null?delete He[H]:He[H]=pe},p._stringRef=H,p)}if(typeof h!="string")throw Error(Z(284));if(!b._owner)throw Error(Z(290,h))}return h}function Wu(h,p){throw h=Object.prototype.toString.call(p),Error(Z(31,h==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":h))}function Zu(h){var p=h._init;return p(h._payload)}function xu(h){function p(kt,gt){if(h){var Lt=kt.deletions;Lt===null?(kt.deletions=[gt],kt.flags|=16):Lt.push(gt)}}function b(kt,gt){if(!h)return null;for(;gt!==null;)p(kt,gt),gt=gt.sibling;return null}function C(kt,gt){for(kt=new Map;gt!==null;)gt.key!==null?kt.set(gt.key,gt):kt.set(gt.index,gt),gt=gt.sibling;return kt}function z(kt,gt){return kt=wa(kt,gt),kt.index=0,kt.sibling=null,kt}function H(kt,gt,Lt){return kt.index=Lt,h?(Lt=kt.alternate,Lt!==null?(Lt=Lt.index,Lt<gt?(kt.flags|=2,gt):Lt):(kt.flags|=2,gt)):(kt.flags|=1048576,gt)}function pe(kt){return h&&kt.alternate===null&&(kt.flags|=2),kt}function He(kt,gt,Lt,br){return gt===null||gt.tag!==6?(gt=Kc(Lt,kt.mode,br),gt.return=kt,gt):(gt=z(gt,Lt),gt.return=kt,gt)}function lt(kt,gt,Lt,br){var vi=Lt.type;return vi===St?Ar(kt,gt,Lt.props.children,br,Lt.key):gt!==null&&(gt.elementType===vi||typeof vi=="object"&&vi!==null&&vi.$$typeof===ri&&Zu(vi)===gt.type)?(br=z(gt,Lt.props),br.ref=$u(kt,gt,Lt),br.return=kt,br):(br=Dl(Lt.type,Lt.key,Lt.props,null,kt.mode,br),br.ref=$u(kt,gt,Lt),br.return=kt,br)}function Gt(kt,gt,Lt,br){return gt===null||gt.tag!==4||gt.stateNode.containerInfo!==Lt.containerInfo||gt.stateNode.implementation!==Lt.implementation?(gt=sc(Lt,kt.mode,br),gt.return=kt,gt):(gt=z(gt,Lt.children||[]),gt.return=kt,gt)}function Ar(kt,gt,Lt,br,vi){return gt===null||gt.tag!==7?(gt=kl(Lt,kt.mode,br,vi),gt.return=kt,gt):(gt=z(gt,Lt),gt.return=kt,gt)}function Rr(kt,gt,Lt){if(typeof gt=="string"&&gt!==""||typeof gt=="number")return gt=Kc(""+gt,kt.mode,Lt),gt.return=kt,gt;if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case $e:return Lt=Dl(gt.type,gt.key,gt.props,null,kt.mode,Lt),Lt.ref=$u(kt,null,gt),Lt.return=kt,Lt;case bt:return gt=sc(gt,kt.mode,Lt),gt.return=kt,gt;case ri:var br=gt._init;return Rr(kt,br(gt._payload),Lt)}if(po(gt)||Lr(gt))return gt=kl(gt,kt.mode,Lt,null),gt.return=kt,gt;Wu(kt,gt)}return null}function Er(kt,gt,Lt,br){var vi=gt!==null?gt.key:null;if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return vi!==null?null:He(kt,gt,""+Lt,br);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case $e:return Lt.key===vi?lt(kt,gt,Lt,br):null;case bt:return Lt.key===vi?Gt(kt,gt,Lt,br):null;case ri:return vi=Lt._init,Er(kt,gt,vi(Lt._payload),br)}if(po(Lt)||Lr(Lt))return vi!==null?null:Ar(kt,gt,Lt,br,null);Wu(kt,Lt)}return null}function Yr(kt,gt,Lt,br,vi){if(typeof br=="string"&&br!==""||typeof br=="number")return kt=kt.get(Lt)||null,He(gt,kt,""+br,vi);if(typeof br=="object"&&br!==null){switch(br.$$typeof){case $e:return kt=kt.get(br.key===null?Lt:br.key)||null,lt(gt,kt,br,vi);case bt:return kt=kt.get(br.key===null?Lt:br.key)||null,Gt(gt,kt,br,vi);case ri:var Ri=br._init;return Yr(kt,gt,Lt,Ri(br._payload),vi)}if(po(br)||Lr(br))return kt=kt.get(Lt)||null,Ar(gt,kt,br,vi,null);Wu(gt,br)}return null}function ui(kt,gt,Lt,br){for(var vi=null,Ri=null,Bi=gt,$i=gt=0,Ds=null;Bi!==null&&$i<Lt.length;$i++){Bi.index>$i?(Ds=Bi,Bi=null):Ds=Bi.sibling;var qn=Er(kt,Bi,Lt[$i],br);if(qn===null){Bi===null&&(Bi=Ds);break}h&&Bi&&qn.alternate===null&&p(kt,Bi),gt=H(qn,gt,$i),Ri===null?vi=qn:Ri.sibling=qn,Ri=qn,Bi=Ds}if($i===Lt.length)return b(kt,Bi),io&&Jl(kt,$i),vi;if(Bi===null){for(;$i<Lt.length;$i++)Bi=Rr(kt,Lt[$i],br),Bi!==null&&(gt=H(Bi,gt,$i),Ri===null?vi=Bi:Ri.sibling=Bi,Ri=Bi);return io&&Jl(kt,$i),vi}for(Bi=C(kt,Bi);$i<Lt.length;$i++)Ds=Yr(Bi,kt,$i,Lt[$i],br),Ds!==null&&(h&&Ds.alternate!==null&&Bi.delete(Ds.key===null?$i:Ds.key),gt=H(Ds,gt,$i),Ri===null?vi=Ds:Ri.sibling=Ds,Ri=Ds);return h&&Bi.forEach(function(Ll){return p(kt,Ll)}),io&&Jl(kt,$i),vi}function gi(kt,gt,Lt,br){var vi=Lr(Lt);if(typeof vi!="function")throw Error(Z(150));if(Lt=vi.call(Lt),Lt==null)throw Error(Z(151));for(var Ri=vi=null,Bi=gt,$i=gt=0,Ds=null,qn=Lt.next();Bi!==null&&!qn.done;$i++,qn=Lt.next()){Bi.index>$i?(Ds=Bi,Bi=null):Ds=Bi.sibling;var Ll=Er(kt,Bi,qn.value,br);if(Ll===null){Bi===null&&(Bi=Ds);break}h&&Bi&&Ll.alternate===null&&p(kt,Bi),gt=H(Ll,gt,$i),Ri===null?vi=Ll:Ri.sibling=Ll,Ri=Ll,Bi=Ds}if(qn.done)return b(kt,Bi),io&&Jl(kt,$i),vi;if(Bi===null){for(;!qn.done;$i++,qn=Lt.next())qn=Rr(kt,qn.value,br),qn!==null&&(gt=H(qn,gt,$i),Ri===null?vi=qn:Ri.sibling=qn,Ri=qn);return io&&Jl(kt,$i),vi}for(Bi=C(kt,Bi);!qn.done;$i++,qn=Lt.next())qn=Yr(Bi,kt,$i,qn.value,br),qn!==null&&(h&&qn.alternate!==null&&Bi.delete(qn.key===null?$i:qn.key),gt=H(qn,gt,$i),Ri===null?vi=qn:Ri.sibling=qn,Ri=qn);return h&&Bi.forEach(function(_m){return p(kt,_m)}),io&&Jl(kt,$i),vi}function qo(kt,gt,Lt,br){if(typeof Lt=="object"&&Lt!==null&&Lt.type===St&&Lt.key===null&&(Lt=Lt.props.children),typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case $e:e:{for(var vi=Lt.key,Ri=gt;Ri!==null;){if(Ri.key===vi){if(vi=Lt.type,vi===St){if(Ri.tag===7){b(kt,Ri.sibling),gt=z(Ri,Lt.props.children),gt.return=kt,kt=gt;break e}}else if(Ri.elementType===vi||typeof vi=="object"&&vi!==null&&vi.$$typeof===ri&&Zu(vi)===Ri.type){b(kt,Ri.sibling),gt=z(Ri,Lt.props),gt.ref=$u(kt,Ri,Lt),gt.return=kt,kt=gt;break e}b(kt,Ri);break}else p(kt,Ri);Ri=Ri.sibling}Lt.type===St?(gt=kl(Lt.props.children,kt.mode,br,Lt.key),gt.return=kt,kt=gt):(br=Dl(Lt.type,Lt.key,Lt.props,null,kt.mode,br),br.ref=$u(kt,gt,Lt),br.return=kt,kt=br)}return pe(kt);case bt:e:{for(Ri=Lt.key;gt!==null;){if(gt.key===Ri)if(gt.tag===4&&gt.stateNode.containerInfo===Lt.containerInfo&&gt.stateNode.implementation===Lt.implementation){b(kt,gt.sibling),gt=z(gt,Lt.children||[]),gt.return=kt,kt=gt;break e}else{b(kt,gt);break}else p(kt,gt);gt=gt.sibling}gt=sc(Lt,kt.mode,br),gt.return=kt,kt=gt}return pe(kt);case ri:return Ri=Lt._init,qo(kt,gt,Ri(Lt._payload),br)}if(po(Lt))return ui(kt,gt,Lt,br);if(Lr(Lt))return gi(kt,gt,Lt,br);Wu(kt,Lt)}return typeof Lt=="string"&&Lt!==""||typeof Lt=="number"?(Lt=""+Lt,gt!==null&&gt.tag===6?(b(kt,gt.sibling),gt=z(gt,Lt),gt.return=kt,kt=gt):(b(kt,gt),gt=Kc(Lt,kt.mode,br),gt.return=kt,kt=gt),pe(kt)):b(kt,gt)}return qo}var rl=xu(!0),Nc=xu(!1),bu=pa(null),Xu=null,wu=null,Vc=null;function wh(){Vc=wu=Xu=null}function Su(h){var p=bu.current;Un(bu),h._currentValue=p}function Yu(h,p,b){for(;h!==null;){var C=h.alternate;if((h.childLanes&p)!==p?(h.childLanes|=p,C!==null&&(C.childLanes|=p)):C!==null&&(C.childLanes&p)!==p&&(C.childLanes|=p),h===b)break;h=h.return}}function ir(h,p){Xu=h,Vc=wu=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&p)!==0&&(Zo=!0),h.firstContext=null)}function Rs(h){var p=h._currentValue;if(Vc!==h)if(h={context:h,memoizedValue:p,next:null},wu===null){if(Xu===null)throw Error(Z(308));wu=h,Xu.dependencies={lanes:0,firstContext:h}}else wu=wu.next=h;return p}var ya=null;function bl(h){ya===null?ya=[h]:ya.push(h)}function Ql(h,p,b,C){var z=p.interleaved;return z===null?(b.next=b,bl(p)):(b.next=z.next,z.next=b),p.interleaved=b,Pr(h,C)}function Pr(h,p){h.lanes|=p;var b=h.alternate;for(b!==null&&(b.lanes|=p),b=h,h=h.return;h!==null;)h.childLanes|=p,b=h.alternate,b!==null&&(b.childLanes|=p),b=h,h=h.return;return b.tag===3?b.stateNode:null}var wl=!1;function Qd(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ef(h,p){h=h.updateQueue,p.updateQueue===h&&(p.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function va(h,p){return{eventTime:h,lane:p,tag:0,payload:null,callback:null,next:null}}function eu(h,p,b){var C=h.updateQueue;if(C===null)return null;if(C=C.shared,(U&2)!==0){var z=C.pending;return z===null?p.next=p:(p.next=z.next,z.next=p),C.pending=p,Pr(h,b)}return z=C.interleaved,z===null?(p.next=p,bl(C)):(p.next=z.next,z.next=p),C.interleaved=p,Pr(h,b)}function od(h,p,b){if(p=p.updateQueue,p!==null&&(p=p.shared,(b&4194240)!==0)){var C=p.lanes;C&=h.pendingLanes,b|=C,p.lanes=b,Cr(h,b)}}function tf(h,p){var b=h.updateQueue,C=h.alternate;if(C!==null&&(C=C.updateQueue,b===C)){var z=null,H=null;if(b=b.firstBaseUpdate,b!==null){do{var pe={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};H===null?z=H=pe:H=H.next=pe,b=b.next}while(b!==null);H===null?z=H=p:H=H.next=p}else z=H=p;b={baseState:C.baseState,firstBaseUpdate:z,lastBaseUpdate:H,shared:C.shared,effects:C.effects},h.updateQueue=b;return}h=b.lastBaseUpdate,h===null?b.firstBaseUpdate=p:h.next=p,b.lastBaseUpdate=p}function sd(h,p,b,C){var z=h.updateQueue;wl=!1;var H=z.firstBaseUpdate,pe=z.lastBaseUpdate,He=z.shared.pending;if(He!==null){z.shared.pending=null;var lt=He,Gt=lt.next;lt.next=null,pe===null?H=Gt:pe.next=Gt,pe=lt;var Ar=h.alternate;Ar!==null&&(Ar=Ar.updateQueue,He=Ar.lastBaseUpdate,He!==pe&&(He===null?Ar.firstBaseUpdate=Gt:He.next=Gt,Ar.lastBaseUpdate=lt))}if(H!==null){var Rr=z.baseState;pe=0,Ar=Gt=lt=null,He=H;do{var Er=He.lane,Yr=He.eventTime;if((C&Er)===Er){Ar!==null&&(Ar=Ar.next={eventTime:Yr,lane:0,tag:He.tag,payload:He.payload,callback:He.callback,next:null});e:{var ui=h,gi=He;switch(Er=p,Yr=b,gi.tag){case 1:if(ui=gi.payload,typeof ui=="function"){Rr=ui.call(Yr,Rr,Er);break e}Rr=ui;break e;case 3:ui.flags=ui.flags&-65537|128;case 0:if(ui=gi.payload,Er=typeof ui=="function"?ui.call(Yr,Rr,Er):ui,Er==null)break e;Rr=or({},Rr,Er);break e;case 2:wl=!0}}He.callback!==null&&He.lane!==0&&(h.flags|=64,Er=z.effects,Er===null?z.effects=[He]:Er.push(He))}else Yr={eventTime:Yr,lane:Er,tag:He.tag,payload:He.payload,callback:He.callback,next:null},Ar===null?(Gt=Ar=Yr,lt=Rr):Ar=Ar.next=Yr,pe|=Er;if(He=He.next,He===null){if(He=z.shared.pending,He===null)break;Er=He,He=Er.next,Er.next=null,z.lastBaseUpdate=Er,z.shared.pending=null}}while(!0);if(Ar===null&&(lt=Rr),z.baseState=lt,z.firstBaseUpdate=Gt,z.lastBaseUpdate=Ar,p=z.shared.interleaved,p!==null){z=p;do pe|=z.lane,z=z.next;while(z!==p)}else H===null&&(z.shared.lanes=0);Te|=pe,h.lanes=pe,h.memoizedState=Rr}}function Uf(h,p,b){if(h=p.effects,p.effects=null,h!==null)for(p=0;p<h.length;p++){var C=h[p],z=C.callback;if(z!==null){if(C.callback=null,C=b,typeof z!="function")throw Error(Z(191,z));z.call(C)}}}var Ku={},Fa=pa(Ku),Ju=pa(Ku),Qu=pa(Ku);function No(h){if(h===Ku)throw Error(Z(174));return h}function Sl(h,p){switch(ro(Qu,p),ro(Ju,h),ro(Fa,Ku),h=p.nodeType,h){case 9:case 11:p=(p=p.documentElement)?p.namespaceURI:ps(null,"");break;default:h=h===8?p.parentNode:p,p=h.namespaceURI||null,h=h.tagName,p=ps(p,h)}Un(Fa),ro(Fa,p)}function Ba(){Un(Fa),Un(Ju),Un(Qu)}function Sh(h){No(Qu.current);var p=No(Fa.current),b=ps(p,h.type);p!==b&&(ro(Ju,h),ro(Fa,b))}function jc(h){Ju.current===h&&(Un(Fa),Un(Ju))}var Kn=pa(0);function Th(h){for(var p=h;p!==null;){if(p.tag===13){var b=p.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===h)break;for(;p.sibling===null;){if(p.return===null||p.return===h)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var Js=[];function Zi(){for(var h=0;h<Js.length;h++)Js[h]._workInProgressVersionPrimary=null;Js.length=0}var Tu=st.ReactCurrentDispatcher,Tl=st.ReactCurrentBatchConfig,Eu=0,_o=null,Vo=null,cs=null,tu=!1,il=!1,Ut=0,ar=0;function So(){throw Error(Z(321))}function kn(h,p){if(p===null)return!1;for(var b=0;b<p.length&&b<h.length;b++)if(!ka(h[b],p[b]))return!1;return!0}function Ze(h,p,b,C,z,H){if(Eu=H,_o=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,Tu.current=h===null||h.memoizedState===null?ic:Wc,h=b(C,z),il){H=0;do{if(il=!1,Ut=0,25<=H)throw Error(Z(301));H+=1,cs=Vo=null,p.updateQueue=null,Tu.current=Gs,h=b(C,z)}while(il)}if(Tu.current=rc,p=Vo!==null&&Vo.next!==null,Eu=0,cs=Vo=_o=null,tu=!1,p)throw Error(Z(300));return h}function xa(){var h=Ut!==0;return Ut=0,h}function ba(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cs===null?_o.memoizedState=cs=h:cs=cs.next=h,cs}function qs(){if(Vo===null){var h=_o.alternate;h=h!==null?h.memoizedState:null}else h=Vo.next;var p=cs===null?_o.memoizedState:cs.next;if(p!==null)cs=p,Vo=h;else{if(h===null)throw Error(Z(310));Vo=h,h={memoizedState:Vo.memoizedState,baseState:Vo.baseState,baseQueue:Vo.baseQueue,queue:Vo.queue,next:null},cs===null?_o.memoizedState=cs=h:cs=cs.next=h}return cs}function ec(h,p){return typeof p=="function"?p(h):p}function ad(h){var p=qs(),b=p.queue;if(b===null)throw Error(Z(311));b.lastRenderedReducer=h;var C=Vo,z=C.baseQueue,H=b.pending;if(H!==null){if(z!==null){var pe=z.next;z.next=H.next,H.next=pe}C.baseQueue=z=H,b.pending=null}if(z!==null){H=z.next,C=C.baseState;var He=pe=null,lt=null,Gt=H;do{var Ar=Gt.lane;if((Eu&Ar)===Ar)lt!==null&&(lt=lt.next={lane:0,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null}),C=Gt.hasEagerState?Gt.eagerState:h(C,Gt.action);else{var Rr={lane:Ar,action:Gt.action,hasEagerState:Gt.hasEagerState,eagerState:Gt.eagerState,next:null};lt===null?(He=lt=Rr,pe=C):lt=lt.next=Rr,_o.lanes|=Ar,Te|=Ar}Gt=Gt.next}while(Gt!==null&&Gt!==H);lt===null?pe=C:lt.next=He,ka(C,p.memoizedState)||(Zo=!0),p.memoizedState=C,p.baseState=pe,p.baseQueue=lt,b.lastRenderedState=C}if(h=b.interleaved,h!==null){z=h;do H=z.lane,_o.lanes|=H,Te|=H,z=z.next;while(z!==h)}else z===null&&(b.lanes=0);return[p.memoizedState,b.dispatch]}function ld(h){var p=qs(),b=p.queue;if(b===null)throw Error(Z(311));b.lastRenderedReducer=h;var C=b.dispatch,z=b.pending,H=p.memoizedState;if(z!==null){b.pending=null;var pe=z=z.next;do H=h(H,pe.action),pe=pe.next;while(pe!==z);ka(H,p.memoizedState)||(Zo=!0),p.memoizedState=H,p.baseQueue===null&&(p.baseState=H),b.lastRenderedState=H}return[H,C]}function tc(){}function qf(h,p){var b=_o,C=qs(),z=p(),H=!ka(C.memoizedState,z);if(H&&(C.memoizedState=z,Zo=!0),C=C.queue,hs(Eh.bind(null,b,C,h),[h]),C.getSnapshot!==p||H||cs!==null&&cs.memoizedState.tag&1){if(b.flags|=2048,Iu(9,rf.bind(null,b,C,z,p),void 0,null),ee===null)throw Error(Z(349));(Eu&30)!==0||Gf(b,p,z)}return z}function Gf(h,p,b){h.flags|=16384,h={getSnapshot:p,value:b},p=_o.updateQueue,p===null?(p={lastEffect:null,stores:null},_o.updateQueue=p,p.stores=[h]):(b=p.stores,b===null?p.stores=[h]:b.push(h))}function rf(h,p,b,C){p.value=b,p.getSnapshot=C,ud(p)&&cd(h)}function Eh(h,p,b){return b(function(){ud(p)&&cd(h)})}function ud(h){var p=h.getSnapshot;h=h.value;try{var b=p();return!ka(h,b)}catch{return!0}}function cd(h){var p=Pr(h,1);p!==null&&nr(p,h,1,-1)}function nf(h){var p=ba();return typeof h=="function"&&(h=h()),p.memoizedState=p.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ec,lastRenderedState:h},p.queue=h,h=h.dispatch=of.bind(null,_o,h),[p.memoizedState,h]}function Iu(h,p,b,C){return h={tag:h,create:p,destroy:b,deps:C,next:null},p=_o.updateQueue,p===null?(p={lastEffect:null,stores:null},_o.updateQueue=p,p.lastEffect=h.next=h):(b=p.lastEffect,b===null?p.lastEffect=h.next=h:(C=b.next,b.next=h,h.next=C,p.lastEffect=h)),h}function Uc(){return qs().memoizedState}function El(h,p,b,C){var z=ba();_o.flags|=h,z.memoizedState=Iu(1|p,b,void 0,C===void 0?null:C)}function qc(h,p,b,C){var z=qs();C=C===void 0?null:C;var H=void 0;if(Vo!==null){var pe=Vo.memoizedState;if(H=pe.destroy,C!==null&&kn(C,pe.deps)){z.memoizedState=Iu(p,b,H,C);return}}_o.flags|=h,z.memoizedState=Iu(1|p,b,H,C)}function ru(h,p){return El(8390656,8,h,p)}function hs(h,p){return qc(2048,8,h,p)}function Hf(h,p){return qc(4,2,h,p)}function Gc(h,p){return qc(4,4,h,p)}function gn(h,p){if(typeof p=="function")return h=h(),p(h),function(){p(null)};if(p!=null)return h=h(),p.current=h,function(){p.current=null}}function Fi(h,p,b){return b=b!=null?b.concat([h]):null,qc(4,4,gn.bind(null,p,h),b)}function Ih(){}function Il(h,p){var b=qs();p=p===void 0?null:p;var C=b.memoizedState;return C!==null&&p!==null&&kn(p,C[1])?C[0]:(b.memoizedState=[h,p],h)}function Ah(h,p){var b=qs();p=p===void 0?null:p;var C=b.memoizedState;return C!==null&&p!==null&&kn(p,C[1])?C[0]:(h=h(),b.memoizedState=[h,p],h)}function Au(h,p,b){return(Eu&21)===0?(h.baseState&&(h.baseState=!1,Zo=!0),h.memoizedState=b):(ka(b,p)||(b=Be(),_o.lanes|=b,Te|=b,h.baseState=!0),p)}function Hc(h,p){var b=kr;kr=b!==0&&4>b?b:4,h(!0);var C=Tl.transition;Tl.transition={};try{h(!1),p()}finally{kr=b,Tl.transition=C}}function Ch(){return qs().memoizedState}function $c(h,p,b){var C=pr(h);if(b={lane:C,action:b,hasEagerState:!1,eagerState:null,next:null},hd(h))nl(p,b);else if(b=Ql(h,p,b,C),b!==null){var z=Kt();nr(b,h,C,z),Al(b,p,C)}}function of(h,p,b){var C=pr(h),z={lane:C,action:b,hasEagerState:!1,eagerState:null,next:null};if(hd(h))nl(p,z);else{var H=h.alternate;if(h.lanes===0&&(H===null||H.lanes===0)&&(H=p.lastRenderedReducer,H!==null))try{var pe=p.lastRenderedState,He=H(pe,b);if(z.hasEagerState=!0,z.eagerState=He,ka(He,pe)){var lt=p.interleaved;lt===null?(z.next=z,bl(p)):(z.next=lt.next,lt.next=z),p.interleaved=z;return}}catch{}finally{}b=Ql(h,p,z,C),b!==null&&(z=Kt(),nr(b,h,C,z),Al(b,p,C))}}function hd(h){var p=h.alternate;return h===_o||p!==null&&p===_o}function nl(h,p){il=tu=!0;var b=h.pending;b===null?p.next=p:(p.next=b.next,b.next=p),h.pending=p}function Al(h,p,b){if((b&4194240)!==0){var C=p.lanes;C&=h.pendingLanes,b|=C,p.lanes=b,Cr(h,b)}}var rc={readContext:Rs,useCallback:So,useContext:So,useEffect:So,useImperativeHandle:So,useInsertionEffect:So,useLayoutEffect:So,useMemo:So,useReducer:So,useRef:So,useState:So,useDebugValue:So,useDeferredValue:So,useTransition:So,useMutableSource:So,useSyncExternalStore:So,useId:So,unstable_isNewReconciler:!1},ic={readContext:Rs,useCallback:function(h,p){return ba().memoizedState=[h,p===void 0?null:p],h},useContext:Rs,useEffect:ru,useImperativeHandle:function(h,p,b){return b=b!=null?b.concat([h]):null,El(4194308,4,gn.bind(null,p,h),b)},useLayoutEffect:function(h,p){return El(4194308,4,h,p)},useInsertionEffect:function(h,p){return El(4,2,h,p)},useMemo:function(h,p){var b=ba();return p=p===void 0?null:p,h=h(),b.memoizedState=[h,p],h},useReducer:function(h,p,b){var C=ba();return p=b!==void 0?b(p):p,C.memoizedState=C.baseState=p,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:p},C.queue=h,h=h.dispatch=$c.bind(null,_o,h),[C.memoizedState,h]},useRef:function(h){var p=ba();return h={current:h},p.memoizedState=h},useState:nf,useDebugValue:Ih,useDeferredValue:function(h){return ba().memoizedState=h},useTransition:function(){var h=nf(!1),p=h[0];return h=Hc.bind(null,h[1]),ba().memoizedState=h,[p,h]},useMutableSource:function(){},useSyncExternalStore:function(h,p,b){var C=_o,z=ba();if(io){if(b===void 0)throw Error(Z(407));b=b()}else{if(b=p(),ee===null)throw Error(Z(349));(Eu&30)!==0||Gf(C,p,b)}z.memoizedState=b;var H={value:b,getSnapshot:p};return z.queue=H,ru(Eh.bind(null,C,H,h),[h]),C.flags|=2048,Iu(9,rf.bind(null,C,H,b,p),void 0,null),b},useId:function(){var h=ba(),p=ee.identifierPrefix;if(io){var b=yl,C=_l;b=(C&~(1<<32-mn(C)-1)).toString(32)+b,p=":"+p+"R"+b,b=Ut++,0<b&&(p+="H"+b.toString(32)),p+=":"}else b=ar++,p=":"+p+"r"+b.toString(32)+":";return h.memoizedState=p},unstable_isNewReconciler:!1},Wc={readContext:Rs,useCallback:Il,useContext:Rs,useEffect:hs,useImperativeHandle:Fi,useInsertionEffect:Hf,useLayoutEffect:Gc,useMemo:Ah,useReducer:ad,useRef:Uc,useState:function(){return ad(ec)},useDebugValue:Ih,useDeferredValue:function(h){var p=qs();return Au(p,Vo.memoizedState,h)},useTransition:function(){var h=ad(ec)[0],p=qs().memoizedState;return[h,p]},useMutableSource:tc,useSyncExternalStore:qf,useId:Ch,unstable_isNewReconciler:!1},Gs={readContext:Rs,useCallback:Il,useContext:Rs,useEffect:hs,useImperativeHandle:Fi,useInsertionEffect:Hf,useLayoutEffect:Gc,useMemo:Ah,useReducer:ld,useRef:Uc,useState:function(){return ld(ec)},useDebugValue:Ih,useDeferredValue:function(h){var p=qs();return Vo===null?p.memoizedState=h:Au(p,Vo.memoizedState,h)},useTransition:function(){var h=ld(ec)[0],p=qs().memoizedState;return[h,p]},useMutableSource:tc,useSyncExternalStore:qf,useId:Ch,unstable_isNewReconciler:!1};function jo(h,p){if(h&&h.defaultProps){p=or({},p),h=h.defaultProps;for(var b in h)p[b]===void 0&&(p[b]=h[b]);return p}return p}function Mh(h,p,b,C){p=h.memoizedState,b=b(C,p),b=b==null?p:or({},p,b),h.memoizedState=b,h.lanes===0&&(h.updateQueue.baseState=b)}var ol={isMounted:function(h){return(h=h._reactInternals)?Qt(h)===h:!1},enqueueSetState:function(h,p,b){h=h._reactInternals;var C=Kt(),z=pr(h),H=va(C,z);H.payload=p,b!=null&&(H.callback=b),p=eu(h,H,z),p!==null&&(nr(p,h,z,C),od(p,h,z))},enqueueReplaceState:function(h,p,b){h=h._reactInternals;var C=Kt(),z=pr(h),H=va(C,z);H.tag=1,H.payload=p,b!=null&&(H.callback=b),p=eu(h,H,z),p!==null&&(nr(p,h,z,C),od(p,h,z))},enqueueForceUpdate:function(h,p){h=h._reactInternals;var b=Kt(),C=pr(h),z=va(b,C);z.tag=2,p!=null&&(z.callback=p),p=eu(h,z,C),p!==null&&(nr(p,h,C,b),od(p,h,C))}};function dd(h,p,b,C,z,H,pe){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(C,H,pe):p.prototype&&p.prototype.isPureReactComponent?!La(b,C)||!La(z,H):!0}function Ph(h,p,b){var C=!1,z=wo,H=p.contextType;return typeof H=="object"&&H!==null?H=Rs(H):(z=Ss(p)?gl:Bo.current,C=p.contextTypes,H=(C=C!=null)?Xl(h,z):wo),p=new p(b,H),h.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=ol,h.stateNode=p,p._reactInternals=h,C&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=z,h.__reactInternalMemoizedMaskedChildContext=H),p}function Zc(h,p,b,C){h=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(b,C),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(b,C),p.state!==h&&ol.enqueueReplaceState(p,p.state,null)}function Rh(h,p,b,C){var z=h.stateNode;z.props=b,z.state=h.memoizedState,z.refs={},Qd(h);var H=p.contextType;typeof H=="object"&&H!==null?z.context=Rs(H):(H=Ss(p)?gl:Bo.current,z.context=Xl(h,H)),z.state=h.memoizedState,H=p.getDerivedStateFromProps,typeof H=="function"&&(Mh(h,p,H,b),z.state=h.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof z.getSnapshotBeforeUpdate=="function"||typeof z.UNSAFE_componentWillMount!="function"&&typeof z.componentWillMount!="function"||(p=z.state,typeof z.componentWillMount=="function"&&z.componentWillMount(),typeof z.UNSAFE_componentWillMount=="function"&&z.UNSAFE_componentWillMount(),p!==z.state&&ol.enqueueReplaceState(z,z.state,null),sd(h,b,z,C),z.state=h.memoizedState),typeof z.componentDidMount=="function"&&(h.flags|=4194308)}function ao(h,p){try{var b="",C=p;do b+=qr(C),C=C.return;while(C);var z=b}catch(H){z=`
Error generating stack: `+H.message+`
`+H.stack}return{value:h,source:p,stack:z,digest:null}}function Dh(h,p,b){return{value:h,source:null,stack:b??null,digest:p??null}}function kh(h,p){try{console.error(p.value)}catch(b){setTimeout(function(){throw b})}}var Cu=typeof WeakMap=="function"?WeakMap:Map;function Xc(h,p,b){b=va(-1,b),b.tag=3,b.payload={element:null};var C=p.value;return b.callback=function(){tt||(tt=!0,Ve=C),kh(h,p)},b}function fd(h,p,b){b=va(-1,b),b.tag=3;var C=h.type.getDerivedStateFromError;if(typeof C=="function"){var z=p.value;b.payload=function(){return C(z)},b.callback=function(){kh(h,p)}}var H=h.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(b.callback=function(){kh(h,p),typeof C!="function"&&(vt===null?vt=new Set([this]):vt.add(this));var pe=p.stack;this.componentDidCatch(p.value,{componentStack:pe!==null?pe:""})}),b}function Lh(h,p,b){var C=h.pingCache;if(C===null){C=h.pingCache=new Cu;var z=new Set;C.set(p,z)}else z=C.get(p),z===void 0&&(z=new Set,C.set(p,z));z.has(b)||(z.add(b),h=Uo.bind(null,h,p,b),p.then(h,h))}function Mu(h){do{var p;if((p=h.tag===13)&&(p=h.memoizedState,p=p!==null?p.dehydrated!==null:!0),p)return h;h=h.return}while(h!==null);return null}function pd(h,p,b,C,z){return(h.mode&1)===0?(h===p?h.flags|=65536:(h.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(p=va(-1,1),p.tag=2,eu(b,p,1))),b.lanes|=1),h):(h.flags|=65536,h.lanes=z,h)}var zh=st.ReactCurrentOwner,Zo=!1;function Xo(h,p,b,C){p.child=h===null?Nc(p,null,b,C):rl(p,h.child,b,C)}function md(h,p,b,C,z){b=b.render;var H=p.ref;return ir(p,z),C=Ze(h,p,b,C,H,z),b=xa(),h!==null&&!Zo?(p.updateQueue=h.updateQueue,p.flags&=-2053,h.lanes&=~z,Qs(h,p,z)):(io&&b&&vl(p),p.flags|=1,Xo(h,p,C,z),p.child)}function Oh(h,p,b,C,z){if(h===null){var H=b.type;return typeof H=="function"&&!qa(H)&&H.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(p.tag=15,p.type=H,sf(h,p,H,C,z)):(h=Dl(b.type,null,C,p,p.mode,z),h.ref=p.ref,h.return=p,p.child=h)}if(H=h.child,(h.lanes&z)===0){var pe=H.memoizedProps;if(b=b.compare,b=b!==null?b:La,b(pe,C)&&h.ref===p.ref)return Qs(h,p,z)}return p.flags|=1,h=wa(H,C),h.ref=p.ref,h.return=p,p.child=h}function sf(h,p,b,C,z){if(h!==null){var H=h.memoizedProps;if(La(H,C)&&h.ref===p.ref)if(Zo=!1,p.pendingProps=C=H,(h.lanes&z)!==0)(h.flags&131072)!==0&&(Zo=!0);else return p.lanes=h.lanes,Qs(h,p,z)}return gd(h,p,b,C,z)}function Fh(h,p,b){var C=p.pendingProps,z=C.children,H=h!==null?h.memoizedState:null;if(C.mode==="hidden")if((p.mode&1)===0)p.memoizedState={baseLanes:0,cachePool:null,transitions:null},ro(ye,xe),xe|=b;else{if((b&1073741824)===0)return h=H!==null?H.baseLanes|b:b,p.lanes=p.childLanes=1073741824,p.memoizedState={baseLanes:h,cachePool:null,transitions:null},p.updateQueue=null,ro(ye,xe),xe|=h,null;p.memoizedState={baseLanes:0,cachePool:null,transitions:null},C=H!==null?H.baseLanes:b,ro(ye,xe),xe|=C}else H!==null?(C=H.baseLanes|b,p.memoizedState=null):C=b,ro(ye,xe),xe|=C;return Xo(h,p,z,b),p.child}function af(h,p){var b=p.ref;(h===null&&b!==null||h!==null&&h.ref!==b)&&(p.flags|=512,p.flags|=2097152)}function gd(h,p,b,C,z){var H=Ss(b)?gl:Bo.current;return H=Xl(p,H),ir(p,z),b=Ze(h,p,b,C,H,z),C=xa(),h!==null&&!Zo?(p.updateQueue=h.updateQueue,p.flags&=-2053,h.lanes&=~z,Qs(h,p,z)):(io&&C&&vl(p),p.flags|=1,Xo(h,p,b,z),p.child)}function lf(h,p,b,C,z){if(Ss(b)){var H=!0;Gu(p)}else H=!1;if(ir(p,z),p.stateNode===null)wd(h,p),Ph(p,b,C),Rh(p,b,C,z),C=!0;else if(h===null){var pe=p.stateNode,He=p.memoizedProps;pe.props=He;var lt=pe.context,Gt=b.contextType;typeof Gt=="object"&&Gt!==null?Gt=Rs(Gt):(Gt=Ss(b)?gl:Bo.current,Gt=Xl(p,Gt));var Ar=b.getDerivedStateFromProps,Rr=typeof Ar=="function"||typeof pe.getSnapshotBeforeUpdate=="function";Rr||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(He!==C||lt!==Gt)&&Zc(p,pe,C,Gt),wl=!1;var Er=p.memoizedState;pe.state=Er,sd(p,C,pe,z),lt=p.memoizedState,He!==C||Er!==lt||ws.current||wl?(typeof Ar=="function"&&(Mh(p,b,Ar,C),lt=p.memoizedState),(He=wl||dd(p,b,He,C,Er,lt,Gt))?(Rr||typeof pe.UNSAFE_componentWillMount!="function"&&typeof pe.componentWillMount!="function"||(typeof pe.componentWillMount=="function"&&pe.componentWillMount(),typeof pe.UNSAFE_componentWillMount=="function"&&pe.UNSAFE_componentWillMount()),typeof pe.componentDidMount=="function"&&(p.flags|=4194308)):(typeof pe.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=C,p.memoizedState=lt),pe.props=C,pe.state=lt,pe.context=Gt,C=He):(typeof pe.componentDidMount=="function"&&(p.flags|=4194308),C=!1)}else{pe=p.stateNode,ef(h,p),He=p.memoizedProps,Gt=p.type===p.elementType?He:jo(p.type,He),pe.props=Gt,Rr=p.pendingProps,Er=pe.context,lt=b.contextType,typeof lt=="object"&&lt!==null?lt=Rs(lt):(lt=Ss(b)?gl:Bo.current,lt=Xl(p,lt));var Yr=b.getDerivedStateFromProps;(Ar=typeof Yr=="function"||typeof pe.getSnapshotBeforeUpdate=="function")||typeof pe.UNSAFE_componentWillReceiveProps!="function"&&typeof pe.componentWillReceiveProps!="function"||(He!==Rr||Er!==lt)&&Zc(p,pe,C,lt),wl=!1,Er=p.memoizedState,pe.state=Er,sd(p,C,pe,z);var ui=p.memoizedState;He!==Rr||Er!==ui||ws.current||wl?(typeof Yr=="function"&&(Mh(p,b,Yr,C),ui=p.memoizedState),(Gt=wl||dd(p,b,Gt,C,Er,ui,lt)||!1)?(Ar||typeof pe.UNSAFE_componentWillUpdate!="function"&&typeof pe.componentWillUpdate!="function"||(typeof pe.componentWillUpdate=="function"&&pe.componentWillUpdate(C,ui,lt),typeof pe.UNSAFE_componentWillUpdate=="function"&&pe.UNSAFE_componentWillUpdate(C,ui,lt)),typeof pe.componentDidUpdate=="function"&&(p.flags|=4),typeof pe.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof pe.componentDidUpdate!="function"||He===h.memoizedProps&&Er===h.memoizedState||(p.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||He===h.memoizedProps&&Er===h.memoizedState||(p.flags|=1024),p.memoizedProps=C,p.memoizedState=ui),pe.props=C,pe.state=ui,pe.context=lt,C=Gt):(typeof pe.componentDidUpdate!="function"||He===h.memoizedProps&&Er===h.memoizedState||(p.flags|=4),typeof pe.getSnapshotBeforeUpdate!="function"||He===h.memoizedProps&&Er===h.memoizedState||(p.flags|=1024),C=!1)}return _d(h,p,b,C,H,z)}function _d(h,p,b,C,z,H){af(h,p);var pe=(p.flags&128)!==0;if(!C&&!pe)return z&&Lc(p,b,!1),Qs(h,p,H);C=p.stateNode,zh.current=p;var He=pe&&typeof b.getDerivedStateFromError!="function"?null:C.render();return p.flags|=1,h!==null&&pe?(p.child=rl(p,h.child,null,H),p.child=rl(p,null,He,H)):Xo(h,p,He,H),p.memoizedState=C.state,z&&Lc(p,b,!0),p.child}function yd(h){var p=h.stateNode;p.pendingContext?_h(h,p.pendingContext,p.pendingContext!==p.context):p.context&&_h(h,p.context,!1),Sl(h,p.containerInfo)}function uf(h,p,b,C,z){return Bc(),tl(z),p.flags|=256,Xo(h,p,b,C),p.child}var vd={dehydrated:null,treeContext:null,retryLane:0};function xd(h){return{baseLanes:h,cachePool:null,transitions:null}}function cf(h,p,b){var C=p.pendingProps,z=Kn.current,H=!1,pe=(p.flags&128)!==0,He;if((He=pe)||(He=h!==null&&h.memoizedState===null?!1:(z&2)!==0),He?(H=!0,p.flags&=-129):(h===null||h.memoizedState!==null)&&(z|=1),ro(Kn,z&1),h===null)return nd(p),h=p.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((p.mode&1)===0?p.lanes=1:h.data==="$!"?p.lanes=8:p.lanes=1073741824,null):(pe=C.children,h=C.fallback,H?(C=p.mode,H=p.child,pe={mode:"hidden",children:pe},(C&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=pe):H=oc(pe,C,0,null),h=kl(h,C,b,null),H.return=p,h.return=p,H.sibling=h,p.child=H,p.child.memoizedState=xd(b),p.memoizedState=vd,h):bd(p,pe));if(z=h.memoizedState,z!==null&&(He=z.dehydrated,He!==null))return vp(h,p,pe,C,He,z,b);if(H){H=C.fallback,pe=p.mode,z=h.child,He=z.sibling;var lt={mode:"hidden",children:C.children};return(pe&1)===0&&p.child!==z?(C=p.child,C.childLanes=0,C.pendingProps=lt,p.deletions=null):(C=wa(z,lt),C.subtreeFlags=z.subtreeFlags&14680064),He!==null?H=wa(He,H):(H=kl(H,pe,b,null),H.flags|=2),H.return=p,C.return=p,C.sibling=H,p.child=C,C=H,H=p.child,pe=h.child.memoizedState,pe=pe===null?xd(b):{baseLanes:pe.baseLanes|b,cachePool:null,transitions:pe.transitions},H.memoizedState=pe,H.childLanes=h.childLanes&~b,p.memoizedState=vd,C}return H=h.child,h=H.sibling,C=wa(H,{mode:"visible",children:C.children}),(p.mode&1)===0&&(C.lanes=b),C.return=p,C.sibling=null,h!==null&&(b=p.deletions,b===null?(p.deletions=[h],p.flags|=16):b.push(h)),p.child=C,p.memoizedState=null,C}function bd(h,p){return p=oc({mode:"visible",children:p},h.mode,0,null),p.return=h,h.child=p}function Bh(h,p,b,C){return C!==null&&tl(C),rl(p,h.child,null,b),h=bd(p,p.pendingProps.children),h.flags|=2,p.memoizedState=null,h}function vp(h,p,b,C,z,H,pe){if(b)return p.flags&256?(p.flags&=-257,C=Dh(Error(Z(422))),Bh(h,p,pe,C)):p.memoizedState!==null?(p.child=h.child,p.flags|=128,null):(H=C.fallback,z=p.mode,C=oc({mode:"visible",children:C.children},z,0,null),H=kl(H,z,pe,null),H.flags|=2,C.return=p,H.return=p,C.sibling=H,p.child=C,(p.mode&1)!==0&&rl(p,h.child,null,pe),p.child.memoizedState=xd(pe),p.memoizedState=vd,H);if((p.mode&1)===0)return Bh(h,p,pe,null);if(z.data==="$!"){if(C=z.nextSibling&&z.nextSibling.dataset,C)var He=C.dgst;return C=He,H=Error(Z(419)),C=Dh(H,C,void 0),Bh(h,p,pe,C)}if(He=(pe&h.childLanes)!==0,Zo||He){if(C=ee,C!==null){switch(pe&-pe){case 4:z=2;break;case 16:z=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:z=32;break;case 536870912:z=268435456;break;default:z=0}z=(z&(C.suspendedLanes|pe))!==0?0:z,z!==0&&z!==H.retryLane&&(H.retryLane=z,Pr(h,z),nr(C,h,z,-1))}return zn(),C=Dh(Error(Z(421))),Bh(h,p,pe,C)}return z.data==="$?"?(p.flags|=128,p.child=h.child,p=Jo.bind(null,h),z._reactRetry=p,null):(h=H.treeContext,Us=$l(z.nextSibling),fo=p,io=!0,Oa=null,h!==null&&(Ps[ga++]=_l,Ps[ga++]=yl,Ps[ga++]=_a,_l=h.id,yl=h.overflow,_a=p),p=bd(p,C.children),p.flags|=4096,p)}function $f(h,p,b){h.lanes|=p;var C=h.alternate;C!==null&&(C.lanes|=p),Yu(h.return,p,b)}function Sn(h,p,b,C,z){var H=h.memoizedState;H===null?h.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:C,tail:b,tailMode:z}:(H.isBackwards=p,H.rendering=null,H.renderingStartTime=0,H.last=C,H.tail=b,H.tailMode=z)}function hf(h,p,b){var C=p.pendingProps,z=C.revealOrder,H=C.tail;if(Xo(h,p,C.children,b),C=Kn.current,(C&2)!==0)C=C&1|2,p.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=p.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&$f(h,b,p);else if(h.tag===19)$f(h,b,p);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===p)break e;for(;h.sibling===null;){if(h.return===null||h.return===p)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}C&=1}if(ro(Kn,C),(p.mode&1)===0)p.memoizedState=null;else switch(z){case"forwards":for(b=p.child,z=null;b!==null;)h=b.alternate,h!==null&&Th(h)===null&&(z=b),b=b.sibling;b=z,b===null?(z=p.child,p.child=null):(z=b.sibling,b.sibling=null),Sn(p,!1,z,b,H);break;case"backwards":for(b=null,z=p.child,p.child=null;z!==null;){if(h=z.alternate,h!==null&&Th(h)===null){p.child=z;break}h=z.sibling,z.sibling=b,b=z,z=h}Sn(p,!0,b,null,H);break;case"together":Sn(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function wd(h,p){(p.mode&1)===0&&h!==null&&(h.alternate=null,p.alternate=null,p.flags|=2)}function Qs(h,p,b){if(h!==null&&(p.dependencies=h.dependencies),Te|=p.lanes,(b&p.childLanes)===0)return null;if(h!==null&&p.child!==h.child)throw Error(Z(153));if(p.child!==null){for(h=p.child,b=wa(h,h.pendingProps),p.child=b,b.return=p;h.sibling!==null;)h=h.sibling,b=b.sibling=wa(h,h.pendingProps),b.return=p;b.sibling=null}return p.child}function xp(h,p,b){switch(p.tag){case 3:yd(p),Bc();break;case 5:Sh(p);break;case 1:Ss(p.type)&&Gu(p);break;case 4:Sl(p,p.stateNode.containerInfo);break;case 10:var C=p.type._context,z=p.memoizedProps.value;ro(bu,C._currentValue),C._currentValue=z;break;case 13:if(C=p.memoizedState,C!==null)return C.dehydrated!==null?(ro(Kn,Kn.current&1),p.flags|=128,null):(b&p.child.childLanes)!==0?cf(h,p,b):(ro(Kn,Kn.current&1),h=Qs(h,p,b),h!==null?h.sibling:null);ro(Kn,Kn.current&1);break;case 19:if(C=(b&p.childLanes)!==0,(h.flags&128)!==0){if(C)return hf(h,p,b);p.flags|=128}if(z=p.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),ro(Kn,Kn.current),C)break;return null;case 22:case 23:return p.lanes=0,Fh(h,p,b)}return Qs(h,p,b)}var nc,Sd,Nh,Yc;nc=function(h,p){for(var b=p.child;b!==null;){if(b.tag===5||b.tag===6)h.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===p)break;for(;b.sibling===null;){if(b.return===null||b.return===p)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},Sd=function(){},Nh=function(h,p,b,C){var z=h.memoizedProps;if(z!==C){h=p.stateNode,No(Fa.current);var H=null;switch(b){case"input":z=ts(h,z),C=ts(h,C),H=[];break;case"select":z=or({},z,{value:void 0}),C=or({},C,{value:void 0}),H=[];break;case"textarea":z=mo(h,z),C=mo(h,C),H=[];break;default:typeof z.onClick!="function"&&typeof C.onClick=="function"&&(h.onclick=_u)}os(b,C);var pe;b=null;for(Gt in z)if(!C.hasOwnProperty(Gt)&&z.hasOwnProperty(Gt)&&z[Gt]!=null)if(Gt==="style"){var He=z[Gt];for(pe in He)He.hasOwnProperty(pe)&&(b||(b={}),b[pe]="")}else Gt!=="dangerouslySetInnerHTML"&&Gt!=="children"&&Gt!=="suppressContentEditableWarning"&&Gt!=="suppressHydrationWarning"&&Gt!=="autoFocus"&&(ue.hasOwnProperty(Gt)?H||(H=[]):(H=H||[]).push(Gt,null));for(Gt in C){var lt=C[Gt];if(He=z!=null?z[Gt]:void 0,C.hasOwnProperty(Gt)&&lt!==He&&(lt!=null||He!=null))if(Gt==="style")if(He){for(pe in He)!He.hasOwnProperty(pe)||lt&&lt.hasOwnProperty(pe)||(b||(b={}),b[pe]="");for(pe in lt)lt.hasOwnProperty(pe)&&He[pe]!==lt[pe]&&(b||(b={}),b[pe]=lt[pe])}else b||(H||(H=[]),H.push(Gt,b)),b=lt;else Gt==="dangerouslySetInnerHTML"?(lt=lt?lt.__html:void 0,He=He?He.__html:void 0,lt!=null&&He!==lt&&(H=H||[]).push(Gt,lt)):Gt==="children"?typeof lt!="string"&&typeof lt!="number"||(H=H||[]).push(Gt,""+lt):Gt!=="suppressContentEditableWarning"&&Gt!=="suppressHydrationWarning"&&(ue.hasOwnProperty(Gt)?(lt!=null&&Gt==="onScroll"&&ho("scroll",h),H||He===lt||(H=[])):(H=H||[]).push(Gt,lt))}b&&(H=H||[]).push("style",b);var Gt=H;(p.updateQueue=Gt)&&(p.flags|=4)}},Yc=function(h,p,b,C){b!==C&&(p.flags|=4)};function ea(h,p){if(!io)switch(h.tailMode){case"hidden":p=h.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?h.tail=null:b.sibling=null;break;case"collapsed":b=h.tail;for(var C=null;b!==null;)b.alternate!==null&&(C=b),b=b.sibling;C===null?p||h.tail===null?h.tail=null:h.tail.sibling=null:C.sibling=null}}function Yo(h){var p=h.alternate!==null&&h.alternate.child===h.child,b=0,C=0;if(p)for(var z=h.child;z!==null;)b|=z.lanes|z.childLanes,C|=z.subtreeFlags&14680064,C|=z.flags&14680064,z.return=h,z=z.sibling;else for(z=h.child;z!==null;)b|=z.lanes|z.childLanes,C|=z.subtreeFlags,C|=z.flags,z.return=h,z=z.sibling;return h.subtreeFlags|=C,h.childLanes=b,p}function lo(h,p,b){var C=p.pendingProps;switch(rd(p),p.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yo(p),null;case 1:return Ss(p.type)&&kc(),Yo(p),null;case 3:return C=p.stateNode,Ba(),Un(ws),Un(Bo),Zi(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(h===null||h.child===null)&&(xl(p)?p.flags|=4:h===null||h.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,Oa!==null&&(Xi(Oa),Oa=null))),Sd(h,p),Yo(p),null;case 5:jc(p);var z=No(Qu.current);if(b=p.type,h!==null&&p.stateNode!=null)Nh(h,p,b,C,z),h.ref!==p.ref&&(p.flags|=512,p.flags|=2097152);else{if(!C){if(p.stateNode===null)throw Error(Z(166));return Yo(p),null}if(h=No(Fa.current),xl(p)){C=p.stateNode,b=p.type;var H=p.memoizedProps;switch(C[js]=p,C[Rc]=H,h=(p.mode&1)!==0,b){case"dialog":ho("cancel",C),ho("close",C);break;case"iframe":case"object":case"embed":ho("load",C);break;case"video":case"audio":for(z=0;z<Nu.length;z++)ho(Nu[z],C);break;case"source":ho("error",C);break;case"img":case"image":case"link":ho("error",C),ho("load",C);break;case"details":ho("toggle",C);break;case"input":zs(C,H),ho("invalid",C);break;case"select":C._wrapperState={wasMultiple:!!H.multiple},ho("invalid",C);break;case"textarea":oo(C,H),ho("invalid",C)}os(b,H),z=null;for(var pe in H)if(H.hasOwnProperty(pe)){var He=H[pe];pe==="children"?typeof He=="string"?C.textContent!==He&&(H.suppressHydrationWarning!==!0&&Hl(C.textContent,He,h),z=["children",He]):typeof He=="number"&&C.textContent!==""+He&&(H.suppressHydrationWarning!==!0&&Hl(C.textContent,He,h),z=["children",""+He]):ue.hasOwnProperty(pe)&&He!=null&&pe==="onScroll"&&ho("scroll",C)}switch(b){case"input":Xn(C),rs(C,H,!0);break;case"textarea":Xn(C),Ao(C);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(C.onclick=_u)}C=z,p.updateQueue=C,C!==null&&(p.flags|=4)}else{pe=z.nodeType===9?z:z.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=Ws(b)),h==="http://www.w3.org/1999/xhtml"?b==="script"?(h=pe.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof C.is=="string"?h=pe.createElement(b,{is:C.is}):(h=pe.createElement(b),b==="select"&&(pe=h,C.multiple?pe.multiple=!0:C.size&&(pe.size=C.size))):h=pe.createElementNS(h,b),h[js]=p,h[Rc]=C,nc(h,p,!1,!1),p.stateNode=h;e:{switch(pe=ia(b,C),b){case"dialog":ho("cancel",h),ho("close",h),z=C;break;case"iframe":case"object":case"embed":ho("load",h),z=C;break;case"video":case"audio":for(z=0;z<Nu.length;z++)ho(Nu[z],h);z=C;break;case"source":ho("error",h),z=C;break;case"img":case"image":case"link":ho("error",h),ho("load",h),z=C;break;case"details":ho("toggle",h),z=C;break;case"input":zs(h,C),z=ts(h,C),ho("invalid",h);break;case"option":z=C;break;case"select":h._wrapperState={wasMultiple:!!C.multiple},z=or({},C,{value:void 0}),ho("invalid",h);break;case"textarea":oo(h,C),z=mo(h,C),ho("invalid",h);break;default:z=C}os(b,z),He=z;for(H in He)if(He.hasOwnProperty(H)){var lt=He[H];H==="style"?ms(h,lt):H==="dangerouslySetInnerHTML"?(lt=lt?lt.__html:void 0,lt!=null&&is(h,lt)):H==="children"?typeof lt=="string"?(b!=="textarea"||lt!=="")&&Lo(h,lt):typeof lt=="number"&&Lo(h,""+lt):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(ue.hasOwnProperty(H)?lt!=null&&H==="onScroll"&&ho("scroll",h):lt!=null&&et(h,H,lt,pe))}switch(b){case"input":Xn(h),rs(h,C,!1);break;case"textarea":Xn(h),Ao(h);break;case"option":C.value!=null&&h.setAttribute("value",""+ji(C.value));break;case"select":h.multiple=!!C.multiple,H=C.value,H!=null?ko(h,!!C.multiple,H,!1):C.defaultValue!=null&&ko(h,!!C.multiple,C.defaultValue,!0);break;default:typeof z.onClick=="function"&&(h.onclick=_u)}switch(b){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}}C&&(p.flags|=4)}p.ref!==null&&(p.flags|=512,p.flags|=2097152)}return Yo(p),null;case 6:if(h&&p.stateNode!=null)Yc(h,p,h.memoizedProps,C);else{if(typeof C!="string"&&p.stateNode===null)throw Error(Z(166));if(b=No(Qu.current),No(Fa.current),xl(p)){if(C=p.stateNode,b=p.memoizedProps,C[js]=p,(H=C.nodeValue!==b)&&(h=fo,h!==null))switch(h.tag){case 3:Hl(C.nodeValue,b,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&Hl(C.nodeValue,b,(h.mode&1)!==0)}H&&(p.flags|=4)}else C=(b.nodeType===9?b:b.ownerDocument).createTextNode(C),C[js]=p,p.stateNode=C}return Yo(p),null;case 13:if(Un(Kn),C=p.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(io&&Us!==null&&(p.mode&1)!==0&&(p.flags&128)===0)Jd(),Bc(),p.flags|=98560,H=!1;else if(H=xl(p),C!==null&&C.dehydrated!==null){if(h===null){if(!H)throw Error(Z(318));if(H=p.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(Z(317));H[js]=p}else Bc(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Yo(p),H=!1}else Oa!==null&&(Xi(Oa),Oa=null),H=!0;if(!H)return p.flags&65536?p:null}return(p.flags&128)!==0?(p.lanes=b,p):(C=C!==null,C!==(h!==null&&h.memoizedState!==null)&&C&&(p.child.flags|=8192,(p.mode&1)!==0&&(h===null||(Kn.current&1)!==0?me===0&&(me=3):zn())),p.updateQueue!==null&&(p.flags|=4),Yo(p),null);case 4:return Ba(),Sd(h,p),h===null&&fh(p.stateNode.containerInfo),Yo(p),null;case 10:return Su(p.type._context),Yo(p),null;case 17:return Ss(p.type)&&kc(),Yo(p),null;case 19:if(Un(Kn),H=p.memoizedState,H===null)return Yo(p),null;if(C=(p.flags&128)!==0,pe=H.rendering,pe===null)if(C)ea(H,!1);else{if(me!==0||h!==null&&(h.flags&128)!==0)for(h=p.child;h!==null;){if(pe=Th(h),pe!==null){for(p.flags|=128,ea(H,!1),C=pe.updateQueue,C!==null&&(p.updateQueue=C,p.flags|=4),p.subtreeFlags=0,C=b,b=p.child;b!==null;)H=b,h=C,H.flags&=14680066,pe=H.alternate,pe===null?(H.childLanes=0,H.lanes=h,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=pe.childLanes,H.lanes=pe.lanes,H.child=pe.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=pe.memoizedProps,H.memoizedState=pe.memoizedState,H.updateQueue=pe.updateQueue,H.type=pe.type,h=pe.dependencies,H.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),b=b.sibling;return ro(Kn,Kn.current&1|2),p.child}h=h.sibling}H.tail!==null&&ii()>Bt&&(p.flags|=128,C=!0,ea(H,!1),p.lanes=4194304)}else{if(!C)if(h=Th(pe),h!==null){if(p.flags|=128,C=!0,b=h.updateQueue,b!==null&&(p.updateQueue=b,p.flags|=4),ea(H,!0),H.tail===null&&H.tailMode==="hidden"&&!pe.alternate&&!io)return Yo(p),null}else 2*ii()-H.renderingStartTime>Bt&&b!==1073741824&&(p.flags|=128,C=!0,ea(H,!1),p.lanes=4194304);H.isBackwards?(pe.sibling=p.child,p.child=pe):(b=H.last,b!==null?b.sibling=pe:p.child=pe,H.last=pe)}return H.tail!==null?(p=H.tail,H.rendering=p,H.tail=p.sibling,H.renderingStartTime=ii(),p.sibling=null,b=Kn.current,ro(Kn,C?b&1|2:b&1),p):(Yo(p),null);case 22:case 23:return wi(),C=p.memoizedState!==null,h!==null&&h.memoizedState!==null!==C&&(p.flags|=8192),C&&(p.mode&1)!==0?(xe&1073741824)!==0&&(Yo(p),p.subtreeFlags&6&&(p.flags|=8192)):Yo(p),null;case 24:return null;case 25:return null}throw Error(Z(156,p.tag))}function sl(h,p){switch(rd(p),p.tag){case 1:return Ss(p.type)&&kc(),h=p.flags,h&65536?(p.flags=h&-65537|128,p):null;case 3:return Ba(),Un(ws),Un(Bo),Zi(),h=p.flags,(h&65536)!==0&&(h&128)===0?(p.flags=h&-65537|128,p):null;case 5:return jc(p),null;case 13:if(Un(Kn),h=p.memoizedState,h!==null&&h.dehydrated!==null){if(p.alternate===null)throw Error(Z(340));Bc()}return h=p.flags,h&65536?(p.flags=h&-65537|128,p):null;case 19:return Un(Kn),null;case 4:return Ba(),null;case 10:return Su(p.type._context),null;case 22:case 23:return wi(),null;case 24:return null;default:return null}}var Pu=!1,Ko=!1,Wf=typeof WeakSet=="function"?WeakSet:Set,Qr=null;function Cl(h,p){var b=h.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(C){yi(h,p,C)}else b.current=null}function Td(h,p,b){try{b()}catch(C){yi(h,p,C)}}var Ed=!1;function Na(h,p){if(Cc=ys,h=bc(),ah(h)){if("selectionStart"in h)var b={start:h.selectionStart,end:h.selectionEnd};else e:{b=(b=h.ownerDocument)&&b.defaultView||window;var C=b.getSelection&&b.getSelection();if(C&&C.rangeCount!==0){b=C.anchorNode;var z=C.anchorOffset,H=C.focusNode;C=C.focusOffset;try{b.nodeType,H.nodeType}catch{b=null;break e}var pe=0,He=-1,lt=-1,Gt=0,Ar=0,Rr=h,Er=null;t:for(;;){for(var Yr;Rr!==b||z!==0&&Rr.nodeType!==3||(He=pe+z),Rr!==H||C!==0&&Rr.nodeType!==3||(lt=pe+C),Rr.nodeType===3&&(pe+=Rr.nodeValue.length),(Yr=Rr.firstChild)!==null;)Er=Rr,Rr=Yr;for(;;){if(Rr===h)break t;if(Er===b&&++Gt===z&&(He=pe),Er===H&&++Ar===C&&(lt=pe),(Yr=Rr.nextSibling)!==null)break;Rr=Er,Er=Rr.parentNode}Rr=Yr}b=He===-1||lt===-1?null:{start:He,end:lt}}else b=null}b=b||{start:0,end:0}}else b=null;for(Mc={focusedElem:h,selectionRange:b},ys=!1,Qr=p;Qr!==null;)if(p=Qr,h=p.child,(p.subtreeFlags&1028)!==0&&h!==null)h.return=p,Qr=h;else for(;Qr!==null;){p=Qr;try{var ui=p.alternate;if((p.flags&1024)!==0)switch(p.tag){case 0:case 11:case 15:break;case 1:if(ui!==null){var gi=ui.memoizedProps,qo=ui.memoizedState,kt=p.stateNode,gt=kt.getSnapshotBeforeUpdate(p.elementType===p.type?gi:jo(p.type,gi),qo);kt.__reactInternalSnapshotBeforeUpdate=gt}break;case 3:var Lt=p.stateNode.containerInfo;Lt.nodeType===1?Lt.textContent="":Lt.nodeType===9&&Lt.documentElement&&Lt.removeChild(Lt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(br){yi(p,p.return,br)}if(h=p.sibling,h!==null){h.return=p.return,Qr=h;break}Qr=p.return}return ui=Ed,Ed=!1,ui}function iu(h,p,b){var C=p.updateQueue;if(C=C!==null?C.lastEffect:null,C!==null){var z=C=C.next;do{if((z.tag&h)===h){var H=z.destroy;z.destroy=void 0,H!==void 0&&Td(p,b,H)}z=z.next}while(z!==C)}}function Ru(h,p){if(p=p.updateQueue,p=p!==null?p.lastEffect:null,p!==null){var b=p=p.next;do{if((b.tag&h)===h){var C=b.create;b.destroy=C()}b=b.next}while(b!==p)}}function Du(h){var p=h.ref;if(p!==null){var b=h.stateNode;switch(h.tag){case 5:h=b;break;default:h=b}typeof p=="function"?p(h):p.current=h}}function Ml(h){var p=h.alternate;p!==null&&(h.alternate=null,Ml(p)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(p=h.stateNode,p!==null&&(delete p[js],delete p[Rc],delete p[mh],delete p[gp],delete p[Qh])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function Va(h){return h.tag===5||h.tag===3||h.tag===4}function ja(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||Va(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Pl(h,p,b){var C=h.tag;if(C===5||C===6)h=h.stateNode,p?b.nodeType===8?b.parentNode.insertBefore(h,p):b.insertBefore(h,p):(b.nodeType===8?(p=b.parentNode,p.insertBefore(h,b)):(p=b,p.appendChild(h)),b=b._reactRootContainer,b!=null||p.onclick!==null||(p.onclick=_u));else if(C!==4&&(h=h.child,h!==null))for(Pl(h,p,b),h=h.sibling;h!==null;)Pl(h,p,b),h=h.sibling}function nu(h,p,b){var C=h.tag;if(C===5||C===6)h=h.stateNode,p?b.insertBefore(h,p):b.appendChild(h);else if(C!==4&&(h=h.child,h!==null))for(nu(h,p,b),h=h.sibling;h!==null;)nu(h,p,b),h=h.sibling}var l=null,t=!1;function n(h,p,b){for(b=b.child;b!==null;)u(h,p,b),b=b.sibling}function u(h,p,b){if(Fn&&typeof Fn.onCommitFiberUnmount=="function")try{Fn.onCommitFiberUnmount(Gn,b)}catch{}switch(b.tag){case 5:Ko||Cl(b,p);case 6:var C=l,z=t;l=null,n(h,p,b),l=C,t=z,l!==null&&(t?(h=l,b=b.stateNode,h.nodeType===8?h.parentNode.removeChild(b):h.removeChild(b)):l.removeChild(b.stateNode));break;case 18:l!==null&&(t?(h=l,b=b.stateNode,h.nodeType===8?ju(h.parentNode,b):h.nodeType===1&&ju(h,b),Ia(h)):ju(l,b.stateNode));break;case 4:C=l,z=t,l=b.stateNode.containerInfo,t=!0,n(h,p,b),l=C,t=z;break;case 0:case 11:case 14:case 15:if(!Ko&&(C=b.updateQueue,C!==null&&(C=C.lastEffect,C!==null))){z=C=C.next;do{var H=z,pe=H.destroy;H=H.tag,pe!==void 0&&((H&2)!==0||(H&4)!==0)&&Td(b,p,pe),z=z.next}while(z!==C)}n(h,p,b);break;case 1:if(!Ko&&(Cl(b,p),C=b.stateNode,typeof C.componentWillUnmount=="function"))try{C.props=b.memoizedProps,C.state=b.memoizedState,C.componentWillUnmount()}catch(He){yi(b,p,He)}n(h,p,b);break;case 21:n(h,p,b);break;case 22:b.mode&1?(Ko=(C=Ko)||b.memoizedState!==null,n(h,p,b),Ko=C):n(h,p,b);break;default:n(h,p,b)}}function f(h){var p=h.updateQueue;if(p!==null){h.updateQueue=null;var b=h.stateNode;b===null&&(b=h.stateNode=new Wf),p.forEach(function(C){var z=al.bind(null,h,C);b.has(C)||(b.add(C),C.then(z,z))})}}function m(h,p){var b=p.deletions;if(b!==null)for(var C=0;C<b.length;C++){var z=b[C];try{var H=h,pe=p,He=pe;e:for(;He!==null;){switch(He.tag){case 5:l=He.stateNode,t=!1;break e;case 3:l=He.stateNode.containerInfo,t=!0;break e;case 4:l=He.stateNode.containerInfo,t=!0;break e}He=He.return}if(l===null)throw Error(Z(160));u(H,pe,z),l=null,t=!1;var lt=z.alternate;lt!==null&&(lt.return=null),z.return=null}catch(Gt){yi(z,p,Gt)}}if(p.subtreeFlags&12854)for(p=p.child;p!==null;)_(p,h),p=p.sibling}function _(h,p){var b=h.alternate,C=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(m(p,h),v(h),C&4){try{iu(3,h,h.return),Ru(3,h)}catch(gi){yi(h,h.return,gi)}try{iu(5,h,h.return)}catch(gi){yi(h,h.return,gi)}}break;case 1:m(p,h),v(h),C&512&&b!==null&&Cl(b,b.return);break;case 5:if(m(p,h),v(h),C&512&&b!==null&&Cl(b,b.return),h.flags&32){var z=h.stateNode;try{Lo(z,"")}catch(gi){yi(h,h.return,gi)}}if(C&4&&(z=h.stateNode,z!=null)){var H=h.memoizedProps,pe=b!==null?b.memoizedProps:H,He=h.type,lt=h.updateQueue;if(h.updateQueue=null,lt!==null)try{He==="input"&&H.type==="radio"&&H.name!=null&&no(z,H),ia(He,pe);var Gt=ia(He,H);for(pe=0;pe<lt.length;pe+=2){var Ar=lt[pe],Rr=lt[pe+1];Ar==="style"?ms(z,Rr):Ar==="dangerouslySetInnerHTML"?is(z,Rr):Ar==="children"?Lo(z,Rr):et(z,Ar,Rr,Gt)}switch(He){case"input":fs(z,H);break;case"textarea":yo(z,H);break;case"select":var Er=z._wrapperState.wasMultiple;z._wrapperState.wasMultiple=!!H.multiple;var Yr=H.value;Yr!=null?ko(z,!!H.multiple,Yr,!1):Er!==!!H.multiple&&(H.defaultValue!=null?ko(z,!!H.multiple,H.defaultValue,!0):ko(z,!!H.multiple,H.multiple?[]:"",!1))}z[Rc]=H}catch(gi){yi(h,h.return,gi)}}break;case 6:if(m(p,h),v(h),C&4){if(h.stateNode===null)throw Error(Z(162));z=h.stateNode,H=h.memoizedProps;try{z.nodeValue=H}catch(gi){yi(h,h.return,gi)}}break;case 3:if(m(p,h),v(h),C&4&&b!==null&&b.memoizedState.isDehydrated)try{Ia(p.containerInfo)}catch(gi){yi(h,h.return,gi)}break;case 4:m(p,h),v(h);break;case 13:m(p,h),v(h),z=h.child,z.flags&8192&&(H=z.memoizedState!==null,z.stateNode.isHidden=H,!H||z.alternate!==null&&z.alternate.memoizedState!==null||(mt=ii())),C&4&&f(h);break;case 22:if(Ar=b!==null&&b.memoizedState!==null,h.mode&1?(Ko=(Gt=Ko)||Ar,m(p,h),Ko=Gt):m(p,h),v(h),C&8192){if(Gt=h.memoizedState!==null,(h.stateNode.isHidden=Gt)&&!Ar&&(h.mode&1)!==0)for(Qr=h,Ar=h.child;Ar!==null;){for(Rr=Qr=Ar;Qr!==null;){switch(Er=Qr,Yr=Er.child,Er.tag){case 0:case 11:case 14:case 15:iu(4,Er,Er.return);break;case 1:Cl(Er,Er.return);var ui=Er.stateNode;if(typeof ui.componentWillUnmount=="function"){C=Er,b=Er.return;try{p=C,ui.props=p.memoizedProps,ui.state=p.memoizedState,ui.componentWillUnmount()}catch(gi){yi(C,b,gi)}}break;case 5:Cl(Er,Er.return);break;case 22:if(Er.memoizedState!==null){P(Rr);continue}}Yr!==null?(Yr.return=Er,Qr=Yr):P(Rr)}Ar=Ar.sibling}e:for(Ar=null,Rr=h;;){if(Rr.tag===5){if(Ar===null){Ar=Rr;try{z=Rr.stateNode,Gt?(H=z.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(He=Rr.stateNode,lt=Rr.memoizedProps.style,pe=lt!=null&&lt.hasOwnProperty("display")?lt.display:null,He.style.display=ns("display",pe))}catch(gi){yi(h,h.return,gi)}}}else if(Rr.tag===6){if(Ar===null)try{Rr.stateNode.nodeValue=Gt?"":Rr.memoizedProps}catch(gi){yi(h,h.return,gi)}}else if((Rr.tag!==22&&Rr.tag!==23||Rr.memoizedState===null||Rr===h)&&Rr.child!==null){Rr.child.return=Rr,Rr=Rr.child;continue}if(Rr===h)break e;for(;Rr.sibling===null;){if(Rr.return===null||Rr.return===h)break e;Ar===Rr&&(Ar=null),Rr=Rr.return}Ar===Rr&&(Ar=null),Rr.sibling.return=Rr.return,Rr=Rr.sibling}}break;case 19:m(p,h),v(h),C&4&&f(h);break;case 21:break;default:m(p,h),v(h)}}function v(h){var p=h.flags;if(p&2){try{e:{for(var b=h.return;b!==null;){if(Va(b)){var C=b;break e}b=b.return}throw Error(Z(160))}switch(C.tag){case 5:var z=C.stateNode;C.flags&32&&(Lo(z,""),C.flags&=-33);var H=ja(h);nu(h,H,z);break;case 3:case 4:var pe=C.stateNode.containerInfo,He=ja(h);Pl(h,He,pe);break;default:throw Error(Z(161))}}catch(lt){yi(h,h.return,lt)}h.flags&=-3}p&4096&&(h.flags&=-4097)}function w(h,p,b){Qr=h,E(h)}function E(h,p,b){for(var C=(h.mode&1)!==0;Qr!==null;){var z=Qr,H=z.child;if(z.tag===22&&C){var pe=z.memoizedState!==null||Pu;if(!pe){var He=z.alternate,lt=He!==null&&He.memoizedState!==null||Ko;He=Pu;var Gt=Ko;if(Pu=pe,(Ko=lt)&&!Gt)for(Qr=z;Qr!==null;)pe=Qr,lt=pe.child,pe.tag===22&&pe.memoizedState!==null?M(z):lt!==null?(lt.return=pe,Qr=lt):M(z);for(;H!==null;)Qr=H,E(H),H=H.sibling;Qr=z,Pu=He,Ko=Gt}A(h)}else(z.subtreeFlags&8772)!==0&&H!==null?(H.return=z,Qr=H):A(h)}}function A(h){for(;Qr!==null;){var p=Qr;if((p.flags&8772)!==0){var b=p.alternate;try{if((p.flags&8772)!==0)switch(p.tag){case 0:case 11:case 15:Ko||Ru(5,p);break;case 1:var C=p.stateNode;if(p.flags&4&&!Ko)if(b===null)C.componentDidMount();else{var z=p.elementType===p.type?b.memoizedProps:jo(p.type,b.memoizedProps);C.componentDidUpdate(z,b.memoizedState,C.__reactInternalSnapshotBeforeUpdate)}var H=p.updateQueue;H!==null&&Uf(p,H,C);break;case 3:var pe=p.updateQueue;if(pe!==null){if(b=null,p.child!==null)switch(p.child.tag){case 5:b=p.child.stateNode;break;case 1:b=p.child.stateNode}Uf(p,pe,b)}break;case 5:var He=p.stateNode;if(b===null&&p.flags&4){b=He;var lt=p.memoizedProps;switch(p.type){case"button":case"input":case"select":case"textarea":lt.autoFocus&&b.focus();break;case"img":lt.src&&(b.src=lt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(p.memoizedState===null){var Gt=p.alternate;if(Gt!==null){var Ar=Gt.memoizedState;if(Ar!==null){var Rr=Ar.dehydrated;Rr!==null&&Ia(Rr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}Ko||p.flags&512&&Du(p)}catch(Er){yi(p,p.return,Er)}}if(p===h){Qr=null;break}if(b=p.sibling,b!==null){b.return=p.return,Qr=b;break}Qr=p.return}}function P(h){for(;Qr!==null;){var p=Qr;if(p===h){Qr=null;break}var b=p.sibling;if(b!==null){b.return=p.return,Qr=b;break}Qr=p.return}}function M(h){for(;Qr!==null;){var p=Qr;try{switch(p.tag){case 0:case 11:case 15:var b=p.return;try{Ru(4,p)}catch(lt){yi(p,b,lt)}break;case 1:var C=p.stateNode;if(typeof C.componentDidMount=="function"){var z=p.return;try{C.componentDidMount()}catch(lt){yi(p,z,lt)}}var H=p.return;try{Du(p)}catch(lt){yi(p,H,lt)}break;case 5:var pe=p.return;try{Du(p)}catch(lt){yi(p,pe,lt)}}}catch(lt){yi(p,p.return,lt)}if(p===h){Qr=null;break}var He=p.sibling;if(He!==null){He.return=p.return,Qr=He;break}Qr=p.return}}var k=Math.ceil,q=st.ReactCurrentDispatcher,V=st.ReactCurrentOwner,$=st.ReactCurrentBatchConfig,U=0,ee=null,se=null,ae=0,xe=0,ye=pa(0),me=0,he=null,Te=0,Ae=0,rt=0,Ge=null,ft=null,mt=0,Bt=1/0,je=null,tt=!1,Ve=null,vt=null,it=!1,Et=null,yt=0,Mt=0,Dt=null,ur=-1,gr=0;function Kt(){return(U&6)!==0?ii():ur!==-1?ur:ur=ii()}function pr(h){return(h.mode&1)===0?1:(U&2)!==0&&ae!==0?ae&-ae:yp.transition!==null?(gr===0&&(gr=Be()),gr):(h=kr,h!==0||(h=window.event,h=h===void 0?16:Ou(h.type)),h)}function nr(h,p,b,C){if(50<Mt)throw Mt=0,Dt=null,Error(Z(185));wt(h,b,C),((U&2)===0||h!==ee)&&(h===ee&&((U&2)===0&&(Ae|=b),me===4&&ei(h,ae)),Ir(h,C),b===1&&U===0&&(p.mode&1)===0&&(Bt=ii()+500,yh&&Kl()))}function Ir(h,p){var b=h.callbackNode;te(h,p);var C=Cs(h,h===ee?ae:0);if(C===0)b!==null&&Jr(b),h.callbackNode=null,h.callbackPriority=0;else if(p=C&-C,h.callbackPriority!==p){if(b!=null&&Jr(b),p===1)h.tag===0?_p(Ln.bind(null,h)):jf(Ln.bind(null,h)),Yd(function(){(U&6)===0&&Kl()}),b=null;else{switch(mi(C)){case 1:b=wn;break;case 4:b=On;break;case 16:b=Vn;break;case 536870912:b=$o;break;default:b=Vn}b=Hs(b,Ur.bind(null,h))}h.callbackPriority=p,h.callbackNode=b}}function Ur(h,p){if(ur=-1,gr=0,(U&6)!==0)throw Error(Z(327));var b=h.callbackNode;if(on()&&h.callbackNode!==b)return null;var C=Cs(h,h===ee?ae:0);if(C===0)return null;if((C&30)!==0||(C&h.expiredLanes)!==0||p)p=Wn(h,C);else{p=C;var z=U;U|=2;var H=uo();(ee!==h||ae!==p)&&(je=null,Bt=ii()+500,Si(h,p));do try{ti();break}catch(He){Ki(h,He)}while(!0);wh(),q.current=H,U=z,se!==null?p=0:(ee=null,ae=0,p=me)}if(p!==0){if(p===2&&(z=we(h),z!==0&&(C=z,p=li(h,z))),p===1)throw b=he,Si(h,0),ei(h,C),Ir(h,ii()),b;if(p===6)ei(h,C);else{if(z=h.current.alternate,(C&30)===0&&!Yi(z)&&(p=Wn(h,C),p===2&&(H=we(h),H!==0&&(C=H,p=li(h,H))),p===1))throw b=he,Si(h,0),ei(h,C),Ir(h,ii()),b;switch(h.finishedWork=z,h.finishedLanes=C,p){case 0:case 1:throw Error(Z(345));case 2:en(h,ft,je);break;case 3:if(ei(h,C),(C&130023424)===C&&(p=mt+500-ii(),10<p)){if(Cs(h,0)!==0)break;if(z=h.suspendedLanes,(z&C)!==C){Kt(),h.pingedLanes|=h.suspendedLanes&z;break}h.timeoutHandle=Pc(en.bind(null,h,ft,je),p);break}en(h,ft,je);break;case 4:if(ei(h,C),(C&4194240)===C)break;for(p=h.eventTimes,z=-1;0<C;){var pe=31-mn(C);H=1<<pe,pe=p[pe],pe>z&&(z=pe),C&=~H}if(C=z,C=ii()-C,C=(120>C?120:480>C?480:1080>C?1080:1920>C?1920:3e3>C?3e3:4320>C?4320:1960*k(C/1960))-C,10<C){h.timeoutHandle=Pc(en.bind(null,h,ft,je),C);break}en(h,ft,je);break;case 5:en(h,ft,je);break;default:throw Error(Z(329))}}}return Ir(h,ii()),h.callbackNode===b?Ur.bind(null,h):null}function li(h,p){var b=Ge;return h.current.memoizedState.isDehydrated&&(Si(h,p).flags|=256),h=Wn(h,p),h!==2&&(p=ft,ft=b,p!==null&&Xi(p)),h}function Xi(h){ft===null?ft=h:ft.push.apply(ft,h)}function Yi(h){for(var p=h;;){if(p.flags&16384){var b=p.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var C=0;C<b.length;C++){var z=b[C],H=z.getSnapshot;z=z.value;try{if(!ka(H(),z))return!1}catch{return!1}}}if(b=p.child,p.subtreeFlags&16384&&b!==null)b.return=p,p=b;else{if(p===h)break;for(;p.sibling===null;){if(p.return===null||p.return===h)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function ei(h,p){for(p&=~rt,p&=~Ae,h.suspendedLanes|=p,h.pingedLanes&=~p,h=h.expirationTimes;0<p;){var b=31-mn(p),C=1<<b;h[b]=-1,p&=~C}}function Ln(h){if((U&6)!==0)throw Error(Z(327));on();var p=Cs(h,0);if((p&1)===0)return Ir(h,ii()),null;var b=Wn(h,p);if(h.tag!==0&&b===2){var C=we(h);C!==0&&(p=C,b=li(h,C))}if(b===1)throw b=he,Si(h,0),ei(h,p),Ir(h,ii()),b;if(b===6)throw Error(Z(345));return h.finishedWork=h.current.alternate,h.finishedLanes=p,en(h,ft,je),Ir(h,ii()),null}function _n(h,p){var b=U;U|=1;try{return h(p)}finally{U=b,U===0&&(Bt=ii()+500,yh&&Kl())}}function Hr(h){Et!==null&&Et.tag===0&&(U&6)===0&&on();var p=U;U|=1;var b=$.transition,C=kr;try{if($.transition=null,kr=1,h)return h()}finally{kr=C,$.transition=b,U=p,(U&6)===0&&Kl()}}function wi(){xe=ye.current,Un(ye)}function Si(h,p){h.finishedWork=null,h.finishedLanes=0;var b=h.timeoutHandle;if(b!==-1&&(h.timeoutHandle=-1,Zd(b)),se!==null)for(b=se.return;b!==null;){var C=b;switch(rd(C),C.tag){case 1:C=C.type.childContextTypes,C!=null&&kc();break;case 3:Ba(),Un(ws),Un(Bo),Zi();break;case 5:jc(C);break;case 4:Ba();break;case 13:Un(Kn);break;case 19:Un(Kn);break;case 10:Su(C.type._context);break;case 22:case 23:wi()}b=b.return}if(ee=h,se=h=wa(h.current,null),ae=xe=p,me=0,he=null,rt=Ae=Te=0,ft=Ge=null,ya!==null){for(p=0;p<ya.length;p++)if(b=ya[p],C=b.interleaved,C!==null){b.interleaved=null;var z=C.next,H=b.pending;if(H!==null){var pe=H.next;H.next=z,C.next=pe}b.pending=C}ya=null}return h}function Ki(h,p){do{var b=se;try{if(wh(),Tu.current=rc,tu){for(var C=_o.memoizedState;C!==null;){var z=C.queue;z!==null&&(z.pending=null),C=C.next}tu=!1}if(Eu=0,cs=Vo=_o=null,il=!1,Ut=0,V.current=null,b===null||b.return===null){me=1,he=p,se=null;break}e:{var H=h,pe=b.return,He=b,lt=p;if(p=ae,He.flags|=32768,lt!==null&&typeof lt=="object"&&typeof lt.then=="function"){var Gt=lt,Ar=He,Rr=Ar.tag;if((Ar.mode&1)===0&&(Rr===0||Rr===11||Rr===15)){var Er=Ar.alternate;Er?(Ar.updateQueue=Er.updateQueue,Ar.memoizedState=Er.memoizedState,Ar.lanes=Er.lanes):(Ar.updateQueue=null,Ar.memoizedState=null)}var Yr=Mu(pe);if(Yr!==null){Yr.flags&=-257,pd(Yr,pe,He,H,p),Yr.mode&1&&Lh(H,Gt,p),p=Yr,lt=Gt;var ui=p.updateQueue;if(ui===null){var gi=new Set;gi.add(lt),p.updateQueue=gi}else ui.add(lt);break e}else{if((p&1)===0){Lh(H,Gt,p),zn();break e}lt=Error(Z(426))}}else if(io&&He.mode&1){var qo=Mu(pe);if(qo!==null){(qo.flags&65536)===0&&(qo.flags|=256),pd(qo,pe,He,H,p),tl(ao(lt,He));break e}}H=lt=ao(lt,He),me!==4&&(me=2),Ge===null?Ge=[H]:Ge.push(H),H=pe;do{switch(H.tag){case 3:H.flags|=65536,p&=-p,H.lanes|=p;var kt=Xc(H,lt,p);tf(H,kt);break e;case 1:He=lt;var gt=H.type,Lt=H.stateNode;if((H.flags&128)===0&&(typeof gt.getDerivedStateFromError=="function"||Lt!==null&&typeof Lt.componentDidCatch=="function"&&(vt===null||!vt.has(Lt)))){H.flags|=65536,p&=-p,H.lanes|=p;var br=fd(H,He,p);tf(H,br);break e}}H=H.return}while(H!==null)}Li(b)}catch(vi){p=vi,se===b&&b!==null&&(se=b=b.return);continue}break}while(!0)}function uo(){var h=q.current;return q.current=rc,h===null?rc:h}function zn(){(me===0||me===3||me===2)&&(me=4),ee===null||(Te&268435455)===0&&(Ae&268435455)===0||ei(ee,ae)}function Wn(h,p){var b=U;U|=2;var C=uo();(ee!==h||ae!==p)&&(je=null,Si(h,p));do try{Tn();break}catch(z){Ki(h,z)}while(!0);if(wh(),U=b,q.current=C,se!==null)throw Error(Z(261));return ee=null,ae=0,me}function Tn(){for(;se!==null;)cn(se)}function ti(){for(;se!==null&&!Wi();)cn(se)}function cn(h){var p=Rl(h.alternate,h,xe);h.memoizedProps=h.pendingProps,p===null?Li(h):se=p,V.current=null}function Li(h){var p=h;do{var b=p.alternate;if(h=p.return,(p.flags&32768)===0){if(b=lo(b,p,xe),b!==null){se=b;return}}else{if(b=sl(b,p),b!==null){b.flags&=32767,se=b;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{me=6,se=null;return}}if(p=p.sibling,p!==null){se=p;return}se=p=h}while(p!==null);me===0&&(me=5)}function en(h,p,b){var C=kr,z=$.transition;try{$.transition=null,kr=1,Gi(h,p,b,C)}finally{$.transition=z,kr=C}return null}function Gi(h,p,b,C){do on();while(Et!==null);if((U&6)!==0)throw Error(Z(327));b=h.finishedWork;var z=h.finishedLanes;if(b===null)return null;if(h.finishedWork=null,h.finishedLanes=0,b===h.current)throw Error(Z(177));h.callbackNode=null,h.callbackPriority=0;var H=b.lanes|b.childLanes;if(Yt(h,H),h===ee&&(se=ee=null,ae=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||it||(it=!0,Hs(Vn,function(){return on(),null})),H=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||H){H=$.transition,$.transition=null;var pe=kr;kr=1;var He=U;U|=4,V.current=null,Na(h,b),_(b,h),za(Mc),ys=!!Cc,Mc=Cc=null,h.current=b,w(b),Mi(),U=He,kr=pe,$.transition=H}else h.current=b;if(it&&(it=!1,Et=h,yt=z),H=h.pendingLanes,H===0&&(vt=null),Yn(b.stateNode),Ir(h,ii()),p!==null)for(C=h.onRecoverableError,b=0;b<p.length;b++)z=p[b],C(z.value,{componentStack:z.stack,digest:z.digest});if(tt)throw tt=!1,h=Ve,Ve=null,h;return(yt&1)!==0&&h.tag!==0&&on(),H=h.pendingLanes,(H&1)!==0?h===Dt?Mt++:(Mt=0,Dt=h):Mt=0,Kl(),null}function on(){if(Et!==null){var h=mi(yt),p=$.transition,b=kr;try{if($.transition=null,kr=16>h?16:h,Et===null)var C=!1;else{if(h=Et,Et=null,yt=0,(U&6)!==0)throw Error(Z(331));var z=U;for(U|=4,Qr=h.current;Qr!==null;){var H=Qr,pe=H.child;if((Qr.flags&16)!==0){var He=H.deletions;if(He!==null){for(var lt=0;lt<He.length;lt++){var Gt=He[lt];for(Qr=Gt;Qr!==null;){var Ar=Qr;switch(Ar.tag){case 0:case 11:case 15:iu(8,Ar,H)}var Rr=Ar.child;if(Rr!==null)Rr.return=Ar,Qr=Rr;else for(;Qr!==null;){Ar=Qr;var Er=Ar.sibling,Yr=Ar.return;if(Ml(Ar),Ar===Gt){Qr=null;break}if(Er!==null){Er.return=Yr,Qr=Er;break}Qr=Yr}}}var ui=H.alternate;if(ui!==null){var gi=ui.child;if(gi!==null){ui.child=null;do{var qo=gi.sibling;gi.sibling=null,gi=qo}while(gi!==null)}}Qr=H}}if((H.subtreeFlags&2064)!==0&&pe!==null)pe.return=H,Qr=pe;else e:for(;Qr!==null;){if(H=Qr,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:iu(9,H,H.return)}var kt=H.sibling;if(kt!==null){kt.return=H.return,Qr=kt;break e}Qr=H.return}}var gt=h.current;for(Qr=gt;Qr!==null;){pe=Qr;var Lt=pe.child;if((pe.subtreeFlags&2064)!==0&&Lt!==null)Lt.return=pe,Qr=Lt;else e:for(pe=gt;Qr!==null;){if(He=Qr,(He.flags&2048)!==0)try{switch(He.tag){case 0:case 11:case 15:Ru(9,He)}}catch(vi){yi(He,He.return,vi)}if(He===pe){Qr=null;break e}var br=He.sibling;if(br!==null){br.return=He.return,Qr=br;break e}Qr=He.return}}if(U=z,Kl(),Fn&&typeof Fn.onPostCommitFiberRoot=="function")try{Fn.onPostCommitFiberRoot(Gn,h)}catch{}C=!0}return C}finally{kr=b,$.transition=p}}return!1}function To(h,p,b){p=ao(b,p),p=Xc(h,p,1),h=eu(h,p,1),p=Kt(),h!==null&&(wt(h,1,p),Ir(h,p))}function yi(h,p,b){if(h.tag===3)To(h,h,b);else for(;p!==null;){if(p.tag===3){To(p,h,b);break}else if(p.tag===1){var C=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(vt===null||!vt.has(C))){h=ao(b,h),h=fd(p,h,1),p=eu(p,h,1),h=Kt(),p!==null&&(wt(p,1,h),Ir(p,h));break}}p=p.return}}function Uo(h,p,b){var C=h.pingCache;C!==null&&C.delete(p),p=Kt(),h.pingedLanes|=h.suspendedLanes&b,ee===h&&(ae&b)===b&&(me===4||me===3&&(ae&130023424)===ae&&500>ii()-mt?Si(h,0):rt|=b),Ir(h,p)}function Jn(h,p){p===0&&((h.mode&1)===0?p=1:(p=Sa,Sa<<=1,(Sa&130023424)===0&&(Sa=4194304)));var b=Kt();h=Pr(h,p),h!==null&&(wt(h,p,b),Ir(h,b))}function Jo(h){var p=h.memoizedState,b=0;p!==null&&(b=p.retryLane),Jn(h,b)}function al(h,p){var b=0;switch(h.tag){case 13:var C=h.stateNode,z=h.memoizedState;z!==null&&(b=z.retryLane);break;case 19:C=h.stateNode;break;default:throw Error(Z(314))}C!==null&&C.delete(p),Jn(h,b)}var Rl;Rl=function(h,p,b){if(h!==null)if(h.memoizedProps!==p.pendingProps||ws.current)Zo=!0;else{if((h.lanes&b)===0&&(p.flags&128)===0)return Zo=!1,xp(h,p,b);Zo=(h.flags&131072)!==0}else Zo=!1,io&&(p.flags&1048576)!==0&&vh(p,Oc,p.index);switch(p.lanes=0,p.tag){case 2:var C=p.type;wd(h,p),h=p.pendingProps;var z=Xl(p,Bo.current);ir(p,b),z=Ze(null,p,C,h,z,b);var H=xa();return p.flags|=1,typeof z=="object"&&z!==null&&typeof z.render=="function"&&z.$$typeof===void 0?(p.tag=1,p.memoizedState=null,p.updateQueue=null,Ss(C)?(H=!0,Gu(p)):H=!1,p.memoizedState=z.state!==null&&z.state!==void 0?z.state:null,Qd(p),z.updater=ol,p.stateNode=z,z._reactInternals=p,Rh(p,C,h,b),p=_d(null,p,C,!0,H,b)):(p.tag=0,io&&H&&vl(p),Xo(null,p,z,b),p=p.child),p;case 16:C=p.elementType;e:{switch(wd(h,p),h=p.pendingProps,z=C._init,C=z(C._payload),p.type=C,z=p.tag=ll(C),h=jo(C,h),z){case 0:p=gd(null,p,C,h,b);break e;case 1:p=lf(null,p,C,h,b);break e;case 11:p=md(null,p,C,h,b);break e;case 14:p=Oh(null,p,C,jo(C.type,h),b);break e}throw Error(Z(306,C,""))}return p;case 0:return C=p.type,z=p.pendingProps,z=p.elementType===C?z:jo(C,z),gd(h,p,C,z,b);case 1:return C=p.type,z=p.pendingProps,z=p.elementType===C?z:jo(C,z),lf(h,p,C,z,b);case 3:e:{if(yd(p),h===null)throw Error(Z(387));C=p.pendingProps,H=p.memoizedState,z=H.element,ef(h,p),sd(p,C,null,b);var pe=p.memoizedState;if(C=pe.element,H.isDehydrated)if(H={element:C,isDehydrated:!1,cache:pe.cache,pendingSuspenseBoundaries:pe.pendingSuspenseBoundaries,transitions:pe.transitions},p.updateQueue.baseState=H,p.memoizedState=H,p.flags&256){z=ao(Error(Z(423)),p),p=uf(h,p,C,b,z);break e}else if(C!==z){z=ao(Error(Z(424)),p),p=uf(h,p,C,b,z);break e}else for(Us=$l(p.stateNode.containerInfo.firstChild),fo=p,io=!0,Oa=null,b=Nc(p,null,C,b),p.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Bc(),C===z){p=Qs(h,p,b);break e}Xo(h,p,C,b)}p=p.child}return p;case 5:return Sh(p),h===null&&nd(p),C=p.type,z=p.pendingProps,H=h!==null?h.memoizedProps:null,pe=z.children,yu(C,z)?pe=null:H!==null&&yu(C,H)&&(p.flags|=32),af(h,p),Xo(h,p,pe,b),p.child;case 6:return h===null&&nd(p),null;case 13:return cf(h,p,b);case 4:return Sl(p,p.stateNode.containerInfo),C=p.pendingProps,h===null?p.child=rl(p,null,C,b):Xo(h,p,C,b),p.child;case 11:return C=p.type,z=p.pendingProps,z=p.elementType===C?z:jo(C,z),md(h,p,C,z,b);case 7:return Xo(h,p,p.pendingProps,b),p.child;case 8:return Xo(h,p,p.pendingProps.children,b),p.child;case 12:return Xo(h,p,p.pendingProps.children,b),p.child;case 10:e:{if(C=p.type._context,z=p.pendingProps,H=p.memoizedProps,pe=z.value,ro(bu,C._currentValue),C._currentValue=pe,H!==null)if(ka(H.value,pe)){if(H.children===z.children&&!ws.current){p=Qs(h,p,b);break e}}else for(H=p.child,H!==null&&(H.return=p);H!==null;){var He=H.dependencies;if(He!==null){pe=H.child;for(var lt=He.firstContext;lt!==null;){if(lt.context===C){if(H.tag===1){lt=va(-1,b&-b),lt.tag=2;var Gt=H.updateQueue;if(Gt!==null){Gt=Gt.shared;var Ar=Gt.pending;Ar===null?lt.next=lt:(lt.next=Ar.next,Ar.next=lt),Gt.pending=lt}}H.lanes|=b,lt=H.alternate,lt!==null&&(lt.lanes|=b),Yu(H.return,b,p),He.lanes|=b;break}lt=lt.next}}else if(H.tag===10)pe=H.type===p.type?null:H.child;else if(H.tag===18){if(pe=H.return,pe===null)throw Error(Z(341));pe.lanes|=b,He=pe.alternate,He!==null&&(He.lanes|=b),Yu(pe,b,p),pe=H.sibling}else pe=H.child;if(pe!==null)pe.return=H;else for(pe=H;pe!==null;){if(pe===p){pe=null;break}if(H=pe.sibling,H!==null){H.return=pe.return,pe=H;break}pe=pe.return}H=pe}Xo(h,p,z.children,b),p=p.child}return p;case 9:return z=p.type,C=p.pendingProps.children,ir(p,b),z=Rs(z),C=C(z),p.flags|=1,Xo(h,p,C,b),p.child;case 14:return C=p.type,z=jo(C,p.pendingProps),z=jo(C.type,z),Oh(h,p,C,z,b);case 15:return sf(h,p,p.type,p.pendingProps,b);case 17:return C=p.type,z=p.pendingProps,z=p.elementType===C?z:jo(C,z),wd(h,p),p.tag=1,Ss(C)?(h=!0,Gu(p)):h=!1,ir(p,b),Ph(p,C,z),Rh(p,C,z,b),_d(null,p,C,!0,h,b);case 19:return hf(h,p,b);case 22:return Fh(h,p,b)}throw Error(Z(156,p.tag))};function Hs(h,p){return nn(h,p)}function Ua(h,p,b,C){this.tag=h,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ro(h,p,b,C){return new Ua(h,p,b,C)}function qa(h){return h=h.prototype,!(!h||!h.isReactComponent)}function ll(h){if(typeof h=="function")return qa(h)?1:0;if(h!=null){if(h=h.$$typeof,h===Zt)return 11;if(h===Or)return 14}return 2}function wa(h,p){var b=h.alternate;return b===null?(b=Ro(h.tag,p,h.key,h.mode),b.elementType=h.elementType,b.type=h.type,b.stateNode=h.stateNode,b.alternate=h,h.alternate=b):(b.pendingProps=p,b.type=h.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=h.flags&14680064,b.childLanes=h.childLanes,b.lanes=h.lanes,b.child=h.child,b.memoizedProps=h.memoizedProps,b.memoizedState=h.memoizedState,b.updateQueue=h.updateQueue,p=h.dependencies,b.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},b.sibling=h.sibling,b.index=h.index,b.ref=h.ref,b}function Dl(h,p,b,C,z,H){var pe=2;if(C=h,typeof h=="function")qa(h)&&(pe=1);else if(typeof h=="string")pe=5;else e:switch(h){case St:return kl(b.children,z,H,p);case dr:pe=8,z|=8;break;case Fr:return h=Ro(12,b,p,z|2),h.elementType=Fr,h.lanes=H,h;case fr:return h=Ro(13,b,p,z),h.elementType=fr,h.lanes=H,h;case Tr:return h=Ro(19,b,p,z),h.elementType=Tr,h.lanes=H,h;case fi:return oc(b,z,H,p);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case hi:pe=10;break e;case ht:pe=9;break e;case Zt:pe=11;break e;case Or:pe=14;break e;case ri:pe=16,C=null;break e}throw Error(Z(130,h==null?h:typeof h,""))}return p=Ro(pe,b,p,z),p.elementType=h,p.type=C,p.lanes=H,p}function kl(h,p,b,C){return h=Ro(7,h,C,p),h.lanes=b,h}function oc(h,p,b,C){return h=Ro(22,h,C,p),h.elementType=fi,h.lanes=b,h.stateNode={isHidden:!1},h}function Kc(h,p,b){return h=Ro(6,h,null,p),h.lanes=b,h}function sc(h,p,b){return p=Ro(4,h.children!==null?h.children:[],h.key,p),p.lanes=b,p.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},p}function yn(h,p,b,C,z){this.tag=p,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ct(0),this.expirationTimes=Ct(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ct(0),this.identifierPrefix=C,this.onRecoverableError=z,this.mutableSourceEagerHydrationData=null}function ku(h,p,b,C,z,H,pe,He,lt){return h=new yn(h,p,b,He,lt),p===1?(p=1,H===!0&&(p|=8)):p=0,H=Ro(3,null,null,p),h.current=H,H.stateNode=h,H.memoizedState={element:C,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},Qd(H),h}function df(h,p,b){var C=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:bt,key:C==null?null:""+C,children:h,containerInfo:p,implementation:b}}function bp(h){if(!h)return wo;h=h._reactInternals;e:{if(Qt(h)!==h||h.tag!==1)throw Error(Z(170));var p=h;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(Ss(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(Z(171))}if(h.tag===1){var b=h.type;if(Ss(b))return ed(h,b,p)}return p}function pm(h,p,b,C,z,H,pe,He,lt){return h=ku(b,C,!0,h,z,H,pe,He,lt),h.context=bp(null),b=h.current,C=Kt(),z=pr(b),H=va(C,z),H.callback=p??null,eu(b,H,z),h.current.lanes=z,wt(h,z,C),Ir(h,C),h}function Id(h,p,b,C){var z=p.current,H=Kt(),pe=pr(z);return b=bp(b),p.context===null?p.context=b:p.pendingContext=b,p=va(H,pe),p.payload={element:h},C=C===void 0?null:C,C!==null&&(p.callback=C),h=eu(z,p,pe),h!==null&&(nr(h,z,pe,H),od(h,z,pe)),pe}function ul(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function Lu(h,p){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var b=h.retryLane;h.retryLane=b!==0&&b<p?b:p}}function Zf(h,p){Lu(h,p),(h=h.alternate)&&Lu(h,p)}function mm(){return null}var ff=typeof reportError=="function"?reportError:function(h){console.error(h)};function pf(h){this._internalRoot=h}Jc.prototype.render=pf.prototype.render=function(h){var p=this._internalRoot;if(p===null)throw Error(Z(409));Id(h,p,null,null)},Jc.prototype.unmount=pf.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var p=h.containerInfo;Hr(function(){Id(null,h,null,null)}),p[Wl]=null}};function Jc(h){this._internalRoot=h}Jc.prototype.unstable_scheduleHydration=function(h){if(h){var p=ss();h={blockedOn:null,target:h,priority:p};for(var b=0;b<sa.length&&p!==0&&p<sa[b].priority;b++);sa.splice(b,0,h),b===0&&aa(h)}};function Ad(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function mf(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function gf(){}function wp(h,p,b,C,z){if(z){if(typeof C=="function"){var H=C;C=function(){var Gt=ul(pe);H.call(Gt)}}var pe=pm(p,C,h,0,null,!1,!1,"",gf);return h._reactRootContainer=pe,h[Wl]=pe.current,fh(h.nodeType===8?h.parentNode:h),Hr(),pe}for(;z=h.lastChild;)h.removeChild(z);if(typeof C=="function"){var He=C;C=function(){var Gt=ul(lt);He.call(Gt)}}var lt=ku(h,0,!1,null,null,!1,!1,"",gf);return h._reactRootContainer=lt,h[Wl]=lt.current,fh(h.nodeType===8?h.parentNode:h),Hr(function(){Id(p,lt,b,C)}),lt}function Cd(h,p,b,C,z){var H=b._reactRootContainer;if(H){var pe=H;if(typeof z=="function"){var He=z;z=function(){var lt=ul(pe);He.call(lt)}}Id(p,pe,h,z)}else pe=wp(b,p,h,z,C);return ul(pe)}Vi=function(h){switch(h.tag){case 3:var p=h.stateNode;if(p.current.memoizedState.isDehydrated){var b=Zs(p.pendingLanes);b!==0&&(Cr(p,b|1),Ir(p,ii()),(U&6)===0&&(Bt=ii()+500,Kl()))}break;case 13:Hr(function(){var C=Pr(h,1);if(C!==null){var z=Kt();nr(C,h,1,z)}}),Zf(h,1)}},jn=function(h){if(h.tag===13){var p=Pr(h,134217728);if(p!==null){var b=Kt();nr(p,h,134217728,b)}Zf(h,134217728)}},bo=function(h){if(h.tag===13){var p=pr(h),b=Pr(h,p);if(b!==null){var C=Kt();nr(b,h,p,C)}Zf(h,p)}},ss=function(){return kr},as=function(h,p){var b=kr;try{return kr=h,p()}finally{kr=b}},Es=function(h,p,b){switch(p){case"input":if(fs(h,b),p=b.name,b.type==="radio"&&p!=null){for(b=h;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+p)+'][type="radio"]'),p=0;p<b.length;p++){var C=b[p];if(C!==h&&C.form===h.form){var z=Dc(C);if(!z)throw Error(Z(90));xo(C),fs(C,z)}}}break;case"textarea":yo(h,b);break;case"select":p=b.value,p!=null&&ko(h,!!b.multiple,p,!1)}},pn=_n,gs=Hr;var gm={usingClientEntryPoint:!1,Events:[qu,vu,Dc,un,Ot,_n]},Md={findFiberByHostInstance:Zl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Qc={bundleType:Md.bundleType,version:Md.version,rendererPackageName:Md.rendererPackageName,rendererConfig:Md.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:st.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=Zr(h),h===null?null:h.stateNode},findFiberByHostInstance:Md.findFiberByHostInstance||mm,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _f=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_f.isDisabled&&_f.supportsFiber)try{Gn=_f.inject(Qc),Fn=_f}catch{}}return Ol.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=gm,Ol.createPortal=function(h,p){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ad(p))throw Error(Z(200));return df(h,p,null,b)},Ol.createRoot=function(h,p){if(!Ad(h))throw Error(Z(299));var b=!1,C="",z=ff;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(C=p.identifierPrefix),p.onRecoverableError!==void 0&&(z=p.onRecoverableError)),p=ku(h,1,!1,null,null,b,!1,C,z),h[Wl]=p.current,fh(h.nodeType===8?h.parentNode:h),new pf(p)},Ol.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var p=h._reactInternals;if(p===void 0)throw typeof h.render=="function"?Error(Z(188)):(h=Object.keys(h).join(","),Error(Z(268,h)));return h=Zr(p),h=h===null?null:h.stateNode,h},Ol.flushSync=function(h){return Hr(h)},Ol.hydrate=function(h,p,b){if(!mf(p))throw Error(Z(200));return Cd(null,h,p,!0,b)},Ol.hydrateRoot=function(h,p,b){if(!Ad(h))throw Error(Z(405));var C=b!=null&&b.hydratedSources||null,z=!1,H="",pe=ff;if(b!=null&&(b.unstable_strictMode===!0&&(z=!0),b.identifierPrefix!==void 0&&(H=b.identifierPrefix),b.onRecoverableError!==void 0&&(pe=b.onRecoverableError)),p=pm(p,null,h,1,b??null,z,!1,H,pe),h[Wl]=p.current,fh(h),C)for(h=0;h<C.length;h++)b=C[h],z=b._getVersion,z=z(b._source),p.mutableSourceEagerHydrationData==null?p.mutableSourceEagerHydrationData=[b,z]:p.mutableSourceEagerHydrationData.push(b,z);return new Jc(p)},Ol.render=function(h,p,b){if(!mf(p))throw Error(Z(200));return Cd(null,h,p,!1,b)},Ol.unmountComponentAtNode=function(h){if(!mf(h))throw Error(Z(40));return h._reactRootContainer?(Hr(function(){Cd(null,null,h,!1,function(){h._reactRootContainer=null,h[Wl]=null})}),!0):!1},Ol.unstable_batchedUpdates=_n,Ol.unstable_renderSubtreeIntoContainer=function(h,p,b,C){if(!mf(b))throw Error(Z(200));if(h==null||h._reactInternals===void 0)throw Error(Z(38));return Cd(h,p,b,!1,C)},Ol.version="18.3.1-next-f1338f8080-20240426",Ol}var t1;function jS(){if(t1)return q_.exports;t1=1;function L(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(L)}catch(Y){console.error(Y)}}return L(),q_.exports=VS(),q_.exports}var r1;function US(){if(r1)return cg;r1=1;var L=jS();return cg.createRoot=L.createRoot,cg.hydrateRoot=L.hydrateRoot,cg}var qS=US(),rm={},i1;function GS(){if(i1)return rm;i1=1,Object.defineProperty(rm,"__esModule",{value:!0}),rm.parse=be,rm.serialize=F;const L=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,Y=/^[\u0021-\u003A\u003C-\u007E]*$/,Z=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,Ee=/^[\u0020-\u003A\u003D-\u007E]*$/,ue=Object.prototype.toString,_e=(()=>{const Ne=function(){};return Ne.prototype=Object.create(null),Ne})();function be(Ne,Ye){const ze=new _e,Xe=Ne.length;if(Xe<2)return ze;const We=(Ye==null?void 0:Ye.decode)||fe;let De=0;do{const Ke=Ne.indexOf("=",De);if(Ke===-1)break;const et=Ne.indexOf(";",De),st=et===-1?Xe:et;if(Ke>st){De=Ne.lastIndexOf(";",Ke-1)+1;continue}const $e=s(Ne,De,Ke),bt=ne(Ne,Ke,$e),St=Ne.slice($e,bt);if(ze[St]===void 0){let dr=s(Ne,Ke+1,st),Fr=ne(Ne,st,dr);const hi=We(Ne.slice(dr,Fr));ze[St]=hi}De=st+1}while(De<Xe);return ze}function s(Ne,Ye,ze){do{const Xe=Ne.charCodeAt(Ye);if(Xe!==32&&Xe!==9)return Ye}while(++Ye<ze);return ze}function ne(Ne,Ye,ze){for(;Ye>ze;){const Xe=Ne.charCodeAt(--Ye);if(Xe!==32&&Xe!==9)return Ye+1}return ze}function F(Ne,Ye,ze){const Xe=(ze==null?void 0:ze.encode)||encodeURIComponent;if(!L.test(Ne))throw new TypeError(`argument name is invalid: ${Ne}`);const We=Xe(Ye);if(!Y.test(We))throw new TypeError(`argument val is invalid: ${Ye}`);let De=Ne+"="+We;if(!ze)return De;if(ze.maxAge!==void 0){if(!Number.isInteger(ze.maxAge))throw new TypeError(`option maxAge is invalid: ${ze.maxAge}`);De+="; Max-Age="+ze.maxAge}if(ze.domain){if(!Z.test(ze.domain))throw new TypeError(`option domain is invalid: ${ze.domain}`);De+="; Domain="+ze.domain}if(ze.path){if(!Ee.test(ze.path))throw new TypeError(`option path is invalid: ${ze.path}`);De+="; Path="+ze.path}if(ze.expires){if(!qe(ze.expires)||!Number.isFinite(ze.expires.valueOf()))throw new TypeError(`option expires is invalid: ${ze.expires}`);De+="; Expires="+ze.expires.toUTCString()}if(ze.httpOnly&&(De+="; HttpOnly"),ze.secure&&(De+="; Secure"),ze.partitioned&&(De+="; Partitioned"),ze.priority)switch(typeof ze.priority=="string"?ze.priority.toLowerCase():void 0){case"low":De+="; Priority=Low";break;case"medium":De+="; Priority=Medium";break;case"high":De+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${ze.priority}`)}if(ze.sameSite)switch(typeof ze.sameSite=="string"?ze.sameSite.toLowerCase():ze.sameSite){case!0:case"strict":De+="; SameSite=Strict";break;case"lax":De+="; SameSite=Lax";break;case"none":De+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${ze.sameSite}`)}return De}function fe(Ne){if(Ne.indexOf("%")===-1)return Ne;try{return decodeURIComponent(Ne)}catch{return Ne}}function qe(Ne){return ue.call(Ne)==="[object Date]"}return rm}GS();var n1="popstate";function HS(L={}){function Y(ue,_e){let{pathname:be="/",search:s="",hash:ne=""}=Lf(ue.location.hash.substring(1));return!be.startsWith("/")&&!be.startsWith(".")&&(be="/"+be),u0("",{pathname:be,search:s,hash:ne},_e.state&&_e.state.usr||null,_e.state&&_e.state.key||"default")}function Z(ue,_e){let be=ue.document.querySelector("base"),s="";if(be&&be.getAttribute("href")){let ne=ue.location.href,F=ne.indexOf("#");s=F===-1?ne:ne.slice(0,F)}return s+"#"+(typeof _e=="string"?_e:am(_e))}function Ee(ue,_e){gc(ue.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(_e)})`)}return WS(Y,Z,Ee,L)}function es(L,Y){if(L===!1||L===null||typeof L>"u")throw new Error(Y)}function gc(L,Y){if(!L){typeof console<"u"&&console.warn(Y);try{throw new Error(Y)}catch{}}}function $S(){return Math.random().toString(36).substring(2,10)}function o1(L,Y){return{usr:L.state,key:L.key,idx:Y}}function u0(L,Y,Z=null,Ee){return{pathname:typeof L=="string"?L:L.pathname,search:"",hash:"",...typeof Y=="string"?Lf(Y):Y,state:Z,key:Y&&Y.key||Ee||$S()}}function am({pathname:L="/",search:Y="",hash:Z=""}){return Y&&Y!=="?"&&(L+=Y.charAt(0)==="?"?Y:"?"+Y),Z&&Z!=="#"&&(L+=Z.charAt(0)==="#"?Z:"#"+Z),L}function Lf(L){let Y={};if(L){let Z=L.indexOf("#");Z>=0&&(Y.hash=L.substring(Z),L=L.substring(0,Z));let Ee=L.indexOf("?");Ee>=0&&(Y.search=L.substring(Ee),L=L.substring(0,Ee)),L&&(Y.pathname=L)}return Y}function WS(L,Y,Z,Ee={}){let{window:ue=document.defaultView,v5Compat:_e=!1}=Ee,be=ue.history,s="POP",ne=null,F=fe();F==null&&(F=0,be.replaceState({...be.state,idx:F},""));function fe(){return(be.state||{idx:null}).idx}function qe(){s="POP";let We=fe(),De=We==null?null:We-F;F=We,ne&&ne({action:s,location:Xe.location,delta:De})}function Ne(We,De){s="PUSH";let Ke=u0(Xe.location,We,De);Z&&Z(Ke,We),F=fe()+1;let et=o1(Ke,F),st=Xe.createHref(Ke);try{be.pushState(et,"",st)}catch($e){if($e instanceof DOMException&&$e.name==="DataCloneError")throw $e;ue.location.assign(st)}_e&&ne&&ne({action:s,location:Xe.location,delta:1})}function Ye(We,De){s="REPLACE";let Ke=u0(Xe.location,We,De);Z&&Z(Ke,We),F=fe();let et=o1(Ke,F),st=Xe.createHref(Ke);be.replaceState(et,"",st),_e&&ne&&ne({action:s,location:Xe.location,delta:0})}function ze(We){return ZS(We)}let Xe={get action(){return s},get location(){return L(ue,be)},listen(We){if(ne)throw new Error("A history only accepts one active listener");return ue.addEventListener(n1,qe),ne=We,()=>{ue.removeEventListener(n1,qe),ne=null}},createHref(We){return Y(ue,We)},createURL:ze,encodeLocation(We){let De=ze(We);return{pathname:De.pathname,search:De.search,hash:De.hash}},push:Ne,replace:Ye,go(We){return be.go(We)}};return Xe}function ZS(L,Y=!1){let Z="http://localhost";typeof window<"u"&&(Z=window.location.origin!=="null"?window.location.origin:window.location.href),es(Z,"No window.location.(origin|href) available to create URL");let Ee=typeof L=="string"?L:am(L);return Ee=Ee.replace(/ $/,"%20"),!Y&&Ee.startsWith("//")&&(Ee=Z+Ee),new URL(Ee,Z)}function ib(L,Y,Z="/"){return XS(L,Y,Z,!1)}function XS(L,Y,Z,Ee){let ue=typeof Y=="string"?Lf(Y):Y,_e=$h(ue.pathname||"/",Z);if(_e==null)return null;let be=nb(L);YS(be);let s=null;for(let ne=0;s==null&&ne<be.length;++ne){let F=aT(_e);s=oT(be[ne],F,Ee)}return s}function nb(L,Y=[],Z=[],Ee=""){let ue=(_e,be,s)=>{let ne={relativePath:s===void 0?_e.path||"":s,caseSensitive:_e.caseSensitive===!0,childrenIndex:be,route:_e};ne.relativePath.startsWith("/")&&(es(ne.relativePath.startsWith(Ee),`Absolute route path "${ne.relativePath}" nested under path "${Ee}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),ne.relativePath=ne.relativePath.slice(Ee.length));let F=Hh([Ee,ne.relativePath]),fe=Z.concat(ne);_e.children&&_e.children.length>0&&(es(_e.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${F}".`),nb(_e.children,Y,fe,F)),!(_e.path==null&&!_e.index)&&Y.push({path:F,score:iT(F,_e.index),routesMeta:fe})};return L.forEach((_e,be)=>{var s;if(_e.path===""||!((s=_e.path)!=null&&s.includes("?")))ue(_e,be);else for(let ne of ob(_e.path))ue(_e,be,ne)}),Y}function ob(L){let Y=L.split("/");if(Y.length===0)return[];let[Z,...Ee]=Y,ue=Z.endsWith("?"),_e=Z.replace(/\?$/,"");if(Ee.length===0)return ue?[_e,""]:[_e];let be=ob(Ee.join("/")),s=[];return s.push(...be.map(ne=>ne===""?_e:[_e,ne].join("/"))),ue&&s.push(...be),s.map(ne=>L.startsWith("/")&&ne===""?"/":ne)}function YS(L){L.sort((Y,Z)=>Y.score!==Z.score?Z.score-Y.score:nT(Y.routesMeta.map(Ee=>Ee.childrenIndex),Z.routesMeta.map(Ee=>Ee.childrenIndex)))}var KS=/^:[\w-]+$/,JS=3,QS=2,eT=1,tT=10,rT=-2,s1=L=>L==="*";function iT(L,Y){let Z=L.split("/"),Ee=Z.length;return Z.some(s1)&&(Ee+=rT),Y&&(Ee+=QS),Z.filter(ue=>!s1(ue)).reduce((ue,_e)=>ue+(KS.test(_e)?JS:_e===""?eT:tT),Ee)}function nT(L,Y){return L.length===Y.length&&L.slice(0,-1).every((Ee,ue)=>Ee===Y[ue])?L[L.length-1]-Y[Y.length-1]:0}function oT(L,Y,Z=!1){let{routesMeta:Ee}=L,ue={},_e="/",be=[];for(let s=0;s<Ee.length;++s){let ne=Ee[s],F=s===Ee.length-1,fe=_e==="/"?Y:Y.slice(_e.length)||"/",qe=xg({path:ne.relativePath,caseSensitive:ne.caseSensitive,end:F},fe),Ne=ne.route;if(!qe&&F&&Z&&!Ee[Ee.length-1].route.index&&(qe=xg({path:ne.relativePath,caseSensitive:ne.caseSensitive,end:!1},fe)),!qe)return null;Object.assign(ue,qe.params),be.push({params:ue,pathname:Hh([_e,qe.pathname]),pathnameBase:hT(Hh([_e,qe.pathnameBase])),route:Ne}),qe.pathnameBase!=="/"&&(_e=Hh([_e,qe.pathnameBase]))}return be}function xg(L,Y){typeof L=="string"&&(L={path:L,caseSensitive:!1,end:!0});let[Z,Ee]=sT(L.path,L.caseSensitive,L.end),ue=Y.match(Z);if(!ue)return null;let _e=ue[0],be=_e.replace(/(.)\/+$/,"$1"),s=ue.slice(1);return{params:Ee.reduce((F,{paramName:fe,isOptional:qe},Ne)=>{if(fe==="*"){let ze=s[Ne]||"";be=_e.slice(0,_e.length-ze.length).replace(/(.)\/+$/,"$1")}const Ye=s[Ne];return qe&&!Ye?F[fe]=void 0:F[fe]=(Ye||"").replace(/%2F/g,"/"),F},{}),pathname:_e,pathnameBase:be,pattern:L}}function sT(L,Y=!1,Z=!0){gc(L==="*"||!L.endsWith("*")||L.endsWith("/*"),`Route path "${L}" will be treated as if it were "${L.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${L.replace(/\*$/,"/*")}".`);let Ee=[],ue="^"+L.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(be,s,ne)=>(Ee.push({paramName:s,isOptional:ne!=null}),ne?"/?([^\\/]+)?":"/([^\\/]+)"));return L.endsWith("*")?(Ee.push({paramName:"*"}),ue+=L==="*"||L==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):Z?ue+="\\/*$":L!==""&&L!=="/"&&(ue+="(?:(?=\\/|$))"),[new RegExp(ue,Y?void 0:"i"),Ee]}function aT(L){try{return L.split("/").map(Y=>decodeURIComponent(Y).replace(/\//g,"%2F")).join("/")}catch(Y){return gc(!1,`The URL path "${L}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${Y}).`),L}}function $h(L,Y){if(Y==="/")return L;if(!L.toLowerCase().startsWith(Y.toLowerCase()))return null;let Z=Y.endsWith("/")?Y.length-1:Y.length,Ee=L.charAt(Z);return Ee&&Ee!=="/"?null:L.slice(Z)||"/"}function lT(L,Y="/"){let{pathname:Z,search:Ee="",hash:ue=""}=typeof L=="string"?Lf(L):L;return{pathname:Z?Z.startsWith("/")?Z:uT(Z,Y):Y,search:dT(Ee),hash:fT(ue)}}function uT(L,Y){let Z=Y.replace(/\/+$/,"").split("/");return L.split("/").forEach(ue=>{ue===".."?Z.length>1&&Z.pop():ue!=="."&&Z.push(ue)}),Z.length>1?Z.join("/"):"/"}function $_(L,Y,Z,Ee){return`Cannot include a '${L}' character in a manually specified \`to.${Y}\` field [${JSON.stringify(Ee)}].  Please separate it out to the \`to.${Z}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function cT(L){return L.filter((Y,Z)=>Z===0||Y.route.path&&Y.route.path.length>0)}function sb(L){let Y=cT(L);return Y.map((Z,Ee)=>Ee===Y.length-1?Z.pathname:Z.pathnameBase)}function ab(L,Y,Z,Ee=!1){let ue;typeof L=="string"?ue=Lf(L):(ue={...L},es(!ue.pathname||!ue.pathname.includes("?"),$_("?","pathname","search",ue)),es(!ue.pathname||!ue.pathname.includes("#"),$_("#","pathname","hash",ue)),es(!ue.search||!ue.search.includes("#"),$_("#","search","hash",ue)));let _e=L===""||ue.pathname==="",be=_e?"/":ue.pathname,s;if(be==null)s=Z;else{let qe=Y.length-1;if(!Ee&&be.startsWith("..")){let Ne=be.split("/");for(;Ne[0]==="..";)Ne.shift(),qe-=1;ue.pathname=Ne.join("/")}s=qe>=0?Y[qe]:"/"}let ne=lT(ue,s),F=be&&be!=="/"&&be.endsWith("/"),fe=(_e||be===".")&&Z.endsWith("/");return!ne.pathname.endsWith("/")&&(F||fe)&&(ne.pathname+="/"),ne}var Hh=L=>L.join("/").replace(/\/\/+/g,"/"),hT=L=>L.replace(/\/+$/,"").replace(/^\/*/,"/"),dT=L=>!L||L==="?"?"":L.startsWith("?")?L:"?"+L,fT=L=>!L||L==="#"?"":L.startsWith("#")?L:"#"+L;function pT(L){return L!=null&&typeof L.status=="number"&&typeof L.statusText=="string"&&typeof L.internal=="boolean"&&"data"in L}var lb=["POST","PUT","PATCH","DELETE"];new Set(lb);var mT=["GET",...lb];new Set(mT);var hp=cr.createContext(null);hp.displayName="DataRouter";var Sg=cr.createContext(null);Sg.displayName="DataRouterState";var ub=cr.createContext({isTransitioning:!1});ub.displayName="ViewTransition";var gT=cr.createContext(new Map);gT.displayName="Fetchers";var _T=cr.createContext(null);_T.displayName="Await";var nh=cr.createContext(null);nh.displayName="Navigation";var um=cr.createContext(null);um.displayName="Location";var Zh=cr.createContext({outlet:null,matches:[],isDataRoute:!1});Zh.displayName="Route";var _0=cr.createContext(null);_0.displayName="RouteError";function yT(L,{relative:Y}={}){es(cm(),"useHref() may be used only in the context of a <Router> component.");let{basename:Z,navigator:Ee}=cr.useContext(nh),{hash:ue,pathname:_e,search:be}=hm(L,{relative:Y}),s=_e;return Z!=="/"&&(s=_e==="/"?Z:Hh([Z,_e])),Ee.createHref({pathname:s,search:be,hash:ue})}function cm(){return cr.useContext(um)!=null}function zf(){return es(cm(),"useLocation() may be used only in the context of a <Router> component."),cr.useContext(um).location}var cb="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function hb(L){cr.useContext(nh).static||cr.useLayoutEffect(L)}function vT(){let{isDataRoute:L}=cr.useContext(Zh);return L?DT():xT()}function xT(){es(cm(),"useNavigate() may be used only in the context of a <Router> component.");let L=cr.useContext(hp),{basename:Y,navigator:Z}=cr.useContext(nh),{matches:Ee}=cr.useContext(Zh),{pathname:ue}=zf(),_e=JSON.stringify(sb(Ee)),be=cr.useRef(!1);return hb(()=>{be.current=!0}),cr.useCallback((ne,F={})=>{if(gc(be.current,cb),!be.current)return;if(typeof ne=="number"){Z.go(ne);return}let fe=ab(ne,JSON.parse(_e),ue,F.relative==="path");L==null&&Y!=="/"&&(fe.pathname=fe.pathname==="/"?Y:Hh([Y,fe.pathname])),(F.replace?Z.replace:Z.push)(fe,F.state,F)},[Y,Z,_e,ue,L])}cr.createContext(null);function hm(L,{relative:Y}={}){let{matches:Z}=cr.useContext(Zh),{pathname:Ee}=zf(),ue=JSON.stringify(sb(Z));return cr.useMemo(()=>ab(L,JSON.parse(ue),Ee,Y==="path"),[L,ue,Ee,Y])}function bT(L,Y){return db(L,Y)}function db(L,Y,Z,Ee){var Ke;es(cm(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:ue,static:_e}=cr.useContext(nh),{matches:be}=cr.useContext(Zh),s=be[be.length-1],ne=s?s.params:{},F=s?s.pathname:"/",fe=s?s.pathnameBase:"/",qe=s&&s.route;{let et=qe&&qe.path||"";fb(F,!qe||et.endsWith("*")||et.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${F}" (under <Route path="${et}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${et}"> to <Route path="${et==="/"?"*":`${et}/*`}">.`)}let Ne=zf(),Ye;if(Y){let et=typeof Y=="string"?Lf(Y):Y;es(fe==="/"||((Ke=et.pathname)==null?void 0:Ke.startsWith(fe)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${fe}" but pathname "${et.pathname}" was given in the \`location\` prop.`),Ye=et}else Ye=Ne;let ze=Ye.pathname||"/",Xe=ze;if(fe!=="/"){let et=fe.replace(/^\//,"").split("/");Xe="/"+ze.replace(/^\//,"").split("/").slice(et.length).join("/")}let We=!_e&&Z&&Z.matches&&Z.matches.length>0?Z.matches:ib(L,{pathname:Xe});gc(qe||We!=null,`No routes matched location "${Ye.pathname}${Ye.search}${Ye.hash}" `),gc(We==null||We[We.length-1].route.element!==void 0||We[We.length-1].route.Component!==void 0||We[We.length-1].route.lazy!==void 0,`Matched leaf route at location "${Ye.pathname}${Ye.search}${Ye.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let De=IT(We&&We.map(et=>Object.assign({},et,{params:Object.assign({},ne,et.params),pathname:Hh([fe,ue.encodeLocation?ue.encodeLocation(et.pathname).pathname:et.pathname]),pathnameBase:et.pathnameBase==="/"?fe:Hh([fe,ue.encodeLocation?ue.encodeLocation(et.pathnameBase).pathname:et.pathnameBase])})),be,Z,Ee);return Y&&De?cr.createElement(um.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Ye},navigationType:"POP"}},De):De}function wT(){let L=RT(),Y=pT(L)?`${L.status} ${L.statusText}`:L instanceof Error?L.message:JSON.stringify(L),Z=L instanceof Error?L.stack:null,Ee="rgba(200,200,200, 0.5)",ue={padding:"0.5rem",backgroundColor:Ee},_e={padding:"2px 4px",backgroundColor:Ee},be=null;return console.error("Error handled by React Router default ErrorBoundary:",L),be=cr.createElement(cr.Fragment,null,cr.createElement("p",null," Hey developer "),cr.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",cr.createElement("code",{style:_e},"ErrorBoundary")," or"," ",cr.createElement("code",{style:_e},"errorElement")," prop on your route.")),cr.createElement(cr.Fragment,null,cr.createElement("h2",null,"Unexpected Application Error!"),cr.createElement("h3",{style:{fontStyle:"italic"}},Y),Z?cr.createElement("pre",{style:ue},Z):null,be)}var ST=cr.createElement(wT,null),TT=class extends cr.Component{constructor(L){super(L),this.state={location:L.location,revalidation:L.revalidation,error:L.error}}static getDerivedStateFromError(L){return{error:L}}static getDerivedStateFromProps(L,Y){return Y.location!==L.location||Y.revalidation!=="idle"&&L.revalidation==="idle"?{error:L.error,location:L.location,revalidation:L.revalidation}:{error:L.error!==void 0?L.error:Y.error,location:Y.location,revalidation:L.revalidation||Y.revalidation}}componentDidCatch(L,Y){console.error("React Router caught the following error during render",L,Y)}render(){return this.state.error!==void 0?cr.createElement(Zh.Provider,{value:this.props.routeContext},cr.createElement(_0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function ET({routeContext:L,match:Y,children:Z}){let Ee=cr.useContext(hp);return Ee&&Ee.static&&Ee.staticContext&&(Y.route.errorElement||Y.route.ErrorBoundary)&&(Ee.staticContext._deepestRenderedBoundaryId=Y.route.id),cr.createElement(Zh.Provider,{value:L},Z)}function IT(L,Y=[],Z=null,Ee=null){if(L==null){if(!Z)return null;if(Z.errors)L=Z.matches;else if(Y.length===0&&!Z.initialized&&Z.matches.length>0)L=Z.matches;else return null}let ue=L,_e=Z==null?void 0:Z.errors;if(_e!=null){let ne=ue.findIndex(F=>F.route.id&&(_e==null?void 0:_e[F.route.id])!==void 0);es(ne>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(_e).join(",")}`),ue=ue.slice(0,Math.min(ue.length,ne+1))}let be=!1,s=-1;if(Z)for(let ne=0;ne<ue.length;ne++){let F=ue[ne];if((F.route.HydrateFallback||F.route.hydrateFallbackElement)&&(s=ne),F.route.id){let{loaderData:fe,errors:qe}=Z,Ne=F.route.loader&&!fe.hasOwnProperty(F.route.id)&&(!qe||qe[F.route.id]===void 0);if(F.route.lazy||Ne){be=!0,s>=0?ue=ue.slice(0,s+1):ue=[ue[0]];break}}}return ue.reduceRight((ne,F,fe)=>{let qe,Ne=!1,Ye=null,ze=null;Z&&(qe=_e&&F.route.id?_e[F.route.id]:void 0,Ye=F.route.errorElement||ST,be&&(s<0&&fe===0?(fb("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Ne=!0,ze=null):s===fe&&(Ne=!0,ze=F.route.hydrateFallbackElement||null)));let Xe=Y.concat(ue.slice(0,fe+1)),We=()=>{let De;return qe?De=Ye:Ne?De=ze:F.route.Component?De=cr.createElement(F.route.Component,null):F.route.element?De=F.route.element:De=ne,cr.createElement(ET,{match:F,routeContext:{outlet:ne,matches:Xe,isDataRoute:Z!=null},children:De})};return Z&&(F.route.ErrorBoundary||F.route.errorElement||fe===0)?cr.createElement(TT,{location:Z.location,revalidation:Z.revalidation,component:Ye,error:qe,children:We(),routeContext:{outlet:null,matches:Xe,isDataRoute:!0}}):We()},null)}function y0(L){return`${L} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function AT(L){let Y=cr.useContext(hp);return es(Y,y0(L)),Y}function CT(L){let Y=cr.useContext(Sg);return es(Y,y0(L)),Y}function MT(L){let Y=cr.useContext(Zh);return es(Y,y0(L)),Y}function v0(L){let Y=MT(L),Z=Y.matches[Y.matches.length-1];return es(Z.route.id,`${L} can only be used on routes that contain a unique "id"`),Z.route.id}function PT(){return v0("useRouteId")}function RT(){var Ee;let L=cr.useContext(_0),Y=CT("useRouteError"),Z=v0("useRouteError");return L!==void 0?L:(Ee=Y.errors)==null?void 0:Ee[Z]}function DT(){let{router:L}=AT("useNavigate"),Y=v0("useNavigate"),Z=cr.useRef(!1);return hb(()=>{Z.current=!0}),cr.useCallback(async(ue,_e={})=>{gc(Z.current,cb),Z.current&&(typeof ue=="number"?L.navigate(ue):await L.navigate(ue,{fromRouteId:Y,..._e}))},[L,Y])}var a1={};function fb(L,Y,Z){!Y&&!a1[L]&&(a1[L]=!0,gc(!1,Z))}cr.memo(kT);function kT({routes:L,future:Y,state:Z}){return db(L,void 0,Z,Y)}function nm(L){es(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function LT({basename:L="/",children:Y=null,location:Z,navigationType:Ee="POP",navigator:ue,static:_e=!1}){es(!cm(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let be=L.replace(/^\/*/,"/"),s=cr.useMemo(()=>({basename:be,navigator:ue,static:_e,future:{}}),[be,ue,_e]);typeof Z=="string"&&(Z=Lf(Z));let{pathname:ne="/",search:F="",hash:fe="",state:qe=null,key:Ne="default"}=Z,Ye=cr.useMemo(()=>{let ze=$h(ne,be);return ze==null?null:{location:{pathname:ze,search:F,hash:fe,state:qe,key:Ne},navigationType:Ee}},[be,ne,F,fe,qe,Ne,Ee]);return gc(Ye!=null,`<Router basename="${be}"> is not able to match the URL "${ne}${F}${fe}" because it does not start with the basename, so the <Router> won't render anything.`),Ye==null?null:cr.createElement(nh.Provider,{value:s},cr.createElement(um.Provider,{children:Y,value:Ye}))}function zT({children:L,location:Y}){return bT(c0(L),Y)}function c0(L,Y=[]){let Z=[];return cr.Children.forEach(L,(Ee,ue)=>{if(!cr.isValidElement(Ee))return;let _e=[...Y,ue];if(Ee.type===cr.Fragment){Z.push.apply(Z,c0(Ee.props.children,_e));return}es(Ee.type===nm,`[${typeof Ee.type=="string"?Ee.type:Ee.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),es(!Ee.props.index||!Ee.props.children,"An index route cannot have child routes.");let be={id:Ee.props.id||_e.join("-"),caseSensitive:Ee.props.caseSensitive,element:Ee.props.element,Component:Ee.props.Component,index:Ee.props.index,path:Ee.props.path,loader:Ee.props.loader,action:Ee.props.action,hydrateFallbackElement:Ee.props.hydrateFallbackElement,HydrateFallback:Ee.props.HydrateFallback,errorElement:Ee.props.errorElement,ErrorBoundary:Ee.props.ErrorBoundary,hasErrorBoundary:Ee.props.hasErrorBoundary===!0||Ee.props.ErrorBoundary!=null||Ee.props.errorElement!=null,shouldRevalidate:Ee.props.shouldRevalidate,handle:Ee.props.handle,lazy:Ee.props.lazy};Ee.props.children&&(be.children=c0(Ee.props.children,_e)),Z.push(be)}),Z}var _g="get",yg="application/x-www-form-urlencoded";function Tg(L){return L!=null&&typeof L.tagName=="string"}function OT(L){return Tg(L)&&L.tagName.toLowerCase()==="button"}function FT(L){return Tg(L)&&L.tagName.toLowerCase()==="form"}function BT(L){return Tg(L)&&L.tagName.toLowerCase()==="input"}function NT(L){return!!(L.metaKey||L.altKey||L.ctrlKey||L.shiftKey)}function VT(L,Y){return L.button===0&&(!Y||Y==="_self")&&!NT(L)}var hg=null;function jT(){if(hg===null)try{new FormData(document.createElement("form"),0),hg=!1}catch{hg=!0}return hg}var UT=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function W_(L){return L!=null&&!UT.has(L)?(gc(!1,`"${L}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${yg}"`),null):L}function qT(L,Y){let Z,Ee,ue,_e,be;if(FT(L)){let s=L.getAttribute("action");Ee=s?$h(s,Y):null,Z=L.getAttribute("method")||_g,ue=W_(L.getAttribute("enctype"))||yg,_e=new FormData(L)}else if(OT(L)||BT(L)&&(L.type==="submit"||L.type==="image")){let s=L.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let ne=L.getAttribute("formaction")||s.getAttribute("action");if(Ee=ne?$h(ne,Y):null,Z=L.getAttribute("formmethod")||s.getAttribute("method")||_g,ue=W_(L.getAttribute("formenctype"))||W_(s.getAttribute("enctype"))||yg,_e=new FormData(s,L),!jT()){let{name:F,type:fe,value:qe}=L;if(fe==="image"){let Ne=F?`${F}.`:"";_e.append(`${Ne}x`,"0"),_e.append(`${Ne}y`,"0")}else F&&_e.append(F,qe)}}else{if(Tg(L))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');Z=_g,Ee=null,ue=yg,be=L}return _e&&ue==="text/plain"&&(be=_e,_e=void 0),{action:Ee,method:Z.toLowerCase(),encType:ue,formData:_e,body:be}}function x0(L,Y){if(L===!1||L===null||typeof L>"u")throw new Error(Y)}async function GT(L,Y){if(L.id in Y)return Y[L.id];try{let Z=await import(L.module);return Y[L.id]=Z,Z}catch(Z){return console.error(`Error loading route module \`${L.module}\`, reloading page...`),console.error(Z),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function HT(L){return L==null?!1:L.href==null?L.rel==="preload"&&typeof L.imageSrcSet=="string"&&typeof L.imageSizes=="string":typeof L.rel=="string"&&typeof L.href=="string"}async function $T(L,Y,Z){let Ee=await Promise.all(L.map(async ue=>{let _e=Y.routes[ue.route.id];if(_e){let be=await GT(_e,Z);return be.links?be.links():[]}return[]}));return YT(Ee.flat(1).filter(HT).filter(ue=>ue.rel==="stylesheet"||ue.rel==="preload").map(ue=>ue.rel==="stylesheet"?{...ue,rel:"prefetch",as:"style"}:{...ue,rel:"prefetch"}))}function l1(L,Y,Z,Ee,ue,_e){let be=(ne,F)=>Z[F]?ne.route.id!==Z[F].route.id:!0,s=(ne,F)=>{var fe;return Z[F].pathname!==ne.pathname||((fe=Z[F].route.path)==null?void 0:fe.endsWith("*"))&&Z[F].params["*"]!==ne.params["*"]};return _e==="assets"?Y.filter((ne,F)=>be(ne,F)||s(ne,F)):_e==="data"?Y.filter((ne,F)=>{var qe;let fe=Ee.routes[ne.route.id];if(!fe||!fe.hasLoader)return!1;if(be(ne,F)||s(ne,F))return!0;if(ne.route.shouldRevalidate){let Ne=ne.route.shouldRevalidate({currentUrl:new URL(ue.pathname+ue.search+ue.hash,window.origin),currentParams:((qe=Z[0])==null?void 0:qe.params)||{},nextUrl:new URL(L,window.origin),nextParams:ne.params,defaultShouldRevalidate:!0});if(typeof Ne=="boolean")return Ne}return!0}):[]}function WT(L,Y,{includeHydrateFallback:Z}={}){return ZT(L.map(Ee=>{let ue=Y.routes[Ee.route.id];if(!ue)return[];let _e=[ue.module];return ue.clientActionModule&&(_e=_e.concat(ue.clientActionModule)),ue.clientLoaderModule&&(_e=_e.concat(ue.clientLoaderModule)),Z&&ue.hydrateFallbackModule&&(_e=_e.concat(ue.hydrateFallbackModule)),ue.imports&&(_e=_e.concat(ue.imports)),_e}).flat(1))}function ZT(L){return[...new Set(L)]}function XT(L){let Y={},Z=Object.keys(L).sort();for(let Ee of Z)Y[Ee]=L[Ee];return Y}function YT(L,Y){let Z=new Set;return new Set(Y),L.reduce((Ee,ue)=>{let _e=JSON.stringify(XT(ue));return Z.has(_e)||(Z.add(_e),Ee.push({key:_e,link:ue})),Ee},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var KT=new Set([100,101,204,205]);function JT(L,Y){let Z=typeof L=="string"?new URL(L,typeof window>"u"?"server://singlefetch/":window.location.origin):L;return Z.pathname==="/"?Z.pathname="_root.data":Y&&$h(Z.pathname,Y)==="/"?Z.pathname=`${Y.replace(/\/$/,"")}/_root.data`:Z.pathname=`${Z.pathname.replace(/\/$/,"")}.data`,Z}function pb(){let L=cr.useContext(hp);return x0(L,"You must render this element inside a <DataRouterContext.Provider> element"),L}function QT(){let L=cr.useContext(Sg);return x0(L,"You must render this element inside a <DataRouterStateContext.Provider> element"),L}var b0=cr.createContext(void 0);b0.displayName="FrameworkContext";function mb(){let L=cr.useContext(b0);return x0(L,"You must render this element inside a <HydratedRouter> element"),L}function eE(L,Y){let Z=cr.useContext(b0),[Ee,ue]=cr.useState(!1),[_e,be]=cr.useState(!1),{onFocus:s,onBlur:ne,onMouseEnter:F,onMouseLeave:fe,onTouchStart:qe}=Y,Ne=cr.useRef(null);cr.useEffect(()=>{if(L==="render"&&be(!0),L==="viewport"){let Xe=De=>{De.forEach(Ke=>{be(Ke.isIntersecting)})},We=new IntersectionObserver(Xe,{threshold:.5});return Ne.current&&We.observe(Ne.current),()=>{We.disconnect()}}},[L]),cr.useEffect(()=>{if(Ee){let Xe=setTimeout(()=>{be(!0)},100);return()=>{clearTimeout(Xe)}}},[Ee]);let Ye=()=>{ue(!0)},ze=()=>{ue(!1),be(!1)};return Z?L!=="intent"?[_e,Ne,{}]:[_e,Ne,{onFocus:im(s,Ye),onBlur:im(ne,ze),onMouseEnter:im(F,Ye),onMouseLeave:im(fe,ze),onTouchStart:im(qe,Ye)}]:[!1,Ne,{}]}function im(L,Y){return Z=>{L&&L(Z),Z.defaultPrevented||Y(Z)}}function tE({page:L,...Y}){let{router:Z}=pb(),Ee=cr.useMemo(()=>ib(Z.routes,L,Z.basename),[Z.routes,L,Z.basename]);return Ee?cr.createElement(iE,{page:L,matches:Ee,...Y}):null}function rE(L){let{manifest:Y,routeModules:Z}=mb(),[Ee,ue]=cr.useState([]);return cr.useEffect(()=>{let _e=!1;return $T(L,Y,Z).then(be=>{_e||ue(be)}),()=>{_e=!0}},[L,Y,Z]),Ee}function iE({page:L,matches:Y,...Z}){let Ee=zf(),{manifest:ue,routeModules:_e}=mb(),{basename:be}=pb(),{loaderData:s,matches:ne}=QT(),F=cr.useMemo(()=>l1(L,Y,ne,ue,Ee,"data"),[L,Y,ne,ue,Ee]),fe=cr.useMemo(()=>l1(L,Y,ne,ue,Ee,"assets"),[L,Y,ne,ue,Ee]),qe=cr.useMemo(()=>{if(L===Ee.pathname+Ee.search+Ee.hash)return[];let ze=new Set,Xe=!1;if(Y.forEach(De=>{var et;let Ke=ue.routes[De.route.id];!Ke||!Ke.hasLoader||(!F.some(st=>st.route.id===De.route.id)&&De.route.id in s&&((et=_e[De.route.id])!=null&&et.shouldRevalidate)||Ke.hasClientLoader?Xe=!0:ze.add(De.route.id))}),ze.size===0)return[];let We=JT(L,be);return Xe&&ze.size>0&&We.searchParams.set("_routes",Y.filter(De=>ze.has(De.route.id)).map(De=>De.route.id).join(",")),[We.pathname+We.search]},[be,s,Ee,ue,F,Y,L,_e]),Ne=cr.useMemo(()=>WT(fe,ue),[fe,ue]),Ye=rE(fe);return cr.createElement(cr.Fragment,null,qe.map(ze=>cr.createElement("link",{key:ze,rel:"prefetch",as:"fetch",href:ze,...Z})),Ne.map(ze=>cr.createElement("link",{key:ze,rel:"modulepreload",href:ze,...Z})),Ye.map(({key:ze,link:Xe})=>cr.createElement("link",{key:ze,...Xe})))}function nE(...L){return Y=>{L.forEach(Z=>{typeof Z=="function"?Z(Y):Z!=null&&(Z.current=Y)})}}var gb=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{gb&&(window.__reactRouterVersion="7.6.0")}catch{}function oE({basename:L,children:Y,window:Z}){let Ee=cr.useRef();Ee.current==null&&(Ee.current=HS({window:Z,v5Compat:!0}));let ue=Ee.current,[_e,be]=cr.useState({action:ue.action,location:ue.location}),s=cr.useCallback(ne=>{cr.startTransition(()=>be(ne))},[be]);return cr.useLayoutEffect(()=>ue.listen(s),[ue,s]),cr.createElement(LT,{basename:L,children:Y,location:_e.location,navigationType:_e.action,navigator:ue})}var _b=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Di=cr.forwardRef(function({onClick:Y,discover:Z="render",prefetch:Ee="none",relative:ue,reloadDocument:_e,replace:be,state:s,target:ne,to:F,preventScrollReset:fe,viewTransition:qe,...Ne},Ye){let{basename:ze}=cr.useContext(nh),Xe=typeof F=="string"&&_b.test(F),We,De=!1;if(typeof F=="string"&&Xe&&(We=F,gb))try{let Fr=new URL(window.location.href),hi=F.startsWith("//")?new URL(Fr.protocol+F):new URL(F),ht=$h(hi.pathname,ze);hi.origin===Fr.origin&&ht!=null?F=ht+hi.search+hi.hash:De=!0}catch{gc(!1,`<Link to="${F}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Ke=yT(F,{relative:ue}),[et,st,$e]=eE(Ee,Ne),bt=uE(F,{replace:be,state:s,target:ne,preventScrollReset:fe,relative:ue,viewTransition:qe});function St(Fr){Y&&Y(Fr),Fr.defaultPrevented||bt(Fr)}let dr=cr.createElement("a",{...Ne,...$e,href:We||Ke,onClick:De||_e?Y:St,ref:nE(Ye,st),target:ne,"data-discover":!Xe&&Z==="render"?"true":void 0});return et&&!Xe?cr.createElement(cr.Fragment,null,dr,cr.createElement(tE,{page:Ke})):dr});Di.displayName="Link";var sE=cr.forwardRef(function({"aria-current":Y="page",caseSensitive:Z=!1,className:Ee="",end:ue=!1,style:_e,to:be,viewTransition:s,children:ne,...F},fe){let qe=hm(be,{relative:F.relative}),Ne=zf(),Ye=cr.useContext(Sg),{navigator:ze,basename:Xe}=cr.useContext(nh),We=Ye!=null&&pE(qe)&&s===!0,De=ze.encodeLocation?ze.encodeLocation(qe).pathname:qe.pathname,Ke=Ne.pathname,et=Ye&&Ye.navigation&&Ye.navigation.location?Ye.navigation.location.pathname:null;Z||(Ke=Ke.toLowerCase(),et=et?et.toLowerCase():null,De=De.toLowerCase()),et&&Xe&&(et=$h(et,Xe)||et);const st=De!=="/"&&De.endsWith("/")?De.length-1:De.length;let $e=Ke===De||!ue&&Ke.startsWith(De)&&Ke.charAt(st)==="/",bt=et!=null&&(et===De||!ue&&et.startsWith(De)&&et.charAt(De.length)==="/"),St={isActive:$e,isPending:bt,isTransitioning:We},dr=$e?Y:void 0,Fr;typeof Ee=="function"?Fr=Ee(St):Fr=[Ee,$e?"active":null,bt?"pending":null,We?"transitioning":null].filter(Boolean).join(" ");let hi=typeof _e=="function"?_e(St):_e;return cr.createElement(Di,{...F,"aria-current":dr,className:Fr,ref:fe,style:hi,to:be,viewTransition:s},typeof ne=="function"?ne(St):ne)});sE.displayName="NavLink";var aE=cr.forwardRef(({discover:L="render",fetcherKey:Y,navigate:Z,reloadDocument:Ee,replace:ue,state:_e,method:be=_g,action:s,onSubmit:ne,relative:F,preventScrollReset:fe,viewTransition:qe,...Ne},Ye)=>{let ze=dE(),Xe=fE(s,{relative:F}),We=be.toLowerCase()==="get"?"get":"post",De=typeof s=="string"&&_b.test(s),Ke=et=>{if(ne&&ne(et),et.defaultPrevented)return;et.preventDefault();let st=et.nativeEvent.submitter,$e=(st==null?void 0:st.getAttribute("formmethod"))||be;ze(st||et.currentTarget,{fetcherKey:Y,method:$e,navigate:Z,replace:ue,state:_e,relative:F,preventScrollReset:fe,viewTransition:qe})};return cr.createElement("form",{ref:Ye,method:We,action:Xe,onSubmit:Ee?ne:Ke,...Ne,"data-discover":!De&&L==="render"?"true":void 0})});aE.displayName="Form";function lE(L){return`${L} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function yb(L){let Y=cr.useContext(hp);return es(Y,lE(L)),Y}function uE(L,{target:Y,replace:Z,state:Ee,preventScrollReset:ue,relative:_e,viewTransition:be}={}){let s=vT(),ne=zf(),F=hm(L,{relative:_e});return cr.useCallback(fe=>{if(VT(fe,Y)){fe.preventDefault();let qe=Z!==void 0?Z:am(ne)===am(F);s(L,{replace:qe,state:Ee,preventScrollReset:ue,relative:_e,viewTransition:be})}},[ne,s,F,Z,Ee,Y,L,ue,_e,be])}var cE=0,hE=()=>`__${String(++cE)}__`;function dE(){let{router:L}=yb("useSubmit"),{basename:Y}=cr.useContext(nh),Z=PT();return cr.useCallback(async(Ee,ue={})=>{let{action:_e,method:be,encType:s,formData:ne,body:F}=qT(Ee,Y);if(ue.navigate===!1){let fe=ue.fetcherKey||hE();await L.fetch(fe,Z,ue.action||_e,{preventScrollReset:ue.preventScrollReset,formData:ne,body:F,formMethod:ue.method||be,formEncType:ue.encType||s,flushSync:ue.flushSync})}else await L.navigate(ue.action||_e,{preventScrollReset:ue.preventScrollReset,formData:ne,body:F,formMethod:ue.method||be,formEncType:ue.encType||s,replace:ue.replace,state:ue.state,fromRouteId:Z,flushSync:ue.flushSync,viewTransition:ue.viewTransition})},[L,Y,Z])}function fE(L,{relative:Y}={}){let{basename:Z}=cr.useContext(nh),Ee=cr.useContext(Zh);es(Ee,"useFormAction must be used inside a RouteContext");let[ue]=Ee.matches.slice(-1),_e={...hm(L||".",{relative:Y})},be=zf();if(L==null){_e.search=be.search;let s=new URLSearchParams(_e.search),ne=s.getAll("index");if(ne.some(fe=>fe==="")){s.delete("index"),ne.filter(qe=>qe).forEach(qe=>s.append("index",qe));let fe=s.toString();_e.search=fe?`?${fe}`:""}}return(!L||L===".")&&ue.route.index&&(_e.search=_e.search?_e.search.replace(/^\?/,"?index&"):"?index"),Z!=="/"&&(_e.pathname=_e.pathname==="/"?Z:Hh([Z,_e.pathname])),am(_e)}function pE(L,Y={}){let Z=cr.useContext(ub);es(Z!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:Ee}=yb("useViewTransitionState"),ue=hm(L,{relative:Y.relative});if(!Z.isTransitioning)return!1;let _e=$h(Z.currentLocation.pathname,Ee)||Z.currentLocation.pathname,be=$h(Z.nextLocation.pathname,Ee)||Z.nextLocation.pathname;return xg(ue.pathname,be)!=null||xg(ue.pathname,_e)!=null}[...KT];const Eg="/",dm="/map",sm="/map/LTS",kf="/map/OSM",mE="/labs_wordmark.svg";function Ig(){return Se.jsx("div",{id:"header_stripe",children:Se.jsx(Di,{to:Eg,children:Se.jsx("img",{src:mE,className:"labs_wordmark",alt:"BCU Labs"})})})}function vb(){return Se.jsx("div",{className:"Pad",children:Se.jsx(Di,{to:"https://secure.everyaction.com/mfRgF-hjuEueYqUtvn9Jeg2",children:Se.jsx("button",{className:"Button Donate",children:"Donate"})})})}function Ag(){return Se.jsxs("div",{className:"foot",children:[Se.jsxs("div",{className:"text",children:[Se.jsx(Di,{to:Eg,children:"BCU Labs"})," is a volunteer-led project of ",Se.jsx(Di,{to:"https://bostoncyclistsunion.org/",children:"Boston Cyclists Union"})]}),Se.jsx("div",{className:"text",children:Se.jsx(Di,{to:"https://docs.google.com/forms/d/e/1FAIpQLSefzxEQ-CAbJd_rrt90DHvdglYvP9RLqdDUVsFq28onw9xXJQ/viewform",children:"Join BCU Labs here"})}),Se.jsx(vb,{})]})}const gE=[{title:"Welcome to BCU Labs!",subheading:"Experiments in data-backed advocacy",paragraph:["We are a volunteer-driven group within ",Se.jsx(Di,{to:"https://bostoncyclistsunion.org/",children:"Boston Cyclists Union"}),". You can ",Se.jsx(Di,{to:"https://docs.google.com/forms/d/e/1FAIpQLSefzxEQ-CAbJd_rrt90DHvdglYvP9RLqdDUVsFq28onw9xXJQ/viewform",children:"join BCU Labs here."})]},{paragraph:Se.jsx(vb,{})},{title:"Our Mission",paragraph:["BCU Labs seeks to draw insight and tell stories from the wealth of biking data in Boston. ","Our mission is to leverage the power of data through creative experimentation, learn ","where Boston can improve its infrastructure, whether physical or digital, and continue ","to empower BCUs advocacy one pedal at a time. Through our framework of mobility ","justice and equity, we strive to push for positive change in our bike networks, ","neighborhoods, and mindsets for everybody, no matter who you are or where you ride."]},{title:"Our Projects and Writing"}];var hc={},dc={},lp={},fc={},dg={},u1;function _E(){return u1||(u1=1,Object.defineProperty(dg,"__esModule",{value:!0}),dg.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(L){return L.charCodeAt(0)}))),dg}var fg={},c1;function yE(){return c1||(c1=1,Object.defineProperty(fg,"__esModule",{value:!0}),fg.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(L){return L.charCodeAt(0)}))),fg}var Z_={},h1;function d1(){return h1||(h1=1,function(L){var Y;Object.defineProperty(L,"__esModule",{value:!0}),L.replaceCodePoint=L.fromCodePoint=void 0;var Z=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);L.fromCodePoint=(Y=String.fromCodePoint)!==null&&Y!==void 0?Y:function(_e){var be="";return _e>65535&&(_e-=65536,be+=String.fromCharCode(_e>>>10&1023|55296),_e=56320|_e&1023),be+=String.fromCharCode(_e),be};function Ee(_e){var be;return _e>=55296&&_e<=57343||_e>1114111?65533:(be=Z.get(_e))!==null&&be!==void 0?be:_e}L.replaceCodePoint=Ee;function ue(_e){return(0,L.fromCodePoint)(Ee(_e))}L.default=ue}(Z_)),Z_}var f1;function bg(){return f1||(f1=1,function(L){var Y=fc&&fc.__createBinding||(Object.create?function(ht,Zt,fr,Tr){Tr===void 0&&(Tr=fr);var Or=Object.getOwnPropertyDescriptor(Zt,fr);(!Or||("get"in Or?!Zt.__esModule:Or.writable||Or.configurable))&&(Or={enumerable:!0,get:function(){return Zt[fr]}}),Object.defineProperty(ht,Tr,Or)}:function(ht,Zt,fr,Tr){Tr===void 0&&(Tr=fr),ht[Tr]=Zt[fr]}),Z=fc&&fc.__setModuleDefault||(Object.create?function(ht,Zt){Object.defineProperty(ht,"default",{enumerable:!0,value:Zt})}:function(ht,Zt){ht.default=Zt}),Ee=fc&&fc.__importStar||function(ht){if(ht&&ht.__esModule)return ht;var Zt={};if(ht!=null)for(var fr in ht)fr!=="default"&&Object.prototype.hasOwnProperty.call(ht,fr)&&Y(Zt,ht,fr);return Z(Zt,ht),Zt},ue=fc&&fc.__importDefault||function(ht){return ht&&ht.__esModule?ht:{default:ht}};Object.defineProperty(L,"__esModule",{value:!0}),L.decodeXML=L.decodeHTMLStrict=L.decodeHTMLAttribute=L.decodeHTML=L.determineBranch=L.EntityDecoder=L.DecodingMode=L.BinTrieFlags=L.fromCodePoint=L.replaceCodePoint=L.decodeCodePoint=L.xmlDecodeTree=L.htmlDecodeTree=void 0;var _e=ue(_E());L.htmlDecodeTree=_e.default;var be=ue(yE());L.xmlDecodeTree=be.default;var s=Ee(d1());L.decodeCodePoint=s.default;var ne=d1();Object.defineProperty(L,"replaceCodePoint",{enumerable:!0,get:function(){return ne.replaceCodePoint}}),Object.defineProperty(L,"fromCodePoint",{enumerable:!0,get:function(){return ne.fromCodePoint}});var F;(function(ht){ht[ht.NUM=35]="NUM",ht[ht.SEMI=59]="SEMI",ht[ht.EQUALS=61]="EQUALS",ht[ht.ZERO=48]="ZERO",ht[ht.NINE=57]="NINE",ht[ht.LOWER_A=97]="LOWER_A",ht[ht.LOWER_F=102]="LOWER_F",ht[ht.LOWER_X=120]="LOWER_X",ht[ht.LOWER_Z=122]="LOWER_Z",ht[ht.UPPER_A=65]="UPPER_A",ht[ht.UPPER_F=70]="UPPER_F",ht[ht.UPPER_Z=90]="UPPER_Z"})(F||(F={}));var fe=32,qe;(function(ht){ht[ht.VALUE_LENGTH=49152]="VALUE_LENGTH",ht[ht.BRANCH_LENGTH=16256]="BRANCH_LENGTH",ht[ht.JUMP_TABLE=127]="JUMP_TABLE"})(qe=L.BinTrieFlags||(L.BinTrieFlags={}));function Ne(ht){return ht>=F.ZERO&&ht<=F.NINE}function Ye(ht){return ht>=F.UPPER_A&&ht<=F.UPPER_F||ht>=F.LOWER_A&&ht<=F.LOWER_F}function ze(ht){return ht>=F.UPPER_A&&ht<=F.UPPER_Z||ht>=F.LOWER_A&&ht<=F.LOWER_Z||Ne(ht)}function Xe(ht){return ht===F.EQUALS||ze(ht)}var We;(function(ht){ht[ht.EntityStart=0]="EntityStart",ht[ht.NumericStart=1]="NumericStart",ht[ht.NumericDecimal=2]="NumericDecimal",ht[ht.NumericHex=3]="NumericHex",ht[ht.NamedEntity=4]="NamedEntity"})(We||(We={}));var De;(function(ht){ht[ht.Legacy=0]="Legacy",ht[ht.Strict=1]="Strict",ht[ht.Attribute=2]="Attribute"})(De=L.DecodingMode||(L.DecodingMode={}));var Ke=function(){function ht(Zt,fr,Tr){this.decodeTree=Zt,this.emitCodePoint=fr,this.errors=Tr,this.state=We.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=De.Strict}return ht.prototype.startEntity=function(Zt){this.decodeMode=Zt,this.state=We.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},ht.prototype.write=function(Zt,fr){switch(this.state){case We.EntityStart:return Zt.charCodeAt(fr)===F.NUM?(this.state=We.NumericStart,this.consumed+=1,this.stateNumericStart(Zt,fr+1)):(this.state=We.NamedEntity,this.stateNamedEntity(Zt,fr));case We.NumericStart:return this.stateNumericStart(Zt,fr);case We.NumericDecimal:return this.stateNumericDecimal(Zt,fr);case We.NumericHex:return this.stateNumericHex(Zt,fr);case We.NamedEntity:return this.stateNamedEntity(Zt,fr)}},ht.prototype.stateNumericStart=function(Zt,fr){return fr>=Zt.length?-1:(Zt.charCodeAt(fr)|fe)===F.LOWER_X?(this.state=We.NumericHex,this.consumed+=1,this.stateNumericHex(Zt,fr+1)):(this.state=We.NumericDecimal,this.stateNumericDecimal(Zt,fr))},ht.prototype.addToNumericResult=function(Zt,fr,Tr,Or){if(fr!==Tr){var ri=Tr-fr;this.result=this.result*Math.pow(Or,ri)+parseInt(Zt.substr(fr,ri),Or),this.consumed+=ri}},ht.prototype.stateNumericHex=function(Zt,fr){for(var Tr=fr;fr<Zt.length;){var Or=Zt.charCodeAt(fr);if(Ne(Or)||Ye(Or))fr+=1;else return this.addToNumericResult(Zt,Tr,fr,16),this.emitNumericEntity(Or,3)}return this.addToNumericResult(Zt,Tr,fr,16),-1},ht.prototype.stateNumericDecimal=function(Zt,fr){for(var Tr=fr;fr<Zt.length;){var Or=Zt.charCodeAt(fr);if(Ne(Or))fr+=1;else return this.addToNumericResult(Zt,Tr,fr,10),this.emitNumericEntity(Or,2)}return this.addToNumericResult(Zt,Tr,fr,10),-1},ht.prototype.emitNumericEntity=function(Zt,fr){var Tr;if(this.consumed<=fr)return(Tr=this.errors)===null||Tr===void 0||Tr.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(Zt===F.SEMI)this.consumed+=1;else if(this.decodeMode===De.Strict)return 0;return this.emitCodePoint((0,s.replaceCodePoint)(this.result),this.consumed),this.errors&&(Zt!==F.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},ht.prototype.stateNamedEntity=function(Zt,fr){for(var Tr=this.decodeTree,Or=Tr[this.treeIndex],ri=(Or&qe.VALUE_LENGTH)>>14;fr<Zt.length;fr++,this.excess++){var fi=Zt.charCodeAt(fr);if(this.treeIndex=st(Tr,Or,this.treeIndex+Math.max(1,ri),fi),this.treeIndex<0)return this.result===0||this.decodeMode===De.Attribute&&(ri===0||Xe(fi))?0:this.emitNotTerminatedNamedEntity();if(Or=Tr[this.treeIndex],ri=(Or&qe.VALUE_LENGTH)>>14,ri!==0){if(fi===F.SEMI)return this.emitNamedEntityData(this.treeIndex,ri,this.consumed+this.excess);this.decodeMode!==De.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},ht.prototype.emitNotTerminatedNamedEntity=function(){var Zt,fr=this,Tr=fr.result,Or=fr.decodeTree,ri=(Or[Tr]&qe.VALUE_LENGTH)>>14;return this.emitNamedEntityData(Tr,ri,this.consumed),(Zt=this.errors)===null||Zt===void 0||Zt.missingSemicolonAfterCharacterReference(),this.consumed},ht.prototype.emitNamedEntityData=function(Zt,fr,Tr){var Or=this.decodeTree;return this.emitCodePoint(fr===1?Or[Zt]&~qe.VALUE_LENGTH:Or[Zt+1],Tr),fr===3&&this.emitCodePoint(Or[Zt+2],Tr),Tr},ht.prototype.end=function(){var Zt;switch(this.state){case We.NamedEntity:return this.result!==0&&(this.decodeMode!==De.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case We.NumericDecimal:return this.emitNumericEntity(0,2);case We.NumericHex:return this.emitNumericEntity(0,3);case We.NumericStart:return(Zt=this.errors)===null||Zt===void 0||Zt.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case We.EntityStart:return 0}},ht}();L.EntityDecoder=Ke;function et(ht){var Zt="",fr=new Ke(ht,function(Tr){return Zt+=(0,s.fromCodePoint)(Tr)});return function(Or,ri){for(var fi=0,mr=0;(mr=Or.indexOf("&",mr))>=0;){Zt+=Or.slice(fi,mr),fr.startEntity(ri);var Lr=fr.write(Or,mr+1);if(Lr<0){fi=mr+fr.end();break}fi=mr+Lr,mr=Lr===0?fi+1:fi}var or=Zt+Or.slice(fi);return Zt="",or}}function st(ht,Zt,fr,Tr){var Or=(Zt&qe.BRANCH_LENGTH)>>7,ri=Zt&qe.JUMP_TABLE;if(Or===0)return ri!==0&&Tr===ri?fr:-1;if(ri){var fi=Tr-ri;return fi<0||fi>=Or?-1:ht[fr+fi]-1}for(var mr=fr,Lr=mr+Or-1;mr<=Lr;){var or=mr+Lr>>>1,dt=ht[or];if(dt<Tr)mr=or+1;else if(dt>Tr)Lr=or-1;else return ht[or+Or]}return-1}L.determineBranch=st;var $e=et(_e.default),bt=et(be.default);function St(ht,Zt){return Zt===void 0&&(Zt=De.Legacy),$e(ht,Zt)}L.decodeHTML=St;function dr(ht){return $e(ht,De.Attribute)}L.decodeHTMLAttribute=dr;function Fr(ht){return $e(ht,De.Strict)}L.decodeHTMLStrict=Fr;function hi(ht){return bt(ht,De.Strict)}L.decodeXML=hi}(fc)),fc}var p1;function xb(){if(p1)return lp;p1=1,Object.defineProperty(lp,"__esModule",{value:!0}),lp.QuoteType=void 0;var L=bg(),Y;(function(F){F[F.Tab=9]="Tab",F[F.NewLine=10]="NewLine",F[F.FormFeed=12]="FormFeed",F[F.CarriageReturn=13]="CarriageReturn",F[F.Space=32]="Space",F[F.ExclamationMark=33]="ExclamationMark",F[F.Number=35]="Number",F[F.Amp=38]="Amp",F[F.SingleQuote=39]="SingleQuote",F[F.DoubleQuote=34]="DoubleQuote",F[F.Dash=45]="Dash",F[F.Slash=47]="Slash",F[F.Zero=48]="Zero",F[F.Nine=57]="Nine",F[F.Semi=59]="Semi",F[F.Lt=60]="Lt",F[F.Eq=61]="Eq",F[F.Gt=62]="Gt",F[F.Questionmark=63]="Questionmark",F[F.UpperA=65]="UpperA",F[F.LowerA=97]="LowerA",F[F.UpperF=70]="UpperF",F[F.LowerF=102]="LowerF",F[F.UpperZ=90]="UpperZ",F[F.LowerZ=122]="LowerZ",F[F.LowerX=120]="LowerX",F[F.OpeningSquareBracket=91]="OpeningSquareBracket"})(Y||(Y={}));var Z;(function(F){F[F.Text=1]="Text",F[F.BeforeTagName=2]="BeforeTagName",F[F.InTagName=3]="InTagName",F[F.InSelfClosingTag=4]="InSelfClosingTag",F[F.BeforeClosingTagName=5]="BeforeClosingTagName",F[F.InClosingTagName=6]="InClosingTagName",F[F.AfterClosingTagName=7]="AfterClosingTagName",F[F.BeforeAttributeName=8]="BeforeAttributeName",F[F.InAttributeName=9]="InAttributeName",F[F.AfterAttributeName=10]="AfterAttributeName",F[F.BeforeAttributeValue=11]="BeforeAttributeValue",F[F.InAttributeValueDq=12]="InAttributeValueDq",F[F.InAttributeValueSq=13]="InAttributeValueSq",F[F.InAttributeValueNq=14]="InAttributeValueNq",F[F.BeforeDeclaration=15]="BeforeDeclaration",F[F.InDeclaration=16]="InDeclaration",F[F.InProcessingInstruction=17]="InProcessingInstruction",F[F.BeforeComment=18]="BeforeComment",F[F.CDATASequence=19]="CDATASequence",F[F.InSpecialComment=20]="InSpecialComment",F[F.InCommentLike=21]="InCommentLike",F[F.BeforeSpecialS=22]="BeforeSpecialS",F[F.BeforeSpecialT=23]="BeforeSpecialT",F[F.SpecialStartSequence=24]="SpecialStartSequence",F[F.InSpecialTag=25]="InSpecialTag",F[F.InEntity=26]="InEntity"})(Z||(Z={}));function Ee(F){return F===Y.Space||F===Y.NewLine||F===Y.Tab||F===Y.FormFeed||F===Y.CarriageReturn}function ue(F){return F===Y.Slash||F===Y.Gt||Ee(F)}function _e(F){return F>=Y.LowerA&&F<=Y.LowerZ||F>=Y.UpperA&&F<=Y.UpperZ}var be;(function(F){F[F.NoValue=0]="NoValue",F[F.Unquoted=1]="Unquoted",F[F.Single=2]="Single",F[F.Double=3]="Double"})(be||(lp.QuoteType=be={}));var s={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])},ne=function(){function F(fe,qe){var Ne=fe.xmlMode,Ye=Ne===void 0?!1:Ne,ze=fe.decodeEntities,Xe=ze===void 0?!0:ze,We=this;this.cbs=qe,this.state=Z.Text,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=Z.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.xmlMode=Ye,this.decodeEntities=Xe,this.entityDecoder=new L.EntityDecoder(Ye?L.xmlDecodeTree:L.htmlDecodeTree,function(De,Ke){return We.emitCodePoint(De,Ke)})}return F.prototype.reset=function(){this.state=Z.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=Z.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},F.prototype.write=function(fe){this.offset+=this.buffer.length,this.buffer=fe,this.parse()},F.prototype.end=function(){this.running&&this.finish()},F.prototype.pause=function(){this.running=!1},F.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},F.prototype.stateText=function(fe){fe===Y.Lt||!this.decodeEntities&&this.fastForwardTo(Y.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=Z.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&fe===Y.Amp&&this.startEntity()},F.prototype.stateSpecialStartSequence=function(fe){var qe=this.sequenceIndex===this.currentSequence.length,Ne=qe?ue(fe):(fe|32)===this.currentSequence[this.sequenceIndex];if(!Ne)this.isSpecial=!1;else if(!qe){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=Z.InTagName,this.stateInTagName(fe)},F.prototype.stateInSpecialTag=function(fe){if(this.sequenceIndex===this.currentSequence.length){if(fe===Y.Gt||Ee(fe)){var qe=this.index-this.currentSequence.length;if(this.sectionStart<qe){var Ne=this.index;this.index=qe,this.cbs.ontext(this.sectionStart,qe),this.index=Ne}this.isSpecial=!1,this.sectionStart=qe+2,this.stateInClosingTagName(fe);return}this.sequenceIndex=0}(fe|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===s.TitleEnd?this.decodeEntities&&fe===Y.Amp&&this.startEntity():this.fastForwardTo(Y.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(fe===Y.Lt)},F.prototype.stateCDATASequence=function(fe){fe===s.Cdata[this.sequenceIndex]?++this.sequenceIndex===s.Cdata.length&&(this.state=Z.InCommentLike,this.currentSequence=s.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=Z.InDeclaration,this.stateInDeclaration(fe))},F.prototype.fastForwardTo=function(fe){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===fe)return!0;return this.index=this.buffer.length+this.offset-1,!1},F.prototype.stateInCommentLike=function(fe){fe===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===s.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=Z.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):fe!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},F.prototype.isTagStartChar=function(fe){return this.xmlMode?!ue(fe):_e(fe)},F.prototype.startSpecial=function(fe,qe){this.isSpecial=!0,this.currentSequence=fe,this.sequenceIndex=qe,this.state=Z.SpecialStartSequence},F.prototype.stateBeforeTagName=function(fe){if(fe===Y.ExclamationMark)this.state=Z.BeforeDeclaration,this.sectionStart=this.index+1;else if(fe===Y.Questionmark)this.state=Z.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(fe)){var qe=fe|32;this.sectionStart=this.index,this.xmlMode?this.state=Z.InTagName:qe===s.ScriptEnd[2]?this.state=Z.BeforeSpecialS:qe===s.TitleEnd[2]?this.state=Z.BeforeSpecialT:this.state=Z.InTagName}else fe===Y.Slash?this.state=Z.BeforeClosingTagName:(this.state=Z.Text,this.stateText(fe))},F.prototype.stateInTagName=function(fe){ue(fe)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=Z.BeforeAttributeName,this.stateBeforeAttributeName(fe))},F.prototype.stateBeforeClosingTagName=function(fe){Ee(fe)||(fe===Y.Gt?this.state=Z.Text:(this.state=this.isTagStartChar(fe)?Z.InClosingTagName:Z.InSpecialComment,this.sectionStart=this.index))},F.prototype.stateInClosingTagName=function(fe){(fe===Y.Gt||Ee(fe))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=Z.AfterClosingTagName,this.stateAfterClosingTagName(fe))},F.prototype.stateAfterClosingTagName=function(fe){(fe===Y.Gt||this.fastForwardTo(Y.Gt))&&(this.state=Z.Text,this.sectionStart=this.index+1)},F.prototype.stateBeforeAttributeName=function(fe){fe===Y.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=Z.InSpecialTag,this.sequenceIndex=0):this.state=Z.Text,this.sectionStart=this.index+1):fe===Y.Slash?this.state=Z.InSelfClosingTag:Ee(fe)||(this.state=Z.InAttributeName,this.sectionStart=this.index)},F.prototype.stateInSelfClosingTag=function(fe){fe===Y.Gt?(this.cbs.onselfclosingtag(this.index),this.state=Z.Text,this.sectionStart=this.index+1,this.isSpecial=!1):Ee(fe)||(this.state=Z.BeforeAttributeName,this.stateBeforeAttributeName(fe))},F.prototype.stateInAttributeName=function(fe){(fe===Y.Eq||ue(fe))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=this.index,this.state=Z.AfterAttributeName,this.stateAfterAttributeName(fe))},F.prototype.stateAfterAttributeName=function(fe){fe===Y.Eq?this.state=Z.BeforeAttributeValue:fe===Y.Slash||fe===Y.Gt?(this.cbs.onattribend(be.NoValue,this.sectionStart),this.sectionStart=-1,this.state=Z.BeforeAttributeName,this.stateBeforeAttributeName(fe)):Ee(fe)||(this.cbs.onattribend(be.NoValue,this.sectionStart),this.state=Z.InAttributeName,this.sectionStart=this.index)},F.prototype.stateBeforeAttributeValue=function(fe){fe===Y.DoubleQuote?(this.state=Z.InAttributeValueDq,this.sectionStart=this.index+1):fe===Y.SingleQuote?(this.state=Z.InAttributeValueSq,this.sectionStart=this.index+1):Ee(fe)||(this.sectionStart=this.index,this.state=Z.InAttributeValueNq,this.stateInAttributeValueNoQuotes(fe))},F.prototype.handleInAttributeValue=function(fe,qe){fe===qe||!this.decodeEntities&&this.fastForwardTo(qe)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(qe===Y.DoubleQuote?be.Double:be.Single,this.index+1),this.state=Z.BeforeAttributeName):this.decodeEntities&&fe===Y.Amp&&this.startEntity()},F.prototype.stateInAttributeValueDoubleQuotes=function(fe){this.handleInAttributeValue(fe,Y.DoubleQuote)},F.prototype.stateInAttributeValueSingleQuotes=function(fe){this.handleInAttributeValue(fe,Y.SingleQuote)},F.prototype.stateInAttributeValueNoQuotes=function(fe){Ee(fe)||fe===Y.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(be.Unquoted,this.index),this.state=Z.BeforeAttributeName,this.stateBeforeAttributeName(fe)):this.decodeEntities&&fe===Y.Amp&&this.startEntity()},F.prototype.stateBeforeDeclaration=function(fe){fe===Y.OpeningSquareBracket?(this.state=Z.CDATASequence,this.sequenceIndex=0):this.state=fe===Y.Dash?Z.BeforeComment:Z.InDeclaration},F.prototype.stateInDeclaration=function(fe){(fe===Y.Gt||this.fastForwardTo(Y.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=Z.Text,this.sectionStart=this.index+1)},F.prototype.stateInProcessingInstruction=function(fe){(fe===Y.Gt||this.fastForwardTo(Y.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=Z.Text,this.sectionStart=this.index+1)},F.prototype.stateBeforeComment=function(fe){fe===Y.Dash?(this.state=Z.InCommentLike,this.currentSequence=s.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=Z.InDeclaration},F.prototype.stateInSpecialComment=function(fe){(fe===Y.Gt||this.fastForwardTo(Y.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=Z.Text,this.sectionStart=this.index+1)},F.prototype.stateBeforeSpecialS=function(fe){var qe=fe|32;qe===s.ScriptEnd[3]?this.startSpecial(s.ScriptEnd,4):qe===s.StyleEnd[3]?this.startSpecial(s.StyleEnd,4):(this.state=Z.InTagName,this.stateInTagName(fe))},F.prototype.stateBeforeSpecialT=function(fe){var qe=fe|32;qe===s.TitleEnd[3]?this.startSpecial(s.TitleEnd,4):qe===s.TextareaEnd[3]?this.startSpecial(s.TextareaEnd,4):(this.state=Z.InTagName,this.stateInTagName(fe))},F.prototype.startEntity=function(){this.baseState=this.state,this.state=Z.InEntity,this.entityStart=this.index,this.entityDecoder.startEntity(this.xmlMode?L.DecodingMode.Strict:this.baseState===Z.Text||this.baseState===Z.InSpecialTag?L.DecodingMode.Legacy:L.DecodingMode.Attribute)},F.prototype.stateInEntity=function(){var fe=this.entityDecoder.write(this.buffer,this.index-this.offset);fe>=0?(this.state=this.baseState,fe===0&&(this.index=this.entityStart)):this.index=this.offset+this.buffer.length-1},F.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===Z.Text||this.state===Z.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===Z.InAttributeValueDq||this.state===Z.InAttributeValueSq||this.state===Z.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},F.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},F.prototype.parse=function(){for(;this.shouldContinue();){var fe=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case Z.Text:{this.stateText(fe);break}case Z.SpecialStartSequence:{this.stateSpecialStartSequence(fe);break}case Z.InSpecialTag:{this.stateInSpecialTag(fe);break}case Z.CDATASequence:{this.stateCDATASequence(fe);break}case Z.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(fe);break}case Z.InAttributeName:{this.stateInAttributeName(fe);break}case Z.InCommentLike:{this.stateInCommentLike(fe);break}case Z.InSpecialComment:{this.stateInSpecialComment(fe);break}case Z.BeforeAttributeName:{this.stateBeforeAttributeName(fe);break}case Z.InTagName:{this.stateInTagName(fe);break}case Z.InClosingTagName:{this.stateInClosingTagName(fe);break}case Z.BeforeTagName:{this.stateBeforeTagName(fe);break}case Z.AfterAttributeName:{this.stateAfterAttributeName(fe);break}case Z.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(fe);break}case Z.BeforeAttributeValue:{this.stateBeforeAttributeValue(fe);break}case Z.BeforeClosingTagName:{this.stateBeforeClosingTagName(fe);break}case Z.AfterClosingTagName:{this.stateAfterClosingTagName(fe);break}case Z.BeforeSpecialS:{this.stateBeforeSpecialS(fe);break}case Z.BeforeSpecialT:{this.stateBeforeSpecialT(fe);break}case Z.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(fe);break}case Z.InSelfClosingTag:{this.stateInSelfClosingTag(fe);break}case Z.InDeclaration:{this.stateInDeclaration(fe);break}case Z.BeforeDeclaration:{this.stateBeforeDeclaration(fe);break}case Z.BeforeComment:{this.stateBeforeComment(fe);break}case Z.InProcessingInstruction:{this.stateInProcessingInstruction(fe);break}case Z.InEntity:{this.stateInEntity();break}}this.index++}this.cleanup()},F.prototype.finish=function(){this.state===Z.InEntity&&(this.entityDecoder.end(),this.state=this.baseState),this.handleTrailingData(),this.cbs.onend()},F.prototype.handleTrailingData=function(){var fe=this.buffer.length+this.offset;this.sectionStart>=fe||(this.state===Z.InCommentLike?this.currentSequence===s.CdataEnd?this.cbs.oncdata(this.sectionStart,fe,0):this.cbs.oncomment(this.sectionStart,fe,0):this.state===Z.InTagName||this.state===Z.BeforeAttributeName||this.state===Z.BeforeAttributeValue||this.state===Z.AfterAttributeName||this.state===Z.InAttributeName||this.state===Z.InAttributeValueSq||this.state===Z.InAttributeValueDq||this.state===Z.InAttributeValueNq||this.state===Z.InClosingTagName||this.cbs.ontext(this.sectionStart,fe))},F.prototype.emitCodePoint=function(fe,qe){this.baseState!==Z.Text&&this.baseState!==Z.InSpecialTag?(this.sectionStart<this.entityStart&&this.cbs.onattribdata(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+qe,this.index=this.sectionStart-1,this.cbs.onattribentity(fe)):(this.sectionStart<this.entityStart&&this.cbs.ontext(this.sectionStart,this.entityStart),this.sectionStart=this.entityStart+qe,this.index=this.sectionStart-1,this.cbs.ontextentity(fe,this.sectionStart))},F}();return lp.default=ne,lp}var m1;function g1(){if(m1)return dc;m1=1;var L=dc&&dc.__createBinding||(Object.create?function(We,De,Ke,et){et===void 0&&(et=Ke);var st=Object.getOwnPropertyDescriptor(De,Ke);(!st||("get"in st?!De.__esModule:st.writable||st.configurable))&&(st={enumerable:!0,get:function(){return De[Ke]}}),Object.defineProperty(We,et,st)}:function(We,De,Ke,et){et===void 0&&(et=Ke),We[et]=De[Ke]}),Y=dc&&dc.__setModuleDefault||(Object.create?function(We,De){Object.defineProperty(We,"default",{enumerable:!0,value:De})}:function(We,De){We.default=De}),Z=dc&&dc.__importStar||function(We){if(We&&We.__esModule)return We;var De={};if(We!=null)for(var Ke in We)Ke!=="default"&&Object.prototype.hasOwnProperty.call(We,Ke)&&L(De,We,Ke);return Y(De,We),De};Object.defineProperty(dc,"__esModule",{value:!0}),dc.Parser=void 0;var Ee=Z(xb()),ue=bg(),_e=new Set(["input","option","optgroup","select","button","datalist","textarea"]),be=new Set(["p"]),s=new Set(["thead","tbody"]),ne=new Set(["dd","dt"]),F=new Set(["rt","rp"]),fe=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",be],["h1",be],["h2",be],["h3",be],["h4",be],["h5",be],["h6",be],["select",_e],["input",_e],["output",_e],["button",_e],["datalist",_e],["textarea",_e],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ne],["dt",ne],["address",be],["article",be],["aside",be],["blockquote",be],["details",be],["div",be],["dl",be],["fieldset",be],["figcaption",be],["figure",be],["footer",be],["form",be],["header",be],["hr",be],["main",be],["nav",be],["ol",be],["pre",be],["section",be],["table",be],["ul",be],["rt",F],["rp",F],["tbody",s],["tfoot",s]]),qe=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),Ne=new Set(["math","svg"]),Ye=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),ze=/\s|\//,Xe=function(){function We(De,Ke){Ke===void 0&&(Ke={});var et,st,$e,bt,St,dr;this.options=Ke,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=De??{},this.htmlMode=!this.options.xmlMode,this.lowerCaseTagNames=(et=Ke.lowerCaseTags)!==null&&et!==void 0?et:this.htmlMode,this.lowerCaseAttributeNames=(st=Ke.lowerCaseAttributeNames)!==null&&st!==void 0?st:this.htmlMode,this.recognizeSelfClosing=($e=Ke.recognizeSelfClosing)!==null&&$e!==void 0?$e:!this.htmlMode,this.tokenizer=new((bt=Ke.Tokenizer)!==null&&bt!==void 0?bt:Ee.default)(this.options,this),this.foreignContext=[!this.htmlMode],(dr=(St=this.cbs).onparserinit)===null||dr===void 0||dr.call(St,this)}return We.prototype.ontext=function(De,Ke){var et,st,$e=this.getSlice(De,Ke);this.endIndex=Ke-1,(st=(et=this.cbs).ontext)===null||st===void 0||st.call(et,$e),this.startIndex=Ke},We.prototype.ontextentity=function(De,Ke){var et,st;this.endIndex=Ke-1,(st=(et=this.cbs).ontext)===null||st===void 0||st.call(et,(0,ue.fromCodePoint)(De)),this.startIndex=Ke},We.prototype.isVoidElement=function(De){return this.htmlMode&&qe.has(De)},We.prototype.onopentagname=function(De,Ke){this.endIndex=Ke;var et=this.getSlice(De,Ke);this.lowerCaseTagNames&&(et=et.toLowerCase()),this.emitOpenTag(et)},We.prototype.emitOpenTag=function(De){var Ke,et,st,$e;this.openTagStart=this.startIndex,this.tagname=De;var bt=this.htmlMode&&fe.get(De);if(bt)for(;this.stack.length>0&&bt.has(this.stack[0]);){var St=this.stack.shift();(et=(Ke=this.cbs).onclosetag)===null||et===void 0||et.call(Ke,St,!0)}this.isVoidElement(De)||(this.stack.unshift(De),this.htmlMode&&(Ne.has(De)?this.foreignContext.unshift(!0):Ye.has(De)&&this.foreignContext.unshift(!1))),($e=(st=this.cbs).onopentagname)===null||$e===void 0||$e.call(st,De),this.cbs.onopentag&&(this.attribs={})},We.prototype.endOpenTag=function(De){var Ke,et;this.startIndex=this.openTagStart,this.attribs&&((et=(Ke=this.cbs).onopentag)===null||et===void 0||et.call(Ke,this.tagname,this.attribs,De),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},We.prototype.onopentagend=function(De){this.endIndex=De,this.endOpenTag(!1),this.startIndex=De+1},We.prototype.onclosetag=function(De,Ke){var et,st,$e,bt,St,dr,Fr,hi;this.endIndex=Ke;var ht=this.getSlice(De,Ke);if(this.lowerCaseTagNames&&(ht=ht.toLowerCase()),this.htmlMode&&(Ne.has(ht)||Ye.has(ht))&&this.foreignContext.shift(),this.isVoidElement(ht))this.htmlMode&&ht==="br"&&((bt=($e=this.cbs).onopentagname)===null||bt===void 0||bt.call($e,"br"),(dr=(St=this.cbs).onopentag)===null||dr===void 0||dr.call(St,"br",{},!0),(hi=(Fr=this.cbs).onclosetag)===null||hi===void 0||hi.call(Fr,"br",!1));else{var Zt=this.stack.indexOf(ht);if(Zt!==-1)for(var fr=0;fr<=Zt;fr++){var Tr=this.stack.shift();(st=(et=this.cbs).onclosetag)===null||st===void 0||st.call(et,Tr,fr!==Zt)}else this.htmlMode&&ht==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=Ke+1},We.prototype.onselfclosingtag=function(De){this.endIndex=De,this.recognizeSelfClosing||this.foreignContext[0]?(this.closeCurrentTag(!1),this.startIndex=De+1):this.onopentagend(De)},We.prototype.closeCurrentTag=function(De){var Ke,et,st=this.tagname;this.endOpenTag(De),this.stack[0]===st&&((et=(Ke=this.cbs).onclosetag)===null||et===void 0||et.call(Ke,st,!De),this.stack.shift())},We.prototype.onattribname=function(De,Ke){this.startIndex=De;var et=this.getSlice(De,Ke);this.attribname=this.lowerCaseAttributeNames?et.toLowerCase():et},We.prototype.onattribdata=function(De,Ke){this.attribvalue+=this.getSlice(De,Ke)},We.prototype.onattribentity=function(De){this.attribvalue+=(0,ue.fromCodePoint)(De)},We.prototype.onattribend=function(De,Ke){var et,st;this.endIndex=Ke,(st=(et=this.cbs).onattribute)===null||st===void 0||st.call(et,this.attribname,this.attribvalue,De===Ee.QuoteType.Double?'"':De===Ee.QuoteType.Single?"'":De===Ee.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},We.prototype.getInstructionName=function(De){var Ke=De.search(ze),et=Ke<0?De:De.substr(0,Ke);return this.lowerCaseTagNames&&(et=et.toLowerCase()),et},We.prototype.ondeclaration=function(De,Ke){this.endIndex=Ke;var et=this.getSlice(De,Ke);if(this.cbs.onprocessinginstruction){var st=this.getInstructionName(et);this.cbs.onprocessinginstruction("!".concat(st),"!".concat(et))}this.startIndex=Ke+1},We.prototype.onprocessinginstruction=function(De,Ke){this.endIndex=Ke;var et=this.getSlice(De,Ke);if(this.cbs.onprocessinginstruction){var st=this.getInstructionName(et);this.cbs.onprocessinginstruction("?".concat(st),"?".concat(et))}this.startIndex=Ke+1},We.prototype.oncomment=function(De,Ke,et){var st,$e,bt,St;this.endIndex=Ke,($e=(st=this.cbs).oncomment)===null||$e===void 0||$e.call(st,this.getSlice(De,Ke-et)),(St=(bt=this.cbs).oncommentend)===null||St===void 0||St.call(bt),this.startIndex=Ke+1},We.prototype.oncdata=function(De,Ke,et){var st,$e,bt,St,dr,Fr,hi,ht,Zt,fr;this.endIndex=Ke;var Tr=this.getSlice(De,Ke-et);!this.htmlMode||this.options.recognizeCDATA?(($e=(st=this.cbs).oncdatastart)===null||$e===void 0||$e.call(st),(St=(bt=this.cbs).ontext)===null||St===void 0||St.call(bt,Tr),(Fr=(dr=this.cbs).oncdataend)===null||Fr===void 0||Fr.call(dr)):((ht=(hi=this.cbs).oncomment)===null||ht===void 0||ht.call(hi,"[CDATA[".concat(Tr,"]]")),(fr=(Zt=this.cbs).oncommentend)===null||fr===void 0||fr.call(Zt)),this.startIndex=Ke+1},We.prototype.onend=function(){var De,Ke;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var et=0;et<this.stack.length;et++)this.cbs.onclosetag(this.stack[et],!0)}(Ke=(De=this.cbs).onend)===null||Ke===void 0||Ke.call(De)},We.prototype.reset=function(){var De,Ke,et,st;(Ke=(De=this.cbs).onreset)===null||Ke===void 0||Ke.call(De),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(st=(et=this.cbs).onparserinit)===null||st===void 0||st.call(et,this),this.buffers.length=0,this.foreignContext.length=0,this.foreignContext.unshift(!this.htmlMode),this.bufferOffset=0,this.writeIndex=0,this.ended=!1},We.prototype.parseComplete=function(De){this.reset(),this.end(De)},We.prototype.getSlice=function(De,Ke){for(;De-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var et=this.buffers[0].slice(De-this.bufferOffset,Ke-this.bufferOffset);Ke-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),et+=this.buffers[0].slice(0,Ke-this.bufferOffset);return et},We.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},We.prototype.write=function(De){var Ke,et;if(this.ended){(et=(Ke=this.cbs).onerror)===null||et===void 0||et.call(Ke,new Error(".write() after done!"));return}this.buffers.push(De),this.tokenizer.running&&(this.tokenizer.write(De),this.writeIndex++)},We.prototype.end=function(De){var Ke,et;if(this.ended){(et=(Ke=this.cbs).onerror)===null||et===void 0||et.call(Ke,new Error(".end() after done!"));return}De&&this.write(De),this.ended=!0,this.tokenizer.end()},We.prototype.pause=function(){this.tokenizer.pause()},We.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},We.prototype.parseChunk=function(De){this.write(De)},We.prototype.done=function(De){this.end(De)},We}();return dc.Parser=Xe,dc}var Mf={},X_={},_1;function fm(){return _1||(_1=1,function(L){Object.defineProperty(L,"__esModule",{value:!0}),L.Doctype=L.CDATA=L.Tag=L.Style=L.Script=L.Comment=L.Directive=L.Text=L.Root=L.isTag=L.ElementType=void 0;var Y;(function(Ee){Ee.Root="root",Ee.Text="text",Ee.Directive="directive",Ee.Comment="comment",Ee.Script="script",Ee.Style="style",Ee.Tag="tag",Ee.CDATA="cdata",Ee.Doctype="doctype"})(Y=L.ElementType||(L.ElementType={}));function Z(Ee){return Ee.type===Y.Tag||Ee.type===Y.Script||Ee.type===Y.Style}L.isTag=Z,L.Root=Y.Root,L.Text=Y.Text,L.Directive=Y.Directive,L.Comment=Y.Comment,L.Script=Y.Script,L.Style=Y.Style,L.Tag=Y.Tag,L.CDATA=Y.CDATA,L.Doctype=Y.Doctype}(X_)),X_}var fn={},y1;function v1(){if(y1)return fn;y1=1;var L=fn&&fn.__extends||function(){var $e=function(bt,St){return $e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(dr,Fr){dr.__proto__=Fr}||function(dr,Fr){for(var hi in Fr)Object.prototype.hasOwnProperty.call(Fr,hi)&&(dr[hi]=Fr[hi])},$e(bt,St)};return function(bt,St){if(typeof St!="function"&&St!==null)throw new TypeError("Class extends value "+String(St)+" is not a constructor or null");$e(bt,St);function dr(){this.constructor=bt}bt.prototype=St===null?Object.create(St):(dr.prototype=St.prototype,new dr)}}(),Y=fn&&fn.__assign||function(){return Y=Object.assign||function($e){for(var bt,St=1,dr=arguments.length;St<dr;St++){bt=arguments[St];for(var Fr in bt)Object.prototype.hasOwnProperty.call(bt,Fr)&&($e[Fr]=bt[Fr])}return $e},Y.apply(this,arguments)};Object.defineProperty(fn,"__esModule",{value:!0}),fn.cloneNode=fn.hasChildren=fn.isDocument=fn.isDirective=fn.isComment=fn.isText=fn.isCDATA=fn.isTag=fn.Element=fn.Document=fn.CDATA=fn.NodeWithChildren=fn.ProcessingInstruction=fn.Comment=fn.Text=fn.DataNode=fn.Node=void 0;var Z=fm(),Ee=function(){function $e(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty($e.prototype,"parentNode",{get:function(){return this.parent},set:function(bt){this.parent=bt},enumerable:!1,configurable:!0}),Object.defineProperty($e.prototype,"previousSibling",{get:function(){return this.prev},set:function(bt){this.prev=bt},enumerable:!1,configurable:!0}),Object.defineProperty($e.prototype,"nextSibling",{get:function(){return this.next},set:function(bt){this.next=bt},enumerable:!1,configurable:!0}),$e.prototype.cloneNode=function(bt){return bt===void 0&&(bt=!1),et(this,bt)},$e}();fn.Node=Ee;var ue=function($e){L(bt,$e);function bt(St){var dr=$e.call(this)||this;return dr.data=St,dr}return Object.defineProperty(bt.prototype,"nodeValue",{get:function(){return this.data},set:function(St){this.data=St},enumerable:!1,configurable:!0}),bt}(Ee);fn.DataNode=ue;var _e=function($e){L(bt,$e);function bt(){var St=$e!==null&&$e.apply(this,arguments)||this;return St.type=Z.ElementType.Text,St}return Object.defineProperty(bt.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),bt}(ue);fn.Text=_e;var be=function($e){L(bt,$e);function bt(){var St=$e!==null&&$e.apply(this,arguments)||this;return St.type=Z.ElementType.Comment,St}return Object.defineProperty(bt.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),bt}(ue);fn.Comment=be;var s=function($e){L(bt,$e);function bt(St,dr){var Fr=$e.call(this,dr)||this;return Fr.name=St,Fr.type=Z.ElementType.Directive,Fr}return Object.defineProperty(bt.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),bt}(ue);fn.ProcessingInstruction=s;var ne=function($e){L(bt,$e);function bt(St){var dr=$e.call(this)||this;return dr.children=St,dr}return Object.defineProperty(bt.prototype,"firstChild",{get:function(){var St;return(St=this.children[0])!==null&&St!==void 0?St:null},enumerable:!1,configurable:!0}),Object.defineProperty(bt.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(bt.prototype,"childNodes",{get:function(){return this.children},set:function(St){this.children=St},enumerable:!1,configurable:!0}),bt}(Ee);fn.NodeWithChildren=ne;var F=function($e){L(bt,$e);function bt(){var St=$e!==null&&$e.apply(this,arguments)||this;return St.type=Z.ElementType.CDATA,St}return Object.defineProperty(bt.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),bt}(ne);fn.CDATA=F;var fe=function($e){L(bt,$e);function bt(){var St=$e!==null&&$e.apply(this,arguments)||this;return St.type=Z.ElementType.Root,St}return Object.defineProperty(bt.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),bt}(ne);fn.Document=fe;var qe=function($e){L(bt,$e);function bt(St,dr,Fr,hi){Fr===void 0&&(Fr=[]),hi===void 0&&(hi=St==="script"?Z.ElementType.Script:St==="style"?Z.ElementType.Style:Z.ElementType.Tag);var ht=$e.call(this,Fr)||this;return ht.name=St,ht.attribs=dr,ht.type=hi,ht}return Object.defineProperty(bt.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(bt.prototype,"tagName",{get:function(){return this.name},set:function(St){this.name=St},enumerable:!1,configurable:!0}),Object.defineProperty(bt.prototype,"attributes",{get:function(){var St=this;return Object.keys(this.attribs).map(function(dr){var Fr,hi;return{name:dr,value:St.attribs[dr],namespace:(Fr=St["x-attribsNamespace"])===null||Fr===void 0?void 0:Fr[dr],prefix:(hi=St["x-attribsPrefix"])===null||hi===void 0?void 0:hi[dr]}})},enumerable:!1,configurable:!0}),bt}(ne);fn.Element=qe;function Ne($e){return(0,Z.isTag)($e)}fn.isTag=Ne;function Ye($e){return $e.type===Z.ElementType.CDATA}fn.isCDATA=Ye;function ze($e){return $e.type===Z.ElementType.Text}fn.isText=ze;function Xe($e){return $e.type===Z.ElementType.Comment}fn.isComment=Xe;function We($e){return $e.type===Z.ElementType.Directive}fn.isDirective=We;function De($e){return $e.type===Z.ElementType.Root}fn.isDocument=De;function Ke($e){return Object.prototype.hasOwnProperty.call($e,"children")}fn.hasChildren=Ke;function et($e,bt){bt===void 0&&(bt=!1);var St;if(ze($e))St=new _e($e.data);else if(Xe($e))St=new be($e.data);else if(Ne($e)){var dr=bt?st($e.children):[],Fr=new qe($e.name,Y({},$e.attribs),dr);dr.forEach(function(fr){return fr.parent=Fr}),$e.namespace!=null&&(Fr.namespace=$e.namespace),$e["x-attribsNamespace"]&&(Fr["x-attribsNamespace"]=Y({},$e["x-attribsNamespace"])),$e["x-attribsPrefix"]&&(Fr["x-attribsPrefix"]=Y({},$e["x-attribsPrefix"])),St=Fr}else if(Ye($e)){var dr=bt?st($e.children):[],hi=new F(dr);dr.forEach(function(Tr){return Tr.parent=hi}),St=hi}else if(De($e)){var dr=bt?st($e.children):[],ht=new fe(dr);dr.forEach(function(Tr){return Tr.parent=ht}),$e["x-mode"]&&(ht["x-mode"]=$e["x-mode"]),St=ht}else if(We($e)){var Zt=new s($e.name,$e.data);$e["x-name"]!=null&&(Zt["x-name"]=$e["x-name"],Zt["x-publicId"]=$e["x-publicId"],Zt["x-systemId"]=$e["x-systemId"]),St=Zt}else throw new Error("Not implemented yet: ".concat($e.type));return St.startIndex=$e.startIndex,St.endIndex=$e.endIndex,$e.sourceCodeLocation!=null&&(St.sourceCodeLocation=$e.sourceCodeLocation),St}fn.cloneNode=et;function st($e){for(var bt=$e.map(function(dr){return et(dr,!0)}),St=1;St<bt.length;St++)bt[St].prev=bt[St-1],bt[St-1].next=bt[St];return bt}return fn}var x1;function Wh(){return x1||(x1=1,function(L){var Y=Mf&&Mf.__createBinding||(Object.create?function(s,ne,F,fe){fe===void 0&&(fe=F);var qe=Object.getOwnPropertyDescriptor(ne,F);(!qe||("get"in qe?!ne.__esModule:qe.writable||qe.configurable))&&(qe={enumerable:!0,get:function(){return ne[F]}}),Object.defineProperty(s,fe,qe)}:function(s,ne,F,fe){fe===void 0&&(fe=F),s[fe]=ne[F]}),Z=Mf&&Mf.__exportStar||function(s,ne){for(var F in s)F!=="default"&&!Object.prototype.hasOwnProperty.call(ne,F)&&Y(ne,s,F)};Object.defineProperty(L,"__esModule",{value:!0}),L.DomHandler=void 0;var Ee=fm(),ue=v1();Z(v1(),L);var _e={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},be=function(){function s(ne,F,fe){this.dom=[],this.root=new ue.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof F=="function"&&(fe=F,F=_e),typeof ne=="object"&&(F=ne,ne=void 0),this.callback=ne??null,this.options=F??_e,this.elementCB=fe??null}return s.prototype.onparserinit=function(ne){this.parser=ne},s.prototype.onreset=function(){this.dom=[],this.root=new ue.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},s.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},s.prototype.onerror=function(ne){this.handleCallback(ne)},s.prototype.onclosetag=function(){this.lastNode=null;var ne=this.tagStack.pop();this.options.withEndIndices&&(ne.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(ne)},s.prototype.onopentag=function(ne,F){var fe=this.options.xmlMode?Ee.ElementType.Tag:void 0,qe=new ue.Element(ne,F,void 0,fe);this.addNode(qe),this.tagStack.push(qe)},s.prototype.ontext=function(ne){var F=this.lastNode;if(F&&F.type===Ee.ElementType.Text)F.data+=ne,this.options.withEndIndices&&(F.endIndex=this.parser.endIndex);else{var fe=new ue.Text(ne);this.addNode(fe),this.lastNode=fe}},s.prototype.oncomment=function(ne){if(this.lastNode&&this.lastNode.type===Ee.ElementType.Comment){this.lastNode.data+=ne;return}var F=new ue.Comment(ne);this.addNode(F),this.lastNode=F},s.prototype.oncommentend=function(){this.lastNode=null},s.prototype.oncdatastart=function(){var ne=new ue.Text(""),F=new ue.CDATA([ne]);this.addNode(F),ne.parent=F,this.lastNode=ne},s.prototype.oncdataend=function(){this.lastNode=null},s.prototype.onprocessinginstruction=function(ne,F){var fe=new ue.ProcessingInstruction(ne,F);this.addNode(fe)},s.prototype.handleCallback=function(ne){if(typeof this.callback=="function")this.callback(ne,this.dom);else if(ne)throw ne},s.prototype.addNode=function(ne){var F=this.tagStack[this.tagStack.length-1],fe=F.children[F.children.length-1];this.options.withStartIndices&&(ne.startIndex=this.parser.startIndex),this.options.withEndIndices&&(ne.endIndex=this.parser.endIndex),F.children.push(ne),fe&&(ne.prev=fe,fe.next=ne),ne.parent=F,this.lastNode=null},s}();L.DomHandler=be,L.default=be}(Mf)),Mf}var Pf={},ih={},Fl={},Y_={},jh={},pg={},b1;function vE(){if(b1)return pg;b1=1,Object.defineProperty(pg,"__esModule",{value:!0});function L(Y){for(var Z=1;Z<Y.length;Z++)Y[Z][0]+=Y[Z-1][0]+1;return Y}return pg.default=new Map(L([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(L([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(L([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(L([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]])),pg}var K_={},w1;function h0(){return w1||(w1=1,function(L){Object.defineProperty(L,"__esModule",{value:!0}),L.escapeText=L.escapeAttribute=L.escapeUTF8=L.escape=L.encodeXML=L.getCodePoint=L.xmlReplacer=void 0,L.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var Y=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);L.getCodePoint=String.prototype.codePointAt!=null?function(ue,_e){return ue.codePointAt(_e)}:function(ue,_e){return(ue.charCodeAt(_e)&64512)===55296?(ue.charCodeAt(_e)-55296)*1024+ue.charCodeAt(_e+1)-56320+65536:ue.charCodeAt(_e)};function Z(ue){for(var _e="",be=0,s;(s=L.xmlReplacer.exec(ue))!==null;){var ne=s.index,F=ue.charCodeAt(ne),fe=Y.get(F);fe!==void 0?(_e+=ue.substring(be,ne)+fe,be=ne+1):(_e+="".concat(ue.substring(be,ne),"&#x").concat((0,L.getCodePoint)(ue,ne).toString(16),";"),be=L.xmlReplacer.lastIndex+=+((F&64512)===55296))}return _e+ue.substr(be)}L.encodeXML=Z,L.escape=Z;function Ee(ue,_e){return function(s){for(var ne,F=0,fe="";ne=ue.exec(s);)F!==ne.index&&(fe+=s.substring(F,ne.index)),fe+=_e.get(ne[0].charCodeAt(0)),F=ne.index+1;return fe+s.substring(F)}}L.escapeUTF8=Ee(/[&<>'"]/g,Y),L.escapeAttribute=Ee(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),L.escapeText=Ee(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))}(K_)),K_}var S1;function T1(){if(S1)return jh;S1=1;var L=jh&&jh.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(jh,"__esModule",{value:!0}),jh.encodeNonAsciiHTML=jh.encodeHTML=void 0;var Y=L(vE()),Z=h0(),Ee=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function ue(s){return be(Ee,s)}jh.encodeHTML=ue;function _e(s){return be(Z.xmlReplacer,s)}jh.encodeNonAsciiHTML=_e;function be(s,ne){for(var F="",fe=0,qe;(qe=s.exec(ne))!==null;){var Ne=qe.index;F+=ne.substring(fe,Ne);var Ye=ne.charCodeAt(Ne),ze=Y.default.get(Ye);if(typeof ze=="object"){if(Ne+1<ne.length){var Xe=ne.charCodeAt(Ne+1),We=typeof ze.n=="number"?ze.n===Xe?ze.o:void 0:ze.n.get(Xe);if(We!==void 0){F+=We,fe=s.lastIndex+=1;continue}}ze=ze.v}if(ze!==void 0)F+=ze,fe=Ne+1;else{var De=(0,Z.getCodePoint)(ne,Ne);F+="&#x".concat(De.toString(16),";"),fe=s.lastIndex+=+(De!==Ye)}}return F+ne.substr(fe)}return jh}var E1;function xE(){return E1||(E1=1,function(L){Object.defineProperty(L,"__esModule",{value:!0}),L.decodeXMLStrict=L.decodeHTML5Strict=L.decodeHTML4Strict=L.decodeHTML5=L.decodeHTML4=L.decodeHTMLAttribute=L.decodeHTMLStrict=L.decodeHTML=L.decodeXML=L.DecodingMode=L.EntityDecoder=L.encodeHTML5=L.encodeHTML4=L.encodeNonAsciiHTML=L.encodeHTML=L.escapeText=L.escapeAttribute=L.escapeUTF8=L.escape=L.encodeXML=L.encode=L.decodeStrict=L.decode=L.EncodingMode=L.EntityLevel=void 0;var Y=bg(),Z=T1(),Ee=h0(),ue;(function(Ne){Ne[Ne.XML=0]="XML",Ne[Ne.HTML=1]="HTML"})(ue=L.EntityLevel||(L.EntityLevel={}));var _e;(function(Ne){Ne[Ne.UTF8=0]="UTF8",Ne[Ne.ASCII=1]="ASCII",Ne[Ne.Extensive=2]="Extensive",Ne[Ne.Attribute=3]="Attribute",Ne[Ne.Text=4]="Text"})(_e=L.EncodingMode||(L.EncodingMode={}));function be(Ne,Ye){Ye===void 0&&(Ye=ue.XML);var ze=typeof Ye=="number"?Ye:Ye.level;if(ze===ue.HTML){var Xe=typeof Ye=="object"?Ye.mode:void 0;return(0,Y.decodeHTML)(Ne,Xe)}return(0,Y.decodeXML)(Ne)}L.decode=be;function s(Ne,Ye){var ze;Ye===void 0&&(Ye=ue.XML);var Xe=typeof Ye=="number"?{level:Ye}:Ye;return(ze=Xe.mode)!==null&&ze!==void 0||(Xe.mode=Y.DecodingMode.Strict),be(Ne,Xe)}L.decodeStrict=s;function ne(Ne,Ye){Ye===void 0&&(Ye=ue.XML);var ze=typeof Ye=="number"?{level:Ye}:Ye;return ze.mode===_e.UTF8?(0,Ee.escapeUTF8)(Ne):ze.mode===_e.Attribute?(0,Ee.escapeAttribute)(Ne):ze.mode===_e.Text?(0,Ee.escapeText)(Ne):ze.level===ue.HTML?ze.mode===_e.ASCII?(0,Z.encodeNonAsciiHTML)(Ne):(0,Z.encodeHTML)(Ne):(0,Ee.encodeXML)(Ne)}L.encode=ne;var F=h0();Object.defineProperty(L,"encodeXML",{enumerable:!0,get:function(){return F.encodeXML}}),Object.defineProperty(L,"escape",{enumerable:!0,get:function(){return F.escape}}),Object.defineProperty(L,"escapeUTF8",{enumerable:!0,get:function(){return F.escapeUTF8}}),Object.defineProperty(L,"escapeAttribute",{enumerable:!0,get:function(){return F.escapeAttribute}}),Object.defineProperty(L,"escapeText",{enumerable:!0,get:function(){return F.escapeText}});var fe=T1();Object.defineProperty(L,"encodeHTML",{enumerable:!0,get:function(){return fe.encodeHTML}}),Object.defineProperty(L,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return fe.encodeNonAsciiHTML}}),Object.defineProperty(L,"encodeHTML4",{enumerable:!0,get:function(){return fe.encodeHTML}}),Object.defineProperty(L,"encodeHTML5",{enumerable:!0,get:function(){return fe.encodeHTML}});var qe=bg();Object.defineProperty(L,"EntityDecoder",{enumerable:!0,get:function(){return qe.EntityDecoder}}),Object.defineProperty(L,"DecodingMode",{enumerable:!0,get:function(){return qe.DecodingMode}}),Object.defineProperty(L,"decodeXML",{enumerable:!0,get:function(){return qe.decodeXML}}),Object.defineProperty(L,"decodeHTML",{enumerable:!0,get:function(){return qe.decodeHTML}}),Object.defineProperty(L,"decodeHTMLStrict",{enumerable:!0,get:function(){return qe.decodeHTMLStrict}}),Object.defineProperty(L,"decodeHTMLAttribute",{enumerable:!0,get:function(){return qe.decodeHTMLAttribute}}),Object.defineProperty(L,"decodeHTML4",{enumerable:!0,get:function(){return qe.decodeHTML}}),Object.defineProperty(L,"decodeHTML5",{enumerable:!0,get:function(){return qe.decodeHTML}}),Object.defineProperty(L,"decodeHTML4Strict",{enumerable:!0,get:function(){return qe.decodeHTMLStrict}}),Object.defineProperty(L,"decodeHTML5Strict",{enumerable:!0,get:function(){return qe.decodeHTMLStrict}}),Object.defineProperty(L,"decodeXMLStrict",{enumerable:!0,get:function(){return qe.decodeXML}})}(Y_)),Y_}var Rf={},I1;function bE(){return I1||(I1=1,Object.defineProperty(Rf,"__esModule",{value:!0}),Rf.attributeNames=Rf.elementNames=void 0,Rf.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(L){return[L.toLowerCase(),L]})),Rf.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(L){return[L.toLowerCase(),L]}))),Rf}var A1;function wE(){if(A1)return Fl;A1=1;var L=Fl&&Fl.__assign||function(){return L=Object.assign||function(st){for(var $e,bt=1,St=arguments.length;bt<St;bt++){$e=arguments[bt];for(var dr in $e)Object.prototype.hasOwnProperty.call($e,dr)&&(st[dr]=$e[dr])}return st},L.apply(this,arguments)},Y=Fl&&Fl.__createBinding||(Object.create?function(st,$e,bt,St){St===void 0&&(St=bt);var dr=Object.getOwnPropertyDescriptor($e,bt);(!dr||("get"in dr?!$e.__esModule:dr.writable||dr.configurable))&&(dr={enumerable:!0,get:function(){return $e[bt]}}),Object.defineProperty(st,St,dr)}:function(st,$e,bt,St){St===void 0&&(St=bt),st[St]=$e[bt]}),Z=Fl&&Fl.__setModuleDefault||(Object.create?function(st,$e){Object.defineProperty(st,"default",{enumerable:!0,value:$e})}:function(st,$e){st.default=$e}),Ee=Fl&&Fl.__importStar||function(st){if(st&&st.__esModule)return st;var $e={};if(st!=null)for(var bt in st)bt!=="default"&&Object.prototype.hasOwnProperty.call(st,bt)&&Y($e,st,bt);return Z($e,st),$e};Object.defineProperty(Fl,"__esModule",{value:!0}),Fl.render=void 0;var ue=Ee(fm()),_e=xE(),be=bE(),s=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function ne(st){return st.replace(/"/g,"&quot;")}function F(st,$e){var bt;if(st){var St=((bt=$e.encodeEntities)!==null&&bt!==void 0?bt:$e.decodeEntities)===!1?ne:$e.xmlMode||$e.encodeEntities!=="utf8"?_e.encodeXML:_e.escapeAttribute;return Object.keys(st).map(function(dr){var Fr,hi,ht=(Fr=st[dr])!==null&&Fr!==void 0?Fr:"";return $e.xmlMode==="foreign"&&(dr=(hi=be.attributeNames.get(dr))!==null&&hi!==void 0?hi:dr),!$e.emptyAttrs&&!$e.xmlMode&&ht===""?dr:"".concat(dr,'="').concat(St(ht),'"')}).join(" ")}}var fe=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function qe(st,$e){$e===void 0&&($e={});for(var bt=("length"in st)?st:[st],St="",dr=0;dr<bt.length;dr++)St+=Ne(bt[dr],$e);return St}Fl.render=qe,Fl.default=qe;function Ne(st,$e){switch(st.type){case ue.Root:return qe(st.children,$e);case ue.Doctype:case ue.Directive:return We(st);case ue.Comment:return et(st);case ue.CDATA:return Ke(st);case ue.Script:case ue.Style:case ue.Tag:return Xe(st,$e);case ue.Text:return De(st,$e)}}var Ye=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),ze=new Set(["svg","math"]);function Xe(st,$e){var bt;$e.xmlMode==="foreign"&&(st.name=(bt=be.elementNames.get(st.name))!==null&&bt!==void 0?bt:st.name,st.parent&&Ye.has(st.parent.name)&&($e=L(L({},$e),{xmlMode:!1}))),!$e.xmlMode&&ze.has(st.name)&&($e=L(L({},$e),{xmlMode:"foreign"}));var St="<".concat(st.name),dr=F(st.attribs,$e);return dr&&(St+=" ".concat(dr)),st.children.length===0&&($e.xmlMode?$e.selfClosingTags!==!1:$e.selfClosingTags&&fe.has(st.name))?($e.xmlMode||(St+=" "),St+="/>"):(St+=">",st.children.length>0&&(St+=qe(st.children,$e)),($e.xmlMode||!fe.has(st.name))&&(St+="</".concat(st.name,">"))),St}function We(st){return"<".concat(st.data,">")}function De(st,$e){var bt,St=st.data||"";return((bt=$e.encodeEntities)!==null&&bt!==void 0?bt:$e.decodeEntities)!==!1&&!(!$e.xmlMode&&st.parent&&s.has(st.parent.name))&&(St=$e.xmlMode||$e.encodeEntities!=="utf8"?(0,_e.encodeXML)(St):(0,_e.escapeText)(St)),St}function Ke(st){return"<![CDATA[".concat(st.children[0].data,"]]>")}function et(st){return"<!--".concat(st.data,"-->")}return Fl}var C1;function bb(){if(C1)return ih;C1=1;var L=ih&&ih.__importDefault||function(F){return F&&F.__esModule?F:{default:F}};Object.defineProperty(ih,"__esModule",{value:!0}),ih.getOuterHTML=ue,ih.getInnerHTML=_e,ih.getText=be,ih.textContent=s,ih.innerText=ne;var Y=Wh(),Z=L(wE()),Ee=fm();function ue(F,fe){return(0,Z.default)(F,fe)}function _e(F,fe){return(0,Y.hasChildren)(F)?F.children.map(function(qe){return ue(qe,fe)}).join(""):""}function be(F){return Array.isArray(F)?F.map(be).join(""):(0,Y.isTag)(F)?F.name==="br"?`
`:be(F.children):(0,Y.isCDATA)(F)?be(F.children):(0,Y.isText)(F)?F.data:""}function s(F){return Array.isArray(F)?F.map(s).join(""):(0,Y.hasChildren)(F)&&!(0,Y.isComment)(F)?s(F.children):(0,Y.isText)(F)?F.data:""}function ne(F){return Array.isArray(F)?F.map(ne).join(""):(0,Y.hasChildren)(F)&&(F.type===Ee.ElementType.Tag||(0,Y.isCDATA)(F))?ne(F.children):(0,Y.isText)(F)?F.data:""}return ih}var pc={},M1;function SE(){if(M1)return pc;M1=1,Object.defineProperty(pc,"__esModule",{value:!0}),pc.getChildren=Y,pc.getParent=Z,pc.getSiblings=Ee,pc.getAttributeValue=ue,pc.hasAttrib=_e,pc.getName=be,pc.nextElementSibling=s,pc.prevElementSibling=ne;var L=Wh();function Y(F){return(0,L.hasChildren)(F)?F.children:[]}function Z(F){return F.parent||null}function Ee(F){var fe,qe,Ne=Z(F);if(Ne!=null)return Y(Ne);for(var Ye=[F],ze=F.prev,Xe=F.next;ze!=null;)Ye.unshift(ze),fe=ze,ze=fe.prev;for(;Xe!=null;)Ye.push(Xe),qe=Xe,Xe=qe.next;return Ye}function ue(F,fe){var qe;return(qe=F.attribs)===null||qe===void 0?void 0:qe[fe]}function _e(F,fe){return F.attribs!=null&&Object.prototype.hasOwnProperty.call(F.attribs,fe)&&F.attribs[fe]!=null}function be(F){return F.name}function s(F){for(var fe,qe=F.next;qe!==null&&!(0,L.isTag)(qe);)fe=qe,qe=fe.next;return qe}function ne(F){for(var fe,qe=F.prev;qe!==null&&!(0,L.isTag)(qe);)fe=qe,qe=fe.prev;return qe}return pc}var Uh={},P1;function TE(){if(P1)return Uh;P1=1,Object.defineProperty(Uh,"__esModule",{value:!0}),Uh.removeElement=L,Uh.replaceElement=Y,Uh.appendChild=Z,Uh.append=Ee,Uh.prependChild=ue,Uh.prepend=_e;function L(be){if(be.prev&&(be.prev.next=be.next),be.next&&(be.next.prev=be.prev),be.parent){var s=be.parent.children,ne=s.lastIndexOf(be);ne>=0&&s.splice(ne,1)}be.next=null,be.prev=null,be.parent=null}function Y(be,s){var ne=s.prev=be.prev;ne&&(ne.next=s);var F=s.next=be.next;F&&(F.prev=s);var fe=s.parent=be.parent;if(fe){var qe=fe.children;qe[qe.lastIndexOf(be)]=s,be.parent=null}}function Z(be,s){if(L(s),s.next=null,s.parent=be,be.children.push(s)>1){var ne=be.children[be.children.length-2];ne.next=s,s.prev=ne}else s.prev=null}function Ee(be,s){L(s);var ne=be.parent,F=be.next;if(s.next=F,s.prev=be,be.next=s,s.parent=ne,F){if(F.prev=s,ne){var fe=ne.children;fe.splice(fe.lastIndexOf(F),0,s)}}else ne&&ne.children.push(s)}function ue(be,s){if(L(s),s.parent=be,s.prev=null,be.children.unshift(s)!==1){var ne=be.children[1];ne.prev=s,s.next=ne}else s.next=null}function _e(be,s){L(s);var ne=be.parent;if(ne){var F=ne.children;F.splice(F.indexOf(be),0,s)}be.prev&&(be.prev.next=s),s.parent=ne,s.prev=be.prev,s.next=be,be.prev=s}return Uh}var qh={},R1;function wb(){if(R1)return qh;R1=1,Object.defineProperty(qh,"__esModule",{value:!0}),qh.filter=Y,qh.find=Z,qh.findOneChild=Ee,qh.findOne=ue,qh.existsOne=_e,qh.findAll=be;var L=Wh();function Y(s,ne,F,fe){return F===void 0&&(F=!0),fe===void 0&&(fe=1/0),Z(s,Array.isArray(ne)?ne:[ne],F,fe)}function Z(s,ne,F,fe){for(var qe=[],Ne=[Array.isArray(ne)?ne:[ne]],Ye=[0];;){if(Ye[0]>=Ne[0].length){if(Ye.length===1)return qe;Ne.shift(),Ye.shift();continue}var ze=Ne[0][Ye[0]++];if(s(ze)&&(qe.push(ze),--fe<=0))return qe;F&&(0,L.hasChildren)(ze)&&ze.children.length>0&&(Ye.unshift(0),Ne.unshift(ze.children))}}function Ee(s,ne){return ne.find(s)}function ue(s,ne,F){F===void 0&&(F=!0);for(var fe=Array.isArray(ne)?ne:[ne],qe=0;qe<fe.length;qe++){var Ne=fe[qe];if((0,L.isTag)(Ne)&&s(Ne))return Ne;if(F&&(0,L.hasChildren)(Ne)&&Ne.children.length>0){var Ye=ue(s,Ne.children,!0);if(Ye)return Ye}}return null}function _e(s,ne){return(Array.isArray(ne)?ne:[ne]).some(function(F){return(0,L.isTag)(F)&&s(F)||(0,L.hasChildren)(F)&&_e(s,F.children)})}function be(s,ne){for(var F=[],fe=[Array.isArray(ne)?ne:[ne]],qe=[0];;){if(qe[0]>=fe[0].length){if(fe.length===1)return F;fe.shift(),qe.shift();continue}var Ne=fe[0][qe[0]++];(0,L.isTag)(Ne)&&s(Ne)&&F.push(Ne),(0,L.hasChildren)(Ne)&&Ne.children.length>0&&(qe.unshift(0),fe.unshift(Ne.children))}}return qh}var Gh={},D1;function Sb(){if(D1)return Gh;D1=1,Object.defineProperty(Gh,"__esModule",{value:!0}),Gh.testElement=be,Gh.getElements=s,Gh.getElementById=ne,Gh.getElementsByTagName=F,Gh.getElementsByClassName=fe,Gh.getElementsByTagType=qe;var L=Wh(),Y=wb(),Z={tag_name:function(Ne){return typeof Ne=="function"?function(Ye){return(0,L.isTag)(Ye)&&Ne(Ye.name)}:Ne==="*"?L.isTag:function(Ye){return(0,L.isTag)(Ye)&&Ye.name===Ne}},tag_type:function(Ne){return typeof Ne=="function"?function(Ye){return Ne(Ye.type)}:function(Ye){return Ye.type===Ne}},tag_contains:function(Ne){return typeof Ne=="function"?function(Ye){return(0,L.isText)(Ye)&&Ne(Ye.data)}:function(Ye){return(0,L.isText)(Ye)&&Ye.data===Ne}}};function Ee(Ne,Ye){return typeof Ye=="function"?function(ze){return(0,L.isTag)(ze)&&Ye(ze.attribs[Ne])}:function(ze){return(0,L.isTag)(ze)&&ze.attribs[Ne]===Ye}}function ue(Ne,Ye){return function(ze){return Ne(ze)||Ye(ze)}}function _e(Ne){var Ye=Object.keys(Ne).map(function(ze){var Xe=Ne[ze];return Object.prototype.hasOwnProperty.call(Z,ze)?Z[ze](Xe):Ee(ze,Xe)});return Ye.length===0?null:Ye.reduce(ue)}function be(Ne,Ye){var ze=_e(Ne);return ze?ze(Ye):!0}function s(Ne,Ye,ze,Xe){Xe===void 0&&(Xe=1/0);var We=_e(Ne);return We?(0,Y.filter)(We,Ye,ze,Xe):[]}function ne(Ne,Ye,ze){return ze===void 0&&(ze=!0),Array.isArray(Ye)||(Ye=[Ye]),(0,Y.findOne)(Ee("id",Ne),Ye,ze)}function F(Ne,Ye,ze,Xe){return ze===void 0&&(ze=!0),Xe===void 0&&(Xe=1/0),(0,Y.filter)(Z.tag_name(Ne),Ye,ze,Xe)}function fe(Ne,Ye,ze,Xe){return ze===void 0&&(ze=!0),Xe===void 0&&(Xe=1/0),(0,Y.filter)(Ee("class",Ne),Ye,ze,Xe)}function qe(Ne,Ye,ze,Xe){return ze===void 0&&(ze=!0),Xe===void 0&&(Xe=1/0),(0,Y.filter)(Z.tag_type(Ne),Ye,ze,Xe)}return Gh}var Fd={},k1;function EE(){if(k1)return Fd;k1=1,Object.defineProperty(Fd,"__esModule",{value:!0}),Fd.DocumentPosition=void 0,Fd.removeSubsets=Y,Fd.compareDocumentPosition=Ee,Fd.uniqueSort=ue;var L=Wh();function Y(_e){for(var be=_e.length;--be>=0;){var s=_e[be];if(be>0&&_e.lastIndexOf(s,be-1)>=0){_e.splice(be,1);continue}for(var ne=s.parent;ne;ne=ne.parent)if(_e.includes(ne)){_e.splice(be,1);break}}return _e}var Z;(function(_e){_e[_e.DISCONNECTED=1]="DISCONNECTED",_e[_e.PRECEDING=2]="PRECEDING",_e[_e.FOLLOWING=4]="FOLLOWING",_e[_e.CONTAINS=8]="CONTAINS",_e[_e.CONTAINED_BY=16]="CONTAINED_BY"})(Z||(Fd.DocumentPosition=Z={}));function Ee(_e,be){var s=[],ne=[];if(_e===be)return 0;for(var F=(0,L.hasChildren)(_e)?_e:_e.parent;F;)s.unshift(F),F=F.parent;for(F=(0,L.hasChildren)(be)?be:be.parent;F;)ne.unshift(F),F=F.parent;for(var fe=Math.min(s.length,ne.length),qe=0;qe<fe&&s[qe]===ne[qe];)qe++;if(qe===0)return Z.DISCONNECTED;var Ne=s[qe-1],Ye=Ne.children,ze=s[qe],Xe=ne[qe];return Ye.indexOf(ze)>Ye.indexOf(Xe)?Ne===be?Z.FOLLOWING|Z.CONTAINED_BY:Z.FOLLOWING:Ne===_e?Z.PRECEDING|Z.CONTAINS:Z.PRECEDING}function ue(_e){return _e=_e.filter(function(be,s,ne){return!ne.includes(be,s+1)}),_e.sort(function(be,s){var ne=Ee(be,s);return ne&Z.PRECEDING?-1:ne&Z.FOLLOWING?1:0}),_e}return Fd}var mg={},L1;function IE(){if(L1)return mg;L1=1,Object.defineProperty(mg,"__esModule",{value:!0}),mg.getFeed=Z;var L=bb(),Y=Sb();function Z(Ne){var Ye=ne(qe,Ne);return Ye?Ye.name==="feed"?Ee(Ye):ue(Ye):null}function Ee(Ne){var Ye,ze=Ne.children,Xe={type:"atom",items:(0,Y.getElementsByTagName)("entry",ze).map(function(Ke){var et,st=Ke.children,$e={media:s(st)};fe($e,"id","id",st),fe($e,"title","title",st);var bt=(et=ne("link",st))===null||et===void 0?void 0:et.attribs.href;bt&&($e.link=bt);var St=F("summary",st)||F("content",st);St&&($e.description=St);var dr=F("updated",st);return dr&&($e.pubDate=new Date(dr)),$e})};fe(Xe,"id","id",ze),fe(Xe,"title","title",ze);var We=(Ye=ne("link",ze))===null||Ye===void 0?void 0:Ye.attribs.href;We&&(Xe.link=We),fe(Xe,"description","subtitle",ze);var De=F("updated",ze);return De&&(Xe.updated=new Date(De)),fe(Xe,"author","email",ze,!0),Xe}function ue(Ne){var Ye,ze,Xe=(ze=(Ye=ne("channel",Ne.children))===null||Ye===void 0?void 0:Ye.children)!==null&&ze!==void 0?ze:[],We={type:Ne.name.substr(0,3),id:"",items:(0,Y.getElementsByTagName)("item",Ne.children).map(function(Ke){var et=Ke.children,st={media:s(et)};fe(st,"id","guid",et),fe(st,"title","title",et),fe(st,"link","link",et),fe(st,"description","description",et);var $e=F("pubDate",et)||F("dc:date",et);return $e&&(st.pubDate=new Date($e)),st})};fe(We,"title","title",Xe),fe(We,"link","link",Xe),fe(We,"description","description",Xe);var De=F("lastBuildDate",Xe);return De&&(We.updated=new Date(De)),fe(We,"author","managingEditor",Xe,!0),We}var _e=["url","type","lang"],be=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function s(Ne){return(0,Y.getElementsByTagName)("media:content",Ne).map(function(Ye){for(var ze=Ye.attribs,Xe={medium:ze.medium,isDefault:!!ze.isDefault},We=0,De=_e;We<De.length;We++){var Ke=De[We];ze[Ke]&&(Xe[Ke]=ze[Ke])}for(var et=0,st=be;et<st.length;et++){var Ke=st[et];ze[Ke]&&(Xe[Ke]=parseInt(ze[Ke],10))}return ze.expression&&(Xe.expression=ze.expression),Xe})}function ne(Ne,Ye){return(0,Y.getElementsByTagName)(Ne,Ye,!0,1)[0]}function F(Ne,Ye,ze){return ze===void 0&&(ze=!1),(0,L.textContent)((0,Y.getElementsByTagName)(Ne,Ye,ze,1)).trim()}function fe(Ne,Ye,ze,Xe,We){We===void 0&&(We=!1);var De=F(ze,Xe,We);De&&(Ne[Ye]=De)}function qe(Ne){return Ne==="rss"||Ne==="feed"||Ne==="rdf:RDF"}return mg}var z1;function J_(){return z1||(z1=1,function(L){var Y=Pf&&Pf.__createBinding||(Object.create?function(ue,_e,be,s){s===void 0&&(s=be);var ne=Object.getOwnPropertyDescriptor(_e,be);(!ne||("get"in ne?!_e.__esModule:ne.writable||ne.configurable))&&(ne={enumerable:!0,get:function(){return _e[be]}}),Object.defineProperty(ue,s,ne)}:function(ue,_e,be,s){s===void 0&&(s=be),ue[s]=_e[be]}),Z=Pf&&Pf.__exportStar||function(ue,_e){for(var be in ue)be!=="default"&&!Object.prototype.hasOwnProperty.call(_e,be)&&Y(_e,ue,be)};Object.defineProperty(L,"__esModule",{value:!0}),L.hasChildren=L.isDocument=L.isComment=L.isText=L.isCDATA=L.isTag=void 0,Z(bb(),L),Z(SE(),L),Z(TE(),L),Z(wb(),L),Z(Sb(),L),Z(EE(),L),Z(IE(),L);var Ee=Wh();Object.defineProperty(L,"isTag",{enumerable:!0,get:function(){return Ee.isTag}}),Object.defineProperty(L,"isCDATA",{enumerable:!0,get:function(){return Ee.isCDATA}}),Object.defineProperty(L,"isText",{enumerable:!0,get:function(){return Ee.isText}}),Object.defineProperty(L,"isComment",{enumerable:!0,get:function(){return Ee.isComment}}),Object.defineProperty(L,"isDocument",{enumerable:!0,get:function(){return Ee.isDocument}}),Object.defineProperty(L,"hasChildren",{enumerable:!0,get:function(){return Ee.hasChildren}})}(Pf)),Pf}var O1;function AE(){return O1||(O1=1,function(L){var Y=hc&&hc.__createBinding||(Object.create?function(Ke,et,st,$e){$e===void 0&&($e=st);var bt=Object.getOwnPropertyDescriptor(et,st);(!bt||("get"in bt?!et.__esModule:bt.writable||bt.configurable))&&(bt={enumerable:!0,get:function(){return et[st]}}),Object.defineProperty(Ke,$e,bt)}:function(Ke,et,st,$e){$e===void 0&&($e=st),Ke[$e]=et[st]}),Z=hc&&hc.__setModuleDefault||(Object.create?function(Ke,et){Object.defineProperty(Ke,"default",{enumerable:!0,value:et})}:function(Ke,et){Ke.default=et}),Ee=hc&&hc.__importStar||function(Ke){if(Ke&&Ke.__esModule)return Ke;var et={};if(Ke!=null)for(var st in Ke)st!=="default"&&Object.prototype.hasOwnProperty.call(Ke,st)&&Y(et,Ke,st);return Z(et,Ke),et},ue=hc&&hc.__importDefault||function(Ke){return Ke&&Ke.__esModule?Ke:{default:Ke}};Object.defineProperty(L,"__esModule",{value:!0}),L.DomUtils=L.parseFeed=L.getFeed=L.ElementType=L.QuoteType=L.Tokenizer=L.createDomStream=L.createDocumentStream=L.parseDOM=L.parseDocument=L.DefaultHandler=L.DomHandler=L.Parser=void 0;var _e=g1(),be=g1();Object.defineProperty(L,"Parser",{enumerable:!0,get:function(){return be.Parser}});var s=Wh(),ne=Wh();Object.defineProperty(L,"DomHandler",{enumerable:!0,get:function(){return ne.DomHandler}}),Object.defineProperty(L,"DefaultHandler",{enumerable:!0,get:function(){return ne.DomHandler}});function F(Ke,et){var st=new s.DomHandler(void 0,et);return new _e.Parser(st,et).end(Ke),st.root}L.parseDocument=F;function fe(Ke,et){return F(Ke,et).children}L.parseDOM=fe;function qe(Ke,et,st){var $e=new s.DomHandler(function(bt){return Ke(bt,$e.root)},et,st);return new _e.Parser($e,et)}L.createDocumentStream=qe;function Ne(Ke,et,st){var $e=new s.DomHandler(Ke,et,st);return new _e.Parser($e,et)}L.createDomStream=Ne;var Ye=xb();Object.defineProperty(L,"Tokenizer",{enumerable:!0,get:function(){return ue(Ye).default}}),Object.defineProperty(L,"QuoteType",{enumerable:!0,get:function(){return Ye.QuoteType}}),L.ElementType=Ee(fm());var ze=J_(),Xe=J_();Object.defineProperty(L,"getFeed",{enumerable:!0,get:function(){return Xe.getFeed}});var We={xmlMode:!0};function De(Ke,et){return et===void 0&&(et=We),(0,ze.getFeed)(fe(Ke,et))}L.parseFeed=De,L.DomUtils=Ee(J_())}(hc)),hc}var Q_,F1;function CE(){if(F1)return Q_;F1=1;function L(Y){return!0}return Q_={shouldProcessEveryNode:L},Q_}var e0,B1;function ME(){if(B1)return e0;B1=1;var L="[object Symbol]",Y=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Z=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ee="\\ud800-\\udfff",ue="\\u0300-\\u036f\\ufe20-\\ufe23",_e="\\u20d0-\\u20f0",be="\\u2700-\\u27bf",s="a-z\\xdf-\\xf6\\xf8-\\xff",ne="\\xac\\xb1\\xd7\\xf7",F="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",fe="\\u2000-\\u206f",qe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ne="A-Z\\xc0-\\xd6\\xd8-\\xde",Ye="\\ufe0e\\ufe0f",ze=ne+F+fe+qe,Xe="[']",We="["+Ee+"]",De="["+ze+"]",Ke="["+ue+_e+"]",et="\\d+",st="["+be+"]",$e="["+s+"]",bt="[^"+Ee+ze+et+be+s+Ne+"]",St="\\ud83c[\\udffb-\\udfff]",dr="(?:"+Ke+"|"+St+")",Fr="[^"+Ee+"]",hi="(?:\\ud83c[\\udde6-\\uddff]){2}",ht="[\\ud800-\\udbff][\\udc00-\\udfff]",Zt="["+Ne+"]",fr="\\u200d",Tr="(?:"+$e+"|"+bt+")",Or="(?:"+Zt+"|"+bt+")",ri="(?:"+Xe+"(?:d|ll|m|re|s|t|ve))?",fi="(?:"+Xe+"(?:D|LL|M|RE|S|T|VE))?",mr=dr+"?",Lr="["+Ye+"]?",or="(?:"+fr+"(?:"+[Fr,hi,ht].join("|")+")"+Lr+mr+")*",dt=Lr+mr+or,sr="(?:"+[st,hi,ht].join("|")+")"+dt,bi="(?:"+[Fr+Ke+"?",Ke,hi,ht,We].join("|")+")",Ai=RegExp(Xe,"g"),qr=RegExp(Ke,"g"),Gr=RegExp(St+"(?="+St+")|"+bi+dt,"g"),pi=RegExp([Zt+"?"+$e+"+"+ri+"(?="+[De,Zt,"$"].join("|")+")",Or+"+"+fi+"(?="+[De,Zt+Tr,"$"].join("|")+")",Zt+"?"+Tr+"+"+ri,Zt+"+"+fi,et,sr].join("|"),"g"),ji=RegExp("["+fr+Ee+ue+_e+Ye+"]"),jr=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Dn={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},Xn=typeof ug=="object"&&ug&&ug.Object===Object&&ug,xo=typeof self=="object"&&self&&self.Object===Object&&self,zi=Xn||xo||Function("return this")();function ts(xr,Oi,un,Ot){for(var pn=-1,gs=xr?xr.length:0;++pn<gs;)un=Oi(un,xr[pn],pn,xr);return un}function zs(xr){return xr.split("")}function no(xr){return xr.match(Y)||[]}function fs(xr){return function(Oi){return xr==null?void 0:xr[Oi]}}var rs=fs(Dn);function eo(xr){return ji.test(xr)}function po(xr){return jr.test(xr)}function ko(xr){return eo(xr)?mo(xr):zs(xr)}function mo(xr){return xr.match(Gr)||[]}function oo(xr){return xr.match(pi)||[]}var yo=Object.prototype,Ao=yo.toString,Ws=zi.Symbol,ps=Ws?Ws.prototype:void 0,Ho=ps?ps.toString:void 0;function is(xr,Oi,un){var Ot=-1,pn=xr.length;Oi<0&&(Oi=-Oi>pn?0:pn+Oi),un=un>pn?pn:un,un<0&&(un+=pn),pn=Oi>un?0:un-Oi>>>0,Oi>>>=0;for(var gs=Array(pn);++Ot<pn;)gs[Ot]=xr[Ot+Oi];return gs}function Lo(xr){if(typeof xr=="string")return xr;if(ra(xr))return Ho?Ho.call(xr):"";var Oi=xr+"";return Oi=="0"&&1/xr==-1/0?"-0":Oi}function co(xr,Oi,un){var Ot=xr.length;return un=un===void 0?Ot:un,is(xr,Oi,un)}function Os(xr){return function(Oi){Oi=os(Oi);var un=eo(Oi)?ko(Oi):void 0,Ot=un?un[0]:Oi.charAt(0),pn=un?co(un,1).join(""):Oi.slice(1);return Ot[xr]()+pn}}function ns(xr){return function(Oi){return ts(so(to(Oi).replace(Ai,"")),xr,"")}}function ms(xr){return!!xr&&typeof xr=="object"}function ra(xr){return typeof xr=="symbol"||ms(xr)&&Ao.call(xr)==L}function os(xr){return xr==null?"":Lo(xr)}var ia=ns(function(xr,Oi,un){return Oi=Oi.toLowerCase(),xr+(un?Qi(Oi):Oi)});function Qi(xr){return Es(os(xr).toLowerCase())}function to(xr){return xr=os(xr),xr&&xr.replace(Z,rs).replace(qr,"")}var Es=Os("toUpperCase");function so(xr,Oi,un){return xr=os(xr),Oi=Oi,Oi===void 0?po(xr)?oo(xr):no(xr):xr.match(Oi)||[]}return e0=ia,e0}var t0,N1;function PE(){if(N1)return t0;N1=1;const L=["accept","acceptCharset","accessKey","action","allowFullScreen","allowTransparency","alt","async","autoComplete","autoFocus","autoPlay","capture","cellPadding","cellSpacing","challenge","charSet","checked","cite","classID","className","colSpan","cols","content","contentEditable","contextMenu","controls","coords","crossOrigin","data","dateTime","default","defer","dir","disabled","download","draggable","encType","form","formAction","formEncType","formMethod","formNoValidate","formTarget","frameBorder","headers","height","hidden","high","href","hrefLang","htmlFor","httpEquiv","icon","id","inputMode","integrity","is","keyParams","keyType","kind","label","lang","list","loop","low","manifest","marginHeight","marginWidth","max","maxLength","media","mediaGroup","method","min","minLength","multiple","muted","name","noValidate","nonce","open","optimum","pattern","placeholder","poster","preload","profile","radioGroup","readOnly","rel","required","reversed","role","rowSpan","rows","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","span","spellCheck","src","srcDoc","srcLang","srcSet","start","step","style","summary","tabIndex","target","title","type","useMap","value","width","wmode","wrap","onClick"],Y=["autoCapitalize","autoCorrect","color","itemProp","itemScope","itemType","itemRef","itemID","security","unselectable","results","autoSave"],Z=["accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baseProfile","baselineShift","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","ideographic","imageRendering","in","in2","intercept","k","k1","k2","k3","k4","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","points","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","scale","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","vHanging","vIdeographic","vMathematical","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","viewBox","viewTarget","visibility","widths","wordSpacing","writingMode","x","x1","x2","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlns","xmlnsXlink","xmlBase","xmlLang","xmlSpace","y","y1","y2","yChannelSelector","z","zoomAndPan"];return t0=L.concat(Y).concat(Z).reduce(function(ue,_e){const be=_e.toLowerCase();return be!==_e&&(ue[be]=_e),ue},{}),t0}var r0,V1;function Tb(){if(V1)return r0;V1=1;const L=ME(),Y=cp(),Z=PE();function Ee(be){be=be||"";const s=be.split(/;(?!base64)/);let ne,F,fe,qe={};for(let Ne=0;Ne<s.length;++Ne)ne=s[Ne].split(":"),ne.length>2&&(ne[1]=ne.slice(1).join(":")),F=ne[0],fe=ne[1],typeof fe=="string"&&(fe=fe.trim()),F!=null&&fe!=null&&F.length>0&&fe.length>0&&(F=F.trim(),F.indexOf("--")!==0&&(F=L(F)),qe[F]=fe);return qe}const ue=["allowFullScreen","allowpaymentrequest","async","autoFocus","autoPlay","checked","controls","default","disabled","formNoValidate","hidden","ismap","itemScope","loop","multiple","muted","nomodule","noValidate","open","playsinline","readOnly","required","reversed","selected","truespeed"];function _e(be,s,ne,F){let fe={key:s};const qe=be.name.includes("-");be.attribs&&(fe=Object.entries(be.attribs).reduce((Ye,[ze,Xe])=>(qe||(ze=Z[ze.replace(/[-:]/,"")]||ze,ze==="style"?Xe=Ee(Xe):ze==="class"?ze="className":ze==="for"?ze="htmlFor":ze.startsWith("on")&&(Xe=Function(Xe)),ue.includes(ze)&&(Xe||"")===""&&(Xe=ze)),Ye[ze]=Xe,Ye),fe)),F=F||[];const Ne=ne!=null?[ne].concat(F):F;return Y.createElement.apply(null,[be.name,fe].concat(Ne))}return r0={createElement:_e},r0}var i0,j1;function Eb(){if(j1)return i0;j1=1;const L=Tb(),Y=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","menuitem","textarea"];function Z(){function Ee(ue,_e,be){return ue.type==="text"?ue.data:ue.type==="comment"?!1:Y.indexOf(ue.name)>-1?L.createElement(ue,be):L.createElement(ue,be,ue.data,_e)}return{processDefaultNode:Ee}}return i0=Z,i0}var n0,U1;function Ib(){if(U1)return n0;U1=1;const L=CE(),Y=Eb();function Z(){const Ee=new Y;return{defaultProcessingInstructions:[{shouldProcessNode:L.shouldProcessEveryNode,processNode:Ee.processDefaultNode}]}}return n0=Z,n0}var o0,q1;function Ab(){if(q1)return o0;q1=1;function L(){return!0}return o0={alwaysValid:L},o0}var s0,G1;function RE(){if(G1)return s0;G1=1;const L=AE().Parser,Y=Wh().DomHandler,Z=Ib(),Ee=Ab(),ue=Tb();function _e(be){function s(qe){be=be||{},be.decodeEntities=!0;const Ne=new Y;return new L(Ne,be).parseComplete(qe),Ne.dom.filter(function(ze){return ze.type!=="directive"})}function ne(qe,Ne,Ye,ze,Xe){if(Ne(qe)){(ze||[]).forEach(De=>{De.shouldPreprocessNode(qe)&&De.preprocessNode(qe,Xe)});const We=(Ye||[]).find(De=>De.shouldProcessNode(qe));if(We!=null){const De=(qe.children||[]).map((Ke,et)=>ne(Ke,Ne,Ye,ze,et)).filter(Ke=>Ke!=null&&Ke!==!1);return We.replaceChildren?ue.createElement(qe,Xe,qe.data,[We.processNode(qe,De,Xe)]):We.processNode(qe,De,Xe)}else return!1}else return!1}function F(qe,Ne,Ye,ze){const We=s(qe).map(function(De,Ke){return ne(De,Ne,Ye,ze,Ke)});return We.length<=1?We[0]:We}function fe(qe){const Ne=new Z;return F(qe,Ee.alwaysValid,Ne.defaultProcessingInstructions)}return{parse:fe,parseWithInstructions:F}}return s0=_e,s0}var a0,H1;function DE(){if(H1)return a0;H1=1;const L=RE(),Y=Ib(),Z=Ab(),Ee=Eb();return a0={Parser:L,ProcessingInstructions:Y,IsValidNodeDefinitions:Z,ProcessNodeDefinitions:Ee},a0}var kE=DE(),Bd={},Df={};/**
 * @license React
 * react-dom-server-legacy.browser.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $1;function LE(){if($1)return Df;$1=1;var L=cp();function Y(j){for(var te="https://reactjs.org/docs/error-decoder.html?invariant="+j,we=1;we<arguments.length;we++)te+="&args[]="+encodeURIComponent(arguments[we]);return"Minified React error #"+j+"; visit "+te+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Z=Object.prototype.hasOwnProperty,Ee=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,ue={},_e={};function be(j){return Z.call(_e,j)?!0:Z.call(ue,j)?!1:Ee.test(j)?_e[j]=!0:(ue[j]=!0,!1)}function s(j,te,we,Be,Ct,wt,Yt){this.acceptsBooleans=te===2||te===3||te===4,this.attributeName=Be,this.attributeNamespace=Ct,this.mustUseProperty=we,this.propertyName=j,this.type=te,this.sanitizeURL=wt,this.removeEmptyString=Yt}var ne={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(j){ne[j]=new s(j,0,!1,j,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(j){var te=j[0];ne[te]=new s(te,1,!1,j[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(j){ne[j]=new s(j,2,!1,j.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(j){ne[j]=new s(j,2,!1,j,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(j){ne[j]=new s(j,3,!1,j.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(j){ne[j]=new s(j,3,!0,j,null,!1,!1)}),["capture","download"].forEach(function(j){ne[j]=new s(j,4,!1,j,null,!1,!1)}),["cols","rows","size","span"].forEach(function(j){ne[j]=new s(j,6,!1,j,null,!1,!1)}),["rowSpan","start"].forEach(function(j){ne[j]=new s(j,5,!1,j.toLowerCase(),null,!1,!1)});var F=/[\-:]([a-z])/g;function fe(j){return j[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(j){var te=j.replace(F,fe);ne[te]=new s(te,1,!1,j,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(j){var te=j.replace(F,fe);ne[te]=new s(te,1,!1,j,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(j){var te=j.replace(F,fe);ne[te]=new s(te,1,!1,j,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(j){ne[j]=new s(j,1,!1,j.toLowerCase(),null,!1,!1)}),ne.xlinkHref=new s("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(j){ne[j]=new s(j,1,!1,j.toLowerCase(),null,!0,!0)});var qe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ne=["Webkit","ms","Moz","O"];Object.keys(qe).forEach(function(j){Ne.forEach(function(te){te=te+j.charAt(0).toUpperCase()+j.substring(1),qe[te]=qe[j]})});var Ye=/["'&<>]/;function ze(j){if(typeof j=="boolean"||typeof j=="number")return""+j;j=""+j;var te=Ye.exec(j);if(te){var we="",Be,Ct=0;for(Be=te.index;Be<j.length;Be++){switch(j.charCodeAt(Be)){case 34:te="&quot;";break;case 38:te="&amp;";break;case 39:te="&#x27;";break;case 60:te="&lt;";break;case 62:te="&gt;";break;default:continue}Ct!==Be&&(we+=j.substring(Ct,Be)),Ct=Be+1,we+=te}j=Ct!==Be?we+j.substring(Ct,Be):we}return j}var Xe=/([A-Z])/g,We=/^ms-/,De=Array.isArray;function Ke(j,te){return{insertionMode:j,selectedValue:te}}function et(j,te,we){switch(te){case"select":return Ke(1,we.value!=null?we.value:we.defaultValue);case"svg":return Ke(2,null);case"math":return Ke(3,null);case"foreignObject":return Ke(1,null);case"table":return Ke(4,null);case"thead":case"tbody":case"tfoot":return Ke(5,null);case"colgroup":return Ke(7,null);case"tr":return Ke(6,null)}return 4<=j.insertionMode||j.insertionMode===0?Ke(1,null):j}var st=new Map;function $e(j,te,we){if(typeof we!="object")throw Error(Y(62));te=!0;for(var Be in we)if(Z.call(we,Be)){var Ct=we[Be];if(Ct!=null&&typeof Ct!="boolean"&&Ct!==""){if(Be.indexOf("--")===0){var wt=ze(Be);Ct=ze((""+Ct).trim())}else{wt=Be;var Yt=st.get(wt);Yt!==void 0||(Yt=ze(wt.replace(Xe,"-$1").toLowerCase().replace(We,"-ms-")),st.set(wt,Yt)),wt=Yt,Ct=typeof Ct=="number"?Ct===0||Z.call(qe,Be)?""+Ct:Ct+"px":ze((""+Ct).trim())}te?(te=!1,j.push(' style="',wt,":",Ct)):j.push(";",wt,":",Ct)}}te||j.push('"')}function bt(j,te,we,Be){switch(we){case"style":$e(j,te,Be);return;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<we.length)||we[0]!=="o"&&we[0]!=="O"||we[1]!=="n"&&we[1]!=="N"){if(te=ne.hasOwnProperty(we)?ne[we]:null,te!==null){switch(typeof Be){case"function":case"symbol":return;case"boolean":if(!te.acceptsBooleans)return}switch(we=te.attributeName,te.type){case 3:Be&&j.push(" ",we,'=""');break;case 4:Be===!0?j.push(" ",we,'=""'):Be!==!1&&j.push(" ",we,'="',ze(Be),'"');break;case 5:isNaN(Be)||j.push(" ",we,'="',ze(Be),'"');break;case 6:!isNaN(Be)&&1<=Be&&j.push(" ",we,'="',ze(Be),'"');break;default:te.sanitizeURL&&(Be=""+Be),j.push(" ",we,'="',ze(Be),'"')}}else if(be(we)){switch(typeof Be){case"function":case"symbol":return;case"boolean":if(te=we.toLowerCase().slice(0,5),te!=="data-"&&te!=="aria-")return}j.push(" ",we,'="',ze(Be),'"')}}}function St(j,te,we){if(te!=null){if(we!=null)throw Error(Y(60));if(typeof te!="object"||!("__html"in te))throw Error(Y(61));te=te.__html,te!=null&&j.push(""+te)}}function dr(j){var te="";return L.Children.forEach(j,function(we){we!=null&&(te+=we)}),te}function Fr(j,te,we,Be){j.push(Zt(we));var Ct=we=null,wt;for(wt in te)if(Z.call(te,wt)){var Yt=te[wt];if(Yt!=null)switch(wt){case"children":we=Yt;break;case"dangerouslySetInnerHTML":Ct=Yt;break;default:bt(j,Be,wt,Yt)}}return j.push(">"),St(j,Ct,we),typeof we=="string"?(j.push(ze(we)),null):we}var hi=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,ht=new Map;function Zt(j){var te=ht.get(j);if(te===void 0){if(!hi.test(j))throw Error(Y(65,j));te="<"+j,ht.set(j,te)}return te}function fr(j,te,we,Be,Ct){switch(te){case"select":j.push(Zt("select"));var wt=null,Yt=null;for(Vi in we)if(Z.call(we,Vi)){var Cr=we[Vi];if(Cr!=null)switch(Vi){case"children":wt=Cr;break;case"dangerouslySetInnerHTML":Yt=Cr;break;case"defaultValue":case"value":break;default:bt(j,Be,Vi,Cr)}}return j.push(">"),St(j,Yt,wt),wt;case"option":Yt=Ct.selectedValue,j.push(Zt("option"));var kr=Cr=null,mi=null,Vi=null;for(wt in we)if(Z.call(we,wt)){var jn=we[wt];if(jn!=null)switch(wt){case"children":Cr=jn;break;case"selected":mi=jn;break;case"dangerouslySetInnerHTML":Vi=jn;break;case"value":kr=jn;default:bt(j,Be,wt,jn)}}if(Yt!=null)if(we=kr!==null?""+kr:dr(Cr),De(Yt)){for(Be=0;Be<Yt.length;Be++)if(""+Yt[Be]===we){j.push(' selected=""');break}}else""+Yt===we&&j.push(' selected=""');else mi&&j.push(' selected=""');return j.push(">"),St(j,Vi,Cr),Cr;case"textarea":j.push(Zt("textarea")),Vi=Yt=wt=null;for(Cr in we)if(Z.call(we,Cr)&&(kr=we[Cr],kr!=null))switch(Cr){case"children":Vi=kr;break;case"value":wt=kr;break;case"defaultValue":Yt=kr;break;case"dangerouslySetInnerHTML":throw Error(Y(91));default:bt(j,Be,Cr,kr)}if(wt===null&&Yt!==null&&(wt=Yt),j.push(">"),Vi!=null){if(wt!=null)throw Error(Y(92));if(De(Vi)&&1<Vi.length)throw Error(Y(93));wt=""+Vi}return typeof wt=="string"&&wt[0]===`
`&&j.push(`
`),wt!==null&&j.push(ze(""+wt)),null;case"input":j.push(Zt("input")),kr=Vi=Cr=wt=null;for(Yt in we)if(Z.call(we,Yt)&&(mi=we[Yt],mi!=null))switch(Yt){case"children":case"dangerouslySetInnerHTML":throw Error(Y(399,"input"));case"defaultChecked":kr=mi;break;case"defaultValue":Cr=mi;break;case"checked":Vi=mi;break;case"value":wt=mi;break;default:bt(j,Be,Yt,mi)}return Vi!==null?bt(j,Be,"checked",Vi):kr!==null&&bt(j,Be,"checked",kr),wt!==null?bt(j,Be,"value",wt):Cr!==null&&bt(j,Be,"value",Cr),j.push("/>"),null;case"menuitem":j.push(Zt("menuitem"));for(var bo in we)if(Z.call(we,bo)&&(wt=we[bo],wt!=null))switch(bo){case"children":case"dangerouslySetInnerHTML":throw Error(Y(400));default:bt(j,Be,bo,wt)}return j.push(">"),null;case"title":j.push(Zt("title")),wt=null;for(jn in we)if(Z.call(we,jn)&&(Yt=we[jn],Yt!=null))switch(jn){case"children":wt=Yt;break;case"dangerouslySetInnerHTML":throw Error(Y(434));default:bt(j,Be,jn,Yt)}return j.push(">"),wt;case"listing":case"pre":j.push(Zt(te)),Yt=wt=null;for(kr in we)if(Z.call(we,kr)&&(Cr=we[kr],Cr!=null))switch(kr){case"children":wt=Cr;break;case"dangerouslySetInnerHTML":Yt=Cr;break;default:bt(j,Be,kr,Cr)}if(j.push(">"),Yt!=null){if(wt!=null)throw Error(Y(60));if(typeof Yt!="object"||!("__html"in Yt))throw Error(Y(61));we=Yt.__html,we!=null&&(typeof we=="string"&&0<we.length&&we[0]===`
`?j.push(`
`,we):j.push(""+we))}return typeof wt=="string"&&wt[0]===`
`&&j.push(`
`),wt;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":j.push(Zt(te));for(var ss in we)if(Z.call(we,ss)&&(wt=we[ss],wt!=null))switch(ss){case"children":case"dangerouslySetInnerHTML":throw Error(Y(399,te));default:bt(j,Be,ss,wt)}return j.push("/>"),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return Fr(j,we,te,Be);case"html":return Ct.insertionMode===0&&j.push("<!DOCTYPE html>"),Fr(j,we,te,Be);default:if(te.indexOf("-")===-1&&typeof we.is!="string")return Fr(j,we,te,Be);j.push(Zt(te)),Yt=wt=null;for(mi in we)if(Z.call(we,mi)&&(Cr=we[mi],Cr!=null))switch(mi){case"children":wt=Cr;break;case"dangerouslySetInnerHTML":Yt=Cr;break;case"style":$e(j,Be,Cr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:be(mi)&&typeof Cr!="function"&&typeof Cr!="symbol"&&j.push(" ",mi,'="',ze(Cr),'"')}return j.push(">"),St(j,Yt,wt),wt}}function Tr(j,te,we){if(j.push('<!--$?--><template id="'),we===null)throw Error(Y(395));return j.push(we),j.push('"></template>')}function Or(j,te,we,Be){switch(we.insertionMode){case 0:case 1:return j.push('<div hidden id="'),j.push(te.segmentPrefix),te=Be.toString(16),j.push(te),j.push('">');case 2:return j.push('<svg aria-hidden="true" style="display:none" id="'),j.push(te.segmentPrefix),te=Be.toString(16),j.push(te),j.push('">');case 3:return j.push('<math aria-hidden="true" style="display:none" id="'),j.push(te.segmentPrefix),te=Be.toString(16),j.push(te),j.push('">');case 4:return j.push('<table hidden id="'),j.push(te.segmentPrefix),te=Be.toString(16),j.push(te),j.push('">');case 5:return j.push('<table hidden><tbody id="'),j.push(te.segmentPrefix),te=Be.toString(16),j.push(te),j.push('">');case 6:return j.push('<table hidden><tr id="'),j.push(te.segmentPrefix),te=Be.toString(16),j.push(te),j.push('">');case 7:return j.push('<table hidden><colgroup id="'),j.push(te.segmentPrefix),te=Be.toString(16),j.push(te),j.push('">');default:throw Error(Y(397))}}function ri(j,te){switch(te.insertionMode){case 0:case 1:return j.push("</div>");case 2:return j.push("</svg>");case 3:return j.push("</math>");case 4:return j.push("</table>");case 5:return j.push("</tbody></table>");case 6:return j.push("</tr></table>");case 7:return j.push("</colgroup></table>");default:throw Error(Y(397))}}var fi=/[<\u2028\u2029]/g;function mr(j){return JSON.stringify(j).replace(fi,function(te){switch(te){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}function Lr(j,te){return te=te===void 0?"":te,{bootstrapChunks:[],startInlineScript:"<script>",placeholderPrefix:te+"P:",segmentPrefix:te+"S:",boundaryPrefix:te+"B:",idPrefix:te,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1,generateStaticMarkup:j}}function or(j,te,we,Be){return we.generateStaticMarkup?(j.push(ze(te)),!1):(te===""?j=Be:(Be&&j.push("<!-- -->"),j.push(ze(te)),j=!0),j)}var dt=Object.assign,sr=Symbol.for("react.element"),bi=Symbol.for("react.portal"),Ai=Symbol.for("react.fragment"),qr=Symbol.for("react.strict_mode"),Gr=Symbol.for("react.profiler"),pi=Symbol.for("react.provider"),ji=Symbol.for("react.context"),jr=Symbol.for("react.forward_ref"),Dn=Symbol.for("react.suspense"),Xn=Symbol.for("react.suspense_list"),xo=Symbol.for("react.memo"),zi=Symbol.for("react.lazy"),ts=Symbol.for("react.scope"),zs=Symbol.for("react.debug_trace_mode"),no=Symbol.for("react.legacy_hidden"),fs=Symbol.for("react.default_value"),rs=Symbol.iterator;function eo(j){if(j==null)return null;if(typeof j=="function")return j.displayName||j.name||null;if(typeof j=="string")return j;switch(j){case Ai:return"Fragment";case bi:return"Portal";case Gr:return"Profiler";case qr:return"StrictMode";case Dn:return"Suspense";case Xn:return"SuspenseList"}if(typeof j=="object")switch(j.$$typeof){case ji:return(j.displayName||"Context")+".Consumer";case pi:return(j._context.displayName||"Context")+".Provider";case jr:var te=j.render;return j=j.displayName,j||(j=te.displayName||te.name||"",j=j!==""?"ForwardRef("+j+")":"ForwardRef"),j;case xo:return te=j.displayName||null,te!==null?te:eo(j.type)||"Memo";case zi:te=j._payload,j=j._init;try{return eo(j(te))}catch{}}return null}var po={};function ko(j,te){if(j=j.contextTypes,!j)return po;var we={},Be;for(Be in j)we[Be]=te[Be];return we}var mo=null;function oo(j,te){if(j!==te){j.context._currentValue2=j.parentValue,j=j.parent;var we=te.parent;if(j===null){if(we!==null)throw Error(Y(401))}else{if(we===null)throw Error(Y(401));oo(j,we)}te.context._currentValue2=te.value}}function yo(j){j.context._currentValue2=j.parentValue,j=j.parent,j!==null&&yo(j)}function Ao(j){var te=j.parent;te!==null&&Ao(te),j.context._currentValue2=j.value}function Ws(j,te){if(j.context._currentValue2=j.parentValue,j=j.parent,j===null)throw Error(Y(402));j.depth===te.depth?oo(j,te):Ws(j,te)}function ps(j,te){var we=te.parent;if(we===null)throw Error(Y(402));j.depth===we.depth?oo(j,we):ps(j,we),te.context._currentValue2=te.value}function Ho(j){var te=mo;te!==j&&(te===null?Ao(j):j===null?yo(te):te.depth===j.depth?oo(te,j):te.depth>j.depth?Ws(te,j):ps(te,j),mo=j)}var is={isMounted:function(){return!1},enqueueSetState:function(j,te){j=j._reactInternals,j.queue!==null&&j.queue.push(te)},enqueueReplaceState:function(j,te){j=j._reactInternals,j.replace=!0,j.queue=[te]},enqueueForceUpdate:function(){}};function Lo(j,te,we,Be){var Ct=j.state!==void 0?j.state:null;j.updater=is,j.props=we,j.state=Ct;var wt={queue:[],replace:!1};j._reactInternals=wt;var Yt=te.contextType;if(j.context=typeof Yt=="object"&&Yt!==null?Yt._currentValue2:Be,Yt=te.getDerivedStateFromProps,typeof Yt=="function"&&(Yt=Yt(we,Ct),Ct=Yt==null?Ct:dt({},Ct,Yt),j.state=Ct),typeof te.getDerivedStateFromProps!="function"&&typeof j.getSnapshotBeforeUpdate!="function"&&(typeof j.UNSAFE_componentWillMount=="function"||typeof j.componentWillMount=="function"))if(te=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),te!==j.state&&is.enqueueReplaceState(j,j.state,null),wt.queue!==null&&0<wt.queue.length)if(te=wt.queue,Yt=wt.replace,wt.queue=null,wt.replace=!1,Yt&&te.length===1)j.state=te[0];else{for(wt=Yt?te[0]:j.state,Ct=!0,Yt=Yt?1:0;Yt<te.length;Yt++){var Cr=te[Yt];Cr=typeof Cr=="function"?Cr.call(j,wt,we,Be):Cr,Cr!=null&&(Ct?(Ct=!1,wt=dt({},wt,Cr)):dt(wt,Cr))}j.state=wt}else wt.queue=null}var co={id:1,overflow:""};function Os(j,te,we){var Be=j.id;j=j.overflow;var Ct=32-ns(Be)-1;Be&=~(1<<Ct),we+=1;var wt=32-ns(te)+Ct;if(30<wt){var Yt=Ct-Ct%5;return wt=(Be&(1<<Yt)-1).toString(32),Be>>=Yt,Ct-=Yt,{id:1<<32-ns(te)+Ct|we<<Ct|Be,overflow:wt+j}}return{id:1<<wt|we<<Ct|Be,overflow:j}}var ns=Math.clz32?Math.clz32:os,ms=Math.log,ra=Math.LN2;function os(j){return j>>>=0,j===0?32:31-(ms(j)/ra|0)|0}function ia(j,te){return j===te&&(j!==0||1/j===1/te)||j!==j&&te!==te}var Qi=typeof Object.is=="function"?Object.is:ia,to=null,Es=null,so=null,xr=null,Oi=!1,un=!1,Ot=0,pn=null,gs=0;function ot(){if(to===null)throw Error(Y(321));return to}function G(){if(0<gs)throw Error(Y(312));return{memoizedState:null,queue:null,next:null}}function K(){return xr===null?so===null?(Oi=!1,so=xr=G()):(Oi=!0,xr=so):xr.next===null?(Oi=!1,xr=xr.next=G()):(Oi=!0,xr=xr.next),xr}function ge(){Es=to=null,un=!1,so=null,gs=0,xr=pn=null}function Ce(j,te){return typeof te=="function"?te(j):te}function Me(j,te,we){if(to=ot(),xr=K(),Oi){var Be=xr.queue;if(te=Be.dispatch,pn!==null&&(we=pn.get(Be),we!==void 0)){pn.delete(Be),Be=xr.memoizedState;do Be=j(Be,we.action),we=we.next;while(we!==null);return xr.memoizedState=Be,[Be,te]}return[xr.memoizedState,te]}return j=j===Ce?typeof te=="function"?te():te:we!==void 0?we(te):te,xr.memoizedState=j,j=xr.queue={last:null,dispatch:null},j=j.dispatch=ke.bind(null,to,j),[xr.memoizedState,j]}function Re(j,te){if(to=ot(),xr=K(),te=te===void 0?null:te,xr!==null){var we=xr.memoizedState;if(we!==null&&te!==null){var Be=we[1];e:if(Be===null)Be=!1;else{for(var Ct=0;Ct<Be.length&&Ct<te.length;Ct++)if(!Qi(te[Ct],Be[Ct])){Be=!1;break e}Be=!0}if(Be)return we[0]}}return j=j(),xr.memoizedState=[j,te],j}function ke(j,te,we){if(25<=gs)throw Error(Y(301));if(j===to)if(un=!0,j={action:we,next:null},pn===null&&(pn=new Map),we=pn.get(te),we===void 0)pn.set(te,j);else{for(te=we;te.next!==null;)te=te.next;te.next=j}}function Fe(){throw Error(Y(394))}function Qe(){}var _t={readContext:function(j){return j._currentValue2},useContext:function(j){return ot(),j._currentValue2},useMemo:Re,useReducer:Me,useRef:function(j){to=ot(),xr=K();var te=xr.memoizedState;return te===null?(j={current:j},xr.memoizedState=j):te},useState:function(j){return Me(Ce,j)},useInsertionEffect:Qe,useLayoutEffect:function(){},useCallback:function(j,te){return Re(function(){return j},te)},useImperativeHandle:Qe,useEffect:Qe,useDebugValue:Qe,useDeferredValue:function(j){return ot(),j},useTransition:function(){return ot(),[!1,Fe]},useId:function(){var j=Es.treeContext,te=j.overflow;j=j.id,j=(j&~(1<<32-ns(j)-1)).toString(32)+te;var we=Je;if(we===null)throw Error(Y(404));return te=Ot++,j=":"+we.idPrefix+"R"+j,0<te&&(j+="H"+te.toString(32)),j+":"},useMutableSource:function(j,te){return ot(),te(j._source)},useSyncExternalStore:function(j,te,we){if(we===void 0)throw Error(Y(407));return we()}},Je=null,Ht=L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function Qt(j){return console.error(j),null}function lr(){}function Nr(j,te,we,Be,Ct,wt,Yt,Cr,kr){var mi=[],Vi=new Set;return te={destination:null,responseState:te,progressiveChunkSize:Be===void 0?12800:Be,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:Vi,pingedTasks:mi,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:Ct===void 0?Qt:Ct,onAllReady:lr,onShellReady:Yt===void 0?lr:Yt,onShellError:lr,onFatalError:lr},we=Zr(te,0,null,we,!1,!1),we.parentFlushed=!0,j=Wr(te,j,null,we,Vi,po,null,co),mi.push(j),te}function Wr(j,te,we,Be,Ct,wt,Yt,Cr){j.allPendingTasks++,we===null?j.pendingRootTasks++:we.pendingTasks++;var kr={node:te,ping:function(){var mi=j.pingedTasks;mi.push(kr),mi.length===1&&Fn(j)},blockedBoundary:we,blockedSegment:Be,abortSet:Ct,legacyContext:wt,context:Yt,treeContext:Cr};return Ct.add(kr),kr}function Zr(j,te,we,Be,Ct,wt){return{status:0,id:-1,index:te,parentFlushed:!1,chunks:[],children:[],formatContext:Be,boundary:we,lastPushedText:Ct,textEmbedded:wt}}function Xr(j,te){if(j=j.onError(te),j!=null&&typeof j!="string")throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof j+'" instead');return j}function nn(j,te){var we=j.onShellError;we(te),we=j.onFatalError,we(te),j.destination!==null?(j.status=2,j.destination.destroy(te)):(j.status=1,j.fatalError=te)}function Jr(j,te,we,Be,Ct){for(to={},Es=te,Ot=0,j=we(Be,Ct);un;)un=!1,Ot=0,gs+=1,xr=null,j=we(Be,Ct);return ge(),j}function Wi(j,te,we,Be){var Ct=we.render(),wt=Be.childContextTypes;if(wt!=null){var Yt=te.legacyContext;if(typeof we.getChildContext!="function")Be=Yt;else{we=we.getChildContext();for(var Cr in we)if(!(Cr in wt))throw Error(Y(108,eo(Be)||"Unknown",Cr));Be=dt({},Yt,we)}te.legacyContext=Be,Pi(j,te,Ct),te.legacyContext=Yt}else Pi(j,te,Ct)}function Mi(j,te){if(j&&j.defaultProps){te=dt({},te),j=j.defaultProps;for(var we in j)te[we]===void 0&&(te[we]=j[we]);return te}return te}function ii(j,te,we,Be,Ct){if(typeof we=="function")if(we.prototype&&we.prototype.isReactComponent){Ct=ko(we,te.legacyContext);var wt=we.contextType;wt=new we(Be,typeof wt=="object"&&wt!==null?wt._currentValue2:Ct),Lo(wt,we,Be,Ct),Wi(j,te,wt,we)}else{wt=ko(we,te.legacyContext),Ct=Jr(j,te,we,Be,wt);var Yt=Ot!==0;if(typeof Ct=="object"&&Ct!==null&&typeof Ct.render=="function"&&Ct.$$typeof===void 0)Lo(Ct,we,Be,wt),Wi(j,te,Ct,we);else if(Yt){Be=te.treeContext,te.treeContext=Os(Be,1,0);try{Pi(j,te,Ct)}finally{te.treeContext=Be}}else Pi(j,te,Ct)}else if(typeof we=="string"){switch(Ct=te.blockedSegment,wt=fr(Ct.chunks,we,Be,j.responseState,Ct.formatContext),Ct.lastPushedText=!1,Yt=Ct.formatContext,Ct.formatContext=et(Yt,we,Be),On(j,te,wt),Ct.formatContext=Yt,we){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:Ct.chunks.push("</",we,">")}Ct.lastPushedText=!1}else{switch(we){case no:case zs:case qr:case Gr:case Ai:Pi(j,te,Be.children);return;case Xn:Pi(j,te,Be.children);return;case ts:throw Error(Y(343));case Dn:e:{we=te.blockedBoundary,Ct=te.blockedSegment,wt=Be.fallback,Be=Be.children,Yt=new Set;var Cr={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:Yt,errorDigest:null},kr=Zr(j,Ct.chunks.length,Cr,Ct.formatContext,!1,!1);Ct.children.push(kr),Ct.lastPushedText=!1;var mi=Zr(j,0,null,Ct.formatContext,!1,!1);mi.parentFlushed=!0,te.blockedBoundary=Cr,te.blockedSegment=mi;try{if(On(j,te,Be),j.responseState.generateStaticMarkup||mi.lastPushedText&&mi.textEmbedded&&mi.chunks.push("<!-- -->"),mi.status=1,$o(Cr,mi),Cr.pendingTasks===0)break e}catch(Vi){mi.status=4,Cr.forceClientRender=!0,Cr.errorDigest=Xr(j,Vi)}finally{te.blockedBoundary=we,te.blockedSegment=Ct}te=Wr(j,wt,we,kr,Yt,te.legacyContext,te.context,te.treeContext),j.pingedTasks.push(te)}return}if(typeof we=="object"&&we!==null)switch(we.$$typeof){case jr:if(Be=Jr(j,te,we.render,Be,Ct),Ot!==0){we=te.treeContext,te.treeContext=Os(we,1,0);try{Pi(j,te,Be)}finally{te.treeContext=we}}else Pi(j,te,Be);return;case xo:we=we.type,Be=Mi(we,Be),ii(j,te,we,Be,Ct);return;case pi:if(Ct=Be.children,we=we._context,Be=Be.value,wt=we._currentValue2,we._currentValue2=Be,Yt=mo,mo=Be={parent:Yt,depth:Yt===null?0:Yt.depth+1,context:we,parentValue:wt,value:Be},te.context=Be,Pi(j,te,Ct),j=mo,j===null)throw Error(Y(403));Be=j.parentValue,j.context._currentValue2=Be===fs?j.context._defaultValue:Be,j=mo=j.parent,te.context=j;return;case ji:Be=Be.children,Be=Be(we._currentValue2),Pi(j,te,Be);return;case zi:Ct=we._init,we=Ct(we._payload),Be=Mi(we,Be),ii(j,te,we,Be,void 0);return}throw Error(Y(130,we==null?we:typeof we,""))}}function Pi(j,te,we){if(te.node=we,typeof we=="object"&&we!==null){switch(we.$$typeof){case sr:ii(j,te,we.type,we.props,we.ref);return;case bi:throw Error(Y(257));case zi:var Be=we._init;we=Be(we._payload),Pi(j,te,we);return}if(De(we)){wn(j,te,we);return}if(we===null||typeof we!="object"?Be=null:(Be=rs&&we[rs]||we["@@iterator"],Be=typeof Be=="function"?Be:null),Be&&(Be=Be.call(we))){if(we=Be.next(),!we.done){var Ct=[];do Ct.push(we.value),we=Be.next();while(!we.done);wn(j,te,Ct)}return}throw j=Object.prototype.toString.call(we),Error(Y(31,j==="[object Object]"?"object with keys {"+Object.keys(we).join(", ")+"}":j))}typeof we=="string"?(Be=te.blockedSegment,Be.lastPushedText=or(te.blockedSegment.chunks,we,j.responseState,Be.lastPushedText)):typeof we=="number"&&(Be=te.blockedSegment,Be.lastPushedText=or(te.blockedSegment.chunks,""+we,j.responseState,Be.lastPushedText))}function wn(j,te,we){for(var Be=we.length,Ct=0;Ct<Be;Ct++){var wt=te.treeContext;te.treeContext=Os(wt,Be,Ct);try{On(j,te,we[Ct])}finally{te.treeContext=wt}}}function On(j,te,we){var Be=te.blockedSegment.formatContext,Ct=te.legacyContext,wt=te.context;try{return Pi(j,te,we)}catch(kr){if(ge(),typeof kr=="object"&&kr!==null&&typeof kr.then=="function"){we=kr;var Yt=te.blockedSegment,Cr=Zr(j,Yt.chunks.length,null,Yt.formatContext,Yt.lastPushedText,!0);Yt.children.push(Cr),Yt.lastPushedText=!1,j=Wr(j,te.node,te.blockedBoundary,Cr,te.abortSet,te.legacyContext,te.context,te.treeContext).ping,we.then(j,j),te.blockedSegment.formatContext=Be,te.legacyContext=Ct,te.context=wt,Ho(wt)}else throw te.blockedSegment.formatContext=Be,te.legacyContext=Ct,te.context=wt,Ho(wt),kr}}function Vn(j){var te=j.blockedBoundary;j=j.blockedSegment,j.status=3,Gn(this,te,j)}function go(j,te,we){var Be=j.blockedBoundary;j.blockedSegment.status=3,Be===null?(te.allPendingTasks--,te.status!==2&&(te.status=2,te.destination!==null&&te.destination.push(null))):(Be.pendingTasks--,Be.forceClientRender||(Be.forceClientRender=!0,j=we===void 0?Error(Y(432)):we,Be.errorDigest=te.onError(j),Be.parentFlushed&&te.clientRenderedBoundaries.push(Be)),Be.fallbackAbortableTasks.forEach(function(Ct){return go(Ct,te,we)}),Be.fallbackAbortableTasks.clear(),te.allPendingTasks--,te.allPendingTasks===0&&(Be=te.onAllReady,Be()))}function $o(j,te){if(te.chunks.length===0&&te.children.length===1&&te.children[0].boundary===null){var we=te.children[0];we.id=te.id,we.parentFlushed=!0,we.status===1&&$o(j,we)}else j.completedSegments.push(te)}function Gn(j,te,we){if(te===null){if(we.parentFlushed){if(j.completedRootSegment!==null)throw Error(Y(389));j.completedRootSegment=we}j.pendingRootTasks--,j.pendingRootTasks===0&&(j.onShellError=lr,te=j.onShellReady,te())}else te.pendingTasks--,te.forceClientRender||(te.pendingTasks===0?(we.parentFlushed&&we.status===1&&$o(te,we),te.parentFlushed&&j.completedBoundaries.push(te),te.fallbackAbortableTasks.forEach(Vn,j),te.fallbackAbortableTasks.clear()):we.parentFlushed&&we.status===1&&($o(te,we),te.completedSegments.length===1&&te.parentFlushed&&j.partialBoundaries.push(te)));j.allPendingTasks--,j.allPendingTasks===0&&(j=j.onAllReady,j())}function Fn(j){if(j.status!==2){var te=mo,we=Ht.current;Ht.current=_t;var Be=Je;Je=j.responseState;try{var Ct=j.pingedTasks,wt;for(wt=0;wt<Ct.length;wt++){var Yt=Ct[wt],Cr=j,kr=Yt.blockedSegment;if(kr.status===0){Ho(Yt.context);try{Pi(Cr,Yt,Yt.node),Cr.responseState.generateStaticMarkup||kr.lastPushedText&&kr.textEmbedded&&kr.chunks.push("<!-- -->"),Yt.abortSet.delete(Yt),kr.status=1,Gn(Cr,Yt.blockedBoundary,kr)}catch(as){if(ge(),typeof as=="object"&&as!==null&&typeof as.then=="function"){var mi=Yt.ping;as.then(mi,mi)}else{Yt.abortSet.delete(Yt),kr.status=4;var Vi=Yt.blockedBoundary,jn=as,bo=Xr(Cr,jn);if(Vi===null?nn(Cr,jn):(Vi.pendingTasks--,Vi.forceClientRender||(Vi.forceClientRender=!0,Vi.errorDigest=bo,Vi.parentFlushed&&Cr.clientRenderedBoundaries.push(Vi))),Cr.allPendingTasks--,Cr.allPendingTasks===0){var ss=Cr.onAllReady;ss()}}}finally{}}}Ct.splice(0,wt),j.destination!==null&&As(j,j.destination)}catch(as){Xr(j,as),nn(j,as)}finally{Je=Be,Ht.current=we,we===_t&&Ho(te)}}}function Yn(j,te,we){switch(we.parentFlushed=!0,we.status){case 0:var Be=we.id=j.nextSegmentId++;return we.lastPushedText=!1,we.textEmbedded=!1,j=j.responseState,te.push('<template id="'),te.push(j.placeholderPrefix),j=Be.toString(16),te.push(j),te.push('"></template>');case 1:we.status=2;var Ct=!0;Be=we.chunks;var wt=0;we=we.children;for(var Yt=0;Yt<we.length;Yt++){for(Ct=we[Yt];wt<Ct.index;wt++)te.push(Be[wt]);Ct=mn(j,te,Ct)}for(;wt<Be.length-1;wt++)te.push(Be[wt]);return wt<Be.length&&(Ct=te.push(Be[wt])),Ct;default:throw Error(Y(390))}}function mn(j,te,we){var Be=we.boundary;if(Be===null)return Yn(j,te,we);if(Be.parentFlushed=!0,Be.forceClientRender)return j.responseState.generateStaticMarkup||(Be=Be.errorDigest,te.push("<!--$!-->"),te.push("<template"),Be&&(te.push(' data-dgst="'),Be=ze(Be),te.push(Be),te.push('"')),te.push("></template>")),Yn(j,te,we),j=j.responseState.generateStaticMarkup?!0:te.push("<!--/$-->"),j;if(0<Be.pendingTasks){Be.rootSegmentID=j.nextSegmentId++,0<Be.completedSegments.length&&j.partialBoundaries.push(Be);var Ct=j.responseState,wt=Ct.nextSuspenseID++;return Ct=Ct.boundaryPrefix+wt.toString(16),Be=Be.id=Ct,Tr(te,j.responseState,Be),Yn(j,te,we),te.push("<!--/$-->")}if(Be.byteSize>j.progressiveChunkSize)return Be.rootSegmentID=j.nextSegmentId++,j.completedBoundaries.push(Be),Tr(te,j.responseState,Be.id),Yn(j,te,we),te.push("<!--/$-->");if(j.responseState.generateStaticMarkup||te.push("<!--$-->"),we=Be.completedSegments,we.length!==1)throw Error(Y(391));return mn(j,te,we[0]),j=j.responseState.generateStaticMarkup?!0:te.push("<!--/$-->"),j}function Is(j,te,we){return Or(te,j.responseState,we.formatContext,we.id),mn(j,te,we),ri(te,we.formatContext)}function na(j,te,we){for(var Be=we.completedSegments,Ct=0;Ct<Be.length;Ct++)$a(j,te,we,Be[Ct]);if(Be.length=0,j=j.responseState,Be=we.id,we=we.rootSegmentID,te.push(j.startInlineScript),j.sentCompleteBoundaryFunction?te.push('$RC("'):(j.sentCompleteBoundaryFunction=!0,te.push('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("')),Be===null)throw Error(Y(395));return we=we.toString(16),te.push(Be),te.push('","'),te.push(j.segmentPrefix),te.push(we),te.push('")<\/script>')}function $a(j,te,we,Be){if(Be.status===2)return!0;var Ct=Be.id;if(Ct===-1){if((Be.id=we.rootSegmentID)===-1)throw Error(Y(392));return Is(j,te,Be)}return Is(j,te,Be),j=j.responseState,te.push(j.startInlineScript),j.sentCompleteSegmentFunction?te.push('$RS("'):(j.sentCompleteSegmentFunction=!0,te.push('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("')),te.push(j.segmentPrefix),Ct=Ct.toString(16),te.push(Ct),te.push('","'),te.push(j.placeholderPrefix),te.push(Ct),te.push('")<\/script>')}function As(j,te){try{var we=j.completedRootSegment;if(we!==null&&j.pendingRootTasks===0){mn(j,te,we),j.completedRootSegment=null;var Be=j.responseState.bootstrapChunks;for(we=0;we<Be.length-1;we++)te.push(Be[we]);we<Be.length&&te.push(Be[we])}var Ct=j.clientRenderedBoundaries,wt;for(wt=0;wt<Ct.length;wt++){var Yt=Ct[wt];Be=te;var Cr=j.responseState,kr=Yt.id,mi=Yt.errorDigest,Vi=Yt.errorMessage,jn=Yt.errorComponentStack;if(Be.push(Cr.startInlineScript),Cr.sentClientRenderFunction?Be.push('$RX("'):(Cr.sentClientRenderFunction=!0,Be.push('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("')),kr===null)throw Error(Y(395));if(Be.push(kr),Be.push('"'),mi||Vi||jn){Be.push(",");var bo=mr(mi||"");Be.push(bo)}if(Vi||jn){Be.push(",");var ss=mr(Vi||"");Be.push(ss)}if(jn){Be.push(",");var as=mr(jn);Be.push(as)}if(!Be.push(")<\/script>")){j.destination=null,wt++,Ct.splice(0,wt);return}}Ct.splice(0,wt);var Fs=j.completedBoundaries;for(wt=0;wt<Fs.length;wt++)if(!na(j,te,Fs[wt])){j.destination=null,wt++,Fs.splice(0,wt);return}Fs.splice(0,wt);var Hn=j.partialBoundaries;for(wt=0;wt<Hn.length;wt++){var _s=Hn[wt];e:{Ct=j,Yt=te;var Wo=_s.completedSegments;for(Cr=0;Cr<Wo.length;Cr++)if(!$a(Ct,Yt,_s,Wo[Cr])){Cr++,Wo.splice(0,Cr);var ls=!1;break e}Wo.splice(0,Cr),ls=!0}if(!ls){j.destination=null,wt++,Hn.splice(0,wt);return}}Hn.splice(0,wt);var Bs=j.completedBoundaries;for(wt=0;wt<Bs.length;wt++)if(!na(j,te,Bs[wt])){j.destination=null,wt++,Bs.splice(0,wt);return}Bs.splice(0,wt)}finally{j.allPendingTasks===0&&j.pingedTasks.length===0&&j.clientRenderedBoundaries.length===0&&j.completedBoundaries.length===0&&te.push(null)}}function Sa(j,te){try{var we=j.abortableTasks;we.forEach(function(Be){return go(Be,j,te)}),we.clear(),j.destination!==null&&As(j,j.destination)}catch(Be){Xr(j,Be),nn(j,Be)}}function Zs(){}function Cs(j,te,we,Be){var Ct=!1,wt=null,Yt="",Cr={push:function(mi){return mi!==null&&(Yt+=mi),!0},destroy:function(mi){Ct=!0,wt=mi}},kr=!1;if(j=Nr(j,Lr(we,te?te.identifierPrefix:void 0),{insertionMode:1,selectedValue:null},1/0,Zs,void 0,function(){kr=!0}),Fn(j),Sa(j,Be),j.status===1)j.status=2,Cr.destroy(j.fatalError);else if(j.status!==2&&j.destination===null){j.destination=Cr;try{As(j,Cr)}catch(mi){Xr(j,mi),nn(j,mi)}}if(Ct)throw wt;if(!kr)throw Error(Y(426));return Yt}return Df.renderToNodeStream=function(){throw Error(Y(207))},Df.renderToStaticMarkup=function(j,te){return Cs(j,te,!0,'The server used "renderToStaticMarkup" which does not support Suspense. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},Df.renderToStaticNodeStream=function(){throw Error(Y(208))},Df.renderToString=function(j,te){return Cs(j,te,!1,'The server used "renderToString" which does not support Suspense. If you intended for this Suspense boundary to render the fallback content on the server consider throwing an Error somewhere within the Suspense boundary. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},Df.version="18.3.1",Df}var gg={};/**
 * @license React
 * react-dom-server.browser.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W1;function zE(){if(W1)return gg;W1=1;var L=cp();function Y(N){for(var Q="https://reactjs.org/docs/error-decoder.html?invariant="+N,ve=1;ve<arguments.length;ve++)Q+="&args[]="+encodeURIComponent(arguments[ve]);return"Minified React error #"+N+"; visit "+Q+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Z=null,Ee=0;function ue(N,Q){if(Q.length!==0)if(512<Q.length)0<Ee&&(N.enqueue(new Uint8Array(Z.buffer,0,Ee)),Z=new Uint8Array(512),Ee=0),N.enqueue(Q);else{var ve=Z.length-Ee;ve<Q.length&&(ve===0?N.enqueue(Z):(Z.set(Q.subarray(0,ve),Ee),N.enqueue(Z),Q=Q.subarray(ve)),Z=new Uint8Array(512),Ee=0),Z.set(Q,Ee),Ee+=Q.length}}function _e(N,Q){return ue(N,Q),!0}function be(N){Z&&0<Ee&&(N.enqueue(new Uint8Array(Z.buffer,0,Ee)),Z=null,Ee=0)}var s=new TextEncoder;function ne(N){return s.encode(N)}function F(N){return s.encode(N)}function fe(N,Q){typeof N.error=="function"?N.error(Q):N.close()}var qe=Object.prototype.hasOwnProperty,Ne=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ye={},ze={};function Xe(N){return qe.call(ze,N)?!0:qe.call(Ye,N)?!1:Ne.test(N)?ze[N]=!0:(Ye[N]=!0,!1)}function We(N,Q,ve,Oe,zt,xt,Xt){this.acceptsBooleans=Q===2||Q===3||Q===4,this.attributeName=Oe,this.attributeNamespace=zt,this.mustUseProperty=ve,this.propertyName=N,this.type=Q,this.sanitizeURL=xt,this.removeEmptyString=Xt}var De={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(N){De[N]=new We(N,0,!1,N,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(N){var Q=N[0];De[Q]=new We(Q,1,!1,N[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(N){De[N]=new We(N,2,!1,N.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(N){De[N]=new We(N,2,!1,N,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(N){De[N]=new We(N,3,!1,N.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(N){De[N]=new We(N,3,!0,N,null,!1,!1)}),["capture","download"].forEach(function(N){De[N]=new We(N,4,!1,N,null,!1,!1)}),["cols","rows","size","span"].forEach(function(N){De[N]=new We(N,6,!1,N,null,!1,!1)}),["rowSpan","start"].forEach(function(N){De[N]=new We(N,5,!1,N.toLowerCase(),null,!1,!1)});var Ke=/[\-:]([a-z])/g;function et(N){return N[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(N){var Q=N.replace(Ke,et);De[Q]=new We(Q,1,!1,N,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(N){var Q=N.replace(Ke,et);De[Q]=new We(Q,1,!1,N,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(N){var Q=N.replace(Ke,et);De[Q]=new We(Q,1,!1,N,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(N){De[N]=new We(N,1,!1,N.toLowerCase(),null,!1,!1)}),De.xlinkHref=new We("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(N){De[N]=new We(N,1,!1,N.toLowerCase(),null,!0,!0)});var st={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$e=["Webkit","ms","Moz","O"];Object.keys(st).forEach(function(N){$e.forEach(function(Q){Q=Q+N.charAt(0).toUpperCase()+N.substring(1),st[Q]=st[N]})});var bt=/["'&<>]/;function St(N){if(typeof N=="boolean"||typeof N=="number")return""+N;N=""+N;var Q=bt.exec(N);if(Q){var ve="",Oe,zt=0;for(Oe=Q.index;Oe<N.length;Oe++){switch(N.charCodeAt(Oe)){case 34:Q="&quot;";break;case 38:Q="&amp;";break;case 39:Q="&#x27;";break;case 60:Q="&lt;";break;case 62:Q="&gt;";break;default:continue}zt!==Oe&&(ve+=N.substring(zt,Oe)),zt=Oe+1,ve+=Q}N=zt!==Oe?ve+N.substring(zt,Oe):ve}return N}var dr=/([A-Z])/g,Fr=/^ms-/,hi=Array.isArray,ht=F("<script>"),Zt=F("<\/script>"),fr=F('<script src="'),Tr=F('<script type="module" src="'),Or=F('" async=""><\/script>'),ri=/(<\/|<)(s)(cript)/gi;function fi(N,Q,ve,Oe){return""+Q+(ve==="s"?"\\u0073":"\\u0053")+Oe}function mr(N,Q,ve,Oe,zt){N=N===void 0?"":N,Q=Q===void 0?ht:F('<script nonce="'+St(Q)+'">');var xt=[];if(ve!==void 0&&xt.push(Q,ne((""+ve).replace(ri,fi)),Zt),Oe!==void 0)for(ve=0;ve<Oe.length;ve++)xt.push(fr,ne(St(Oe[ve])),Or);if(zt!==void 0)for(Oe=0;Oe<zt.length;Oe++)xt.push(Tr,ne(St(zt[Oe])),Or);return{bootstrapChunks:xt,startInlineScript:Q,placeholderPrefix:F(N+"P:"),segmentPrefix:F(N+"S:"),boundaryPrefix:N+"B:",idPrefix:N,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1}}function Lr(N,Q){return{insertionMode:N,selectedValue:Q}}function or(N){return Lr(N==="http://www.w3.org/2000/svg"?2:N==="http://www.w3.org/1998/Math/MathML"?3:0,null)}function dt(N,Q,ve){switch(Q){case"select":return Lr(1,ve.value!=null?ve.value:ve.defaultValue);case"svg":return Lr(2,null);case"math":return Lr(3,null);case"foreignObject":return Lr(1,null);case"table":return Lr(4,null);case"thead":case"tbody":case"tfoot":return Lr(5,null);case"colgroup":return Lr(7,null);case"tr":return Lr(6,null)}return 4<=N.insertionMode||N.insertionMode===0?Lr(1,null):N}var sr=F("<!-- -->");function bi(N,Q,ve,Oe){return Q===""?Oe:(Oe&&N.push(sr),N.push(ne(St(Q))),!0)}var Ai=new Map,qr=F(' style="'),Gr=F(":"),pi=F(";");function ji(N,Q,ve){if(typeof ve!="object")throw Error(Y(62));Q=!0;for(var Oe in ve)if(qe.call(ve,Oe)){var zt=ve[Oe];if(zt!=null&&typeof zt!="boolean"&&zt!==""){if(Oe.indexOf("--")===0){var xt=ne(St(Oe));zt=ne(St((""+zt).trim()))}else{xt=Oe;var Xt=Ai.get(xt);Xt!==void 0||(Xt=F(St(xt.replace(dr,"-$1").toLowerCase().replace(Fr,"-ms-"))),Ai.set(xt,Xt)),xt=Xt,zt=typeof zt=="number"?zt===0||qe.call(st,Oe)?ne(""+zt):ne(zt+"px"):ne(St((""+zt).trim()))}Q?(Q=!1,N.push(qr,xt,Gr,zt)):N.push(pi,xt,Gr,zt)}}Q||N.push(Xn)}var jr=F(" "),Dn=F('="'),Xn=F('"'),xo=F('=""');function zi(N,Q,ve,Oe){switch(ve){case"style":ji(N,Q,Oe);return;case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<ve.length)||ve[0]!=="o"&&ve[0]!=="O"||ve[1]!=="n"&&ve[1]!=="N"){if(Q=De.hasOwnProperty(ve)?De[ve]:null,Q!==null){switch(typeof Oe){case"function":case"symbol":return;case"boolean":if(!Q.acceptsBooleans)return}switch(ve=ne(Q.attributeName),Q.type){case 3:Oe&&N.push(jr,ve,xo);break;case 4:Oe===!0?N.push(jr,ve,xo):Oe!==!1&&N.push(jr,ve,Dn,ne(St(Oe)),Xn);break;case 5:isNaN(Oe)||N.push(jr,ve,Dn,ne(St(Oe)),Xn);break;case 6:!isNaN(Oe)&&1<=Oe&&N.push(jr,ve,Dn,ne(St(Oe)),Xn);break;default:Q.sanitizeURL&&(Oe=""+Oe),N.push(jr,ve,Dn,ne(St(Oe)),Xn)}}else if(Xe(ve)){switch(typeof Oe){case"function":case"symbol":return;case"boolean":if(Q=ve.toLowerCase().slice(0,5),Q!=="data-"&&Q!=="aria-")return}N.push(jr,ne(ve),Dn,ne(St(Oe)),Xn)}}}var ts=F(">"),zs=F("/>");function no(N,Q,ve){if(Q!=null){if(ve!=null)throw Error(Y(60));if(typeof Q!="object"||!("__html"in Q))throw Error(Y(61));Q=Q.__html,Q!=null&&N.push(ne(""+Q))}}function fs(N){var Q="";return L.Children.forEach(N,function(ve){ve!=null&&(Q+=ve)}),Q}var rs=F(' selected=""');function eo(N,Q,ve,Oe){N.push(oo(ve));var zt=ve=null,xt;for(xt in Q)if(qe.call(Q,xt)){var Xt=Q[xt];if(Xt!=null)switch(xt){case"children":ve=Xt;break;case"dangerouslySetInnerHTML":zt=Xt;break;default:zi(N,Oe,xt,Xt)}}return N.push(ts),no(N,zt,ve),typeof ve=="string"?(N.push(ne(St(ve))),null):ve}var po=F(`
`),ko=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,mo=new Map;function oo(N){var Q=mo.get(N);if(Q===void 0){if(!ko.test(N))throw Error(Y(65,N));Q=F("<"+N),mo.set(N,Q)}return Q}var yo=F("<!DOCTYPE html>");function Ao(N,Q,ve,Oe,zt){switch(Q){case"select":N.push(oo("select"));var xt=null,Xt=null;for(rr in ve)if(qe.call(ve,rr)){var Ft=ve[rr];if(Ft!=null)switch(rr){case"children":xt=Ft;break;case"dangerouslySetInnerHTML":Xt=Ft;break;case"defaultValue":case"value":break;default:zi(N,Oe,rr,Ft)}}return N.push(ts),no(N,Xt,xt),xt;case"option":Xt=zt.selectedValue,N.push(oo("option"));var Rt=Ft=null,qi=null,rr=null;for(xt in ve)if(qe.call(ve,xt)){var Pn=ve[xt];if(Pn!=null)switch(xt){case"children":Ft=Pn;break;case"selected":qi=Pn;break;case"dangerouslySetInnerHTML":rr=Pn;break;case"value":Rt=Pn;default:zi(N,Oe,xt,Pn)}}if(Xt!=null)if(ve=Rt!==null?""+Rt:fs(Ft),hi(Xt)){for(Oe=0;Oe<Xt.length;Oe++)if(""+Xt[Oe]===ve){N.push(rs);break}}else""+Xt===ve&&N.push(rs);else qi&&N.push(rs);return N.push(ts),no(N,rr,Ft),Ft;case"textarea":N.push(oo("textarea")),rr=Xt=xt=null;for(Ft in ve)if(qe.call(ve,Ft)&&(Rt=ve[Ft],Rt!=null))switch(Ft){case"children":rr=Rt;break;case"value":xt=Rt;break;case"defaultValue":Xt=Rt;break;case"dangerouslySetInnerHTML":throw Error(Y(91));default:zi(N,Oe,Ft,Rt)}if(xt===null&&Xt!==null&&(xt=Xt),N.push(ts),rr!=null){if(xt!=null)throw Error(Y(92));if(hi(rr)&&1<rr.length)throw Error(Y(93));xt=""+rr}return typeof xt=="string"&&xt[0]===`
`&&N.push(po),xt!==null&&N.push(ne(St(""+xt))),null;case"input":N.push(oo("input")),Rt=rr=Ft=xt=null;for(Xt in ve)if(qe.call(ve,Xt)&&(qi=ve[Xt],qi!=null))switch(Xt){case"children":case"dangerouslySetInnerHTML":throw Error(Y(399,"input"));case"defaultChecked":Rt=qi;break;case"defaultValue":Ft=qi;break;case"checked":rr=qi;break;case"value":xt=qi;break;default:zi(N,Oe,Xt,qi)}return rr!==null?zi(N,Oe,"checked",rr):Rt!==null&&zi(N,Oe,"checked",Rt),xt!==null?zi(N,Oe,"value",xt):Ft!==null&&zi(N,Oe,"value",Ft),N.push(zs),null;case"menuitem":N.push(oo("menuitem"));for(var Po in ve)if(qe.call(ve,Po)&&(xt=ve[Po],xt!=null))switch(Po){case"children":case"dangerouslySetInnerHTML":throw Error(Y(400));default:zi(N,Oe,Po,xt)}return N.push(ts),null;case"title":N.push(oo("title")),xt=null;for(Pn in ve)if(qe.call(ve,Pn)&&(Xt=ve[Pn],Xt!=null))switch(Pn){case"children":xt=Xt;break;case"dangerouslySetInnerHTML":throw Error(Y(434));default:zi(N,Oe,Pn,Xt)}return N.push(ts),xt;case"listing":case"pre":N.push(oo(Q)),Xt=xt=null;for(Rt in ve)if(qe.call(ve,Rt)&&(Ft=ve[Rt],Ft!=null))switch(Rt){case"children":xt=Ft;break;case"dangerouslySetInnerHTML":Xt=Ft;break;default:zi(N,Oe,Rt,Ft)}if(N.push(ts),Xt!=null){if(xt!=null)throw Error(Y(60));if(typeof Xt!="object"||!("__html"in Xt))throw Error(Y(61));ve=Xt.__html,ve!=null&&(typeof ve=="string"&&0<ve.length&&ve[0]===`
`?N.push(po,ne(ve)):N.push(ne(""+ve)))}return typeof xt=="string"&&xt[0]===`
`&&N.push(po),xt;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":N.push(oo(Q));for(var Dr in ve)if(qe.call(ve,Dr)&&(xt=ve[Dr],xt!=null))switch(Dr){case"children":case"dangerouslySetInnerHTML":throw Error(Y(399,Q));default:zi(N,Oe,Dr,xt)}return N.push(zs),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return eo(N,ve,Q,Oe);case"html":return zt.insertionMode===0&&N.push(yo),eo(N,ve,Q,Oe);default:if(Q.indexOf("-")===-1&&typeof ve.is!="string")return eo(N,ve,Q,Oe);N.push(oo(Q)),Xt=xt=null;for(qi in ve)if(qe.call(ve,qi)&&(Ft=ve[qi],Ft!=null))switch(qi){case"children":xt=Ft;break;case"dangerouslySetInnerHTML":Xt=Ft;break;case"style":ji(N,Oe,Ft);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:Xe(qi)&&typeof Ft!="function"&&typeof Ft!="symbol"&&N.push(jr,ne(qi),Dn,ne(St(Ft)),Xn)}return N.push(ts),no(N,Xt,xt),xt}}var Ws=F("</"),ps=F(">"),Ho=F('<template id="'),is=F('"></template>'),Lo=F("<!--$-->"),co=F('<!--$?--><template id="'),Os=F('"></template>'),ns=F("<!--$!-->"),ms=F("<!--/$-->"),ra=F("<template"),os=F('"'),ia=F(' data-dgst="');F(' data-msg="'),F(' data-stck="');var Qi=F("></template>");function to(N,Q,ve){if(ue(N,co),ve===null)throw Error(Y(395));return ue(N,ve),_e(N,Os)}var Es=F('<div hidden id="'),so=F('">'),xr=F("</div>"),Oi=F('<svg aria-hidden="true" style="display:none" id="'),un=F('">'),Ot=F("</svg>"),pn=F('<math aria-hidden="true" style="display:none" id="'),gs=F('">'),ot=F("</math>"),G=F('<table hidden id="'),K=F('">'),ge=F("</table>"),Ce=F('<table hidden><tbody id="'),Me=F('">'),Re=F("</tbody></table>"),ke=F('<table hidden><tr id="'),Fe=F('">'),Qe=F("</tr></table>"),_t=F('<table hidden><colgroup id="'),Je=F('">'),Ht=F("</colgroup></table>");function Qt(N,Q,ve,Oe){switch(ve.insertionMode){case 0:case 1:return ue(N,Es),ue(N,Q.segmentPrefix),ue(N,ne(Oe.toString(16))),_e(N,so);case 2:return ue(N,Oi),ue(N,Q.segmentPrefix),ue(N,ne(Oe.toString(16))),_e(N,un);case 3:return ue(N,pn),ue(N,Q.segmentPrefix),ue(N,ne(Oe.toString(16))),_e(N,gs);case 4:return ue(N,G),ue(N,Q.segmentPrefix),ue(N,ne(Oe.toString(16))),_e(N,K);case 5:return ue(N,Ce),ue(N,Q.segmentPrefix),ue(N,ne(Oe.toString(16))),_e(N,Me);case 6:return ue(N,ke),ue(N,Q.segmentPrefix),ue(N,ne(Oe.toString(16))),_e(N,Fe);case 7:return ue(N,_t),ue(N,Q.segmentPrefix),ue(N,ne(Oe.toString(16))),_e(N,Je);default:throw Error(Y(397))}}function lr(N,Q){switch(Q.insertionMode){case 0:case 1:return _e(N,xr);case 2:return _e(N,Ot);case 3:return _e(N,ot);case 4:return _e(N,ge);case 5:return _e(N,Re);case 6:return _e(N,Qe);case 7:return _e(N,Ht);default:throw Error(Y(397))}}var Nr=F('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("'),Wr=F('$RS("'),Zr=F('","'),Xr=F('")<\/script>'),nn=F('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("'),Jr=F('$RC("'),Wi=F('","'),Mi=F('")<\/script>'),ii=F('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("'),Pi=F('$RX("'),wn=F('"'),On=F(")<\/script>"),Vn=F(","),go=/[<\u2028\u2029]/g;function $o(N){return JSON.stringify(N).replace(go,function(Q){switch(Q){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}})}var Gn=Object.assign,Fn=Symbol.for("react.element"),Yn=Symbol.for("react.portal"),mn=Symbol.for("react.fragment"),Is=Symbol.for("react.strict_mode"),na=Symbol.for("react.profiler"),$a=Symbol.for("react.provider"),As=Symbol.for("react.context"),Sa=Symbol.for("react.forward_ref"),Zs=Symbol.for("react.suspense"),Cs=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),te=Symbol.for("react.lazy"),we=Symbol.for("react.scope"),Be=Symbol.for("react.debug_trace_mode"),Ct=Symbol.for("react.legacy_hidden"),wt=Symbol.for("react.default_value"),Yt=Symbol.iterator;function Cr(N){if(N==null)return null;if(typeof N=="function")return N.displayName||N.name||null;if(typeof N=="string")return N;switch(N){case mn:return"Fragment";case Yn:return"Portal";case na:return"Profiler";case Is:return"StrictMode";case Zs:return"Suspense";case Cs:return"SuspenseList"}if(typeof N=="object")switch(N.$$typeof){case As:return(N.displayName||"Context")+".Consumer";case $a:return(N._context.displayName||"Context")+".Provider";case Sa:var Q=N.render;return N=N.displayName,N||(N=Q.displayName||Q.name||"",N=N!==""?"ForwardRef("+N+")":"ForwardRef"),N;case j:return Q=N.displayName||null,Q!==null?Q:Cr(N.type)||"Memo";case te:Q=N._payload,N=N._init;try{return Cr(N(Q))}catch{}}return null}var kr={};function mi(N,Q){if(N=N.contextTypes,!N)return kr;var ve={},Oe;for(Oe in N)ve[Oe]=Q[Oe];return ve}var Vi=null;function jn(N,Q){if(N!==Q){N.context._currentValue=N.parentValue,N=N.parent;var ve=Q.parent;if(N===null){if(ve!==null)throw Error(Y(401))}else{if(ve===null)throw Error(Y(401));jn(N,ve)}Q.context._currentValue=Q.value}}function bo(N){N.context._currentValue=N.parentValue,N=N.parent,N!==null&&bo(N)}function ss(N){var Q=N.parent;Q!==null&&ss(Q),N.context._currentValue=N.value}function as(N,Q){if(N.context._currentValue=N.parentValue,N=N.parent,N===null)throw Error(Y(402));N.depth===Q.depth?jn(N,Q):as(N,Q)}function Fs(N,Q){var ve=Q.parent;if(ve===null)throw Error(Y(402));N.depth===ve.depth?jn(N,ve):Fs(N,ve),Q.context._currentValue=Q.value}function Hn(N){var Q=Vi;Q!==N&&(Q===null?ss(N):N===null?bo(Q):Q.depth===N.depth?jn(Q,N):Q.depth>N.depth?as(Q,N):Fs(Q,N),Vi=N)}var _s={isMounted:function(){return!1},enqueueSetState:function(N,Q){N=N._reactInternals,N.queue!==null&&N.queue.push(Q)},enqueueReplaceState:function(N,Q){N=N._reactInternals,N.replace=!0,N.queue=[Q]},enqueueForceUpdate:function(){}};function Wo(N,Q,ve,Oe){var zt=N.state!==void 0?N.state:null;N.updater=_s,N.props=ve,N.state=zt;var xt={queue:[],replace:!1};N._reactInternals=xt;var Xt=Q.contextType;if(N.context=typeof Xt=="object"&&Xt!==null?Xt._currentValue:Oe,Xt=Q.getDerivedStateFromProps,typeof Xt=="function"&&(Xt=Xt(ve,zt),zt=Xt==null?zt:Gn({},zt,Xt),N.state=zt),typeof Q.getDerivedStateFromProps!="function"&&typeof N.getSnapshotBeforeUpdate!="function"&&(typeof N.UNSAFE_componentWillMount=="function"||typeof N.componentWillMount=="function"))if(Q=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),Q!==N.state&&_s.enqueueReplaceState(N,N.state,null),xt.queue!==null&&0<xt.queue.length)if(Q=xt.queue,Xt=xt.replace,xt.queue=null,xt.replace=!1,Xt&&Q.length===1)N.state=Q[0];else{for(xt=Xt?Q[0]:N.state,zt=!0,Xt=Xt?1:0;Xt<Q.length;Xt++){var Ft=Q[Xt];Ft=typeof Ft=="function"?Ft.call(N,xt,ve,Oe):Ft,Ft!=null&&(zt?(zt=!1,xt=Gn({},xt,Ft)):Gn(xt,Ft))}N.state=xt}else xt.queue=null}var ls={id:1,overflow:""};function Bs(N,Q,ve){var Oe=N.id;N=N.overflow;var zt=32-oa(Oe)-1;Oe&=~(1<<zt),ve+=1;var xt=32-oa(Q)+zt;if(30<xt){var Xt=zt-zt%5;return xt=(Oe&(1<<Xt)-1).toString(32),Oe>>=Xt,zt-=Xt,{id:1<<32-oa(Q)+zt|ve<<zt|Oe,overflow:xt+N}}return{id:1<<xt|ve<<zt|Oe,overflow:N}}var oa=Math.clz32?Math.clz32:Bl,sa=Math.log,ki=Math.LN2;function Bl(N){return N>>>=0,N===0?32:31-(sa(N)/ki|0)|0}function Ta(N,Q){return N===Q&&(N!==0||1/N===1/Q)||N!==N&&Q!==Q}var Vd=typeof Object.is=="function"?Object.is:Ta,aa=null,Xs=null,Ys=null,Mn=null,Ea=!1,Ia=!1,us=0,ys=null,Wa=0;function Aa(){if(aa===null)throw Error(Y(321));return aa}function su(){if(0<Wa)throw Error(Y(312));return{memoizedState:null,queue:null,next:null}}function Co(){return Mn===null?Ys===null?(Ea=!1,Ys=Mn=su()):(Ea=!0,Mn=Ys):Mn.next===null?(Ea=!1,Mn=Mn.next=su()):(Ea=!0,Mn=Mn.next),Mn}function Ks(){Xs=aa=null,Ia=!1,Ys=null,Wa=0,Mn=ys=null}function Ou(N,Q){return typeof Q=="function"?Q(N):Q}function la(N,Q,ve){if(aa=Aa(),Mn=Co(),Ea){var Oe=Mn.queue;if(Q=Oe.dispatch,ys!==null&&(ve=ys.get(Oe),ve!==void 0)){ys.delete(Oe),Oe=Mn.memoizedState;do Oe=N(Oe,ve.action),ve=ve.next;while(ve!==null);return Mn.memoizedState=Oe,[Oe,Q]}return[Mn.memoizedState,Q]}return N=N===Ou?typeof Q=="function"?Q():Q:ve!==void 0?ve(Q):Q,Mn.memoizedState=N,N=Mn.queue={last:null,dispatch:null},N=N.dispatch=Ca.bind(null,aa,N),[Mn.memoizedState,N]}function Nl(N,Q){if(aa=Aa(),Mn=Co(),Q=Q===void 0?null:Q,Mn!==null){var ve=Mn.memoizedState;if(ve!==null&&Q!==null){var Oe=ve[1];e:if(Oe===null)Oe=!1;else{for(var zt=0;zt<Oe.length&&zt<Q.length;zt++)if(!Vd(Q[zt],Oe[zt])){Oe=!1;break e}Oe=!0}if(Oe)return ve[0]}}return N=N(),Mn.memoizedState=[N,Q],N}function Ca(N,Q,ve){if(25<=Wa)throw Error(Y(301));if(N===aa)if(Ia=!0,N={action:ve,next:null},ys===null&&(ys=new Map),ve=ys.get(Q),ve===void 0)ys.set(Q,N);else{for(Q=ve;Q.next!==null;)Q=Q.next;Q.next=N}}function vs(){throw Error(Y(394))}function Za(){}var hl={readContext:function(N){return N._currentValue},useContext:function(N){return Aa(),N._currentValue},useMemo:Nl,useReducer:la,useRef:function(N){aa=Aa(),Mn=Co();var Q=Mn.memoizedState;return Q===null?(N={current:N},Mn.memoizedState=N):Q},useState:function(N){return la(Ou,N)},useInsertionEffect:Za,useLayoutEffect:function(){},useCallback:function(N,Q){return Nl(function(){return N},Q)},useImperativeHandle:Za,useEffect:Za,useDebugValue:Za,useDeferredValue:function(N){return Aa(),N},useTransition:function(){return Aa(),[!1,vs]},useId:function(){var N=Xs.treeContext,Q=N.overflow;N=N.id,N=(N&~(1<<32-oa(N)-1)).toString(32)+Q;var ve=Xa;if(ve===null)throw Error(Y(404));return Q=us++,N=":"+ve.idPrefix+"R"+N,0<Q&&(N+="H"+Q.toString(32)),N+":"},useMutableSource:function(N,Q){return Aa(),Q(N._source)},useSyncExternalStore:function(N,Q,ve){if(ve===void 0)throw Error(Y(407));return ve()}},Xa=null,ai=L.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function Vl(N){return console.error(N),null}function Mr(){}function au(N,Q,ve,Oe,zt,xt,Xt,Ft,Rt){var qi=[],rr=new Set;return Q={destination:null,responseState:Q,progressiveChunkSize:Oe===void 0?12800:Oe,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:rr,pingedTasks:qi,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:zt===void 0?Vl:zt,onAllReady:xt===void 0?Mr:xt,onShellReady:Xt===void 0?Mr:Xt,onShellError:Ft===void 0?Mr:Ft,onFatalError:Rt===void 0?Mr:Rt},ve=Ya(Q,0,null,ve,!1,!1),ve.parentFlushed=!0,N=lu(Q,N,null,ve,rr,kr,null,ls),qi.push(N),Q}function lu(N,Q,ve,Oe,zt,xt,Xt,Ft){N.allPendingTasks++,ve===null?N.pendingRootTasks++:ve.pendingTasks++;var Rt={node:Q,ping:function(){var qi=N.pingedTasks;qi.push(Rt),qi.length===1&&Oo(N)},blockedBoundary:ve,blockedSegment:Oe,abortSet:zt,legacyContext:xt,context:Xt,treeContext:Ft};return zt.add(Rt),Rt}function Ya(N,Q,ve,Oe,zt,xt){return{status:0,id:-1,index:Q,parentFlushed:!1,chunks:[],children:[],formatContext:Oe,boundary:ve,lastPushedText:zt,textEmbedded:xt}}function ua(N,Q){if(N=N.onError(Q),N!=null&&typeof N!="string")throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof N+'" instead');return N}function Mo(N,Q){var ve=N.onShellError;ve(Q),ve=N.onFatalError,ve(Q),N.destination!==null?(N.status=2,fe(N.destination,Q)):(N.status=1,N.fatalError=Q)}function ca(N,Q,ve,Oe,zt){for(aa={},Xs=Q,us=0,N=ve(Oe,zt);Ia;)Ia=!1,us=0,Wa+=1,Mn=null,N=ve(Oe,zt);return Ks(),N}function Ma(N,Q,ve,Oe){var zt=ve.render(),xt=Oe.childContextTypes;if(xt!=null){var Xt=Q.legacyContext;if(typeof ve.getChildContext!="function")Oe=Xt;else{ve=ve.getChildContext();for(var Ft in ve)if(!(Ft in xt))throw Error(Y(108,Cr(Oe)||"Unknown",Ft));Oe=Gn({},Xt,ve)}Q.legacyContext=Oe,xi(N,Q,zt),Q.legacyContext=Xt}else xi(N,Q,zt)}function Sr(N,Q){if(N&&N.defaultProps){Q=Gn({},Q),N=N.defaultProps;for(var ve in N)Q[ve]===void 0&&(Q[ve]=N[ve]);return Q}return Q}function Hi(N,Q,ve,Oe,zt){if(typeof ve=="function")if(ve.prototype&&ve.prototype.isReactComponent){zt=mi(ve,Q.legacyContext);var xt=ve.contextType;xt=new ve(Oe,typeof xt=="object"&&xt!==null?xt._currentValue:zt),Wo(xt,ve,Oe,zt),Ma(N,Q,xt,ve)}else{xt=mi(ve,Q.legacyContext),zt=ca(N,Q,ve,Oe,xt);var Xt=us!==0;if(typeof zt=="object"&&zt!==null&&typeof zt.render=="function"&&zt.$$typeof===void 0)Wo(zt,ve,Oe,xt),Ma(N,Q,zt,ve);else if(Xt){Oe=Q.treeContext,Q.treeContext=Bs(Oe,1,0);try{xi(N,Q,zt)}finally{Q.treeContext=Oe}}else xi(N,Q,zt)}else if(typeof ve=="string"){switch(zt=Q.blockedSegment,xt=Ao(zt.chunks,ve,Oe,N.responseState,zt.formatContext),zt.lastPushedText=!1,Xt=zt.formatContext,zt.formatContext=dt(Xt,ve,Oe),Pa(N,Q,xt),zt.formatContext=Xt,ve){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:zt.chunks.push(Ws,ne(ve),ps)}zt.lastPushedText=!1}else{switch(ve){case Ct:case Be:case Is:case na:case mn:xi(N,Q,Oe.children);return;case Cs:xi(N,Q,Oe.children);return;case we:throw Error(Y(343));case Zs:e:{ve=Q.blockedBoundary,zt=Q.blockedSegment,xt=Oe.fallback,Oe=Oe.children,Xt=new Set;var Ft={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:Xt,errorDigest:null},Rt=Ya(N,zt.chunks.length,Ft,zt.formatContext,!1,!1);zt.children.push(Rt),zt.lastPushedText=!1;var qi=Ya(N,0,null,zt.formatContext,!1,!1);qi.parentFlushed=!0,Q.blockedBoundary=Ft,Q.blockedSegment=qi;try{if(Pa(N,Q,Oe),qi.lastPushedText&&qi.textEmbedded&&qi.chunks.push(sr),qi.status=1,fl(Ft,qi),Ft.pendingTasks===0)break e}catch(rr){qi.status=4,Ft.forceClientRender=!0,Ft.errorDigest=ua(N,rr)}finally{Q.blockedBoundary=ve,Q.blockedSegment=zt}Q=lu(N,xt,ve,Rt,Xt,Q.legacyContext,Q.context,Q.treeContext),N.pingedTasks.push(Q)}return}if(typeof ve=="object"&&ve!==null)switch(ve.$$typeof){case Sa:if(Oe=ca(N,Q,ve.render,Oe,zt),us!==0){ve=Q.treeContext,Q.treeContext=Bs(ve,1,0);try{xi(N,Q,Oe)}finally{Q.treeContext=ve}}else xi(N,Q,Oe);return;case j:ve=ve.type,Oe=Sr(ve,Oe),Hi(N,Q,ve,Oe,zt);return;case $a:if(zt=Oe.children,ve=ve._context,Oe=Oe.value,xt=ve._currentValue,ve._currentValue=Oe,Xt=Vi,Vi=Oe={parent:Xt,depth:Xt===null?0:Xt.depth+1,context:ve,parentValue:xt,value:Oe},Q.context=Oe,xi(N,Q,zt),N=Vi,N===null)throw Error(Y(403));Oe=N.parentValue,N.context._currentValue=Oe===wt?N.context._defaultValue:Oe,N=Vi=N.parent,Q.context=N;return;case As:Oe=Oe.children,Oe=Oe(ve._currentValue),xi(N,Q,Oe);return;case te:zt=ve._init,ve=zt(ve._payload),Oe=Sr(ve,Oe),Hi(N,Q,ve,Oe,void 0);return}throw Error(Y(130,ve==null?ve:typeof ve,""))}}function xi(N,Q,ve){if(Q.node=ve,typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case Fn:Hi(N,Q,ve.type,ve.props,ve.ref);return;case Yn:throw Error(Y(257));case te:var Oe=ve._init;ve=Oe(ve._payload),xi(N,Q,ve);return}if(hi(ve)){zo(N,Q,ve);return}if(ve===null||typeof ve!="object"?Oe=null:(Oe=Yt&&ve[Yt]||ve["@@iterator"],Oe=typeof Oe=="function"?Oe:null),Oe&&(Oe=Oe.call(ve))){if(ve=Oe.next(),!ve.done){var zt=[];do zt.push(ve.value),ve=Oe.next();while(!ve.done);zo(N,Q,zt)}return}throw N=Object.prototype.toString.call(ve),Error(Y(31,N==="[object Object]"?"object with keys {"+Object.keys(ve).join(", ")+"}":N))}typeof ve=="string"?(Oe=Q.blockedSegment,Oe.lastPushedText=bi(Q.blockedSegment.chunks,ve,N.responseState,Oe.lastPushedText)):typeof ve=="number"&&(Oe=Q.blockedSegment,Oe.lastPushedText=bi(Q.blockedSegment.chunks,""+ve,N.responseState,Oe.lastPushedText))}function zo(N,Q,ve){for(var Oe=ve.length,zt=0;zt<Oe;zt++){var xt=Q.treeContext;Q.treeContext=Bs(xt,Oe,zt);try{Pa(N,Q,ve[zt])}finally{Q.treeContext=xt}}}function Pa(N,Q,ve){var Oe=Q.blockedSegment.formatContext,zt=Q.legacyContext,xt=Q.context;try{return xi(N,Q,ve)}catch(Rt){if(Ks(),typeof Rt=="object"&&Rt!==null&&typeof Rt.then=="function"){ve=Rt;var Xt=Q.blockedSegment,Ft=Ya(N,Xt.chunks.length,null,Xt.formatContext,Xt.lastPushedText,!0);Xt.children.push(Ft),Xt.lastPushedText=!1,N=lu(N,Q.node,Q.blockedBoundary,Ft,Q.abortSet,Q.legacyContext,Q.context,Q.treeContext).ping,ve.then(N,N),Q.blockedSegment.formatContext=Oe,Q.legacyContext=zt,Q.context=xt,Hn(xt)}else throw Q.blockedSegment.formatContext=Oe,Q.legacyContext=zt,Q.context=xt,Hn(xt),Rt}}function Ui(N){var Q=N.blockedBoundary;N=N.blockedSegment,N.status=3,uu(this,Q,N)}function dl(N,Q,ve){var Oe=N.blockedBoundary;N.blockedSegment.status=3,Oe===null?(Q.allPendingTasks--,Q.status!==2&&(Q.status=2,Q.destination!==null&&Q.destination.close())):(Oe.pendingTasks--,Oe.forceClientRender||(Oe.forceClientRender=!0,N=ve===void 0?Error(Y(432)):ve,Oe.errorDigest=Q.onError(N),Oe.parentFlushed&&Q.clientRenderedBoundaries.push(Oe)),Oe.fallbackAbortableTasks.forEach(function(zt){return dl(zt,Q,ve)}),Oe.fallbackAbortableTasks.clear(),Q.allPendingTasks--,Q.allPendingTasks===0&&(Oe=Q.onAllReady,Oe()))}function fl(N,Q){if(Q.chunks.length===0&&Q.children.length===1&&Q.children[0].boundary===null){var ve=Q.children[0];ve.id=Q.id,ve.parentFlushed=!0,ve.status===1&&fl(N,ve)}else N.completedSegments.push(Q)}function uu(N,Q,ve){if(Q===null){if(ve.parentFlushed){if(N.completedRootSegment!==null)throw Error(Y(389));N.completedRootSegment=ve}N.pendingRootTasks--,N.pendingRootTasks===0&&(N.onShellError=Mr,Q=N.onShellReady,Q())}else Q.pendingTasks--,Q.forceClientRender||(Q.pendingTasks===0?(ve.parentFlushed&&ve.status===1&&fl(Q,ve),Q.parentFlushed&&N.completedBoundaries.push(Q),Q.fallbackAbortableTasks.forEach(Ui,N),Q.fallbackAbortableTasks.clear()):ve.parentFlushed&&ve.status===1&&(fl(Q,ve),Q.completedSegments.length===1&&Q.parentFlushed&&N.partialBoundaries.push(Q)));N.allPendingTasks--,N.allPendingTasks===0&&(N=N.onAllReady,N())}function Oo(N){if(N.status!==2){var Q=Vi,ve=ai.current;ai.current=hl;var Oe=Xa;Xa=N.responseState;try{var zt=N.pingedTasks,xt;for(xt=0;xt<zt.length;xt++){var Xt=zt[xt],Ft=N,Rt=Xt.blockedSegment;if(Rt.status===0){Hn(Xt.context);try{xi(Ft,Xt,Xt.node),Rt.lastPushedText&&Rt.textEmbedded&&Rt.chunks.push(sr),Xt.abortSet.delete(Xt),Rt.status=1,uu(Ft,Xt.blockedBoundary,Rt)}catch(Ns){if(Ks(),typeof Ns=="object"&&Ns!==null&&typeof Ns.then=="function"){var qi=Xt.ping;Ns.then(qi,qi)}else{Xt.abortSet.delete(Xt),Rt.status=4;var rr=Xt.blockedBoundary,Pn=Ns,Po=ua(Ft,Pn);if(rr===null?Mo(Ft,Pn):(rr.pendingTasks--,rr.forceClientRender||(rr.forceClientRender=!0,rr.errorDigest=Po,rr.parentFlushed&&Ft.clientRenderedBoundaries.push(rr))),Ft.allPendingTasks--,Ft.allPendingTasks===0){var Dr=Ft.onAllReady;Dr()}}}finally{}}}zt.splice(0,xt),N.destination!==null&&Ra(N,N.destination)}catch(Ns){ua(N,Ns),Mo(N,Ns)}finally{Xa=Oe,ai.current=ve,ve===hl&&Hn(Q)}}}function $n(N,Q,ve){switch(ve.parentFlushed=!0,ve.status){case 0:var Oe=ve.id=N.nextSegmentId++;return ve.lastPushedText=!1,ve.textEmbedded=!1,N=N.responseState,ue(Q,Ho),ue(Q,N.placeholderPrefix),N=ne(Oe.toString(16)),ue(Q,N),_e(Q,is);case 1:ve.status=2;var zt=!0;Oe=ve.chunks;var xt=0;ve=ve.children;for(var Xt=0;Xt<ve.length;Xt++){for(zt=ve[Xt];xt<zt.index;xt++)ue(Q,Oe[xt]);zt=_c(N,Q,zt)}for(;xt<Oe.length-1;xt++)ue(Q,Oe[xt]);return xt<Oe.length&&(zt=_e(Q,Oe[xt])),zt;default:throw Error(Y(390))}}function _c(N,Q,ve){var Oe=ve.boundary;if(Oe===null)return $n(N,Q,ve);if(Oe.parentFlushed=!0,Oe.forceClientRender)Oe=Oe.errorDigest,_e(Q,ns),ue(Q,ra),Oe&&(ue(Q,ia),ue(Q,ne(St(Oe))),ue(Q,os)),_e(Q,Qi),$n(N,Q,ve);else if(0<Oe.pendingTasks){Oe.rootSegmentID=N.nextSegmentId++,0<Oe.completedSegments.length&&N.partialBoundaries.push(Oe);var zt=N.responseState,xt=zt.nextSuspenseID++;zt=F(zt.boundaryPrefix+xt.toString(16)),Oe=Oe.id=zt,to(Q,N.responseState,Oe),$n(N,Q,ve)}else if(Oe.byteSize>N.progressiveChunkSize)Oe.rootSegmentID=N.nextSegmentId++,N.completedBoundaries.push(Oe),to(Q,N.responseState,Oe.id),$n(N,Q,ve);else{if(_e(Q,Lo),ve=Oe.completedSegments,ve.length!==1)throw Error(Y(391));_c(N,Q,ve[0])}return _e(Q,ms)}function cu(N,Q,ve){return Qt(Q,N.responseState,ve.formatContext,ve.id),_c(N,Q,ve),lr(Q,ve.formatContext)}function yc(N,Q,ve){for(var Oe=ve.completedSegments,zt=0;zt<Oe.length;zt++)Ka(N,Q,ve,Oe[zt]);if(Oe.length=0,N=N.responseState,Oe=ve.id,ve=ve.rootSegmentID,ue(Q,N.startInlineScript),N.sentCompleteBoundaryFunction?ue(Q,Jr):(N.sentCompleteBoundaryFunction=!0,ue(Q,nn)),Oe===null)throw Error(Y(395));return ve=ne(ve.toString(16)),ue(Q,Oe),ue(Q,Wi),ue(Q,N.segmentPrefix),ue(Q,ve),_e(Q,Mi)}function Ka(N,Q,ve,Oe){if(Oe.status===2)return!0;var zt=Oe.id;if(zt===-1){if((Oe.id=ve.rootSegmentID)===-1)throw Error(Y(392));return cu(N,Q,Oe)}return cu(N,Q,Oe),N=N.responseState,ue(Q,N.startInlineScript),N.sentCompleteSegmentFunction?ue(Q,Wr):(N.sentCompleteSegmentFunction=!0,ue(Q,Nr)),ue(Q,N.segmentPrefix),zt=ne(zt.toString(16)),ue(Q,zt),ue(Q,Zr),ue(Q,N.placeholderPrefix),ue(Q,zt),_e(Q,Xr)}function Ra(N,Q){Z=new Uint8Array(512),Ee=0;try{var ve=N.completedRootSegment;if(ve!==null&&N.pendingRootTasks===0){_c(N,Q,ve),N.completedRootSegment=null;var Oe=N.responseState.bootstrapChunks;for(ve=0;ve<Oe.length-1;ve++)ue(Q,Oe[ve]);ve<Oe.length&&_e(Q,Oe[ve])}var zt=N.clientRenderedBoundaries,xt;for(xt=0;xt<zt.length;xt++){var Xt=zt[xt];Oe=Q;var Ft=N.responseState,Rt=Xt.id,qi=Xt.errorDigest,rr=Xt.errorMessage,Pn=Xt.errorComponentStack;if(ue(Oe,Ft.startInlineScript),Ft.sentClientRenderFunction?ue(Oe,Pi):(Ft.sentClientRenderFunction=!0,ue(Oe,ii)),Rt===null)throw Error(Y(395));ue(Oe,Rt),ue(Oe,wn),(qi||rr||Pn)&&(ue(Oe,Vn),ue(Oe,ne($o(qi||"")))),(rr||Pn)&&(ue(Oe,Vn),ue(Oe,ne($o(rr||"")))),Pn&&(ue(Oe,Vn),ue(Oe,ne($o(Pn)))),_e(Oe,On)}zt.splice(0,xt);var Po=N.completedBoundaries;for(xt=0;xt<Po.length;xt++)yc(N,Q,Po[xt]);Po.splice(0,xt),be(Q),Z=new Uint8Array(512),Ee=0;var Dr=N.partialBoundaries;for(xt=0;xt<Dr.length;xt++){var Ns=Dr[xt];e:{zt=N,Xt=Q;var xs=Ns.completedSegments;for(Ft=0;Ft<xs.length;Ft++)if(!Ka(zt,Xt,Ns,xs[Ft])){Ft++,xs.splice(0,Ft);var vc=!1;break e}xs.splice(0,Ft),vc=!0}if(!vc){N.destination=null,xt++,Dr.splice(0,xt);return}}Dr.splice(0,xt);var ha=N.completedBoundaries;for(xt=0;xt<ha.length;xt++)yc(N,Q,ha[xt]);ha.splice(0,xt)}finally{be(Q),N.allPendingTasks===0&&N.pingedTasks.length===0&&N.clientRenderedBoundaries.length===0&&N.completedBoundaries.length===0&&Q.close()}}function Fu(N,Q){try{var ve=N.abortableTasks;ve.forEach(function(Oe){return dl(Oe,N,Q)}),ve.clear(),N.destination!==null&&Ra(N,N.destination)}catch(Oe){ua(N,Oe),Mo(N,Oe)}}return gg.renderToReadableStream=function(N,Q){return new Promise(function(ve,Oe){var zt,xt,Xt=new Promise(function(rr,Pn){xt=rr,zt=Pn}),Ft=au(N,mr(Q?Q.identifierPrefix:void 0,Q?Q.nonce:void 0,Q?Q.bootstrapScriptContent:void 0,Q?Q.bootstrapScripts:void 0,Q?Q.bootstrapModules:void 0),or(Q?Q.namespaceURI:void 0),Q?Q.progressiveChunkSize:void 0,Q?Q.onError:void 0,xt,function(){var rr=new ReadableStream({type:"bytes",pull:function(Pn){if(Ft.status===1)Ft.status=2,fe(Pn,Ft.fatalError);else if(Ft.status!==2&&Ft.destination===null){Ft.destination=Pn;try{Ra(Ft,Pn)}catch(Po){ua(Ft,Po),Mo(Ft,Po)}}},cancel:function(){Fu(Ft)}},{highWaterMark:0});rr.allReady=Xt,ve(rr)},function(rr){Xt.catch(function(){}),Oe(rr)},zt);if(Q&&Q.signal){var Rt=Q.signal,qi=function(){Fu(Ft,Rt.reason),Rt.removeEventListener("abort",qi)};Rt.addEventListener("abort",qi)}Oo(Ft)})},gg.version="18.3.1",gg}var Z1;function OE(){if(Z1)return Bd;Z1=1;var L,Y;return L=LE(),Y=zE(),Bd.version=L.version,Bd.renderToString=L.renderToString,Bd.renderToStaticMarkup=L.renderToStaticMarkup,Bd.renderToNodeStream=L.renderToNodeStream,Bd.renderToStaticNodeStream=L.renderToStaticNodeStream,Bd.renderToReadableStream=Y.renderToReadableStream,Bd}OE();new kE.Parser(FS);function FE(L){let Y=L.paragraph;return typeof Y=="string"?Se.jsx("p",{className:"paragraph",children:Y}):Array.isArray(Y)?Se.jsx("p",{className:"paragraph",children:Y}):Se.jsx("p",{className:"paragraph",children:Y})}function lm(L){const{title:Y,subheading:Z,paragraph:Ee,list:ue,graphic:_e}=L;return Se.jsxs("div",{className:"text-section",children:[Y&&Se.jsx("h1",{className:"title",children:Y}),Z&&Se.jsx("h2",{className:"subheading",children:Z}),Se.jsx(FE,{paragraph:Ee}),ue&&Se.jsx(Se.Fragment,{children:ue.map((be,s)=>Se.jsx("ul",{className:"paragraph",children:Se.jsx("li",{children:be})},s))}),_e&&Se.jsx("div",{className:"graphic",children:_e})]})}function Nd(L){const{link:Y,title:Z,subtitle:Ee}=L;return Se.jsx("div",{className:"Pad",children:Se.jsx(Di,{to:Y,children:Se.jsxs("button",{className:"Button Project",children:[Se.jsxs("div",{className:"Title",children:[Z," "]}),Se.jsxs("div",{className:"Subitle",children:[Ee," "]})]})})})}function BE(){return Se.jsxs("div",{children:[Se.jsx(Ig,{}),Se.jsxs("div",{className:"wrapper",children:[gE.map(L=>Se.jsx(lm,{title:L.title,subheading:L.subheading,paragraph:L.paragraph,list:L.list,graphic:L.graphic},L.title)),Se.jsx(Nd,{link:"https://landway.bostoncyclistsunion.org/",title:"Landway Map",subtitle:"Mobility Network Vision"}),Se.jsx(Nd,{link:dm,title:"Bike Stress Map",subtitle:"See how stressful Boston's streets are"}),Se.jsx(Nd,{link:"https://bostoncyclistsunion.org/author/bcu-labs",title:"Articles",subtitle:"Data analysis, stories, infrastructure projects, and more"}),Se.jsx(Ag,{})]})]})}var vg={exports:{}},NE=vg.exports,X1;function VE(){return X1||(X1=1,function(L,Y){(function(Z,Ee){L.exports=Ee()})(NE,function(){var Z,Ee,ue;function _e(s,ne){if(!Z)Z=ne;else if(!Ee)Ee=ne;else{var F="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Z+")(sharedChunk); ("+Ee+")(sharedChunk); self.onerror = null;",fe={};Z(fe),ue=ne(fe),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ue.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}_e(["exports"],function(s){var ne=1e-6,F=typeof Float32Array<"u"?Float32Array:Array;function fe(i,e){var r=e[0],o=e[1],a=e[2],c=e[3],d=r*c-a*o;return d?(i[0]=c*(d=1/d),i[1]=-o*d,i[2]=-a*d,i[3]=r*d,i):null}function qe(){var i=new F(9);return F!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ne(i,e){var r=e[0],o=e[1],a=e[2],c=e[3],d=e[4],g=e[5],y=e[6],x=e[7],S=e[8];return i[0]=d*S-g*x,i[1]=a*x-o*S,i[2]=o*g-a*d,i[3]=g*y-c*S,i[4]=r*S-a*y,i[5]=a*c-r*g,i[6]=c*x-d*y,i[7]=o*y-r*x,i[8]=r*d-o*c,i}function Ye(i,e,r){var o=e[0],a=e[1],c=e[2],d=e[3],g=e[4],y=e[5],x=e[6],S=e[7],T=e[8],I=r[0],R=r[1],D=r[2],O=r[3],W=r[4],X=r[5],oe=r[6],re=r[7],B=r[8];return i[0]=I*o+R*d+D*x,i[1]=I*a+R*g+D*S,i[2]=I*c+R*y+D*T,i[3]=O*o+W*d+X*x,i[4]=O*a+W*g+X*S,i[5]=O*c+W*y+X*T,i[6]=oe*o+re*d+B*x,i[7]=oe*a+re*g+B*S,i[8]=oe*c+re*y+B*T,i}function ze(){var i=new F(16);return F!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function Xe(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function We(i,e){var r=e[0],o=e[1],a=e[2],c=e[3],d=e[4],g=e[5],y=e[6],x=e[7],S=e[8],T=e[9],I=e[10],R=e[11],D=e[12],O=e[13],W=e[14],X=e[15],oe=r*g-o*d,re=r*y-a*d,B=r*x-c*d,J=o*y-a*g,ie=o*x-c*g,ce=a*x-c*y,Ie=S*O-T*D,Pe=S*W-I*D,Le=S*X-R*D,Ue=T*W-I*O,ct=T*X-R*O,Pt=I*X-R*W,Tt=oe*Pt-re*ct+B*Ue+J*Le-ie*Pe+ce*Ie;return Tt?(i[0]=(g*Pt-y*ct+x*Ue)*(Tt=1/Tt),i[1]=(a*ct-o*Pt-c*Ue)*Tt,i[2]=(O*ce-W*ie+X*J)*Tt,i[3]=(I*ie-T*ce-R*J)*Tt,i[4]=(y*Le-d*Pt-x*Pe)*Tt,i[5]=(r*Pt-a*Le+c*Pe)*Tt,i[6]=(W*B-D*ce-X*re)*Tt,i[7]=(S*ce-I*B+R*re)*Tt,i[8]=(d*ct-g*Le+x*Ie)*Tt,i[9]=(o*Le-r*ct-c*Ie)*Tt,i[10]=(D*ie-O*B+X*oe)*Tt,i[11]=(T*B-S*ie-R*oe)*Tt,i[12]=(g*Pe-d*Ue-y*Ie)*Tt,i[13]=(r*Ue-o*Pe+a*Ie)*Tt,i[14]=(O*re-D*J-W*oe)*Tt,i[15]=(S*J-T*re+I*oe)*Tt,i):null}function De(i,e,r){var o=e[0],a=e[1],c=e[2],d=e[3],g=e[4],y=e[5],x=e[6],S=e[7],T=e[8],I=e[9],R=e[10],D=e[11],O=e[12],W=e[13],X=e[14],oe=e[15],re=r[0],B=r[1],J=r[2],ie=r[3];return i[0]=re*o+B*g+J*T+ie*O,i[1]=re*a+B*y+J*I+ie*W,i[2]=re*c+B*x+J*R+ie*X,i[3]=re*d+B*S+J*D+ie*oe,i[4]=(re=r[4])*o+(B=r[5])*g+(J=r[6])*T+(ie=r[7])*O,i[5]=re*a+B*y+J*I+ie*W,i[6]=re*c+B*x+J*R+ie*X,i[7]=re*d+B*S+J*D+ie*oe,i[8]=(re=r[8])*o+(B=r[9])*g+(J=r[10])*T+(ie=r[11])*O,i[9]=re*a+B*y+J*I+ie*W,i[10]=re*c+B*x+J*R+ie*X,i[11]=re*d+B*S+J*D+ie*oe,i[12]=(re=r[12])*o+(B=r[13])*g+(J=r[14])*T+(ie=r[15])*O,i[13]=re*a+B*y+J*I+ie*W,i[14]=re*c+B*x+J*R+ie*X,i[15]=re*d+B*S+J*D+ie*oe,i}function Ke(i,e,r){var o,a,c,d,g,y,x,S,T,I,R,D,O=r[0],W=r[1],X=r[2];return e===i?(i[12]=e[0]*O+e[4]*W+e[8]*X+e[12],i[13]=e[1]*O+e[5]*W+e[9]*X+e[13],i[14]=e[2]*O+e[6]*W+e[10]*X+e[14],i[15]=e[3]*O+e[7]*W+e[11]*X+e[15]):(a=e[1],c=e[2],d=e[3],g=e[4],y=e[5],x=e[6],S=e[7],T=e[8],I=e[9],R=e[10],D=e[11],i[0]=o=e[0],i[1]=a,i[2]=c,i[3]=d,i[4]=g,i[5]=y,i[6]=x,i[7]=S,i[8]=T,i[9]=I,i[10]=R,i[11]=D,i[12]=o*O+g*W+T*X+e[12],i[13]=a*O+y*W+I*X+e[13],i[14]=c*O+x*W+R*X+e[14],i[15]=d*O+S*W+D*X+e[15]),i}function et(i,e,r){var o=r[0],a=r[1],c=r[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*c,i[9]=e[9]*c,i[10]=e[10]*c,i[11]=e[11]*c,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function st(i,e,r){var o=Math.sin(r),a=Math.cos(r),c=e[4],d=e[5],g=e[6],y=e[7],x=e[8],S=e[9],T=e[10],I=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=c*a+x*o,i[5]=d*a+S*o,i[6]=g*a+T*o,i[7]=y*a+I*o,i[8]=x*a-c*o,i[9]=S*a-d*o,i[10]=T*a-g*o,i[11]=I*a-y*o,i}function $e(i,e,r){var o=Math.sin(r),a=Math.cos(r),c=e[0],d=e[1],g=e[2],y=e[3],x=e[8],S=e[9],T=e[10],I=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*a-x*o,i[1]=d*a-S*o,i[2]=g*a-T*o,i[3]=y*a-I*o,i[8]=c*o+x*a,i[9]=d*o+S*a,i[10]=g*o+T*a,i[11]=y*o+I*a,i}function bt(i,e,r){var o=Math.sin(r),a=Math.cos(r),c=e[0],d=e[1],g=e[2],y=e[3],x=e[4],S=e[5],T=e[6],I=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=c*a+x*o,i[1]=d*a+S*o,i[2]=g*a+T*o,i[3]=y*a+I*o,i[4]=x*a-c*o,i[5]=S*a-d*o,i[6]=T*a-g*o,i[7]=I*a-y*o,i}function St(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function dr(i,e,r){var o,a,c,d=r[0],g=r[1],y=r[2],x=Math.hypot(d,g,y);return x<ne?null:(d*=x=1/x,g*=x,y*=x,o=Math.sin(e),a=Math.cos(e),i[0]=d*d*(c=1-a)+a,i[1]=g*d*c+y*o,i[2]=y*d*c-g*o,i[3]=0,i[4]=d*g*c-y*o,i[5]=g*g*c+a,i[6]=y*g*c+d*o,i[7]=0,i[8]=d*y*c+g*o,i[9]=g*y*c-d*o,i[10]=y*y*c+a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function Fr(i,e){var r=e[0],o=e[1],a=e[2],c=e[3],d=r+r,g=o+o,y=a+a,x=r*d,S=o*d,T=o*g,I=a*d,R=a*g,D=a*y,O=c*d,W=c*g,X=c*y;return i[0]=1-T-D,i[1]=S+X,i[2]=I-W,i[3]=0,i[4]=S-X,i[5]=1-x-D,i[6]=R+O,i[7]=0,i[8]=I+W,i[9]=R-O,i[10]=1-x-T,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var hi=De;function ht(){var i=new F(3);return F!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Zt(i){var e=new F(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function fr(i){return Math.hypot(i[0],i[1],i[2])}function Tr(i,e,r){var o=new F(3);return o[0]=i,o[1]=e,o[2]=r,o}function Or(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function ri(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function fi(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function mr(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i}function Lr(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function or(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function dt(i,e,r,o){return i[0]=e[0]+r[0]*o,i[1]=e[1]+r[1]*o,i[2]=e[2]+r[2]*o,i}function sr(i,e){var r=e[0]-i[0],o=e[1]-i[1],a=e[2]-i[2];return r*r+o*o+a*a}function bi(i){var e=i[0],r=i[1],o=i[2];return e*e+r*r+o*o}function Ai(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i}function qr(i,e){var r=e[0],o=e[1],a=e[2],c=r*r+o*o+a*a;return c>0&&(c=1/Math.sqrt(c)),i[0]=e[0]*c,i[1]=e[1]*c,i[2]=e[2]*c,i}function Gr(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function pi(i,e,r){var o=e[0],a=e[1],c=e[2],d=r[0],g=r[1],y=r[2];return i[0]=a*y-c*g,i[1]=c*d-o*y,i[2]=o*g-a*d,i}function ji(i,e,r,o){var a=e[0],c=e[1],d=e[2];return i[0]=a+o*(r[0]-a),i[1]=c+o*(r[1]-c),i[2]=d+o*(r[2]-d),i}function jr(i,e,r){var o=e[0],a=e[1],c=e[2],d=r[3]*o+r[7]*a+r[11]*c+r[15];return i[0]=(r[0]*o+r[4]*a+r[8]*c+r[12])/(d=d||1),i[1]=(r[1]*o+r[5]*a+r[9]*c+r[13])/d,i[2]=(r[2]*o+r[6]*a+r[10]*c+r[14])/d,i}function Dn(i,e,r){var o=e[0],a=e[1],c=e[2];return i[0]=o*r[0]+a*r[3]+c*r[6],i[1]=o*r[1]+a*r[4]+c*r[7],i[2]=o*r[2]+a*r[5]+c*r[8],i}function Xn(i,e,r){var o=r[0],a=r[1],c=r[2],d=e[0],g=e[1],y=e[2],x=a*y-c*g,S=c*d-o*y,T=o*g-a*d,I=a*T-c*S,R=c*x-o*T,D=o*S-a*x,O=2*r[3];return S*=O,T*=O,R*=2,D*=2,i[0]=d+(x*=O)+(I*=2),i[1]=g+S+R,i[2]=y+T+D,i}function xo(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]}var zi=ri,ts=fi,zs=fr;function no(){var i=new F(4);return F!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function fs(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i}function rs(i,e){var r=e[0],o=e[1],a=e[2],c=e[3],d=r*r+o*o+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),i[0]=r*d,i[1]=o*d,i[2]=a*d,i[3]=c*d,i}function eo(i,e,r){var o=e[0],a=e[1],c=e[2],d=e[3];return i[0]=r[0]*o+r[4]*a+r[8]*c+r[12]*d,i[1]=r[1]*o+r[5]*a+r[9]*c+r[13]*d,i[2]=r[2]*o+r[6]*a+r[10]*c+r[14]*d,i[3]=r[3]*o+r[7]*a+r[11]*c+r[15]*d,i}function po(){var i=new F(4);return F!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function ko(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function mo(i,e,r){r*=.5;var o=e[0],a=e[1],c=e[2],d=e[3],g=Math.sin(r),y=Math.cos(r);return i[0]=o*y+d*g,i[1]=a*y+c*g,i[2]=c*y-a*g,i[3]=d*y-o*g,i}function oo(i,e,r){r*=.5;var o=e[0],a=e[1],c=e[2],d=e[3],g=Math.sin(r),y=Math.cos(r);return i[0]=o*y-c*g,i[1]=a*y+d*g,i[2]=c*y+o*g,i[3]=d*y-a*g,i}ht(),no();var yo,Ao,Ws,ps,Ho,is=rs,Lo=(yo=ht(),Ao=Tr(1,0,0),Ws=Tr(0,1,0),function(i,e,r){var o=Gr(e,r);return o<-.999999?(pi(yo,Ao,e),zs(yo)<1e-6&&pi(yo,Ws,e),qr(yo,yo),function(a,c,d){d*=.5;var g=Math.sin(d);a[0]=g*c[0],a[1]=g*c[1],a[2]=g*c[2],a[3]=Math.cos(d)}(i,yo,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(pi(yo,e,r),i[0]=yo[0],i[1]=yo[1],i[2]=yo[2],i[3]=1+o,is(i,i))});function co(){var i=new F(2);return F!=Float32Array&&(i[0]=0,i[1]=0),i}function Os(i,e){var r=new F(2);return r[0]=i,r[1]=e,r}function ns(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i}function ms(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i}function ra(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i}function os(i){return Math.hypot(i[0],i[1])}function ia(i,e){var r=e[0],o=e[1],a=r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),i[0]=e[0]*a,i[1]=e[1]*a,i}function Qi(i,e){return i[0]*e[0]+i[1]*e[1]}function to(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}po(),po(),qe(),co();var Es,so,xr=function(){if(Ho)return ps;function i(e,r,o,a){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(a-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=o,this.p2y=a}return Ho=1,ps=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,a=0;a<8;a++){var c=this.sampleCurveX(o)-e;if(Math.abs(c)<r)return o;var d=this.sampleCurveDerivativeX(o);if(Math.abs(d)<1e-6)break;o-=c/d}var g=0,y=1;for(o=e,a=0;a<20&&(c=this.sampleCurveX(o),!(Math.abs(c-e)<r));a++)e>c?g=o:y=o,o=.5*(y-g)+g;return o},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},ps}(),Oi=to(xr);function un(){if(so)return Es;function i(e,r){this.x=e,this.y=r}return so=1,Es=i,i.prototype={clone:function(){return new i(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,o=e.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),o=Math.sin(e),a=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=a,this},_rotateAround:function(e,r){var o=Math.cos(e),a=Math.sin(e),c=r.y+a*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-a*(this.y-r.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},i.convert=function(e){return e instanceof i?e:Array.isArray(e)?new i(e[0],e[1]):e},Es}var Ot=to(un());function pn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(!pn(i[r],e[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const r in i)if(!pn(i[r],e[r]))return!1;return!0}return i===e}const gs=Math.PI/180,ot=180/Math.PI;function G(i){return i*gs}function K(i){return i*ot}const ge=[[0,0],[1,0],[1,1],[0,1]];function Ce(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function Me(i,e,r,o){const a=new Oi(i,e,r,o);return function(c){return a.solve(c)}}const Re=Me(.25,.1,.25,1);function ke(i,e,r){return Math.min(r,Math.max(e,i))}function Fe(i,e,r){return(r=ke((r-i)/(e-i),0,1))*r*(3-2*r)}function Qe(i,e,r){const o=r-e,a=((i-e)%o+o)%o+e;return a===e?r:a}function _t(i,e,r){if(!i.length)return r(null,[]);let o=i.length;const a=new Array(i.length);let c=null;i.forEach((d,g)=>{e(d,(y,x)=>{y&&(c=y),a[g]=x,--o==0&&r(c,a)})})}function Je(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}let Ht=1;function Qt(){return Ht++}function lr(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Nr(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Wr(i,e,r){const o={};for(const a in i)o[a]=e.call(this,i[a],a,i);return o}function Zr(i,e,r){const o={};for(const a in i)e.call(this,i[a],a,i)&&(o[a]=i[a]);return o}function Xr(i){return Array.isArray(i)?i.map(Xr):typeof i=="object"&&i?Wr(i,Xr):i}const nn={};function Jr(i){nn[i]||(typeof console<"u"&&console.warn(i),nn[i]=!0)}function Wi(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Mi(i){let e=0;for(let r,o,a=0,c=i.length,d=c-1;a<c;d=a++)r=i[a],o=i[d],e+=(o.x-r.x)*(r.y+o.y);return e}function ii([i,e,r]){const o=G(e+90),a=G(r);return{x:i*Math.cos(o)*Math.sin(a),y:i*Math.sin(o)*Math.sin(a),z:i*Math.cos(a),azimuthal:e,polar:r}}function Pi(i){return(typeof self<"u"||i!==void 0)&&typeof WorkerGlobalScope<"u"&&(i!==void 0?i:self)instanceof WorkerGlobalScope}function wn(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,a,c)=>{const d=a||c;return e[o]=!d||d.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let On=null;function Vn(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}function go(i,e,r,o){for(;e<r;){const a=e+r>>1;i[a]<o?e=a+1:r=a}return e}function $o(i,e,r,o){for(;e<r;){const a=e+r>>1;i[a]<=o?e=a+1:r=a}return e}function Gn(i){return i>0?1/(1.001-i):1+i}function Fn(i){return i>0?1-1/(1.001-i):-i}function Yn(i,e,r){return(i-e.min)*(r.max-r.min)/(e.max-e.min)+r.min}const mn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!mn.API_URL)return null;try{const i=new URL(mn.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Is(i){return mn.API_URL_REGEX.test(i)}function na(i){return mn.API_SPRITE_REGEX.test(i)}let $a,As,Sa,Zs,Cs,j;function te(){return $a==null&&($a=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),$a}const we={now:()=>Zs!==void 0?Zs:performance.now(),setNow(i){Zs=i},restoreNow(){Zs=void 0},frame(i){const e=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(i,e=0){const{width:r,height:o}=i;Cs||(Cs=document.createElement("canvas"));const a=Cs.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(r>Cs.width||o>Cs.height)&&(Cs.width=r,Cs.height=o),a.clearRect(-e,-e,r+2*e,o+2*e),a.drawImage(i,0,0,r,o),a.getImageData(-e,-e,r+2*e,o+2*e)},resolveURL:i=>(As||(As=document.createElement("a")),As.href=i,As.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Sa==null&&(Sa=window.matchMedia("(prefers-reduced-motion: reduce)")),Sa.matches)},hasCanvasFingerprintNoise(){if(j!==void 0)return j;if(!te())return j=!1,!1;const i=new OffscreenCanvas(85,1),e=i.getContext("2d",{willReadFrequently:!0});let r=0;for(let a=0;a<i.width;++a)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(a,0,1,1);const o=e.getImageData(0,0,i.width,i.height);r=0;for(let a=0;a<o.data.length;++a)if(a%4!=3&&r++!==o.data[a])return j=!0,!0;return j=!1,!1}};function Be(i,e){const r=i.indexOf("?");if(r<0)return`${i}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(i.slice(r));for(const a in e)o.set(a,e[a]);return`${i.slice(0,r)}?${o.toString()}`}function Ct(i,e={persistentParams:[]}){const r=i.indexOf("?");if(r<0)return i;const o=new URLSearchParams,a=new URLSearchParams(i.slice(r));for(const d of e.persistentParams){const g=a.get(d);g&&o.set(d,g)}const c=o.toString();return`${i.slice(0,r)}${c.length>0?`?${c}`:""}`}const wt="mapbox-tiles";let Yt=500,Cr=50;const kr=["language","worldview","jobid"];let mi,Vi;function jn(){try{return caches}catch{}}function bo(){const i=jn();i&&mi==null&&(mi=i.open(wt))}let ss=1/0;const as={supported:!1,testSupport:function(i){!_s&&Hn&&(Wo?Bs(i):Fs=i)}};let Fs,Hn,_s=!1,Wo=!1;const ls=typeof self<"u"?self:{};function Bs(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Hn),i.isContextLost())return;as.supported=!0}catch{}i.deleteTexture(e),_s=!0}ls.document&&(Hn=ls.document.createElement("img"),Hn.onload=function(){Fs&&Bs(Fs),Fs=null,Wo=!0},Hn.onerror=function(){_s=!0,Fs=null},Hn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const oa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(oa);class sa extends Error{constructor(e,r,o){r===401&&Is(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ki=Pi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Bl=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(ki())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,a){const c=new AbortController,d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:ki(),referrerPolicy:o.referrerPolicy,signal:c.signal});let g=!1,y=!1;const x=(S=d.url).indexOf("sku=")>0&&Is(S);var S;o.type==="json"&&d.headers.set("Accept","application/json");const T=(R,D,O)=>{if(y)return;if(R&&R.message!=="SecurityError"&&Jr(R.toString()),D&&O)return I(D);const W=Date.now();fetch(d).then(X=>{if(X.ok){const oe=x?X.clone():null;return I(X,oe,W)}return a(new sa(X.statusText,X.status,o.url))}).catch(X=>{X.name!=="AbortError"&&a(new Error(`${X.message} ${o.url}`))})},I=(R,D,O)=>{(o.type==="arrayBuffer"?R.arrayBuffer():o.type==="json"?R.json():R.text()).then(W=>{y||(D&&O&&function(X,oe,re){if(bo(),mi==null)return;const B=wn(oe.headers.get("Cache-Control")||"");if(B["no-store"])return;const J={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((Ie,Pe)=>J.headers.set(Pe,Ie)),B["max-age"]&&J.headers.set("Expires",new Date(re+1e3*B["max-age"]).toUTCString());const ie=J.headers.get("Expires");if(!ie||new Date(ie).getTime()-re<42e4)return;let ce=Ct(X.url,{persistentParams:kr});if(oe.status===206){const Ie=X.headers.get("Range");if(!Ie)return;J.status=200,ce=Be(ce,{range:Ie})}(function(Ie,Pe){if(Vi===void 0)try{new Response(new ReadableStream),Vi=!0}catch{Vi=!1}Vi?Pe(Ie.body):Ie.blob().then(Pe).catch(Le=>Jr(Le.message))})(oe,Ie=>{const Pe=new Response((Le=oe.status)!==200&&Le!==404&&[101,103,204,205,304].includes(Le)?null:Ie,J);var Le;bo(),mi!=null&&mi.then(Ue=>Ue.put(ce,Pe)).catch(Ue=>Jr(Ue.message))})}(d,D,O),g=!0,a(null,W,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(W=>{y||a(new Error(W.message))})};return x?function(R,D){if(bo(),mi==null)return D(null);mi.then(O=>{let W=Ct(R.url,{persistentParams:kr});const X=R.headers.get("Range");X&&(W=Be(W,{range:X})),O.match(W).then(oe=>{const re=function(B){if(!B)return!1;const J=new Date(B.headers.get("Expires")||0),ie=wn(B.headers.get("Cache-Control")||"");return Number(J)>Date.now()&&!ie["no-cache"]}(oe);O.delete(W).catch(D),re&&O.put(W,oe.clone()).catch(D),D(null,oe,re)}).catch(D)}).catch(D)}(d,T):T(null,null),{cancel:()=>{y=!0,g||c.abort()}}}(i,e);if(Pi(self)&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(o,a){const c=new XMLHttpRequest;c.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const d in o.headers)c.setRequestHeader(d,o.headers[d]);return o.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=o.credentials==="include",c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let d=c.response;if(o.type==="json")try{d=JSON.parse(c.response)}catch(g){return a(g)}a(null,d,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new sa(c.statusText,c.status,o.url))},c.send(o.body),{cancel:()=>c.abort()}}(i,e)},Ta=function(i,e){return Bl(Je(i,{type:"arrayBuffer"}),e)};function Vd(i){const e=document.createElement("a");return e.href=i,e.protocol===location.protocol&&e.host===location.host}const aa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Xs,Ys;Xs=[],Ys=0;const Mn=function(i,e){if(as.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Ys>=mn.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Xs.push(c),c}Ys++;let r=!1;const o=()=>{if(!r)for(r=!0,Ys--;Xs.length&&Ys<mn.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Xs.shift(),{requestParameters:d,callback:g,cancelled:y}=c;y||(c.cancel=Mn(d,g).cancel)}},a=Ta(i,(c,d,g,y)=>{o(),c?e(c):d&&(self.createImageBitmap?function(x,S){const T=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(T).then(I=>{S(null,I)}).catch(I=>{S(new Error(`Could not load image because of ${I.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(x,S)=>e(x,S,g,y)):function(x,S){const T=new Image;T.onload=()=>{S(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=aa})},T.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const I=new Blob([new Uint8Array(x)],{type:"image/png"});T.src=x.byteLength?URL.createObjectURL(I):aa}(d,(x,S)=>e(x,S,g,y)))});return{cancel:()=>{a.cancel(),o()}}};var Ea,Ia,us,ys={exports:{}},Wa={exports:{}},Aa={exports:{}},su=function(){if(us)return ys.exports;us=1;var i=(Ea||(Ea=1,Wa.exports=function(r,o){var a,c,d,g,y,x,S,T;for(c=r.length-(a=3&r.length),d=o,y=3432918353,x=461845907,T=0;T<c;)S=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,d=27492+(65535&(g=5*(65535&(d=(d^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(S=0,a){case 3:S^=(255&r.charCodeAt(T+2))<<16;case 2:S^=(255&r.charCodeAt(T+1))<<8;case 1:d^=S=(65535&(S=(S=(65535&(S^=255&r.charCodeAt(T)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*x+(((S>>>16)*x&65535)<<16)&4294967295}return d^=r.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),Wa.exports),e=(Ia||(Ia=1,Aa.exports=function(r,o){for(var a,c=r.length,d=o^c,g=0;c>=4;)a=1540483477*(65535&(a=255&r.charCodeAt(g)|(255&r.charCodeAt(++g))<<8|(255&r.charCodeAt(++g))<<16|(255&r.charCodeAt(++g))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),c-=4,++g;switch(c){case 3:d^=(255&r.charCodeAt(g+2))<<16;case 2:d^=(255&r.charCodeAt(g+1))<<8;case 1:d=1540483477*(65535&(d^=255&r.charCodeAt(g)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),Aa.exports);return ys.exports=i,ys.exports.murmur3=i,ys.exports.murmur2=e,ys.exports}(),Co=to(su);class Ks{constructor(e,...r){Je(this,r[0]||{}),this.type=e}}class Ou extends Ks{constructor(e,r={}){super("error",Je({error:e},r))}}function la(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function Nl(i,e,r){if(r&&r[i]){const o=r[i].indexOf(e);o!==-1&&r[i].splice(o,1)}}class Ca{on(e,r){return this._listeners=this._listeners||{},la(e,r,this._listeners),this}off(e,r){return Nl(e,r,this._listeners),Nl(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},la(e,r,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,r){const o=typeof e=="string"?new Ks(e,r):e,a=o.type;if(this.listens(a)){o.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,o);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of d)Nl(a,y,this._oneTimeListeners),y.call(this,o);const g=this._eventedParent;g&&(Je(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(o))}else o instanceof Ou&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class vs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new vs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,o]=e.split("");return new vs({name:r,iconsetId:o})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return vs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Za,hl={},Xa=function(){if(Za)return hl;Za=1;var i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(c){return(c=Math.round(c))<0?0:c>255?255:c}function r(c){return e(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function o(c){return(d=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:d>1?1:d;var d}function a(c,d,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?c+(d-c)*g*6:2*g<1?d:3*g<2?c+(d-c)*(2/3-g)*6:c}try{hl.parseCSSColor=function(c){var d,g=c.replace(/ /g,"").toLowerCase();if(g in i)return i[g].slice();if(g[0]==="#")return g.length===4?(d=parseInt(g.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:g.length===7&&(d=parseInt(g.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var y=g.indexOf("("),x=g.indexOf(")");if(y!==-1&&x+1===g.length){var S=g.substr(0,y),T=g.substr(y+1,x-(y+1)).split(","),I=1;switch(S){case"rgba":if(T.length!==4)return null;I=o(T.pop());case"rgb":return T.length!==3?null:[r(T[0]),r(T[1]),r(T[2]),I];case"hsla":if(T.length!==4)return null;I=o(T.pop());case"hsl":if(T.length!==3)return null;var R=(parseFloat(T[0])%360+360)%360/360,D=o(T[1]),O=o(T[2]),W=O<=.5?O*(D+1):O+D-O*D,X=2*O-W;return[e(255*a(X,W,R+1/3)),e(255*a(X,W,R)),e(255*a(X,W,R-1/3)),I];default:return null}}return null}}catch{}return hl}();class ai{constructor(e,r,o,a=1){this.r=e,this.g=r,this.b=o,this.a=a}static parse(e){if(!e)return;if(e instanceof ai)return e;if(typeof e!="string")return;const r=Xa.parseCSSColor(e);return r?new ai(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toStringPremultipliedAlpha(){const[e,r,o,a]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(o)},${a})`}toString(){const[e,r,o,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*o)},${a})`}toRenderColor(e){const{r,g:o,b:a,a:c}=this;return new Vl(e,r,o,a,c)}clone(){return new ai(this.r,this.g,this.b,this.a)}}class Vl{constructor(e,r,o,a,c){if(e){const d=e.image.height,g=d*d;r=c===0?0:r/c*(d-1),o=c===0?0:o/c*(d-1),a=c===0?0:a/c*(d-1);const y=Math.floor(r),x=Math.floor(o),S=Math.floor(a),T=Math.ceil(r),I=Math.ceil(o),R=Math.ceil(a),D=r-y,O=o-x,W=a-S,X=e.image.data,oe=4*(y+x*g+S*d),re=4*(y+x*g+R*d),B=4*(y+I*g+S*d),J=4*(y+I*g+R*d),ie=4*(T+x*g+S*d),ce=4*(T+x*g+R*d),Ie=4*(T+I*g+S*d),Pe=4*(T+I*g+R*d);if(oe<0||Pe>=X.length)throw new Error("out of range");this.r=Mr(Mr(Mr(X[oe],X[re],W),Mr(X[B],X[J],W),O),Mr(Mr(X[ie],X[ce],W),Mr(X[Ie],X[Pe],W),O),D)/255*c,this.g=Mr(Mr(Mr(X[oe+1],X[re+1],W),Mr(X[B+1],X[J+1],W),O),Mr(Mr(X[ie+1],X[ce+1],W),Mr(X[Ie+1],X[Pe+1],W),O),D)/255*c,this.b=Mr(Mr(Mr(X[oe+2],X[re+2],W),Mr(X[B+2],X[J+2],W),O),Mr(Mr(X[ie+2],X[ce+2],W),Mr(X[Ie+2],X[Pe+2],W),O),D)/255*c,this.a=c}else this.r=r,this.g=o,this.b=a,this.a=c}toArray(){const{r:e,g:r,b:o,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*r/a,255*o/a,a]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:r,b:o,a}=this,c=Math.min(Math.max(e/a,0),1),d=Math.min(Math.max(r/a,0),1),g=Math.min(Math.max(o/a,0),1),y=Math.min(c,d,g),x=Math.max(c,d,g),S=(y+x)/2;if(y===x)return[0,0,100*S,a];const T=x-y,I=S>.5?T/(2-x-y):T/(x+y);let R=0;return x===c?R=(d-g)/T+(d<g?6:0):x===d?R=(g-c)/T+2:x===g&&(R=(c-d)/T+4),R*=60,[Math.min(Math.max(R,0),360),Math.min(Math.max(100*I,0),100),Math.min(Math.max(100*S,0),100),a]}toArray01(){const{r:e,g:r,b:o,a}=this;return a===0?[0,0,0,0]:[e/a,r/a,o/a,a]}toArray01Scaled(e){const{r,g:o,b:a,a:c}=this;return c===0?[0,0,0]:[r/c*e,o/c*e,a/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:o,a}=this;return[e,r,o,a]}toArray01Linear(){const{r:e,g:r,b:o,a}=this;return a===0?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(r/a,2.2),Math.pow(o/a,2.2),a]}}function Mr(i,e,r){return i*(1-r)+e*r}function au(i,e,r){return i.map((o,a)=>Mr(o,e[a],r))}function lu(i){return i*i*i*i*i}ai.black=new ai(0,0,0,1),ai.white=new ai(1,1,1,1),ai.transparent=new ai(0,0,0,0),ai.red=new ai(1,0,0,1),ai.blue=new ai(0,0,1,1);var Ya=Object.freeze({__proto__:null,array:au,color:function(i,e,r){return new ai(Mr(i.r,e.r,r),Mr(i.g,e.g,r),Mr(i.b,e.b,r),Mr(i.a,e.a,r))},easeIn:lu,number:Mr});function ua(i,...e){for(const r of e)for(const o in r)i[o]=r[o];return i}class Mo extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class ca{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[o,a]of r)this.bindings[o]=a}concat(e){return new ca(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ma={kind:"null"},Sr={kind:"number"},Hi={kind:"string"},xi={kind:"boolean"},zo={kind:"color"},Pa={kind:"object"},Ui={kind:"value"},dl={kind:"collator"},fl={kind:"formatted"},uu={kind:"resolvedImage"};function Oo(i,e){return{kind:"array",itemType:i,N:e}}function $n(i){if(i.kind==="array"){const e=$n(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const _c=[Ma,Sr,Hi,xi,zo,fl,Pa,Oo(Ui),uu];function cu(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!cu(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const r of _c)if(!cu(r,e))return null}}return`Expected ${$n(i)} but found ${$n(e)} instead.`}function yc(i,e){return e.some(r=>r.kind===i.kind)}function Ka(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}class Ra{constructor(e,r,o){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fu{constructor(e,r,o,a,c){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=o,this.fontStack=a,this.textColor=c}}class N{constructor(e){this.sections=e}static fromString(e){return new N([new Fu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof N?e:N.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const a=r.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(r.text);const o={};r.fontStack&&(o["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(o["font-scale"]=r.scale),r.textColor&&(o["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(o)}return e}}class Q{constructor(e,r={}){if(this.id=vs.from(e),this.options=Object.assign({},r),r.transform){const{a:o,b:a,c,d,e:g,f:y}=r.transform;this.options.transform=new DOMMatrix([o,a,c,d,g,y])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:o,d:a,e:c,f:d}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:o,d:a,e:c,f:d}})}static parse(e){let r,o,a,c;try{({name:r,iconsetId:o,params:a,transform:c}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:d,b:g,c:y,d:x,e:S,f:T}=c||{};return new Q({name:r,iconsetId:o},{params:a,transform:new DOMMatrix([d,g,y,x,S,T])})}scaleSelf(e,r){return this.options.transform.scaleSelf(e,r),this}}class ve{constructor(e,r,o,a,c=!1){this.primaryId=vs.from(e),this.primaryOptions=r,o&&(this.secondaryId=vs.from(o)),this.secondaryOptions=a,this.available=c}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Q(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Q(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ve.build({name:e}):e}static build(e,r,o,a){return!e||typeof e=="object"&&!("name"in e)?null:new ve(e,o,r,a)}}function Oe(i,e,r,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,r,o]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zt(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ai||i instanceof Ra||i instanceof N||i instanceof ve)return!0;if(Array.isArray(i)){for(const e of i)if(!zt(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!zt(i[e]))return!1;return!0}return!1}function xt(i){if(i===null)return Ma;if(typeof i=="string")return Hi;if(typeof i=="boolean")return xi;if(typeof i=="number")return Sr;if(i instanceof ai)return zo;if(i instanceof Ra)return dl;if(i instanceof N)return fl;if(i instanceof ve)return uu;if(Array.isArray(i)){const e=i.length;let r;for(const o of i){const a=xt(o);if(r){if(r===a)continue;r=Ui;break}r=a}return Oo(r||Ui,e)}return Pa}function Xt(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof ai?i.toStringPremultipliedAlpha():i instanceof N||i instanceof ve?i.toString():JSON.stringify(i)}class Ft{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zt(e[1]))return r.error("invalid value");const o=e[1];let a=xt(o);const c=r.expectedType;return a.kind!=="array"||a.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(a=c),new Ft(a,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ai?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof N?this.value.serialize():this.value}}class Rt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const qi={string:Hi,number:Sr,boolean:xi,object:Pa};class rr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let o,a=1;const c=e[0];if(c==="array"){let g,y;if(e.length>2){const x=e[1];if(typeof x!="string"||!(x in qi)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=qi[x],a++}else g=Ui;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=e[2],a++}o=Oo(g,y)}else o=qi[c];const d=[];for(;a<e.length;a++){const g=r.parse(e[a],a,Ui);if(!g)return null;d.push(g)}return new rr(o,d)}evaluate(e){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(e);if(!cu(this.type,xt(o)))return o;if(r===this.args.length-1)throw new Rt(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${$n(xt(o))} but was expected to be of type ${$n(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){r.push(o.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(o=>o.serialize()))}}class Pn{constructor(e){this.type=fl,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const a=[];let c=!1;for(let d=1;d<=e.length-1;++d){const g=e[d];if(c&&typeof g=="object"&&!Array.isArray(g)){c=!1;let y=null;if(g["font-scale"]&&(y=r.parseObjectValue(g["font-scale"],d,"font-scale",Sr),!y))return null;let x=null;if(g["text-font"]&&(x=r.parseObjectValue(g["text-font"],d,"text-font",Oo(Hi)),!x))return null;let S=null;if(g["text-color"]&&(S=r.parseObjectValue(g["text-color"],d,"text-color",zo),!S))return null;const T=a[a.length-1];T.scale=y,T.font=x,T.textColor=S}else{const y=r.parse(e[d],d,Ui);if(!y)return null;const x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new Pn(a)}evaluate(e){return new N(this.sections.map(r=>{const o=r.content.evaluate(e);return xt(o)===uu?new Fu("",o,null,null,null):new Fu(Xt(o),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const o={};r.scale&&(o["font-scale"]=r.scale.serialize()),r.font&&(o["text-font"]=r.font.serialize()),r.textColor&&(o["text-color"]=r.textColor.serialize()),e.push(o)}return e}}class Po{constructor(e,r,o,a){this._imageWarnHistory={},this.type=uu,this.namePrimary=e,this.nameSecondary=r,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let o=1;const a=[];function c(){if(o<e.length){const g=r.parse(e[o],o++,Hi);return g?(a.push({image:g,options:{}}),!0):(r.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(o<e.length){const y=e[o];if((g=y)===null||typeof g!="object"||Array.isArray(g))return!0;const x=y.params,S=y.iconset,T=r.concat(o);if(!x&&!S)return o++,!0;if(x){if(typeof x!="object"||x.constructor!==Object)return T.error('Image options "params" should be an object'),!1;const I={},R=T.concat(void 0,"params");for(const D in x){if(!D)return R.error("Image parameter name should be non-empty"),!1;const O=R.concat(void 0,D).parse(x[D],void 0,zo,void 0,{typeAnnotation:"coerce"});if(!O)return!1;I[D]=O}a[a.length-1].options.params=I}if(S){if(typeof S!="object"||S.constructor!==Object)return T.error('Image options "iconset" should be an object'),!1;if(!S.id)return T.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=S}return o++,!0}var g;return!0}for(let g=0;g<2;g++)if(!c()||!d())return;return new Po(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,r){const o={};if(r){for(const a in r)if(r[a])try{o[a]=r[a].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=ve.build(r,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){const c=a.getPrimary().id;if(a.available=e.availableImages.some(d=>vs.isEqual(d,c)),a.available){const d=a.getSecondary()?a.getSecondary().id:null;d&&(a.available=e.availableImages.some(g=>vs.isEqual(g,d)))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const o={};if(r&&(o.iconset={id:r}),e){o.params={};for(const a in e)e[a]&&(o.params[a]=e[a].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function Dr(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}const Ns={"to-boolean":xi,"to-color":zo,"to-number":Sr,"to-string":Hi};class xs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const o=e[0],a=[];let c=Ma;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);c=Oo(r.expectedType.itemType,d)}else{if(!(d>0&&zt(e[1][0])))return null;c=Oo(xt(e[1][0]),d)}for(let g=0;g<d;g++){const y=e[1][g];let x;if(Dr(y)==="array")x=r.parse(y,void 0,c.itemType);else{const S=Dr(y);if(S!==c.itemType.kind)return r.error(`Expected ${c.itemType.kind} but found ${S}.`);x=r.registry.literal.parse(["literal",y===void 0?null:y],r)}if(!x)return null;a.push(x)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return r.error("Expected one argument.");c=Ns[o];for(let d=1;d<e.length;d++){const g=r.parse(e[d],d,Ui);if(!g)return null;a.push(g)}}return new xs(c,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,o;for(const a of this.args){if(r=a.evaluate(e),o=null,r instanceof ai)return r;if(typeof r=="string"){const c=e.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Oe(r[0],r[1],r[2],r[3]),!o))return new ai(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Rt(o||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const o of this.args){if(r=o.evaluate(e),r===null)return 0;const a=Number(r);if(!isNaN(a))return a}throw new Rt(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?N.fromString(Xt(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ve.build(Xt(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Xt(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Pn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Po(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const vc=["Unknown","Point","LineString","Polygon"];class ha{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:o,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*r-e[0])+this.featureDistanceData.bearing[1]*(a*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ai.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class bs{constructor(e,r,o,a,c){this.name=e,this.type=r,this._evaluate=o,this.args=a,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const r=bs.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const o=e[0],a=bs.definitions[o];if(!a)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,g=[];let y=null,x=-1;for(const[S,T]of d){if(Array.isArray(S)&&S.length!==e.length-1)continue;g.push(S),x++,y=new Xd(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const I=[];let R=!1;for(let D=1;D<e.length;D++){const O=e[D],W=Array.isArray(S)?S[D-1]:S.type,X=y.parse(O,1+I.length,W);if(!X){R=!0;break}I.push(X)}if(!R)if(Array.isArray(S)&&S.length!==I.length)y.error(`Expected ${S.length} arguments, but found ${I.length} instead.`);else{for(let D=0;D<I.length;D++){const O=Array.isArray(S)?S[D]:S.type,W=I[D];y.concat(D+1).checkSubtype(O,W.type)}if(y.errors.length===0)return new bs(o,c,T,I,x)}}if(g.length===1)r.errors.push(...y.errors);else{const S=(g.length?g:d.map(([I])=>I)).map(Ms).join(" | "),T=[];for(let I=1;I<e.length;I++){const R=r.parse(e[I],1+T.length);if(!R)return null;T.push($n(R.type))}r.error(`Expected arguments of type ${S}, but found (${T.join(", ")}) instead.`)}return null}static register(e,r){bs.definitions=r;for(const o in r)e[o]=bs}}function Ms(i){return Array.isArray(i)?`(${i.map($n).join(", ")})`:`(${$n(i.type)}...)`}class xc{constructor(e,r,o){this.type=dl,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const a=o["case-sensitive"]===void 0?r.parse(!1,1,xi):r.parseObjectValue(o["case-sensitive"],1,"case-sensitive",xi);if(!a)return null;const c=o["diacritic-sensitive"]===void 0?r.parse(!1,1,xi):r.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",xi);if(!c)return null;let d=null;return o.locale&&(d=r.parseObjectValue(o.locale,1,"locale",Hi),!d)?null:new xc(a,c,d)}evaluate(e){return new Ra(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function jl(i,e,r=0,o=i.length-1,a=Ja){for(;o>r;){if(o-r>600){const y=o-r+1,x=e-r+1,S=Math.log(y),T=.5*Math.exp(2*S/3),I=.5*Math.sqrt(S*T*(y-T)/y)*(x-y/2<0?-1:1);jl(i,e,Math.max(r,Math.floor(e-x*T/y+I)),Math.min(o,Math.floor(e+(y-x)*T/y+I)),a)}const c=i[e];let d=r,g=o;for(hu(i,r,e),a(i[o],c)>0&&hu(i,r,o);d<g;){for(hu(i,d,g),d++,g--;a(i[d],c)<0;)d++;for(;a(i[g],c)>0;)g--}a(i[r],c)===0?hu(i,r,g):(g++,hu(i,g,o)),g<=e&&(r=g+1),e<=g&&(o=g-1)}}function hu(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}function Ja(i,e){return i<e?-1:i>e?1:0}function Fo(i){let e=0;for(let r,o,a=0,c=i.length,d=c-1;a<c;d=a++)r=i[a],o=i[d],e+=(o.x-r.x)*(r.y+o.y);return e}function oh(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function du(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function dp(i,e,r){const o=i[0]-e[0],a=i[1]-e[1],c=i[0]-r[0],d=i[1]-r[1];return o*d-c*a==0&&o*c<=0&&a*d<=0}function pl(i,e,r=!1){let o=!1;for(let g=0,y=e.length;g<y;g++){const x=e[g];for(let S=0,T=x.length,I=T-1;S<T;I=S++){const R=x[I],D=x[S];if(dp(i,R,D))return r;(c=R)[1]>(a=i)[1]!=(d=D)[1]>a[1]&&a[0]<(d[0]-c[0])*(a[1]-c[1])/(d[1]-c[1])+c[0]&&(o=!o)}}var a,c,d;return o}function sh(i,e,r,o){const a=o[0]-r[0],c=o[1]-r[1],d=(i[0]-r[0])*c-a*(i[1]-r[1]),g=(e[0]-r[0])*c-a*(e[1]-r[1]);return d>0&&g<0||d<0&&g>0}function Da(i,e,r,o){return(a=[o[0]-r[0],o[1]-r[1]])[0]*(c=[e[0]-i[0],e[1]-i[1]])[1]-a[1]*c[0]!=0&&!(!sh(i,e,r,o)||!sh(r,o,i,e));var a,c}function Xh(i){const e=new Ot(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new Ot(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of i[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),r.x<o.x&&(r.x=o.x),r.y<o.y&&(r.y=o.y);return{min:e,max:r}}const Ul=8192;function Of(i,e){const r=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(r*a*Ul),Math.round(o*a*Ul)]}function fp(i,e){for(let r=0;r<e.length;r++)if(pl(i,e[r]))return!0;return!1}function Ff(i,e,r){for(const o of r)for(let a=0,c=o.length,d=c-1;a<c;d=a++)if(Da(i,e,o[d],o[a]))return!0;return!1}function Bf(i,e){for(let r=0;r<i.length;++r)if(!pl(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(Ff(i[r],i[r+1],e))return!1;return!0}function pp(i,e){for(let r=0;r<e.length;r++)if(Bf(i,e[r]))return!0;return!1}function Yh(i,e,r){const o=[];for(let a=0;a<i.length;a++){const c=[];for(let d=0;d<i[a].length;d++){const g=Of(i[a][d],r);oh(e,g),c.push(g)}o.push(c)}return o}function ka(i,e,r){const o=[];for(let a=0;a<i.length;a++){const c=Yh(i[a],e,r);o.push(c)}return o}function La(i,e,r,o){if(i[0]<r[0]||i[0]>r[2]){const a=.5*o;let c=i[0]-r[0]>a?-o:r[0]-i[0]>a?o:0;c===0&&(c=i[0]-r[2]>a?-o:r[2]-i[0]>a?o:0),i[0]+=c}oh(e,i)}function jd(i,e,r,o){const a=Math.pow(2,o.z)*Ul,c=[o.x*Ul,o.y*Ul],d=[];if(!i)return d;for(const g of i)for(const y of g){const x=[y.x+c[0],y.y+c[1]];La(x,e,r,a),d.push(x)}return d}function Ud(i,e,r,o){const a=Math.pow(2,o.z)*Ul,c=[o.x*Ul,o.y*Ul],d=[];if(!i)return d;for(const y of i){const x=[];for(const S of y){const T=[S.x+c[0],S.y+c[1]];oh(e,T),x.push(T)}d.push(x)}if(e[2]-e[0]<=a/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const y of d)for(const x of y)La(x,e,r,a)}var g;return d}class ml{constructor(e,r){this.type=xi,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zt(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let a=0;a<o.features.length;++a){const c=o.features[a].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ml(o,o.features[a].geometry)}else if(o.type==="Feature"){const a=o.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new ml(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ml(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,o){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const g=Yh(o.coordinates,c,d),y=jd(r.geometry(),a,c,d);if(!du(a,c))return!1;for(const x of y)if(!pl(x,g))return!1}if(o.type==="MultiPolygon"){const g=ka(o.coordinates,c,d),y=jd(r.geometry(),a,c,d);if(!du(a,c))return!1;for(const x of y)if(!fp(x,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,o){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const g=Yh(o.coordinates,c,d),y=Ud(r.geometry(),a,c,d);if(!du(a,c))return!1;for(const x of y)if(!Bf(x,g))return!1}if(o.type==="MultiPolygon"){const g=ka(o.coordinates,c,d),y=Ud(r.geometry(),a,c,d);if(!du(a,c))return!1;for(const x of y)if(!pp(x,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const bc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ah=1/298.257223563,za=ah*(2-ah),wc=Math.PI/180;class Qa{static fromTile(e,r,o){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),c=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/wc;return new Qa(c,o)}static get units(){return bc}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!bc[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(bc).join(", ")}`);const o=6378.137*wc*(r?bc[r]:1),a=Math.cos(e*wc),c=1/(1-za*(1-a*a)),d=Math.sqrt(c);this.kx=o*d*a,this.ky=o*d*c*(1-za)}distance(e,r){const o=Vs(e[0]-r[0])*this.kx,a=(e[1]-r[1])*this.ky;return Math.sqrt(o*o+a*a)}bearing(e,r){const o=Vs(r[0]-e[0])*this.kx;return Math.atan2(o,(r[1]-e[1])*this.ky)/wc}destination(e,r,o){const a=o*wc;return this.offset(e,Math.sin(a)*r,Math.cos(a)*r)}offset(e,r,o){return[e[0]+r/this.kx,e[1]+o/this.ky]}lineDistance(e){let r=0;for(let o=0;o<e.length-1;o++)r+=this.distance(e[o],e[o+1]);return r}area(e){let r=0;for(let o=0;o<e.length;o++){const a=e[o];for(let c=0,d=a.length,g=d-1;c<d;g=c++)r+=Vs(a[c][0]-a[g][0])*(a[c][1]+a[g][1])*(o?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let o=0;if(r<=0)return e[0];for(let a=0;a<e.length-1;a++){const c=e[a],d=e[a+1],g=this.distance(c,d);if(o+=g,o>r)return fu(c,d,(r-(o-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,r,o){let[a,c]=r,d=Vs(o[0]-a)*this.kx,g=(o[1]-c)*this.ky;if(d!==0||g!==0){const y=(Vs(e[0]-a)*this.kx*d+(e[1]-c)*this.ky*g)/(d*d+g*g);y>1?(a=o[0],c=o[1]):y>0&&(a+=d/this.kx*y,c+=g/this.ky*y)}return d=Vs(e[0]-a)*this.kx,g=(e[1]-c)*this.ky,Math.sqrt(d*d+g*g)}pointOnLine(e,r){let o=1/0,a=e[0][0],c=e[0][1],d=0,g=0;for(let y=0;y<e.length-1;y++){let x=e[y][0],S=e[y][1],T=Vs(e[y+1][0]-x)*this.kx,I=(e[y+1][1]-S)*this.ky,R=0;T===0&&I===0||(R=(Vs(r[0]-x)*this.kx*T+(r[1]-S)*this.ky*I)/(T*T+I*I),R>1?(x=e[y+1][0],S=e[y+1][1]):R>0&&(x+=T/this.kx*R,S+=I/this.ky*R)),T=Vs(r[0]-x)*this.kx,I=(r[1]-S)*this.ky;const D=T*T+I*I;D<o&&(o=D,a=x,c=S,d=y,g=R)}return{point:[a,c],index:d,t:Math.max(0,Math.min(1,g))}}lineSlice(e,r,o){let a=this.pointOnLine(o,e),c=this.pointOnLine(o,r);if(a.index>c.index||a.index===c.index&&a.t>c.t){const x=a;a=c,c=x}const d=[a.point],g=a.index+1,y=c.index;!lh(o[g],d[0])&&g<=y&&d.push(o[g]);for(let x=g+1;x<=y;x++)d.push(o[x]);return lh(o[y],c.point)||d.push(c.point),d}lineSliceAlong(e,r,o){let a=0;const c=[];for(let d=0;d<o.length-1;d++){const g=o[d],y=o[d+1],x=this.distance(g,y);if(a+=x,a>e&&c.length===0&&c.push(fu(g,y,(e-(a-x))/x)),a>=r)return c.push(fu(g,y,(r-(a-x))/x)),c;a>e&&c.push(y)}return c}bufferPoint(e,r){const o=r/this.ky,a=r/this.kx;return[e[0]-a,e[1]-o,e[0]+a,e[1]+o]}bufferBBox(e,r){const o=r/this.ky,a=r/this.kx;return[e[0]-a,e[1]-o,e[2]+a,e[3]+o]}insideBBox(e,r){return Vs(e[0]-r[0])>=0&&Vs(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function lh(i,e){return i[0]===e[0]&&i[1]===e[1]}function fu(i,e,r){const o=Vs(e[0]-i[0]);return[i[0]+o*r,i[1]+(e[1]-i[1])*r]}function Vs(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}class uh{constructor(e=[],r=(o,a)=>o<a?-1:o>a?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:o}=this,a=r[e];for(;e>0;){const c=e-1>>1,d=r[c];if(o(a,d)>=0)break;r[e]=d,e=c}r[e]=a}_down(e){const{data:r,compare:o}=this,a=this.length>>1,c=r[e];for(;e<a;){let d=1+(e<<1);const g=d+1;if(g<this.length&&o(r[g],r[d])<0&&(d=g),o(r[d],c)>=0)break;r[e]=r[d],e=d}r[e]=c}}var Wt=8192;function pu(i,e){return e.dist-i.dist}const Sc=100,ch=50;function Tc(i){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==i[r])return!1;return!0}function mu(i){return i[1]-i[0]+1}function da(i,e){const r=i[1]>=i[0]&&i[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Bu(i,e){if(i[0]>i[1])return[null,null];const r=mu(i);if(e){if(r===2)return[i,null];const o=Math.floor(r/2);return[[i[0],i[0]+o],[i[0]+o,i[1]]]}{if(r===1)return[i,null];const o=Math.floor(r/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}}function ql(i,e){const r=[1/0,1/0,-1/0,-1/0];if(!da(e,i.length))return r;for(let o=e[0];o<=e[1];++o)oh(r,i[o]);return r}function Ec(i){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<i.length;++r)for(let o=0;o<i[r].length;++o)oh(e,i[r][o]);return e}function gu(i,e,r){if(Tc(i)||Tc(e))return NaN;let o=0,a=0;return i[2]<e[0]&&(o=e[0]-i[2]),i[0]>e[2]&&(o=i[0]-e[2]),i[1]>e[3]&&(a=i[1]-e[3]),i[3]<e[1]&&(a=e[1]-i[3]),r.distance([0,0],[o,a])}function fa(i){return 360*i-180}function Ci(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function hh(i,e){const r=Math.pow(2,e.z),o=(i.y/Wt+e.y)/r;return[fa((i.x/Wt+e.x)/r),Ci(o)]}function mp(i,e){const r=[];for(let o=0;o<i.length;++o)r.push(hh(i[o],e));return r}function Nf(i,e,r){const o=r.pointOnLine(e,i).point;return r.distance(i,o)}function Nu(i,e,r,o,a){const c=r.slice(o[0],o[1]+1);let d=1/0;for(let g=e[0];g<=e[1];++g)if((d=Math.min(d,Nf(i[g],c,a)))===0)return 0;return d}function qd(i,e,r,o,a){const c=Math.min(a.pointToSegmentDistance(i,r,o),a.pointToSegmentDistance(e,r,o)),d=Math.min(a.pointToSegmentDistance(r,i,e),a.pointToSegmentDistance(o,i,e));return Math.min(c,d)}function Rn(i,e,r,o,a){if(!da(e,i.length)||!da(o,r.length))return NaN;let c=1/0;for(let d=e[0];d<e[1];++d)for(let g=o[0];g<o[1];++g){if(Da(i[d],i[d+1],r[g],r[g+1]))return 0;c=Math.min(c,qd(i[d],i[d+1],r[g],r[g+1],a))}return c}function Vf(i,e,r,o,a){if(!da(e,i.length)||!da(o,r.length))return NaN;let c=1/0;for(let d=e[0];d<=e[1];++d)for(let g=o[0];g<=o[1];++g)if((c=Math.min(c,a.distance(i[d],r[g])))===0)return c;return c}function ho(i,e,r){if(pl(i,e,!0))return 0;let o=1/0;for(const a of e){const c=a.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[c-1]&&(o=Math.min(o,r.pointToSegmentDistance(i,a[c-1],a[0])))===0||(o=Math.min(o,Nf(i,a,r)))===0)return o}return o}function Gd(i,e,r,o){if(!da(e,i.length))return NaN;for(let c=e[0];c<=e[1];++c)if(pl(i[c],r,!0))return 0;let a=1/0;for(let c=e[0];c<e[1];++c)for(const d of r)for(let g=0,y=d.length,x=y-1;g<y;x=g++){if(Da(i[c],i[c+1],d[x],d[g]))return 0;a=Math.min(a,qd(i[c],i[c+1],d[x],d[g],o))}return a}function dh(i,e){for(const r of i)for(let o=0;o<=r.length-1;++o)if(pl(r[o],e,!0))return!0;return!1}function fh(i,e,r,o=1/0){const a=Ec(i),c=Ec(e);if(o!==1/0&&gu(a,c,r)>=o)return o;if(du(a,c)){if(dh(i,e))return 0}else if(dh(e,i))return 0;let d=o;for(const g of i)for(let y=0,x=g.length,S=x-1;y<x;S=y++)for(const T of e)for(let I=0,R=T.length,D=R-1;I<R;D=I++){if(Da(g[S],g[y],T[D],T[I]))return 0;d=Math.min(d,qd(g[S],g[y],T[D],T[I],r))}return d}function ph(i,e,r,o,a,c,d){if(c===null||d===null)return;const g=gu(ql(o,c),ql(a,d),r);g<e&&i.push({dist:g,range1:c,range2:d})}function Hd(i,e,r,o,a=1/0){let c=Math.min(o.distance(i[0],r[0][0]),a);if(c===0)return c;const d=new uh([{dist:0,range1:[0,i.length-1],range2:[0,0]}],pu),g=e?ch:Sc,y=Ec(r);for(;d.length;){const x=d.pop();if(x.dist>=c)continue;const S=x.range1;if(mu(S)<=g){if(!da(S,i.length))return NaN;if(e){const T=Gd(i,S,r,o);if((c=Math.min(c,T))===0)return c}else for(let T=S[0];T<=S[1];++T){const I=ho(i[T],r,o);if((c=Math.min(c,I))===0)return c}}else{const T=Bu(S,e);if(T[0]!==null){const I=gu(ql(i,T[0]),y,o);I<c&&d.push({dist:I,range1:T[0],range2:[0,0]})}if(T[1]!==null){const I=gu(ql(i,T[1]),y,o);I<c&&d.push({dist:I,range1:T[1],range2:[0,0]})}}}return c}function Ic(i,e,r,o,a,c=1/0){let d=Math.min(c,a.distance(i[0],r[0]));if(d===0)return d;const g=new uh([{dist:0,range1:[0,i.length-1],range2:[0,r.length-1]}],pu),y=e?ch:Sc,x=o?ch:Sc;for(;g.length;){const S=g.pop();if(S.dist>=d)continue;const T=S.range1,I=S.range2;if(mu(T)<=y&&mu(I)<=x){if(!da(T,i.length)||!da(I,r.length))return NaN;if(e&&o?d=Math.min(d,Rn(i,T,r,I,a)):e||o?e&&!o?d=Math.min(d,Nu(r,I,i,T,a)):!e&&o&&(d=Math.min(d,Nu(i,T,r,I,a))):d=Math.min(d,Vf(i,T,r,I,a)),d===0)return d}else{const R=Bu(T,e),D=Bu(I,o);ph(g,d,a,i,r,R[0],D[0]),ph(g,d,a,i,r,R[0],D[1]),ph(g,d,a,i,r,R[1],D[0]),ph(g,d,a,i,r,R[1],D[1])}}return d}function Ac(i,e,r,o,a=1/0){let c=a;const d=ql(i,[0,i.length-1]);for(const g of r)if(!(c!==1/0&&gu(d,ql(g,[0,g.length-1]),o)>=c)&&(c=Math.min(c,Ic(i,e,g,!0,o,c)),c===0))return c;return c}function Gl(i,e,r,o,a=1/0){let c=a;const d=ql(i,[0,i.length-1]);for(const g of r){if(c!==1/0&&gu(d,Ec(g),o)>=c)continue;const y=Hd(i,e,g,o,c);if(isNaN(y))return y;if((c=Math.min(c,y))===0)return c}return c}function Kh(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class Vu{constructor(e,r){this.type=Sr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(zt(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let a=0;a<o.features.length;++a)if(Kh(o.features[a].geometry.type))return new Vu(o,o.features[a].geometry)}else if(o.type==="Feature"){if(Kh(o.geometry.type))return new Vu(o,o.geometry)}else if(Kh(o.type))return new Vu(o,o)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),o=e.canonicalID();if(r!=null&&o!=null){if(e.geometryType()==="Point")return function(a,c,d){const g=[];for(const x of a)for(const S of x)g.push(hh(S,c));const y=new Qa(g[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Ic(g,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",y):d.type==="MultiLineString"?Ac(g,!1,d.coordinates,y):d.type==="Polygon"||d.type==="MultiPolygon"?Gl(g,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,y):null}(r,o,this.geometries);if(e.geometryType()==="LineString")return function(a,c,d){const g=[];for(const x of a){const S=[];for(const T of x)S.push(hh(T,c));g.push(S)}const y=new Qa(g[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Ac(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,y);if(d.type==="MultiLineString"){let x=1/0;for(let S=0;S<d.coordinates.length;S++){const T=Ac(d.coordinates[S],!0,g,y,x);if(isNaN(T))return T;if((x=Math.min(x,T))===0)return x}return x}if(d.type==="Polygon"||d.type==="MultiPolygon"){let x=1/0;for(let S=0;S<g.length;S++){const T=Gl(g[S],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,y,x);if(isNaN(T))return T;if((x=Math.min(x,T))===0)return x}return x}return null}(r,o,this.geometries);if(e.geometryType()==="Polygon")return function(a,c,d){const g=[];for(const x of function(S,T){const I=S.length;if(I<=1)return[S];const R=[];let D,O;for(let W=0;W<I;W++){const X=Fo(S[W]);X!==0&&(S[W].area=Math.abs(X),O===void 0&&(O=X<0),O===X<0?(D&&R.push(D),D=[S[W]]):D.push(S[W]))}return D&&R.push(D),R}(a)){const S=[];for(let T=0;T<x.length;++T)S.push(mp(x[T],c));g.push(S)}const y=new Qa(g[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Gl(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,y);if(d.type==="MultiLineString"){let x=1/0;for(let S=0;S<d.coordinates.length;S++){const T=Gl(d.coordinates[S],!0,g,y,x);if(isNaN(T))return T;if((x=Math.min(x,T))===0)return x}return x}return d.type==="Polygon"||d.type==="MultiPolygon"?function(x,S,T){let I=1/0;for(const R of x)for(const D of S){const O=fh(R,D,T,I);if(isNaN(O))return O;if((I=Math.min(I,O))===0)return I}return I}(d.type==="Polygon"?[d.coordinates]:d.coordinates,g,y):null}(r,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function $d(i,e){switch(i){case"string":return Xt(e);case"number":return+e;case"boolean":return!!e;case"color":return ai.parse(e);case"formatted":return N.fromString(Xt(e));case"resolvedImage":return ve.build(Xt(e))}return e}function Wd(i,e,r,o){return o!==void 0&&(i=o*Math.round(i/o)),e!==void 0&&i<e&&(i=e),r!==void 0&&i>r&&(i=r),i}class Hl{constructor(e,r,o){this.type=e,this.key=r,this.scope=o}static parse(e,r){let o=r.expectedType;if(o==null&&(o=Ui),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const a=r.parse(e[1],1);if(!(a instanceof Ft))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=r.parse(e[2],2);return c instanceof Ft?new Hl(o,Xt(a.value),Xt(c.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Hl(o,Xt(a.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(r);if(!o)return null;const{type:a,value:c,values:d,minValue:g,maxValue:y,stepValue:x}=o,S=o.default.evaluate(e);let T=S;if(c){const I=e.scope;e.scope=(I||"").split("").slice(1).join(""),T=c.evaluate(e),e.scope=I}return a&&(T=$d(a,T)),T===void 0||g===void 0&&y===void 0&&x===void 0||(typeof T=="number"?T=Wd(T,g,y,x):Array.isArray(T)&&(T=T.map(I=>typeof I=="number"?Wd(I,g,y,x):I))),c!==void 0&&T!==void 0&&d&&!d.includes(T)&&(T=S,a&&(T=$d(a,T))),(a&&a!==this.type||T!==void 0&&xt(T)!==this.type)&&(T=$d(this.type.kind,T)),T}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function _u(i){if(i instanceof bs&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ml||i instanceof Vu)return!1;let e=!0;return i.eachChild(r=>{e&&!_u(r)&&(e=!1)}),e}function Cc(i){if(i instanceof bs&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!Cc(r)&&(e=!1)}),e}function Mc(i){if(i instanceof Hl)return new Set([i.key]);let e=new Set;return i.eachChild(r=>{e=new Set([...e,...Mc(r)])}),e}function yu(i,e){if(i instanceof bs&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(o=>{r&&!yu(o,e)&&(r=!1)}),r}class Pc{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=e[1];return r.scope.has(o)?new Pc(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Zd{constructor(e,r=[],o,a=new ca,c=[],d,g){this.registry=e,this.path=r,this.key=r.map(y=>typeof y=="string"?`['${y}']`:`[${y}]`).join(""),this.scope=a,this.errors=c,this.expectedType=o,this._scope=d,this.options=g}parse(e,r,o,a,c={}){return r||o?this.concat(r,null,o,a)._parse(e,c):this._parse(e,c)}parseObjectValue(e,r,o,a,c,d={}){return this.concat(r,o,a,c)._parse(e,d)}_parse(e,r){function o(a,c,d){return d==="assert"?new rr(c,[a]):d==="coerce"?new xs(c,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let c=a.parse(e,this);if(!c)return null;if(this.expectedType){const d=this.expectedType,g=c.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||g.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(d,g))return null}else c=o(c,d,r.typeAnnotation||"coerce");else c=o(c,d,r.typeAnnotation||"assert")}if(!(c instanceof Ft)&&c.type.kind!=="resolvedImage"&&Yd(c)){const d=new ha(this._scope,this.options);try{c=new Ft(c.type,c.evaluate(d))}catch(g){return this.error(g.message),null}}return c}return xs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,o,a){let c=typeof e=="number"?this.path.concat(e):this.path;c=typeof r=="string"?c.concat(r):c;const d=a?this.scope.concat(a):this.scope;return new Zd(this.registry,c,o||null,d,this.errors,this._scope,this.options)}error(e,...r){const o=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new Mo(o,e))}checkSubtype(e,r){const o=cu(e,r);return o&&this.error(o),o}}var Xd=Zd;function Yd(i){if(i instanceof Pc)return Yd(i.boundExpression);if(i instanceof bs&&i.name==="error"||i instanceof xc||i instanceof ml||i instanceof Vu||i instanceof Hl)return!1;const e=i instanceof xs||i instanceof rr;let r=!0;return i.eachChild(o=>{r=e?r&&Yd(o):r&&o instanceof Ft}),!!r&&_u(i)&&yu(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Jh(i,e){const r=i.length-1;let o,a,c=0,d=r,g=0;for(;c<=d;)if(g=Math.floor((c+d)/2),o=i[g],a=i[g+1],o<=e){if(g===r||e<a)return g;c=g+1}else{if(!(o>e))throw new Rt("Input is not a number.");d=g-1}return 0}class ju{constructor(e,r,o){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[a,c]of o)this.labels.push(a),this.outputs.push(c)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(e[1],1,Sr);if(!o)return null;const a=[];let c=null;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);for(let d=1;d<e.length;d+=2){const g=d===1?-1/0:e[d],y=e[d+1],x=d,S=d+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);const T=r.parse(y,S,c);if(!T)return null;c=c||T.type,a.push([g,T])}return new ju(c,o,a)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return o[0].evaluate(e);const c=r.length;return a>=r[c-1]?o[c-1].evaluate(e):o[Jh(r,a)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const $l=.95047,Kd=1.08883,Uu=4/29,js=6/29,Rc=3*js*js,Wl=js*js*js,mh=Math.PI/180,gp=180/Math.PI;function Qh(i){return i>Wl?Math.pow(i,1/3):i/Rc+Uu}function Zl(i){return i>js?i*i*i:Rc*(i-Uu)}function qu(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function vu(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Dc(i){const e=vu(i.r),r=vu(i.g),o=vu(i.b),a=Qh((.4124564*e+.3575761*r+.1804375*o)/$l),c=Qh((.2126729*e+.7151522*r+.072175*o)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-Qh((.0193339*e+.119192*r+.9503041*o)/Kd)),alpha:i.a}}function gh(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Zl(e),r=$l*Zl(r),o=Kd*Zl(o),new ai(qu(3.2404542*r-1.5371385*e-.4985314*o),qu(-.969266*r+1.8760108*e+.041556*o),qu(.0556434*r-.2040259*e+1.0572252*o),i.alpha)}function el(i,e,r){const o=e-i;return i+r*(o>180||o<-180?o-360*Math.round(o/360):o)}const pa={forward:Dc,reverse:gh,interpolate:function(i,e,r){return{l:Mr(i.l,e.l,r),a:Mr(i.a,e.a,r),b:Mr(i.b,e.b,r),alpha:Mr(i.alpha,e.alpha,r)}}},Un={forward:function(i){const{l:e,a:r,b:o}=Dc(i),a=Math.atan2(o,r)*gp;return{h:a<0?a+360:a,c:Math.sqrt(r*r+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*mh,r=i.c;return gh({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:el(i.h,e.h,r),c:Mr(i.c,e.c,r),l:Mr(i.l,e.l,r),alpha:Mr(i.alpha,e.alpha,r)}}};var ro=Object.freeze({__proto__:null,hcl:Un,lab:pa});class wo{constructor(e,r,o,a,c){this.type=e,this.operator=r,this.interpolation=o,this.input=a,this.labels=[],this.outputs=[];for(const[d,g]of c)this.labels.push(d),this.outputs.push(g)}static interpolationFactor(e,r,o,a){let c=0;if(e.name==="exponential")c=Bo(r,e.base,o,a);else if(e.name==="linear")c=Bo(r,1,o,a);else if(e.name==="cubic-bezier"){const d=e.controlPoints;c=new Oi(d[0],d[1],d[2],d[3]).solve(Bo(r,1,o,a))}return c}static parse(e,r){let[o,a,c,...d]=e;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const x=a[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:x}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const x=a.slice(1);if(x.length!==4||x.some(S=>typeof S!="number"||S<0||S>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,Sr),!c)return null;const g=[];let y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=zo:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let x=0;x<d.length;x+=2){const S=d[x],T=d[x+1],I=x+3,R=x+4;if(typeof S!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(g.length&&g[g.length-1][0]>=S)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const D=r.parse(T,R,y);if(!D)return null;y=y||D.type,g.push([S,D])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new wo(y,o,a,c,g):r.error(`Type ${$n(y)} is not interpolatable.`)}evaluate(e){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=r[0])return o[0].evaluate(e);const c=r.length;if(a>=r[c-1])return o[c-1].evaluate(e);const d=Jh(r,a),g=wo.interpolationFactor(this.interpolation,a,r[d],r[d+1]),y=o[d].evaluate(e),x=o[d+1].evaluate(e);return this.operator==="interpolate"?Ya[this.type.kind.toLowerCase()](y,x,g):this.operator==="interpolate-hcl"?Un.reverse(Un.interpolate(Un.forward(y),Un.forward(x),g)):pa.reverse(pa.interpolate(pa.forward(y),pa.forward(x),g))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)r.push(this.labels[o],this.outputs[o].serialize());return r}}function Bo(i,e,r,o){const a=o-r,c=i-r;return a===0?0:e===1?c/a:(Math.pow(e,c)-1)/(Math.pow(e,a)-1)}class ws{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let o=null;const a=r.expectedType;a&&a.kind!=="value"&&(o=a);const c=[];for(const g of e.slice(1)){const y=r.parse(g,1+c.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,c.push(y)}const d=a&&c.some(g=>cu(a,g.type));return new ws(d?Ui:o,c)}evaluate(e){let r,o=null,a=0;for(const c of this.args){if(a++,o=c.evaluate(e),o&&o instanceof ve&&!o.available&&(r||(r=o),o=null,a===this.args.length))return r;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class gl{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let c=1;c<e.length-1;c+=2){const d=e[c];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,c);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);const g=r.parse(e[c+1],c+1);if(!g)return null;o.push([d,g])}const a=r.parse(e[e.length-1],e.length-1,r.expectedType,o);return a?new gl(o,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,o]of this.bindings)e.push(r,o.serialize());return e.push(this.result.serialize()),e}}class Xl{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Sr),a=r.parse(e[2],2,Oo(r.expectedType||Ui));return o&&a?new Xl(a.type.itemType,o,a):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Rt(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Rt(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Rt(`Array index must be an integer, but found ${r} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return o[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ss{constructor(e,r,o){this.type=e,this.index=r,this.input=o}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Sr),a=r.parse(e[2],2,Oo(r.expectedType||Ui));return o&&a?new Ss(a.type.itemType,o,a):null}evaluate(e){const r=this.index.evaluate(e),o=this.input.evaluate(e);if(r<0)throw new Rt(`Array index out of bounds: ${r} < 0.`);if(r>o.length-1)throw new Rt(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r===Math.floor(r))return o[r];const a=Math.floor(r),c=Math.ceil(r),d=o[a],g=o[c];if(typeof d!="number"||typeof g!="number")throw new Rt(`Cannot interpolate between non-number values at index ${r}.`);const y=r-a;return d*(1-y)+g*y}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class kc{constructor(e,r){this.type=xi,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Ui),a=r.parse(e[2],2,Ui);return o&&a?yc(o.type,[xi,Hi,Sr,Ma,Ui])?new kc(o,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(o.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Ka(r,["boolean","string","number","null"]))throw new Rt(`Expected first argument to be of type boolean, string, number or null, but found ${$n(xt(r))} instead.`);if(!Ka(o,["string","array"]))throw new Rt(`Expected second argument to be of type array or string, but found ${$n(xt(o))} instead.`);return o.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class _h{constructor(e,r,o){this.type=Sr,this.needle=e,this.haystack=r,this.fromIndex=o}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Ui),a=r.parse(e[2],2,Ui);if(!o||!a)return null;if(!yc(o.type,[xi,Hi,Sr,Ma,Ui]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${$n(o.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,Sr);return c?new _h(o,a,c):null}return new _h(o,a)}evaluate(e){const r=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ka(r,["boolean","string","number","null"]))throw new Rt(`Expected first argument to be of type boolean, string, number or null, but found ${$n(xt(r))} instead.`);if(!Ka(o,["string","array"]))throw new Rt(`Expected second argument to be of type array or string, but found ${$n(xt(o))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return o.indexOf(r,a)}return o.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ed{constructor(e,r,o,a,c,d){this.inputType=e,this.type=r,this.input=o,this.cases=a,this.outputs=c,this.otherwise=d}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let o,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const c={},d=[];for(let x=2;x<e.length-1;x+=2){let S=e[x];const T=e[x+1];Array.isArray(S)||(S=[S]);const I=r.concat(x);if(S.length===0)return I.error("Expected at least one branch label.");for(const D of S){if(typeof D!="number"&&typeof D!="string")return I.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return I.error("Numeric branch labels must be integer values.");if(o){if(I.checkSubtype(o,xt(D)))return null}else o=xt(D);if(c[String(D)]!==void 0)return I.error("Branch labels must be unique.");c[String(D)]=d.length}const R=r.parse(T,x,a);if(!R)return null;a=a||R.type,d.push(R)}const g=r.parse(e[1],1,Ui);if(!g)return null;const y=r.parse(e[e.length-1],e.length-1,a);return y?g.type.kind!=="value"&&r.concat(1).checkSubtype(o,g.type)?null:new ed(o,a,g,c,d,y):null}evaluate(e){const r=this.input.evaluate(e);return(xt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),o=[],a={};for(const d of r){const g=a[this.cases[d]];g===void 0?(a[this.cases[d]]=o.length,o.push([this.cases[d],[d]])):o[g][1].push(d)}const c=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,g]of o)e.push(g.length===1?c(g[0]):g.map(c)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class Gu{constructor(e,r,o){this.type=e,this.branches=r,this.otherwise=o}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const a=[];for(let d=1;d<e.length-1;d+=2){const g=r.parse(e[d],d,xi);if(!g)return null;const y=r.parse(e[d+1],d+1,o);if(!y)return null;a.push([g,y]),o=o||y.type}const c=r.parse(e[e.length-1],e.length-1,o);return c?new Gu(o,a,c):null}evaluate(e){for(const[r,o]of this.branches)if(r.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,o]of this.branches)e(r),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Lc{constructor(e,r,o,a){this.type=e,this.input=r,this.beginIndex=o,this.endIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=r.parse(e[1],1,Ui),a=r.parse(e[2],2,Sr);if(!o||!a)return null;if(!yc(o.type,[Oo(Ui),Hi,Ui]))return r.error(`Expected first argument to be of type array or string, but found ${$n(o.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,Sr);return c?new Lc(o.type,o,a,c):null}return new Lc(o.type,o,a)}evaluate(e){const r=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Ka(r,["string","array"]))throw new Rt(`Expected first argument to be of type array or string, but found ${$n(xt(r))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return r.slice(o,a)}return r.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function ma(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function yh(i,e,r,o){return o.compare(e,r)===0}function Yl(i,e,r){const o=i!=="=="&&i!=="!=";return class Cb{constructor(c,d,g){this.type=xi,this.lhs=c,this.rhs=d,this.collator=g,this.hasUntypedArgument=c.type.kind==="value"||d.type.kind==="value"}static parse(c,d){if(c.length!==3&&c.length!==4)return d.error("Expected two or three arguments.");const g=c[0];let y=d.parse(c[1],1,Ui);if(!y)return null;if(!ma(g,y.type))return d.concat(1).error(`"${g}" comparisons are not supported for type '${$n(y.type)}'.`);let x=d.parse(c[2],2,Ui);if(!x)return null;if(!ma(g,x.type))return d.concat(2).error(`"${g}" comparisons are not supported for type '${$n(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${$n(y.type)}' and '${$n(x.type)}'.`);o&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new rr(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new rr(y.type,[x])));let S=null;if(c.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(S=d.parse(c[3],3,dl),!S)return null}return new Cb(y,x,S)}evaluate(c){const d=this.lhs.evaluate(c),g=this.rhs.evaluate(c);if(o&&this.hasUntypedArgument){const y=xt(d),x=xt(g);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new Rt(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const y=xt(d),x=xt(g);if(y.kind!=="string"||x.kind!=="string")return e(c,d,g)}return this.collator?r(c,d,g,this.collator.evaluate(c)):e(c,d,g)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[i];return this.eachChild(d=>{c.push(d.serialize())}),c}}}const jf=Yl("==",function(i,e,r){return e===r},yh),_p=Yl("!=",function(i,e,r){return e!==r},function(i,e,r,o){return!yh(0,e,r,o)}),Kl=Yl("<",function(i,e,r){return e<r},function(i,e,r,o){return o.compare(e,r)<0}),Hu=Yl(">",function(i,e,r){return e>r},function(i,e,r,o){return o.compare(e,r)>0}),zc=Yl("<=",function(i,e,r){return e<=r},function(i,e,r,o){return o.compare(e,r)<=0}),td=Yl(">=",function(i,e,r){return e>=r},function(i,e,r,o){return o.compare(e,r)>=0});class Oc{constructor(e,r,o,a,c,d){this.type=Hi,this.number=e,this.locale=r,this.currency=o,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const o=r.parse(e[1],1,Sr);if(!o)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=r.parseObjectValue(a.locale,2,"locale",Hi),!c))return null;let d=null;if(a.currency&&(d=r.parseObjectValue(a.currency,2,"currency",Hi),!d))return null;let g=null;if(a.unit&&(g=r.parseObjectValue(a.unit,2,"unit",Hi),!g))return null;let y=null;if(a["min-fraction-digits"]&&(y=r.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",Sr),!y))return null;let x=null;return a["max-fraction-digits"]&&(x=r.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",Sr),!x)?null:new Oc(o,c,d,g,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ps{constructor(e){this.type=Sr,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=r.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${$n(o.type)} instead.`):new Ps(o):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Rt(`Expected value to be of type string or array, but found ${$n(xt(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function ga(i){return function(){i=1831565813+(i|=0)|0;let e=Math.imul(i^i>>>15,1|i);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const _a={"==":jf,"!=":_p,">":Hu,"<":Kl,">=":td,"<=":zc,array:rr,at:Xl,"at-interpolated":Ss,boolean:rr,case:Gu,coalesce:ws,collator:xc,format:Pn,image:Po,in:kc,"index-of":_h,interpolate:wo,"interpolate-hcl":wo,"interpolate-lab":wo,length:Ps,let:gl,literal:Ft,match:ed,number:rr,"number-format":Oc,object:rr,slice:Lc,step:ju,string:rr,"to-boolean":xs,"to-color":xs,"to-number":xs,"to-string":xs,var:Pc,within:ml,distance:Vu,config:Hl};function _l(i,[e,r,o,a]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const c=a?a.evaluate(i):1,d=Oe(e,r,o,c);if(d)throw new Rt(d);return new ai(e/255*c,r/255*c,o/255*c,c)}function yl(i,[e,r,o,a]){e=e.evaluate(i),r=r.evaluate(i),o=o.evaluate(i);const c=a?a.evaluate(i):1,d=function(x,S,T,I){return typeof x=="number"&&x>=0&&x<=360?typeof S=="number"&&S>=0&&S<=100&&typeof T=="number"&&T>=0&&T<=100?I===void 0||typeof I=="number"&&I>=0&&I<=1?null:`Invalid hsla value [${[x,S,T,I].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof I=="number"?[x,S,T,I]:[x,S,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof I=="number"?[x,S,T,I]:[x,S,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,o,c);if(d)throw new Rt(d);const g=`hsla(${e}, ${r}%, ${o}%, ${c})`,y=ai.parse(g);if(!y)throw new Rt(`Failed to parse HSLA color: ${g}`);return y}function Jl(i,e){return i in e}function vh(i,e){const r=e[i];return r===void 0?null:r}function vl(i){return{type:i}}function rd(i){return{result:"success",value:i}}function fo(i){return{result:"error",value:i}}function Us(i,e){return!!i&&!!i.parameters&&i.parameters.indexOf(e)>-1}function io(i){return i["property-type"]==="data-driven"}function Oa(i){return Us(i.expression,"measure-light")}function id(i){return Us(i.expression,"zoom")}function xh(i){return!!i.expression&&i.expression.interpolated}function Fc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function nd(i){return i}function bh(i,e){const r=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",a=o||!(o||i.property!==void 0),c=i.type||(xh(e)?"exponential":"interval");if(r&&((i=ua({},i)).stops&&(i.stops=i.stops.map(x=>[x[0],ai.parse(x[1])])),i.default=ai.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!ro[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let d,g,y;if(c==="exponential")d=tl;else if(c==="interval")d=Bc;else if(c==="categorical"){d=Jd,g=Object.create(null);for(const x of i.stops)g[x[0]]=x[1];y=typeof i.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);d=yp}if(o){const x={},S=[];for(let R=0;R<i.stops.length;R++){const D=i.stops[R],O=D[0].zoom;x[O]===void 0&&(x[O]={zoom:O,type:i.type,property:i.property,default:i.default,stops:[]},S.push(O)),x[O].stops.push([D[0].value,D[1]])}const T=[];for(const R of S)T.push([x[R].zoom,bh(x[R],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:wo.interpolationFactor.bind(void 0,I),zoomStops:T.map(R=>R[0]),evaluate:({zoom:R},D)=>tl({stops:T,base:i.base},e,R).evaluate(R,D)}}if(a){const x=c==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:wo.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(S=>S[0]),evaluate:({zoom:S})=>d(i,e,S,g,y)}}return{kind:"source",evaluate(x,S){const T=S&&S.properties?S.properties[i.property]:void 0;return T===void 0?xl(i.default,e.default):d(i,e,T,g,y)}}}function xl(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function Jd(i,e,r,o,a){return xl(typeof r===a?o[r]:void 0,i.default,e.default)}function Bc(i,e,r){if(Dr(r)!=="number")return xl(i.default,e.default);const o=i.stops.length;if(o===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[o-1][0])return i.stops[o-1][1];const a=Jh(i.stops.map(c=>c[0]),r);return i.stops[a][1]}function tl(i,e,r){const o=i.base!==void 0?i.base:1;if(Dr(r)!=="number")return xl(i.default,e.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const c=Jh(i.stops.map(S=>S[0]),r),d=function(S,T,I,R){const D=R-I,O=S-I;return D===0?0:T===1?O/D:(Math.pow(T,O)-1)/(Math.pow(T,D)-1)}(r,o,i.stops[c][0],i.stops[c+1][0]),g=i.stops[c][1],y=i.stops[c+1][1];let x=Ya[e.type]||nd;if(i.colorSpace&&i.colorSpace!=="rgb"){const S=ro[i.colorSpace];x=(T,I)=>S.reverse(S.interpolate(S.forward(T),S.forward(I),d))}return typeof g.evaluate=="function"?{evaluate(...S){const T=g.evaluate.apply(void 0,S),I=y.evaluate.apply(void 0,S);if(T!==void 0&&I!==void 0)return x(T,I,d)}}:x(g,y,d)}function yp(i,e,r){return e.type==="color"?r=ai.parse(r):e.type==="formatted"?r=N.fromString(r.toString()):e.type==="resolvedImage"?r=ve.build(r.toString()):Dr(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),xl(r,i.default,e.default)}bs.register(_a,{error:[{kind:"error"},[Hi],(i,[e])=>{throw new Rt(e.evaluate(i))}],typeof:[Hi,[Ui],(i,[e])=>$n(xt(e.evaluate(i)))],"to-rgba":[Oo(Sr,4),[zo],(i,[e])=>e.evaluate(i).toRenderColor(null).toArray()],"to-hsla":[Oo(Sr,4),[zo],(i,[e])=>e.evaluate(i).toRenderColor(null).toHslaArray()],rgb:[zo,[Sr,Sr,Sr],_l],rgba:[zo,[Sr,Sr,Sr,Sr],_l],hsl:[zo,[Sr,Sr,Sr],yl],hsla:[zo,[Sr,Sr,Sr,Sr],yl],has:{type:xi,overloads:[[[Hi],(i,[e])=>Jl(e.evaluate(i),i.properties())],[[Hi,Pa],(i,[e,r])=>Jl(e.evaluate(i),r.evaluate(i))]]},get:{type:Ui,overloads:[[[Hi],(i,[e])=>vh(e.evaluate(i),i.properties())],[[Hi,Pa],(i,[e,r])=>vh(e.evaluate(i),r.evaluate(i))]]},"feature-state":[Ui,[Hi],(i,[e])=>vh(e.evaluate(i),i.featureState||{})],properties:[Pa,[],i=>i.properties()],"geometry-type":[Hi,[],i=>i.geometryType()],id:[Ui,[],i=>i.id()],zoom:[Sr,[],i=>i.globals.zoom],pitch:[Sr,[],i=>i.globals.pitch||0],"distance-from-center":[Sr,[],i=>i.distanceFromCenter()],"measure-light":[Sr,[Hi],(i,[e])=>i.measureLight(e.evaluate(i))],"heatmap-density":[Sr,[],i=>i.globals.heatmapDensity||0],"line-progress":[Sr,[],i=>i.globals.lineProgress||0],"raster-value":[Sr,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Sr,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Sr,[],i=>i.globals.skyRadialProgress||0],accumulated:[Ui,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Sr,vl(Sr),(i,e)=>{let r=0;for(const o of e)r+=o.evaluate(i);return r}],"*":[Sr,vl(Sr),(i,e)=>{let r=1;for(const o of e)r*=o.evaluate(i);return r}],"-":{type:Sr,overloads:[[[Sr,Sr],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[Sr],(i,[e])=>-e.evaluate(i)]]},"/":[Sr,[Sr,Sr],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[Sr,[Sr,Sr],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[Sr,[],()=>Math.LN2],pi:[Sr,[],()=>Math.PI],e:[Sr,[],()=>Math.E],"^":[Sr,[Sr,Sr],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[Sr,[Sr],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Sr,[Sr],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Sr,[Sr],(i,[e])=>Math.log(e.evaluate(i))],log2:[Sr,[Sr],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Sr,[Sr],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Sr,[Sr],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Sr,[Sr],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Sr,[Sr],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Sr,[Sr],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Sr,[Sr],(i,[e])=>Math.atan(e.evaluate(i))],min:[Sr,vl(Sr),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[Sr,vl(Sr),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[Sr,[Sr],(i,[e])=>Math.abs(e.evaluate(i))],round:[Sr,[Sr],(i,[e])=>{const r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Sr,[Sr],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Sr,[Sr],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[xi,[Hi,Ui],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[xi,[Ui],(i,[e])=>i.id()===e.value],"filter-type-==":[xi,[Hi],(i,[e])=>i.geometryType()===e.value],"filter-<":[xi,[Hi,Ui],(i,[e,r])=>{const o=i.properties()[e.value],a=r.value;return typeof o==typeof a&&o<a}],"filter-id-<":[xi,[Ui],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<o}],"filter->":[xi,[Hi,Ui],(i,[e,r])=>{const o=i.properties()[e.value],a=r.value;return typeof o==typeof a&&o>a}],"filter-id->":[xi,[Ui],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>o}],"filter-<=":[xi,[Hi,Ui],(i,[e,r])=>{const o=i.properties()[e.value],a=r.value;return typeof o==typeof a&&o<=a}],"filter-id-<=":[xi,[Ui],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r<=o}],"filter->=":[xi,[Hi,Ui],(i,[e,r])=>{const o=i.properties()[e.value],a=r.value;return typeof o==typeof a&&o>=a}],"filter-id->=":[xi,[Ui],(i,[e])=>{const r=i.id(),o=e.value;return typeof r==typeof o&&r>=o}],"filter-has":[xi,[Ui],(i,[e])=>e.value in i.properties()],"filter-has-id":[xi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[xi,[Oo(Hi)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[xi,[Oo(Ui)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[xi,[Hi,Oo(Ui)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[xi,[Hi,Oo(Ui)],(i,[e,r])=>function(o,a,c,d){for(;c<=d;){const g=c+d>>1;if(a[g]===o)return!0;a[g]>o?d=g-1:c=g+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:xi,overloads:[[[xi,xi],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[vl(xi),(i,e)=>{for(const r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:xi,overloads:[[[xi,xi],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[vl(xi),(i,e)=>{for(const r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[xi,[xi],(i,[e])=>!e.evaluate(i)],"is-supported-script":[xi,[Hi],(i,[e])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Hi,[Hi],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Hi,[Hi],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Hi,vl(Ui),(i,e)=>e.map(r=>Xt(r.evaluate(i))).join("")],"resolved-locale":[Hi,[dl],(i,[e])=>e.evaluate(i).resolvedLocale()],random:[Sr,[Sr,Sr,Ui],(i,e)=>{const[r,o,a]=e.map(d=>d.evaluate(i));if(r>o||r===o)return r;let c;if(typeof a=="string")c=function(d){let g=0;if(d.length===0)return g;for(let y=0;y<d.length;y++)g=(g<<5)-g+d.charCodeAt(y),g|=0;return g}(a);else{if(typeof a!="number")throw new Rt(`Invalid seed input: ${a}`);c=a}return r+ga(c)()*(o-r)}]});class $u{constructor(e,r,o,a){this.expression=e,this._warningHistory={},this._evaluator=new ha(o,a),this._defaultValue=r?function(c){return c.type==="color"&&(Fc(c.default)||Array.isArray(c.default))?new ai(0,0,0,0):c.type==="color"?ai.parse(c.default)||null:c.default===void 0?null:c.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Mc(e)}evaluateWithoutErrorHandling(e,r,o,a,c,d,g,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,o,a,c,d,g,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=y||null;try{const x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Rt(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${x.message}`)),this._defaultValue}}}function Wu(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in _a}function Zu(i,e,r,o){const a=new Xd(_a,[],e?function(d){const g={color:zo,string:Hi,number:Sr,enum:Hi,boolean:xi,formatted:fl,resolvedImage:uu};return d.type==="array"?Oo(g[d.value]||Ui,d.length):g[d.type]}(e):void 0,void 0,void 0,r,o),c=a.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?rd(new $u(c,e,r,o)):fo(a.errors)}class xu{constructor(e,r,o,a){this.kind=e,this._styleExpression=r,this.isLightConstant=o,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!Cc(r.expression),this.configDependencies=Mc(r.expression)}evaluateWithoutErrorHandling(e,r,o,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,a,c,d)}evaluate(e,r,o,a,c,d){return this._styleExpression.evaluate(e,r,o,a,c,d)}}class rl{constructor(e,r,o,a,c,d){this.kind=e,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Cc(r.expression),this.isLightConstant=c,this.isLineProgressConstant=d,this.configDependencies=Mc(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,r,o,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,o,a,c,d)}evaluate(e,r,o,a,c,d){return this._styleExpression.evaluate(e,r,o,a,c,d)}interpolationFactor(e,r,o){return this.interpolationType?wo.interpolationFactor(this.interpolationType,e,r,o):0}}function Nc(i,e,r,o){if((i=Zu(i,e,r,o)).result==="error")return i;const a=i.value.expression,c=_u(a);if(!c&&!io(e))return fo([new Mo("","data expressions not supported")]);const d=yu(a,["zoom","pitch","distance-from-center"]);if(!d&&!id(e))return fo([new Mo("","zoom expressions not supported")]);const g=yu(a,["measure-light"]);if(!g&&!Oa(e))return fo([new Mo("","measure-light expression not supported")]);const y=yu(a,["line-progress"]);if(!y&&!function(T){return Us(T.expression,"line-progress")}(e))return fo([new Mo("","line-progress expression not supported")]);const x=e.expression&&e.expression.relaxZoomRestriction,S=Xu(a);return S||d||x?S instanceof Mo?fo([S]):S instanceof wo&&!xh(e)?fo([new Mo("",'"interpolate" expressions cannot be used with this property')]):rd(S?new rl(c&&y?"camera":"composite",i.value,S.labels,S instanceof wo?S.interpolation:void 0,g,y):new xu(c&&y?"constant":"source",i.value,g,y)):fo([new Mo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bu{constructor(e,r){this._parameters=e,this._specification=r,ua(this,bh(this._parameters,this._specification))}static deserialize(e){return new bu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Xu(i){let e=null;if(i instanceof gl)e=Xu(i.result);else if(i instanceof ws){for(const r of i.args)if(e=Xu(r),e)break}else(i instanceof ju||i instanceof wo)&&i.input instanceof bs&&i.input.name==="zoom"&&(e=i);return e instanceof Mo||i.eachChild(r=>{const o=Xu(r);o instanceof Mo?e=o:e&&o&&e!==o&&(e=new Mo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var wu,Vc,wh=function(){if(Vc)return wu;Vc=1,wu=e;var i=3;function e(r,o,a){var c=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var d=new Int32Array(this.arrayBuffer);r=d[0],this.d=(o=d[1])+2*(a=d[2]);for(var g=0;g<this.d*this.d;g++){var y=d[i+g],x=d[i+g+1];c.push(y===x?null:d.subarray(y,x))}var S=d[i+c.length+1];this.keys=d.subarray(d[i+c.length],S),this.bboxes=d.subarray(S),this.insert=this._insertReadonly}else{this.d=o+2*a;for(var T=0;T<this.d*this.d;T++)c.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=r,this.padding=a,this.scale=o/r,this.uid=0;var I=a/o*r;this.min=-I,this.max=r+I}return e.prototype.insert=function(r,o,a,c,d){this._forEachCell(o,a,c,d,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(o),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,o,a,c,d,g){this.cells[d].push(g)},e.prototype.query=function(r,o,a,c,d){var g=this.min,y=this.max;if(r<=g&&o<=g&&y<=a&&y<=c&&!d)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(r,o,a,c,this._queryCell,x,{},d),x},e.prototype._queryCell=function(r,o,a,c,d,g,y,x){var S=this.cells[d];if(S!==null)for(var T=this.keys,I=this.bboxes,R=0;R<S.length;R++){var D=S[R];if(y[D]===void 0){var O=4*D;(x?x(I[O+0],I[O+1],I[O+2],I[O+3]):r<=I[O+2]&&o<=I[O+3]&&a>=I[O+0]&&c>=I[O+1])?(y[D]=!0,g.push(T[D])):y[D]=!1}}},e.prototype._forEachCell=function(r,o,a,c,d,g,y,x){for(var S=this._convertToCellCoord(r),T=this._convertToCellCoord(o),I=this._convertToCellCoord(a),R=this._convertToCellCoord(c),D=S;D<=I;D++)for(var O=T;O<=R;O++){var W=this.d*O+D;if((!x||x(this._convertFromCellCoord(D),this._convertFromCellCoord(O),this._convertFromCellCoord(D+1),this._convertFromCellCoord(O+1)))&&d.call(this,r,o,a,c,W,g,y,x))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,o=i+this.cells.length+1+1,a=0,c=0;c<this.cells.length;c++)a+=this.cells[c].length;var d=new Int32Array(o+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var g=o,y=0;y<r.length;y++){var x=r[y];d[i+y]=g,d.set(x,g),g+=x.length}return d[i+r.length]=g,d.set(this.keys,g),d[i+r.length+1]=g+=this.keys.length,d.set(this.bboxes,g),g+=this.bboxes.length,d.buffer},wu}(),Su=to(wh);const Yu={};function ir(i,e,r={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writable:!1}),Yu[e]={klass:i,omit:r.omit||[]}}ir(Object,"Object"),Su.serialize=function(i,e){const r=i.toArrayBuffer();return e&&e.add(r),{buffer:r}},Su.deserialize=function(i){return new Su(i.buffer)},Object.defineProperty(Su,"name",{value:"Grid"}),ir(Su,"Grid"),typeof DOMMatrix<"u"&&ir(DOMMatrix,"DOMMatrix"),ir(ai,"Color"),ir(Error,"Error"),ir(N,"Formatted"),ir(Fu,"FormattedSection"),ir(sa,"AJAXError"),ir(ve,"ResolvedImage"),ir(bu,"StylePropertyFunction"),ir($u,"StyleExpression",{omit:["_evaluator"]}),ir(vs,"ImageId"),ir(Q,"ImageVariant"),ir(rl,"ZoomDependentExpression"),ir(xu,"ZoomConstantExpression"),ir(bs,"CompoundExpression",{omit:["_evaluate"]});for(const i in _a)Yu[_a[i]._classRegistryKey]||ir(_a[i],`Expression${i}`);function Rs(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ya(i){return self.ImageBitmap&&i instanceof ImageBitmap}function bl(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Rs(i)||ya(i))return e&&e.add(i),i;if(ArrayBuffer.isView(i))return e&&e.add(i.buffer),i;if(i instanceof ImageData)return e&&e.add(i.data.buffer),i;if(Array.isArray(i)){const r=[];for(const o of i)r.push(bl(o,e));return r}if(i instanceof Map){const r={$name:"Map",entries:[]};for(const[o,a]of i.entries())r.entries.push(bl(o),bl(a,e));return r}if(i instanceof Set){const r={$name:"Set"};let o=0;for(const a of i.values())r[++o]=bl(a);return r}if(i instanceof DOMMatrix){const r={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const a of o)r[a]=i[a];return r}if(typeof i=="bigint")return{$name:"BigInt",value:i.toString()};if(typeof i=="object"){const r=i.constructor,o=r._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const a=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(const c in i)i.hasOwnProperty(c)&&(Yu[o].omit.indexOf(c)>=0||(a[c]=bl(i[c],e)));i instanceof Error&&(a.message=i.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(a.$name=o),a}throw new Error("can't serialize object of type "+typeof i)}function Ql(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Rs(i)||ya(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Ql);if(typeof i=="object"){const e=i.$name||"Object";if(e==="Map"){const a=i.entries||[],c=new Map;for(let d=0;d<a.length;d+=2)c.set(Ql(a[d]),Ql(a[d+1]));return c}if(e==="Set"){const a=new Set;for(const c of Object.keys(i))c!=="$name"&&a.add(Ql(i[c]));return a}if(e==="DOMMatrix"){let a;return a=i.is2D?[i.a,i.b,i.c,i.d,i.e,i.f]:[i.m11,i.m12,i.m13,i.m14,i.m21,i.m22,i.m23,i.m24,i.m31,i.m32,i.m33,i.m34,i.m41,i.m42,i.m43,i.m44],new DOMMatrix(a)}if(e==="BigInt")return BigInt(i.value);const{klass:r}=Yu[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(i);const o=Object.create(r.prototype);for(const a of Object.keys(i))a!=="$name"&&(o[a]=Ql(i[a]));return o}throw new Error("can't deserialize object of type "+typeof i)}const Pr={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,Osage:i=>i>=66736&&i<=66815,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function wl(i){for(const e of i)if(va(e.charCodeAt(0)))return!0;return!1}function Qd(i){for(const e of i)if(!ef(e.charCodeAt(0)))return!1;return!0}function ef(i){return!(Pr.Arabic(i)||Pr["Arabic Supplement"](i)||Pr["Arabic Extended-A"](i)||Pr["Arabic Presentation Forms-A"](i)||Pr["Arabic Presentation Forms-B"](i))}function va(i){return!(i!==746&&i!==747&&(i<4352||!(Pr["Bopomofo Extended"](i)||Pr.Bopomofo(i)||Pr["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Pr["CJK Compatibility Ideographs"](i)||Pr["CJK Compatibility"](i)||Pr["CJK Radicals Supplement"](i)||Pr["CJK Strokes"](i)||!(!Pr["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Pr["CJK Unified Ideographs Extension A"](i)||Pr["CJK Unified Ideographs"](i)||Pr["Enclosed CJK Letters and Months"](i)||Pr["Hangul Compatibility Jamo"](i)||Pr["Hangul Jamo Extended-A"](i)||Pr["Hangul Jamo Extended-B"](i)||Pr["Hangul Jamo"](i)||Pr["Hangul Syllables"](i)||Pr.Hiragana(i)||Pr["Ideographic Description Characters"](i)||Pr.Kanbun(i)||Pr["Kangxi Radicals"](i)||Pr["Katakana Phonetic Extensions"](i)||Pr.Katakana(i)&&i!==12540||!(!Pr["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Pr["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Pr["Unified Canadian Aboriginal Syllabics"](i)||Pr["Unified Canadian Aboriginal Syllabics Extended"](i)||Pr["Vertical Forms"](i)||Pr["Yijing Hexagram Symbols"](i)||Pr["Yi Syllables"](i)||Pr["Yi Radicals"](i))))}function eu(i){return!(va(i)||function(e){return!!(Pr["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pr["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pr["Letterlike Symbols"](e)||Pr["Number Forms"](e)||Pr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pr["Control Pictures"](e)&&e!==9251||Pr["Optical Character Recognition"](e)||Pr["Enclosed Alphanumerics"](e)||Pr["Geometric Shapes"](e)||Pr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pr["CJK Symbols and Punctuation"](e)||Pr.Katakana(e)||Pr["Private Use Area"](e)||Pr["CJK Compatibility Forms"](e)||Pr["Small Form Variants"](e)||Pr["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function od(i){return Pr.Arabic(i)||Pr["Arabic Supplement"](i)||Pr["Arabic Extended-A"](i)||Pr["Arabic Presentation Forms-A"](i)||Pr["Arabic Presentation Forms-B"](i)}function tf(i){return i>=1424&&i<=2303||Pr["Arabic Presentation Forms-A"](i)||Pr["Arabic Presentation Forms-B"](i)}function sd(i,e){return!(!e&&tf(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Pr.Khmer(i))}function Uf(i){for(const e of i)if(tf(e.charCodeAt(0)))return!0;return!1}const Ku="deferred",Fa="loading",Ju="loaded";let Qu=null,No="unavailable",Sl=null;const Ba=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(No="error"),Qu&&Qu(i)};function Sh(){jc.fire(new Ks("pluginStateChange",{pluginStatus:No,pluginURL:Sl}))}const jc=new Ca,Kn=function(){return No},Th=function(){if(No!==Ku||!Sl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");No=Fa,Sh(),Sl&&Ta({url:Sl},i=>{i?Ba(i):(No=Ju,Sh())})},Js={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>No===Ju||Js.applyArabicShaping!=null,isLoading:()=>No===Fa,setState(i){No=i.pluginStatus,Sl=i.pluginURL},isParsed:()=>Js.applyArabicShaping!=null&&Js.processBidirectionalText!=null&&Js.processStyledBidirectionalText!=null,getPluginURL:()=>Sl};class Zi{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,o){for(const a of r)if(!sd(a.charCodeAt(0),o))return!1;return!0}(e,Js.isLoaded())}}class Tu{constructor(e,r,o,a){this.property=e,this.value=r,this.expression=function(c,d,g,y){if(Fc(c))return new bu(c,d);if(Wu(c)||Array.isArray(c)&&c.length>0){const x=Nc(c,d,g,y);if(x.result==="error")throw new Error(x.value.map(S=>`${S.key}: ${S.message}`).join(", "));return x.value}{let x=c;return typeof c=="string"&&d.type==="color"&&(x=ai.parse(c)),{kind:"constant",configDependencies:new Set,evaluate:()=>x}}}(r===void 0?e.specification.default:r,e.specification,o,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,o){return this.property.possiblyEvaluate(this,e,r,o)}}class Tl{constructor(e,r,o){this.property=e,this.value=new Tu(e,void 0,r,o)}transitioned(e,r){return new _o(this.property,this.value,r,Je({},e.transition,this.transition),e.now)}untransitioned(){return new _o(this.property,this.value,null,{},0)}}class Eu{constructor(e,r,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=o,this.configDependencies=new Set}getValue(e){return Xr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Tl(this._values[e].property,this._scope,this._options)),this._values[e].value=new Tu(this._values[e].property,r===null?void 0:Xr(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);const o=this._properties.properties;if(e)for(const a in e){const c=e[a];if(a.endsWith("-transition")){const d=a.slice(0,-11);o[d]&&this.setTransition(d,c)}else o.hasOwnProperty(a)&&this.setValue(a,c)}}getTransition(e){return Xr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Tl(this._values[e].property)),this._values[e].transition=Xr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o);const a=this.getTransition(r);a!==void 0&&(e[`${r}-transition`]=a)}return e}transitioned(e,r){const o=new Vo(this._properties);for(const a of Object.keys(this._values))o._values[a]=this._values[a].transitioned(e,r._values[a]);return o}untransitioned(){const e=new Vo(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class _o{constructor(e,r,o,a,c){const d=a.delay||0,g=a.duration||0;c=c||0,this.property=e,this.value=r,this.begin=c+d,this.end=this.begin+g,e.specification.transition&&(a.delay||a.duration)&&(this.prior=o)}possiblyEvaluate(e,r,o){const a=e.now||0,c=this.value.possiblyEvaluate(e,r,o),d=this.prior;if(d){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return d.possiblyEvaluate(e,r,o);{const g=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,r,o),c,Ce(g))}}return c}}class Vo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,o){const a=new il(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,r,o);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cs{constructor(e,r,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=o,this.configDependencies=new Set}getValue(e){return Xr(this._values[e].value)}setValue(e,r){this._values[e]=new Tu(this._values[e].property,r===null?void 0:Xr(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(e[r]=o)}return e}possiblyEvaluate(e,r,o){const a=new il(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,r,o);return a}}class tu{constructor(e,r,o){this.property=e,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,o,a){return this.property.evaluate(this.value,this.parameters,e,r,o,a)}}class il{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ut{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,o){const a=Ya[this.specification.type];return a?a(e,r,o):e}}class ar{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,o,a){return new tu(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},o,a)}:e.expression,r)}interpolate(e,r,o){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new tu(this,{kind:"constant",value:void 0},e.parameters);const a=Ya[this.specification.type];return a?new tu(this,{kind:"constant",value:a(e.value.value,r.value.value,o)},e.parameters):e}evaluate(e,r,o,a,c,d){return e.kind==="constant"?e.value:e.evaluate(r,o,a,c,d)}}class So{constructor(e){this.specification=e}possiblyEvaluate(e,r,o,a){return!!e.expression.evaluate(r,null,{},o,a)}interpolate(){return!1}}class kn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new Zi(0,{});for(const o in e){const a=e[o];a.specification.overridable&&this.overridableProperties.push(o);const c=this.defaultPropertyValues[o]=new Tu(a,void 0),d=this.defaultTransitionablePropertyValues[o]=new Tl(a);this.defaultTransitioningPropertyValues[o]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=c.possiblyEvaluate(r)}}}ir(ar,"DataDrivenProperty"),ir(Ut,"DataConstantProperty"),ir(So,"ColorRampProperty");var Ze=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white"},"sky-atmosphere-color":{"type":"color","default":"white"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function xa(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function ba(i){if(Array.isArray(i))return i.map(ba);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const r in i)e[r]=ba(i[r]);return e}return xa(i)}function qs(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!qs(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ec(i,e="",r=null,o="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qs(i)||(i=Eh(i));const a=i;let c=!0;try{c=function(S){if(!tc(S))return S;let T=ba(S);return ld(T),T=ad(T),T}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let d=null,g=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){g=Ze[`filter_${o}`];const S=Zu(c,g,e,r);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));d=(T,I,R)=>S.value.evaluate(T,I,{},R)}let y=null,x=null;if(c!==a){const S=Zu(a,g,e,r);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));y=(T,I,R,D,O)=>S.value.evaluate(T,I,{},R,void 0,void 0,D,O),x=!_u(S.value.expression)}return{filter:d,dynamicFilter:y||void 0,needGeometry:rf(c),needFeature:!!x}}function ad(i){if(!Array.isArray(i))return i;const e=function(r){if(qf.has(r[0])){for(let o=1;o<r.length;o++)if(tc(r[o]))return!0}return r}(i);return e===!0?e:e.map(r=>ad(r))}function ld(i){let e=!1;const r=[];if(i[0]==="case"){for(let o=1;o<i.length-1;o+=2)e=e||tc(i[o]),r.push(i[o+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||tc(i[1]);for(let o=2;o<i.length-1;o+=2)r.push(i[o+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||tc(i[1]);for(let o=1;o<i.length-1;o+=2)r.push(i[o+1])}e&&(i.length=0,i.push("any",...r));for(let o=1;o<i.length;o++)ld(i[o])}function tc(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(tc(i[r]))return!0;return!1}const qf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Gf(i,e){return i<e?-1:i>e?1:0}function rf(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(rf(i[e]))return!0;return!1}function Eh(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ud(i[1],i[2],"=="):e==="!="?Iu(ud(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ud(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Eh))):e==="all"?["all"].concat(i.slice(1).map(Eh)):e==="none"?["all"].concat(i.slice(1).map(Eh).map(Iu)):e==="in"?cd(i[1],i.slice(2)):e==="!in"?Iu(cd(i[1],i.slice(2))):e==="has"?nf(i[1]):e!=="!has"||Iu(nf(i[1]));var r}function ud(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function cd(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Gf)]]:["filter-in-small",i,["literal",e]]}}function nf(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Iu(i){return["!",i]}const Uc="";function El(i,e){return e?`${i}${Uc}${e}`:i}const qc="-transition",ru=new Set(["fill","line","background","hillshade","raster"]);class hs extends Ca{constructor(e,r,o,a,c){if(super(),this.id=e.id,this.fqid=El(this.id,o),this.type=e.type,this.scope=o,this.lut=a,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=Zu(this.filter,Ze[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new cs(r.layout,this.scope,c),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new Eu(r.paint,this.scope,c);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new il(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&ru.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(qc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const o=this._transitionablePaint,a=o._properties.properties;if(e.endsWith(qc)){const T=e.slice(0,-11);return a[T]&&o.setTransition(T,r||void 0),!1}if(!a[e])return!1;const c=o._values[e],d=c.value.isDataDriven(),g=c.value;o.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const y=o._values[e].value,x=y.isDataDriven(),S=e.endsWith("pattern")||e==="line-dasharray";return x||d||S||this._handleOverridablePaintPropertyUpdate(e,g,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,o){return null}_handleOverridablePaintPropertyUpdate(e,r,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return Zr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof tu&&io(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=ec(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,o,a,c,d,g,y,x){}}const Hf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Fi(i,e=1){let r=0,o=0;return{members:i.map(a=>{const c=Hf[a.type].BYTES_PER_ELEMENT,d=r=Ih(r,Math.max(e,c)),g=a.components||1;return o=Math.max(o,c),r+=c*g,{name:a.name,type:a.type,components:g,offset:d}}),size:Ih(r,Math.max(o,e)),alignment:e}}function Ih(i,e){return Math.ceil(i/e)*e}class Il extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const a=2*e;return this.int16[a+0]=r,this.int16[a+1]=o,e}}Il.prototype.bytesPerElement=4,ir(Il,"StructArrayLayout2i4");class Ah extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const c=3*e;return this.int16[c+0]=r,this.int16[c+1]=o,this.int16[c+2]=a,e}}Ah.prototype.bytesPerElement=6,ir(Ah,"StructArrayLayout3i6");class Au extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,o,a)}emplace(e,r,o,a,c){const d=4*e;return this.int16[d+0]=r,this.int16[d+1]=o,this.int16[d+2]=a,this.int16[d+3]=c,e}}Au.prototype.bytesPerElement=8,ir(Au,"StructArrayLayout4i8");class Hc extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Hc.prototype.bytesPerElement=4,ir(Hc,"StructArrayLayout1f4");class Ch extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const c=4*e,d=2*e;return this.int16[c+0]=r,this.int16[c+1]=o,this.float32[d+1]=a,e}}Ch.prototype.bytesPerElement=8,ir(Ch,"StructArrayLayout2i1f8");class $c extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const c=4*e;return this.int16[c+0]=r,this.int16[c+1]=o,this.int16[c+2]=a,e}}$c.prototype.bytesPerElement=8,ir($c,"StructArrayLayout3i8");class of extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o,a,c)}emplace(e,r,o,a,c,d){const g=5*e;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=a,this.int16[g+3]=c,this.int16[g+4]=d,e}}of.prototype.bytesPerElement=10,ir(of,"StructArrayLayout5i10");class hd extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,a,c,d,g)}emplace(e,r,o,a,c,d,g,y){const x=6*e,S=12*e,T=3*e;return this.int16[x+0]=r,this.int16[x+1]=o,this.uint8[S+4]=a,this.uint8[S+5]=c,this.uint8[S+6]=d,this.uint8[S+7]=g,this.float32[T+2]=y,e}}hd.prototype.bytesPerElement=12,ir(hd,"StructArrayLayout2i4ub1f12");class nl extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const c=3*e;return this.float32[c+0]=r,this.float32[c+1]=o,this.float32[c+2]=a,e}}nl.prototype.bytesPerElement=12,ir(nl,"StructArrayLayout3f12");class Al extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o,a,c)}emplace(e,r,o,a,c,d){const g=6*e,y=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=o,this.uint16[g+2]=a,this.uint16[g+3]=c,this.float32[y+2]=d,e}}Al.prototype.bytesPerElement=12,ir(Al,"StructArrayLayout4ui1f12");class rc extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,o,a)}emplace(e,r,o,a,c){const d=4*e;return this.uint16[d+0]=r,this.uint16[d+1]=o,this.uint16[d+2]=a,this.uint16[d+3]=c,e}}rc.prototype.bytesPerElement=8,ir(rc,"StructArrayLayout4ui8");class ic extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,a,c,d)}emplace(e,r,o,a,c,d,g){const y=6*e;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=a,this.int16[y+3]=c,this.int16[y+4]=d,this.int16[y+5]=g,e}}ic.prototype.bytesPerElement=12,ir(ic,"StructArrayLayout6i12");class Wc extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g,y,x,S,T,I){const R=this.length;return this.resize(R+1),this.emplace(R,e,r,o,a,c,d,g,y,x,S,T,I)}emplace(e,r,o,a,c,d,g,y,x,S,T,I,R){const D=12*e;return this.int16[D+0]=r,this.int16[D+1]=o,this.int16[D+2]=a,this.int16[D+3]=c,this.uint16[D+4]=d,this.uint16[D+5]=g,this.uint16[D+6]=y,this.uint16[D+7]=x,this.int16[D+8]=S,this.int16[D+9]=T,this.int16[D+10]=I,this.int16[D+11]=R,e}}Wc.prototype.bytesPerElement=24,ir(Wc,"StructArrayLayout4i4ui4i24");class Gs extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,a,c,d)}emplace(e,r,o,a,c,d,g){const y=10*e,x=5*e;return this.int16[y+0]=r,this.int16[y+1]=o,this.int16[y+2]=a,this.float32[x+2]=c,this.float32[x+3]=d,this.float32[x+4]=g,e}}Gs.prototype.bytesPerElement=20,ir(Gs,"StructArrayLayout3i3f20");class jo extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,o,a)}emplace(e,r,o,a,c){const d=4*e;return this.float32[d+0]=r,this.float32[d+1]=o,this.float32[d+2]=a,this.float32[d+3]=c,e}}jo.prototype.bytesPerElement=16,ir(jo,"StructArrayLayout4f16");class Mh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Mh.prototype.bytesPerElement=4,ir(Mh,"StructArrayLayout1ul4");class ol extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const a=2*e;return this.uint16[a+0]=r,this.uint16[a+1]=o,e}}ol.prototype.bytesPerElement=4,ir(ol,"StructArrayLayout2ui4");class dd extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g,y,x,S,T,I,R){const D=this.length;return this.resize(D+1),this.emplace(D,e,r,o,a,c,d,g,y,x,S,T,I,R)}emplace(e,r,o,a,c,d,g,y,x,S,T,I,R,D){const O=20*e,W=10*e;return this.int16[O+0]=r,this.int16[O+1]=o,this.int16[O+2]=a,this.int16[O+3]=c,this.int16[O+4]=d,this.float32[W+3]=g,this.float32[W+4]=y,this.float32[W+5]=x,this.float32[W+6]=S,this.int16[O+14]=T,this.uint32[W+8]=I,this.uint16[O+18]=R,this.uint16[O+19]=D,e}}dd.prototype.bytesPerElement=40,ir(dd,"StructArrayLayout5i4f1i1ul2ui40");class Ph extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,a,c,d,g)}emplace(e,r,o,a,c,d,g,y){const x=8*e;return this.int16[x+0]=r,this.int16[x+1]=o,this.int16[x+2]=a,this.int16[x+4]=c,this.int16[x+5]=d,this.int16[x+6]=g,this.int16[x+7]=y,e}}Ph.prototype.bytesPerElement=16,ir(Ph,"StructArrayLayout3i2i2i16");class Zc extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o,a,c)}emplace(e,r,o,a,c,d){const g=4*e,y=8*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=a,this.int16[y+6]=c,this.int16[y+7]=d,e}}Zc.prototype.bytesPerElement=16,ir(Zc,"StructArrayLayout2f1f2i16");class Rh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,o,a,c,d)}emplace(e,r,o,a,c,d,g){const y=20*e,x=5*e;return this.uint8[y+0]=r,this.uint8[y+1]=o,this.float32[x+1]=a,this.float32[x+2]=c,this.float32[x+3]=d,this.float32[x+4]=g,e}}Rh.prototype.bytesPerElement=20,ir(Rh,"StructArrayLayout2ub4f20");class ao extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,r,o)}emplace(e,r,o,a){const c=3*e;return this.uint16[c+0]=r,this.uint16[c+1]=o,this.uint16[c+2]=a,e}}ao.prototype.bytesPerElement=6,ir(ao,"StructArrayLayout3ui6");class Dh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X,oe,re,B,J){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X,oe,re,B,J)}emplace(e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X,oe,re,B,J,ie){const ce=30*e,Ie=15*e,Pe=60*e;return this.int16[ce+0]=r,this.int16[ce+1]=o,this.int16[ce+2]=a,this.float32[Ie+2]=c,this.float32[Ie+3]=d,this.uint16[ce+8]=g,this.uint16[ce+9]=y,this.uint32[Ie+5]=x,this.uint32[Ie+6]=S,this.uint32[Ie+7]=T,this.uint16[ce+16]=I,this.uint16[ce+17]=R,this.uint16[ce+18]=D,this.float32[Ie+10]=O,this.float32[Ie+11]=W,this.uint8[Pe+48]=X,this.uint8[Pe+49]=oe,this.uint8[Pe+50]=re,this.uint32[Ie+13]=B,this.int16[ce+28]=J,this.uint8[Pe+58]=ie,e}}Dh.prototype.bytesPerElement=60,ir(Dh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class kh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X,oe,re,B,J,ie,ce,Ie,Pe,Le,Ue,ct,Pt,Tt,At,Nt,at){const It=this.length;return this.resize(It+1),this.emplace(It,e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X,oe,re,B,J,ie,ce,Ie,Pe,Le,Ue,ct,Pt,Tt,At,Nt,at)}emplace(e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X,oe,re,B,J,ie,ce,Ie,Pe,Le,Ue,ct,Pt,Tt,At,Nt,at,It){const nt=20*e,ut=40*e,jt=80*e;return this.float32[nt+0]=r,this.float32[nt+1]=o,this.int16[ut+4]=a,this.int16[ut+5]=c,this.int16[ut+6]=d,this.int16[ut+7]=g,this.int16[ut+8]=y,this.int16[ut+9]=x,this.int16[ut+10]=S,this.int16[ut+11]=T,this.int16[ut+12]=I,this.uint16[ut+13]=R,this.uint16[ut+14]=D,this.uint16[ut+15]=O,this.uint16[ut+16]=W,this.uint16[ut+17]=X,this.uint16[ut+18]=oe,this.uint16[ut+19]=re,this.uint16[ut+20]=B,this.uint16[ut+21]=J,this.uint16[ut+22]=ie,this.uint16[ut+23]=ce,this.uint16[ut+24]=Ie,this.uint16[ut+25]=Pe,this.uint16[ut+26]=Le,this.uint16[ut+27]=Ue,this.uint32[nt+14]=ct,this.float32[nt+15]=Pt,this.float32[nt+16]=Tt,this.float32[nt+17]=At,this.float32[nt+18]=Nt,this.uint8[jt+76]=at,this.uint16[ut+39]=It,e}}kh.prototype.bytesPerElement=80,ir(kh,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Cu extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,o,a,c)}emplace(e,r,o,a,c,d){const g=5*e;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=a,this.float32[g+3]=c,this.float32[g+4]=d,e}}Cu.prototype.bytesPerElement=20,ir(Cu,"StructArrayLayout5f20");class Xc extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,a,c,d,g)}emplace(e,r,o,a,c,d,g,y){const x=7*e;return this.float32[x+0]=r,this.float32[x+1]=o,this.float32[x+2]=a,this.float32[x+3]=c,this.float32[x+4]=d,this.float32[x+5]=g,this.float32[x+6]=y,e}}Xc.prototype.bytesPerElement=28,ir(Xc,"StructArrayLayout7f28");class fd extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g,y,x,S,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,o,a,c,d,g,y,x,S,T)}emplace(e,r,o,a,c,d,g,y,x,S,T,I){const R=11*e;return this.float32[R+0]=r,this.float32[R+1]=o,this.float32[R+2]=a,this.float32[R+3]=c,this.float32[R+4]=d,this.float32[R+5]=g,this.float32[R+6]=y,this.float32[R+7]=x,this.float32[R+8]=S,this.float32[R+9]=T,this.float32[R+10]=I,e}}fd.prototype.bytesPerElement=44,ir(fd,"StructArrayLayout11f44");class Lh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g,y,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,r,o,a,c,d,g,y,x)}emplace(e,r,o,a,c,d,g,y,x,S){const T=9*e;return this.float32[T+0]=r,this.float32[T+1]=o,this.float32[T+2]=a,this.float32[T+3]=c,this.float32[T+4]=d,this.float32[T+5]=g,this.float32[T+6]=y,this.float32[T+7]=x,this.float32[T+8]=S,e}}Lh.prototype.bytesPerElement=36,ir(Lh,"StructArrayLayout9f36");class Mu extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,r)}emplace(e,r,o){const a=2*e;return this.float32[a+0]=r,this.float32[a+1]=o,e}}Mu.prototype.bytesPerElement=8,ir(Mu,"StructArrayLayout2f8");class pd extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,o,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,o,a)}emplace(e,r,o,a,c){const d=6*e;return this.uint32[3*e+0]=r,this.uint16[d+2]=o,this.uint16[d+3]=a,this.uint16[d+4]=c,e}}pd.prototype.bytesPerElement=12,ir(pd,"StructArrayLayout1ul3ui12");class zh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}zh.prototype.bytesPerElement=2,ir(zh,"StructArrayLayout1ui2");class Zo extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W){const X=this.length;return this.resize(X+1),this.emplace(X,e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W)}emplace(e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X){const oe=16*e;return this.float32[oe+0]=r,this.float32[oe+1]=o,this.float32[oe+2]=a,this.float32[oe+3]=c,this.float32[oe+4]=d,this.float32[oe+5]=g,this.float32[oe+6]=y,this.float32[oe+7]=x,this.float32[oe+8]=S,this.float32[oe+9]=T,this.float32[oe+10]=I,this.float32[oe+11]=R,this.float32[oe+12]=D,this.float32[oe+13]=O,this.float32[oe+14]=W,this.float32[oe+15]=X,e}}Zo.prototype.bytesPerElement=64,ir(Zo,"StructArrayLayout16f64");class Xo extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,o,a,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,o,a,c,d,g)}emplace(e,r,o,a,c,d,g,y){const x=10*e,S=5*e;return this.uint16[x+0]=r,this.uint16[x+1]=o,this.uint16[x+2]=a,this.uint16[x+3]=c,this.float32[S+2]=d,this.float32[S+3]=g,this.float32[S+4]=y,e}}Xo.prototype.bytesPerElement=20,ir(Xo,"StructArrayLayout4ui3f20");class md extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}md.prototype.bytesPerElement=2,ir(md,"StructArrayLayout1i2");class Oh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Oh.prototype.bytesPerElement=1,ir(Oh,"StructArrayLayout1ub1");class sf extends Gc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}sf.prototype.size=40;class Fh extends dd{get(e){return new sf(this,e)}}ir(Fh,"CollisionBoxArray");class af extends Gc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}af.prototype.size=60;class gd extends Dh{get(e){return new af(this,e)}}ir(gd,"PlacedSymbolArray");class lf extends Gc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}lf.prototype.size=80;class _d extends kh{get(e){return new lf(this,e)}}ir(_d,"SymbolInstanceArray");class yd extends Hc{getoffsetX(e){return this.float32[1*e+0]}}ir(yd,"GlyphOffsetArray");class uf extends Il{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ir(uf,"SymbolLineVertexArray");class vd extends Gc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}vd.prototype.size=12;class xd extends pd{get(e){return new vd(this,e)}}ir(xd,"FeatureIndexArray");class cf extends ol{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ir(cf,"FillExtrusionCentroidArray");class bd extends Gc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}bd.prototype.size=6;class Bh extends Ah{get(e){return new bd(this,e)}}ir(Bh,"FillExtrusionWallArray");const vp=Fi([{name:"a_pos",components:2,type:"Int16"}],4),$f=Fi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Sn{constructor(e=[]){this.segments=e}_prepareSegment(e,r,o,a){let c=this.segments[this.segments.length-1];return e>Sn.MAX_VERTEX_ARRAY_LENGTH&&Jr(`Max vertices per segment is ${Sn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>Sn.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:r,primitiveOffset:o,vertexLength:0,primitiveLength:0},a!==void 0&&(c.sortKey=a),this.segments.push(c)),c}prepareSegment(e,r,o,a){return this._prepareSegment(e,r.length,o.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,o,a){return new Sn([{vertexOffset:e,primitiveOffset:r,vertexLength:o,primitiveLength:a,vaos:{},sortKey:0}])}}function hf(i,e){return 256*(i=ke(Math.floor(i),0,255))+ke(Math.floor(e),0,255)}Sn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ir(Sn,"SegmentVector");const wd=Fi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Qs=Fi([{name:"a_pattern_b",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),xp=Fi([{name:"a_dash",components:4,type:"Uint16"}]);class nc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,o,a){this.ids.push(Sd(e)),this.positions.push(r,o,a)}eachPosition(e,r){const o=Sd(e);let a=0,c=this.ids.length-1;for(;a<c;){const d=a+c>>1;this.ids[d]>=o?c=d:a=d+1}for(;this.ids[a]===o;)r(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,r){const o=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Nh(o,a,0,o.length-1),r&&(r.add(o.buffer),r.add(a.buffer)),{ids:o,positions:a}}static deserialize(e){const r=new nc;let o;r.ids=e.ids,r.positions=e.positions;for(const a of r.ids)a!==o&&r.uniqueIds.push(a),o=a;return r.indexed=!0,r}}function Sd(i){const e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Co(String(i))}function Nh(i,e,r,o){for(;r<o;){const a=i[r+o>>1];let c=r-1,d=o+1;for(;;){do c++;while(i[c]<a);do d--;while(i[d]>a);if(c>=d)break;Yc(i,c,d),Yc(e,3*c,3*d),Yc(e,3*c+1,3*d+1),Yc(e,3*c+2,3*d+2)}d-r<o-d?(Nh(i,e,r,d),r=d+1):(Nh(i,e,d+1,o),o=d)}}function Yc(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}ir(nc,"FeaturePositionMap");class ea{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Yo extends ea{constructor(e){super(e),this.current=0}set(e,r,o){this.fetchUniformLocation(e,r)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class lo extends ea{constructor(e){super(e),this.current=0}set(e,r,o){this.fetchUniformLocation(e,r)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class sl extends ea{constructor(e){super(e),this.current=[0,0]}set(e,r,o){this.fetchUniformLocation(e,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Pu extends ea{constructor(e){super(e),this.current=[0,0,0]}set(e,r,o){this.fetchUniformLocation(e,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class Ko extends ea{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,o){this.fetchUniformLocation(e,r)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Wf extends ea{constructor(e){super(e),this.current=ai.transparent.toRenderColor(null)}set(e,r,o){this.fetchUniformLocation(e,r)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Qr=new Float32Array(16);class Cl extends ea{constructor(e){super(e),this.current=Qr}set(e,r,o){if(this.fetchUniformLocation(e,r)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let a=1;a<16;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Td=new Float32Array(9),Ed=new Float32Array(4);class Na extends ea{constructor(e){super(e),this.current=Ed}set(e,r,o){if(this.fetchUniformLocation(e,r)){for(let a=0;a<4;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function iu(i){return[hf(255*i.r,255*i.g),hf(255*i.b,255*i.a)]}class Ru{constructor(e,r,o,a){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=o,this.context=a}setUniform(e,r,o,a,c){const d=a.constantOr(this.value);r.set(e,c,d instanceof ai?d.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):d)}getBinding(e,r){return this.type==="color"?new Wf(e):new lo(e)}}class Du{constructor(e,r){this.uniformNames=r.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,r){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=r?r.tl.concat(r.br):this.pattern}setUniform(e,r,o,a,c){let d=null;c!=="u_pattern"&&c!=="u_dash"||(d=this.pattern),c==="u_pattern_b"&&(d=this.patternTransition),c==="u_pixel_ratio"&&(d=this.pixelRatio),d&&r.set(e,c,d)}getBinding(e,r){return r==="u_pattern"||r==="u_pattern_b"||r==="u_dash"?new Ko(e):new lo(e)}}class Ml{constructor(e,r,o,a){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,r,o,a,c,d,g){const y=this.paintVertexArray.length,x=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Zi(0,{brightness:d}),r,{},c,a,g):this.expression.kind==="constant"&&this.expression.value,S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:d}),r,{},c,a,g):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(y,e,x,S?null:this.context.lut)}updatePaintArray(e,r,o,a,c,d,g){const y=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g},o,a,void 0,c):this.expression.kind==="constant"&&this.expression.value,x=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:g}),o,a,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,r,y,x?null:this.context.lut)}_setPaintValue(e,r,o,a){if(this.type==="color"){const c=iu(o.toRenderColor(a));for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Va{constructor(e,r,o,a,c,d){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=a,this.context=c,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,o,a,c,d,g){const y=this.expression.evaluate(new Zi(this.context.zoom,{brightness:d}),r,{},c,a,g),x=this.expression.evaluate(new Zi(this.context.zoom+1,{brightness:d}),r,{},c,a,g),S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:d}),r,{},c,a,g):this.lutExpression.value)==="none",T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,y,x,S?null:this.context.lut)}updatePaintArray(e,r,o,a,c,d,g){const y=this.expression.evaluate({zoom:this.context.zoom,brightness:g},o,a,void 0,c),x=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},o,a,void 0,c),S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Zi(0,{brightness:g}),o,a,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,r,y,x,S?null:this.context.lut)}_setPaintValue(e,r,o,a,c){if(this.type==="color"){const d=iu(o.toRenderColor(c)),g=iu(o.toRenderColor(c));for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],g[0],g[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,o,a);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,o,a,c){const d=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,g=ke(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);r.set(e,c,g)}getBinding(e,r){return new lo(e)}}class ja{constructor(e,r,o,a,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(o==="array"?xp:wd).members;for(let d=0;d<r.length;++d);this.paintVertexArray=new a,this.paintTransitionVertexArray=new Al}populatePaintArray(e,r,o,a){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(e,r,o,a,c,d,g){this._setPaintValues(e,r,o.patterns&&o.patterns[this.layerId],d)}_setPaintValues(e,r,o,a){if(!a||!o)return;const c=a[o[0]],d=a[o[1]];if(c){if(c){const{tl:g,br:y,pixelRatio:x}=c;for(let S=e;S<r;S++)this.paintVertexArray.emplace(S,g[0],g[1],y[0],y[1],x)}if(d){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:g,br:y,pixelRatio:x}=d;for(let S=e;S<r;S++)this.paintTransitionVertexArray.emplace(S,g[0],g[1],y[0],y[1],x)}}}upload(e){const r=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,r)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Qs.members,r))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Pl{constructor(e,r,o=()=>!0){this.binders={},this._buffers=[],this.context=r;const a=[];for(const c in e.paint._values){const d=e.paint.get(c);if(c.endsWith("-use-theme")||!o(c)||!(d instanceof tu&&io(d.property.specification)))continue;const g=t(c,e.type),y=d.value,x=d.property.specification.type,S=!!d.property.useIntegerZoom,T=c==="line-dasharray"||c.endsWith("pattern"),I=e.paint.get(`${c}-use-theme`),R=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||I&&I.value.kind!=="constant";if(y.kind!=="constant"||R)if(y.kind==="source"||R||T){const D=f(c,x,"source");this.binders[c]=T?new ja(y,g,x,D,e.id):new Ml(y,g,x,D),a.push(`/a_${c}`)}else{const D=f(c,x,"composite");this.binders[c]=new Va(y,g,x,S,r,D),a.push(`/z_${c}`)}else this.binders[c]=T?new Du(y.value,g):new Ru(y.value,g,x,r),a.push(`/u_${c}`);I&&(this.binders[c].lutExpression=I.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Ml||r instanceof Va?r.maxValue:0}populatePaintArrays(e,r,o,a,c,d,g){for(const y in this.binders){const x=this.binders[y];x.context=this.context,(x instanceof Ml||x instanceof Va||x instanceof ja)&&x.populatePaintArray(e,r,o,a,c,d,g)}}setConstantPatternPositions(e,r){for(const o in this.binders){const a=this.binders[o];a instanceof Du&&a.setConstantPatternPositions(e,r)}}getPatternTransitionVertexBuffer(e){const r=this.binders[e];return r instanceof ja?r.paintTransitionVertexBuffer:null}updatePaintArrays(e,r,o,a,c,d,g,y,x){let S=!1;const T=Object.keys(e),I=T.length!==0&&!y,R=I?T:r.uniqueIds;this.context.lut=c.lut;for(const D in this.binders){const O=this.binders[D];if(O.context=this.context,(O instanceof Ml||O instanceof Va||O instanceof ja)&&O.expression&&O.expression.kind&&O.expression.kind!=="constant"&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){const W=c.paint.get(D);O.expression=W.value;for(const X of R){const oe=e[X.toString()];r.eachPosition(X,(re,B,J)=>{const ie=a.feature(re);O.updatePaintArray(B,J,ie,oe,d,g,x)})}if(!I)for(const X of o.uniqueIds){const oe=e[X.toString()];o.eachPosition(X,(re,B,J)=>{const ie=a.feature(re);O.updatePaintArray(B,J,ie,oe,d,g,x)})}S=!0}}return S}defines(){const e=[];for(const r in this.binders){const o=this.binders[r];(o instanceof Ru||o instanceof Du)&&e.push(...o.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Ml||o instanceof Va||o instanceof ja)for(let a=0;a<o.paintVertexAttributes.length;a++)e.push(o.paintVertexAttributes[a].name);if(o instanceof ja)for(let a=0;a<Qs.members.length;a++)e.push(Qs.members[a].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Ru||o instanceof Du||o instanceof Va)for(const a of o.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof Ru||a instanceof Du||a instanceof Va)for(const c of a.uniformNames)r.push({name:c,property:o,binding:a.getBinding(e,c)})}return r}setUniforms(e,r,o,a,c){for(const{name:d,property:g,binding:y}of o)this.binders[g].setUniform(e,y,c,a.get(g),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Ml||r instanceof Va||r instanceof ja)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer),r instanceof ja&&r.paintTransitionVertexBuffer&&this._buffers.push(r.paintTransitionVertexBuffer)}}upload(e){for(const r in this.binders){const o=this.binders[r];(o instanceof Ml||o instanceof Va||o instanceof ja)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Ml||r instanceof Va||r instanceof ja)&&r.destroy()}}}class nu{constructor(e,r,o=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Pl(a,r,o);this.needsUpload=!1,this._featureMap=new nc,this._featureMapWithoutIds=new nc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,o,a,c,d,g,y){for(const x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,r,a,c,d,g,y);r.id!==void 0?this._featureMap.add(r.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,o,a,c,d,g){for(const y of o)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,y,a,c,d,g||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const l={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"]};function t(i,e){return l[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const n={"line-pattern":{source:Al,composite:Al},"fill-pattern":{source:Al,composite:Al},"fill-extrusion-pattern":{source:Al,composite:Al},"line-dasharray":{source:rc,composite:rc}},u={color:{source:Mu,composite:jo},number:{source:Hc,composite:Mu}};function f(i,e,r){const o=n[i];return o&&o[r]||u[e][r]}ir(Ru,"ConstantBinder"),ir(Du,"PatternConstantBinder"),ir(Ml,"SourceExpressionBinder"),ir(ja,"PatternCompositeBinder"),ir(Va,"CompositeExpressionBinder"),ir(Pl,"ProgramConfiguration",{omit:["_buffers"]}),ir(nu,"ProgramConfigurationSet");const m=Wt/Math.PI/2,_=5,v=6,w=16383,E=64,A=[E,32,16],P=-m,M=m;function k(i,e,r,o=m){return r=G(r),[i*Math.sin(r)*o,-e*o,i*Math.cos(r)*o]}function q(i,e,r){return k(Math.cos(G(i)),Math.sin(G(i)),e,r)}const V=63710088e-1,$=2*Math.PI*V;class U{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new U(Qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,o=this.lat*r,a=e.lat*r,c=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos((e.lng-this.lng)*r);return V*Math.acos(Math.min(c,1))}toBounds(e=0){const r=360*e/40075017,o=r/Math.cos(Math.PI/180*this.lat);return new ee({lng:this.lng-o,lat:this.lat-r},{lng:this.lng+o,lat:this.lat+r})}toEcef(e){return q(this.lat,this.lng,m+e*m/V)}static convert(e){if(e instanceof U)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new U(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new U(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ee{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}setSouthWest(e){return this._sw=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}extend(e){const r=this._sw,o=this._ne;let a,c;if(e instanceof U)a=e,c=e;else{if(!(e instanceof ee))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ee.convert(e)):this.extend(U.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(U.convert(e)):this;if(a=e._sw,c=e._ne,!a||!c)return this}return r||o?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),o.lng=Math.max(c.lng,o.lng),o.lat=Math.max(c.lat,o.lat)):(this._sw=new U(a.lng,a.lat),this._ne=new U(c.lng,c.lat)),this}getCenter(){return new U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new U(this.getWest(),this.getNorth())}getSouthEast(){return new U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:o}=U.convert(e);let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&a}static convert(e){if(e)return e instanceof ee?e:new ee(e)}}const se=0,ae=25.5;function xe(i){return $*Math.cos(i*Math.PI/180)}function ye(i){return(180+i)/360}function me(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function he(i,e){return i/xe(e)}function Te(i){return 360*i-180}function Ae(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function rt(i,e){return i*xe(Ae(e))}const Ge=85.051129;function ft(i){return Math.cos(G(ke(i,-85.051129,Ge)))}function mt(i,e){const r=ke(e,se,ae),o=Math.pow(2,r);return ft(i)*$/(512*o)}function Bt(i){return 1/Math.cos(i*Math.PI/180)}function je(i,e=0){const r=Math.exp(Math.PI*(1-(i.y+e/Wt)/(1<<i.z)*2));return 80150034*r/(r*r+1)/Wt/(1<<i.z)}class tt{constructor(e,r,o=0){this.x=+e,this.y=+r,this.z=+o}static fromLngLat(e,r=0){const o=U.convert(e);return new tt(ye(o.lng),me(o.lat),he(r,o.lat))}toLngLat(){return new U(Te(this.x),Ae(this.y))}toAltitude(){return rt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$*Bt(Ae(this.y))}}function Ve(i,e,r,o,a,c,d,g,y){const x=(e+o)/2,S=(r+a)/2,T=new Ot(x,S);g(T),function(I,R,D,O,W,X){const oe=D-W,re=O-X;return Math.abs((O-R)*oe-(D-I)*re)/Math.hypot(oe,re)}(T.x,T.y,c.x,c.y,d.x,d.y)>=y?(Ve(i,e,r,x,S,c,T,g,y),Ve(i,x,S,o,a,T,d,g,y)):i.push(d)}function vt(i,e,r){let o=i[0],a=o.x,c=o.y;e(o);const d=[o];for(let g=1;g<i.length;g++){const y=i[g],{x,y:S}=y;e(y),Ve(d,a,c,x,S,o,y,e,r),a=x,c=S,o=y}return d}function it(i,e,r,o){if(o(e,r)){const a=e.add(r)._mult(.5);it(i,e,a,o),it(i,a,r,o)}else i.push(r)}function Et(i,e){let r=i[0];const o=[r];for(let a=1;a<i.length;a++){const c=i[a];it(o,r,c,e),r=c}return o}const yt=Math.pow(2,14)-1,Mt=-yt-1;function Dt(i,e){const r=Math.round(i.x*e),o=Math.round(i.y*e);return i.x=ke(r,Mt,yt),i.y=ke(o,Mt,yt),(r<i.x||r>i.x+1||o<i.y||o>i.y+1)&&Jr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function ur(i,e,r){const o=i.loadGeometry(),a=i.extent,c=Wt/a;if(e&&r&&r.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:g,x:y,y:x,projection:S}=r,T=I=>{const R=Te((e.x+I.x/a)/d),D=Ae((e.y+I.y/a)/d),O=S.project(R,D);I.x=(O.x*g-y)*a,I.y=(O.y*g-x)*a};for(let I=0;I<o.length;I++)if(i.type!==1)o[I]=vt(o[I],T,1);else{const R=[];for(const D of o[I])D.x<0||D.x>=a||D.y<0||D.y>=a||(T(D),R.push(D));o[I]=R}}for(const d of o)for(const g of d)Dt(g,c);return o}function gr(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?ur(i):[]}}function Kt(i,e,r,o,a){i.emplaceBack(2*e+(o+1)/2,2*r+(a+1)/2)}function pr(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class nr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Il,this.indexArray=new ao,this.segments=new Sn,this.programConfigurations=new nu(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,o,a){const c=this.layers[0],d=[];let g=null;c.type==="circle"&&(g=c.layout.get("circle-sort-key"));for(const{feature:x,id:S,index:T,sourceLayerIndex:I}of e){const R=this.layers[0]._featureFilter.needGeometry,D=gr(x,R);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),D,o))continue;const O=g?g.evaluate(D,{},o):void 0,W={id:S,properties:x.properties,type:x.type,sourceLayerIndex:I,index:T,geometry:R?D.geometry:ur(x,o,a),patterns:{},sortKey:O};d.push(W)}g&&d.sort((x,S)=>x.sortKey-S.sortKey);let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new ic,y=a.projection);for(const x of d){const{geometry:S,index:T,sourceLayerIndex:I}=x,R=e[T].feature;this.addFeature(x,S,T,r.availableImages,o,y,r.brightness),r.featureIndex.insert(R,S,T,I,this.index)}}update(e,r,o,a,c,d,g){this.programConfigurations.updatePaintArrays(e,r,c,o,a,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$f.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,o,a,c,d,g){for(const y of r)for(const x of y){const S=x.x,T=x.y;if(S<0||S>=Wt||T<0||T>=Wt)continue;if(d){const D=d.projectTilePoint(S,T,c),O=d.upVector(c,S,T),W=this.globeExtVertexArray;pr(W,D,O),pr(W,D,O),pr(W,D,O),pr(W,D,O)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=I.vertexLength;Kt(this.layoutVertexArray,S,T,-1,-1),Kt(this.layoutVertexArray,S,T,1,-1),Kt(this.layoutVertexArray,S,T,1,1),Kt(this.layoutVertexArray,S,T,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},a,c,g)}}function Ir(i,e){for(let r=0;r<i.length;r++)if(Ki(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ki(i,e[r]))return!0;return!!Yi(i,e)}function Ur(i,e,r){return!!Ki(i,e)||!!Hr(e,i,r)}function li(i,e){if(i.length===1)return Si(e,i[0]);for(let r=0;r<e.length;r++){const o=e[r];for(let a=0;a<o.length;a++)if(Ki(i,o[a]))return!0}for(let r=0;r<i.length;r++)if(Si(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Yi(i,e[r]))return!0;return!1}function Xi(i,e,r){if(i.length>1){if(Yi(i,e))return!0;for(let o=0;o<e.length;o++)if(Hr(e[o],i,r))return!0}for(let o=0;o<i.length;o++)if(Hr(i[o],e,r))return!0;return!1}function Yi(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){const o=i[r],a=i[r+1];for(let c=0;c<e.length-1;c++)if(ei(o,a,e[c],e[c+1]))return!0}return!1}function ei(i,e,r,o){return Wi(i,r,o)!==Wi(e,r,o)&&Wi(i,e,r)!==Wi(i,e,o)}function Ln(i,e,r){return(i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x)}function _n(i,e,r,o){const a=Ln(i,e,o),c=Ln(i,e,r);if(Math.sign(a)===Math.sign(c))return;const d=Ln(r,o,i),g=d+c-a;return Math.sign(d)!==Math.sign(g)?[d/(d-g),c/(c-a)]:void 0}function Hr(i,e,r){const o=r*r;if(e.length===1)return i.distSqr(e[0])<o;for(let a=1;a<e.length;a++)if(wi(i,e[a-1],e[a])<o)return!0;return!1}function wi(i,e,r){const o=e.distSqr(r);if(o===0)return i.distSqr(e);const a=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/o;return i.distSqr(a<0?e:a>1?r:r.sub(e)._mult(a)._add(e))}function Si(i,e){let r,o,a,c=!1;for(let d=0;d<i.length;d++){r=i[d];for(let g=0,y=r.length-1;g<r.length;y=g++)o=r[g],a=r[y],o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(c=!c)}return c}function Ki(i,e){let r=!1;for(let o=0,a=i.length-1;o<i.length;a=o++){const c=i[o],d=i[a];c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(r=!r)}return r}function uo(i,e,r,o,a){for(const d of i)if(e<=d.x&&r<=d.y&&o>=d.x&&a>=d.y)return!0;const c=[new Ot(e,r),new Ot(e,a),new Ot(o,a),new Ot(o,r)];if(i.length>2){for(const d of c)if(Ki(i,d))return!0}for(let d=0;d<i.length-1;d++)if(zn(i[d],i[d+1],c))return!0;return!1}function zn(i,e,r){const o=r[0],a=r[2];if(i.x<o.x&&e.x<o.x||i.x>a.x&&e.x>a.x||i.y<o.y&&e.y<o.y||i.y>a.y&&e.y>a.y)return!1;const c=Wi(i,e,r[0]);return c!==Wi(i,e,r[1])||c!==Wi(i,e,r[2])||c!==Wi(i,e,r[3])}function Wn(i,e,r,o,a,c){let d=e.y-i.y,g=i.x-e.x;if(c=c||0){const y=d*d+g*g;if(y===0)return!0;const x=Math.sqrt(y);d/=x,g/=x}return!((r.x-i.x)*d+(r.y-i.y)*g-c<0||(o.x-i.x)*d+(o.y-i.y)*g-c<0||(a.x-i.x)*d+(a.y-i.y)*g-c<0)}function Tn(i,e,r,o,a,c,d){return!(Wn(i,e,o,a,c,d)||Wn(e,r,o,a,c,d)||Wn(r,i,o,a,c,d)||Wn(o,a,i,e,r,d)||Wn(a,c,i,e,r,d)||Wn(c,o,i,e,r,d))}function ti(i,e,r){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:r.programConfigurations.get(e.id).getMaxValue(i)}function cn(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Li(i,e,r,o,a){if(!e[0]&&!e[1])return i;const c=Ot.convert(e)._mult(a);r==="viewport"&&c._rotate(-o);const d=[];for(let g=0;g<i.length;g++)d.push(i[g].sub(c));return d}function en(i,e,r,o){const a=Ot.convert(i)._mult(o);return e==="viewport"&&a._rotate(-r),a}let Gi,on;function To(i,e,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}ir(nr,"CircleBucket",{omit:["layers"]});class yi{constructor(e,r,o){this.z=e,this.x=r,this.y=o,this.key=Jo(0,e,e,r,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const o=function(c,d,g){var y=To(256*c,256*(d=Math.pow(2,g)-d-1),g),x=To(256*(c+1),256*(d+1),g);return y[0]+","+y[1]+","+x[0]+","+x[1]}(this.x,this.y,this.z),a=function(c,d,g){let y,x="";for(let S=c;S>0;S--)y=1<<S-1,x+=(d&y?1:0)+(g&y?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Uo{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Jo(e,r.z,r.z,r.x,r.y)}}class Jn{constructor(e,r,o,a,c){this.overscaledZ=e,this.wrap=r,this.canonical=new yi(o,+a,+c),this.key=r===0&&e===o?this.canonical.key:Jo(r,e,o,a,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Jn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Jo(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Jo(this.wrap*+r,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Jn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,a=2*this.canonical.y;return[new Jn(r,this.wrap,r,o,a),new Jn(r,this.wrap,r,o+1,a),new Jn(r,this.wrap,r,o,a+1),new Jn(r,this.wrap,r,o+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Jn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Jn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Uo(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Jo(i,e,r,o,a){const c=1<<Math.min(r,22);let d=c*(a%c)+o%c;return i&&r<22&&(d+=c*c*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*d+r)+(e-r)}const al=[i=>{let e=i.canonical.x-1,r=i.wrap;return e<0&&(e=(1<<i.canonical.z)-1,r--),new Jn(i.overscaledZ,r,i.canonical.z,e,i.canonical.y)},i=>{let e=i.canonical.x+1,r=i.wrap;return e===1<<i.canonical.z&&(e=0,r++),new Jn(i.overscaledZ,r,i.canonical.z,e,i.canonical.y)},i=>new Jn(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new Jn(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];ir(yi,"CanonicalTileID"),ir(Jn,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Rl=Fi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Hs}=Rl,Ua=Fi([{name:"a_pos_3",components:3,type:"Int16"}]);var Ro=Fi([{name:"a_pos",type:"Int16",components:2}]);class qa{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,o){const a=Qi(r,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/a;return o[0]=this.pos[0]+this.dir[0]*c,o[1]=this.pos[1]+this.dir[1]*c,!0}}class ll{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,o){const a=Gr(r,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/a;return o[0]=this.pos[0]+this.dir[0]*c,o[1]=this.pos[1]+this.dir[1]*c,o[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,r,o){if(function(R,D){var O=R[0],W=R[1],X=R[2],oe=D[0],re=D[1],B=D[2];return Math.abs(O-oe)<=ne*Math.max(1,Math.abs(O),Math.abs(oe))&&Math.abs(W-re)<=ne*Math.max(1,Math.abs(W),Math.abs(re))&&Math.abs(X-B)<=ne*Math.max(1,Math.abs(X),Math.abs(B))}(this.pos,e)||r===0)return o[0]=o[1]=o[2]=0,!1;const[a,c,d]=this.dir,g=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],S=a*a+c*c+d*d,T=2*(g*a+y*c+x*d),I=T*T-4*S*(g*g+y*y+x*x-r*r);if(I<0){const R=Math.max(-T/2,0),D=g+a*R,O=y+c*R,W=x+d*R,X=Math.hypot(D,O,W);return o[0]=D*r/X,o[1]=O*r/X,o[2]=W*r/X,!1}{const R=(-T-Math.sqrt(I))/(2*S);if(R<0){const D=Math.hypot(g,y,x);return o[0]=g*r/D,o[1]=y*r/D,o[2]=x*r/D,!1}return o[0]=g+a*R,o[1]=y+c*R,o[2]=x+d*R,!0}}}class wa{constructor(e,r,o,a,c){this.TL=e,this.TR=r,this.BR=o,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(e,r,o){const a=[-1,1,1],c=[1,1,1],d=[1,-1,1],g=[-1,-1,1],y=jr(a,a,e),x=jr(c,c,e),S=jr(d,d,e),T=jr(g,g,e);return new wa(y,x,S,T,r/o)}}function Dl(i,e,r){let o=1/0,a=-1/0;const c=[];for(const d of i){zi(c,d,e);const g=Gr(c,r);o=Math.min(o,g),a=Math.max(a,g)}return[o,a]}function kl(i,e){let r=!0;for(let o=0;o<i.planes.length;o++){const a=i.planes[o];let c=0;for(let d=0;d<e.length;d++)c+=Gr(a,e[d])+a[3]>=0;if(c===0)return 0;c!==e.length&&(r=!1)}return r?2:1}function oc(i,e){for(const r of i.projections){const o=Dl(e,i.points[0],r.axis);if(r.projection[1]<o[0]||r.projection[0]>o[1])return 0}return 1}function Kc(i,e){let r=0;const o=[0,0,0,0];for(let d=0;d<i.length;d++)o[0]=i[d][0],o[1]=i[d][1],o[2]=i[d][2],o[3]=1,(a=o)[0]*(c=e)[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]>=0&&r++;var a,c;return r}class sc{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=yn.fromPoints(this.points),this.projections=[],this.frustumEdges=[zi([],this.points[2],this.points[3]),zi([],this.points[0],this.points[3]),zi([],this.points[4],this.points[0]),zi([],this.points[5],this.points[1]),zi([],this.points[6],this.points[2]),zi([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const a=[0,-o[2],o[1]],c=[o[2],0,-o[0]];this.projections.push({axis:a,projection:Dl(this.points,this.points[0],a)}),this.projections.push({axis:c,projection:Dl(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,r,o,a){const c=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{const S=eo([],x,e),T=1/S[3]/r*c;return(I=S)[0]=(R=S)[0]*(D=[T,T,a?1/S[3]:T,T])[0],I[1]=R[1]*D[1],I[2]=R[2]*D[2],I[3]=R[3]*D[3],I;var I,R,D}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{const S=qr([],pi([],zi([],d[x[0]],d[x[1]]),zi([],d[x[2]],d[x[1]]))),T=-Gr(S,d[x[1]]);return S.concat(T)}),y=[];for(let x=0;x<d.length;x++)y.push([d[x][0],d[x][1],d[x][2]]);return new sc(y,g)}intersectsPrecise(e,r,o){for(let a=0;a<r.length;a++)if(!Kc(e,r[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Kc(e,this.planes[a]))return 0;for(const a of o)for(const c of this.frustumEdges){const d=pi([],a,c),g=fr(d);if(g===0)continue;or(d,d,1/g);const y=Dl(this.points,this.points[0],d),x=Dl(e,this.points[0],d);if(y[0]>x[1]||x[0]>y[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const o=r[3];if(Gr([r[0],r[1],r[2]],e)+o<0)return!1}return!0}}class yn{static fromPoints(e){const r=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const a of e)mr(r,r,a),Lr(o,o,a);return new yn(r,o)}static fromTileIdAndHeight(e,r,o){const a=1<<e.canonical.z,c=e.canonical.x,d=e.canonical.y;return new yn([c/a,d/a,r],[(c+1)/a,(d+1)/a,o])}static applyTransform(e,r){const o=e.getCorners();for(let a=0;a<o.length;++a)jr(o[a],o[a],r);return yn.fromPoints(o)}static applyTransformFast(e,r){const o=[r[12],r[13],r[14]],a=[...o];for(let c=0;c<3;c++)for(let d=0;d<3;d++){const g=r[4*d+c],y=g*e.min[d],x=g*e.max[d];o[c]+=Math.min(y,x),a[c]+=Math.max(y,x)}return new yn(o,a)}static projectAabbCorners(e,r){const o=e.getCorners();for(let a=0;a<o.length;++a)jr(o[a],o[a],r);return o}constructor(e,r){this.min=e,this.max=r,this.center=or([],Or([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],o=Zt(this.min),a=Zt(this.max);for(let c=0;c<r.length;c++)o[c]=r[c]?this.min[c]:this.center[c],a[c]=r[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new yn(o,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?kl(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?kl(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?oc(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?oc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function ku(i){return i*m/V}ir(yn,"Aabb");const df=[new yn([P,P,P],[M,M,M]),new yn([P,P,P],[0,0,M]),new yn([0,P,P],[M,0,M]),new yn([P,0,P],[0,M,M]),new yn([0,0,P],[M,M,M])];function bp(i,e,r,o=!0){const a=or([],i._camera.position,i.worldSize),c=[e,r,1,1];eo(c,c,i.pixelMatrixInverse),fs(c,c,1/c[3]);const d=qr([],zi([],c,a)),g=i.globeMatrix,y=[g[12],g[13],g[14]],x=zi([],y,a),S=fr(x),T=qr([],x),I=i.worldSize/(2*Math.PI),R=Gr(T,d),D=Math.asin(I/S);if(D<Math.acos(R)){if(!o)return null;const Le=[],Ue=[];or(Le,d,S/R),qr(Ue,zi(Ue,Le,x)),qr(d,Or(d,x,or(d,Ue,Math.tan(D)*S)))}const O=[];new ll(a,d).closestPointOnSphere(y,I,O);const W=qr([],Vn(g,0)),X=qr([],Vn(g,1)),oe=qr([],Vn(g,2)),re=Gr(W,O),B=Gr(X,O),J=Gr(oe,O),ie=K(Math.asin(-B/I));let ce=K(Math.atan2(re,J));ce=i.center.lng+function(Le,Ue){const ct=(Ue-Le+180)%360-180;return ct<-180?ct+360:ct}(i.center.lng,ce);const Ie=ye(ce),Pe=ke(me(ie),0,1);return new tt(Ie,Pe)}class pm{constructor(e,r,o){this.a=zi([],e,o),this.b=zi([],r,o),this.center=o;const a=qr([],this.a),c=qr([],this.b);this.angle=Math.acos(Gr(a,c))}}function Id(i,e){if(i.angle===0)return null;let r;return r=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(o,a,c,d){const g=Math.sin(c);return o*(Math.sin((1-d)*c)/g)+a*(Math.sin(d*c)/g)}(i.a[e],i.b[e],i.angle,ke(r,0,1))+i.center[e]}function ul(i){if(i.z<=1)return df[i.z+2*i.y+i.x];const e=pf(ff(i));return yn.fromPoints(e)}function Lu(i,e,r){return or(i,i,1-r),dt(i,i,e,r)}function Zf(i,e,r){for(const o of i)jr(o,o,e),or(o,o,r)}function mm(i,e,r,o){const a=e/i.worldSize,c=i.globeMatrix;if(r.z<=1){const Pe=ul(r).getCorners();return Zf(Pe,c,a),yn.fromPoints(Pe)}const d=ff(r,o),g=pf(d,m+ku(i._tileCoverLift));Zf(g,c,a);const y=Number.MAX_VALUE,x=[-y,-y,-y],S=[y,y,y];if(d.contains(i.center)){for(const Ue of g)mr(S,S,Ue),Lr(x,x,Ue);x[2]=0;const Pe=i.point,Le=[Pe.x*a,Pe.y*a,0];return mr(S,S,Le),Lr(x,x,Le),new yn(S,x)}if(i._tileCoverLift>0){for(const Pe of g)mr(S,S,Pe),Lr(x,x,Pe);return new yn(S,x)}const T=[c[12]*a,c[13]*a,c[14]*a],I=d.getCenter(),R=ke(i.center.lat,-85.051129,Ge),D=ke(I.lat,-85.051129,Ge),O=ye(i.center.lng),W=me(R);let X=O-ye(I.lng);const oe=W-me(D);X>.5?X-=1:X<-.5&&(X+=1);let re=0;Math.abs(X)>Math.abs(oe)?re=X>=0?1:3:(re=oe>=0?0:2,dt(T,T,[c[4]*a,c[5]*a,c[6]*a],-Math.sin(G(oe>=0?d.getSouth():d.getNorth()))*m));const B=g[re],J=g[(re+1)%4],ie=new pm(B,J,T),ce=[Id(ie,0)||B[0],Id(ie,1)||B[1],Id(ie,2)||B[2]],Ie=Qc(i.zoom);if(Ie>0){const Pe=function({x:Ue,y:ct,z:Pt},Tt,At,Nt,at){const It=1/(1<<Pt);let nt=Ue*It,ut=nt+It,jt=ct*It,qt=jt+It,wr=0;const hr=(nt+ut)/2-Nt;return hr>.5?wr=-1:hr<-.5&&(wr=1),nt=((nt+wr)*Tt-(Nt*=Tt))*At+Nt,ut=((ut+wr)*Tt-Nt)*At+Nt,jt=(jt*Tt-(at*=Tt))*At+at,qt=(qt*Tt-at)*At+at,[[nt,qt,0],[ut,qt,0],[ut,jt,0],[nt,jt,0]]}(r,e,i._pixelsPerMercatorPixel,O,W);for(let Ue=0;Ue<g.length;Ue++)Lu(g[Ue],Pe[Ue],Ie);const Le=Or([],Pe[re],Pe[(re+1)%4]);or(Le,Le,.5),Lu(ce,Le,Ie)}for(const Pe of g)mr(S,S,Pe),Lr(x,x,Pe);return S[2]=Math.min(B[2],J[2]),mr(S,S,ce),Lr(x,x,ce),new yn(S,x)}function ff({x:i,y:e,z:r},o=!1){const a=1/(1<<r),c=new U(Te(i*a),e===(1<<r)-1&&o?-90:Ae((e+1)*a)),d=new U(Te((i+1)*a),e===0&&o?90:Ae(e*a));return new ee(c,d)}function pf(i,e=m){const r=G(i.getNorth()),o=G(i.getSouth()),a=Math.cos(r),c=Math.cos(o),d=Math.sin(r),g=Math.sin(o),y=i.getWest(),x=i.getEast();return[k(c,g,y,e),k(c,g,x,e),k(a,d,x,e),k(a,d,y,e)]}function Jc(i,e,r,o){const a=1<<r.z,c=(i/Wt+r.x)/a;return q(Ae((e/Wt+r.y)/a),Te(c),o)}function Ad({min:i,max:e}){return w/Math.max(e[0]-i[0],e[1]-i[1],e[2]-i[2])}const mf=new Float64Array(16);function gf(i){const e=Ad(i),r=St(mf,[e,e,e]);return Ke(r,r,Ai([],i.min))}function wp(i){const e=(o=i.min,(r=mf)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=o[0],r[13]=o[1],r[14]=o[2],r[15]=1,r);var r,o;const a=1/Ad(i);return et(e,e,[a,a,a])}function Cd(i){const e=Wt/(2*Math.PI);return i/(2*Math.PI)/e}function gm(i,e){return Wt/(512*Math.pow(2,i))*Ad(ul(e))}function Md(i,e,r,o,a){const c=Cd(r),d=[i,e,-r/(2*Math.PI)],g=Xe(new Float64Array(16));return Ke(g,g,d),et(g,g,[c,c,c]),st(g,g,G(-a)),$e(g,g,G(-o)),g}function Qc(i){return Fe(_,v,i)}function _f(i,e){const r=q(e.lat,e.lng),o=function(D){const O=q(D._center.lat,D._center.lng);let W=pi([],Tr(0,1,0),O);const X=dr([],-D.angle,O);W=jr(W,W,X),dr(X,-D._pitch,W);const oe=qr([],O);return or(oe,oe,ku(D.cameraToCenterDistance/D.pixelsPerMeter)),jr(oe,oe,X),Or([],O,oe)}(i);return d=(a=ri([],o,r))[0],g=a[1],y=a[2],x=(c=r)[0],S=c[1],T=c[2],R=(I=Math.sqrt(d*d+g*g+y*y)*Math.sqrt(x*x+S*S+T*T))&&Gr(a,c)/I,Math.acos(Math.min(Math.max(R,-1),1));var a,c,d,g,y,x,S,T,I,R}function h(i,e){return _f(i,e)>Math.PI/2*1.01}const p=G(85),b=Math.cos(p),C=Math.sin(p),z=ze(),H=i=>{const e=[];return i.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function pe(i,e,r,o,a,c,d,g,y){if(c&&i.queryGeometry.isAboveHorizon)return!1;c&&(y*=i.pixelToTileUnitsFactor);const x=i.tileID.canonical,S=r.projection.upVectorScale(x,r.center.lat,r.worldSize).metersToTile;for(const T of e)for(const I of T){const R=I.add(g),D=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(R.x,R.y,!0):0,O=r.projection.projectTilePoint(R.x,R.y,x);if(D>0){const re=r.projection.upVector(x,R.x,R.y);O.x+=re[0]*S*D,O.y+=re[1]*S*D,O.z+=re[2]*S*D}const W=c?R:He(O.x,O.y,O.z,o),X=c?i.tilespaceRays.map(re=>Ar(re,D)):i.queryGeometry.screenGeometry,oe=eo([],[O.x,O.y,O.z,1],o);if(!d&&c?y*=oe[3]/r.cameraToCenterDistance:d&&!c&&(y*=r.cameraToCenterDistance/oe[3]),c){const re=Ae((I.y/Wt+x.y)/(1<<x.z));y/=r.projection.pixelsPerMeter(re,1)/he(1,re)}if(Ur(X,W,y))return!0}return!1}function He(i,e,r,o){const a=eo([],[i,e,r,1],o);return new Ot(a[0]/a[3],a[1]/a[3])}const lt=Tr(0,0,0),Gt=Tr(0,0,1);function Ar(i,e){const r=ht();return lt[2]=e,i.intersectsPlane(lt,Gt,r),new Ot(r[0],r[1])}class Rr extends nr{}let Er,Yr,ui,gi;function qo(i,{width:e,height:r},o,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*r*o)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*r*o);return i.width=e,i.height=r,i.data=a,i}function kt(i,e,r){const{width:o,height:a}=e;o===i.width&&a===i.height||(gt(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,o),height:Math.min(i.height,a)},r,null),i.width=o,i.height=a,i.data=e.data)}function gt(i,e,r,o,a,c,d,g){if(a.width===0||a.height===0)return e;if(a.width>i.width||a.height>i.height||r.x>i.width-a.width||r.y>i.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||o.x>e.width-a.width||o.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,x=e.data,S=c===4&&g;for(let T=0;T<a.height;T++){const I=((r.y+T)*i.width+r.x)*c,R=((o.y+T)*e.width+o.x)*c;if(S)for(let D=0;D<a.width;D++){const O=I+D*c+3,W=R+D*c;x[W+0]=255,x[W+1]=255,x[W+2]=255,x[W+3]=y[O]}else if(d)for(let D=0;D<a.width;D++){const O=I+D*c,W=R+D*c,X=y[O+3],oe=new ai(y[O+0]/255*X,y[O+1]/255*X,y[O+2]/255*X,X).toRenderColor(d).toArray();x[W+0]=oe[0],x[W+1]=oe[1],x[W+2]=oe[2],x[W+3]=oe[3]}else for(let D=0;D<a.width*c;D++)x[R+D]=y[I+D]}return e}ir(Rr,"HeatmapBucket",{omit:["layers"]});class Lt{constructor(e,r){qo(this,e,1,r)}resize(e){kt(this,new Lt(e),1)}clone(){return new Lt({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,a,c){gt(e,r,o,a,c,1,null)}}class br{constructor(e,r){qo(this,e,4,r)}resize(e){kt(this,new br(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,o,a,c,d,g){gt(e,r,o,a,c,4,d,g)}}class vi{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function Ri(i){const e={},r=i.resolution||256,o=i.clips?i.clips.length:1,a=i.image||new br({width:r,height:o}),c=(d,g,y)=>{e[i.evaluationKey]=y;const x=i.expression.evaluate(e);x&&(a.data[d+g+0]=Math.floor(255*x.r/x.a),a.data[d+g+1]=Math.floor(255*x.g/x.a),a.data[d+g+2]=Math.floor(255*x.b/x.a),a.data[d+g+3]=Math.floor(255*x.a))};if(i.clips)for(let d=0,g=0;d<o;++d,g+=4*r)for(let y=0,x=0;y<r;y++,x+=4){const S=y/(r-1),{start:T,end:I}=i.clips[d];c(g,x,T*(1-S)+I*S)}else for(let d=0,g=0;d<r;d++,g+=4)c(0,g,d/(r-1));return a}ir(Lt,"AlphaImage"),ir(br,"RGBAImage");const Bi=Fi([{name:"a_pos",components:2,type:"Int16"}],4),$i=Fi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Ds=Fi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),qn=Fi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Ll(i,e,r=2){const o=e&&e.length,a=o?e[0]*r:i.length;let c=_m(i,0,a,r,!0);const d=[];if(!c||c.next===c.prev)return d;let g,y,x;if(o&&(c=function(S,T,I,R){const D=[];for(let O=0,W=T.length;O<W;O++){const X=_m(S,T[O]*R,O<W-1?T[O+1]*R:S.length,R,!1);X===X.next&&(X.steiner=!0),D.push(jb(X))}D.sort(Bb);for(let O=0;O<D.length;O++)I=Nb(D[O],I);return I}(i,e,c,r)),i.length>80*r){g=1/0,y=1/0;let S=-1/0,T=-1/0;for(let I=r;I<a;I+=r){const R=i[I],D=i[I+1];R<g&&(g=R),D<y&&(y=D),R>S&&(S=R),D>T&&(T=D)}x=Math.max(S-g,T-y),x=x!==0?32767/x:0}return Sp(c,d,r,g,y,x,0),d}function _m(i,e,r,o,a){let c;if(a===function(d,g,y,x){let S=0;for(let T=g,I=y-x;T<y;T+=x)S+=(d[I]-d[T])*(d[T+1]+d[I+1]),I=T;return S}(i,e,r,o)>0)for(let d=e;d<r;d+=o)c=I0(d/o|0,i[d],i[d+1],c);else for(let d=r-o;d>=e;d-=o)c=I0(d/o|0,i[d],i[d+1],c);return c&&Xf(c,c.next)&&(Ip(c),c=c.next),c}function yf(i,e){if(!i)return i;e||(e=i);let r,o=i;do if(r=!1,o.steiner||!Xf(o,o.next)&&Qo(o.prev,o,o.next)!==0)o=o.next;else{if(Ip(o),o=e=o.prev,o===o.next)break;r=!0}while(r||o!==e);return e}function Sp(i,e,r,o,a,c,d){if(!i)return;!d&&c&&function(y,x,S,T){let I=y;do I.z===0&&(I.z=Cg(I.x,I.y,x,S,T)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==y);I.prevZ.nextZ=null,I.prevZ=null,function(R){let D,O=1;do{let W,X=R;R=null;let oe=null;for(D=0;X;){D++;let re=X,B=0;for(let ie=0;ie<O&&(B++,re=re.nextZ,re);ie++);let J=O;for(;B>0||J>0&&re;)B!==0&&(J===0||!re||X.z<=re.z)?(W=X,X=X.nextZ,B--):(W=re,re=re.nextZ,J--),oe?oe.nextZ=W:R=W,W.prevZ=oe,oe=W;X=re}oe.nextZ=null,O*=2}while(D>1)}(I)}(i,o,a,c);let g=i;for(;i.prev!==i.next;){const y=i.prev,x=i.next;if(c?zb(i,o,a,c):Lb(i))e.push(y.i,i.i,x.i),Ip(i),i=x.next,g=x.next;else if((i=x)===g){d?d===1?Sp(i=Ob(yf(i),e),e,r,o,a,c,2):d===2&&Fb(i,e,r,o,a,c):Sp(yf(i),e,r,o,a,c,1);break}}}function Lb(i){const e=i.prev,r=i,o=i.next;if(Qo(e,r,o)>=0)return!1;const a=e.x,c=r.x,d=o.x,g=e.y,y=r.y,x=o.y,S=Math.min(a,c,d),T=Math.min(g,y,x),I=Math.max(a,c,d),R=Math.max(g,y,x);let D=o.next;for(;D!==e;){if(D.x>=S&&D.x<=I&&D.y>=T&&D.y<=R&&Tp(a,g,c,y,d,x,D.x,D.y)&&Qo(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function zb(i,e,r,o){const a=i.prev,c=i,d=i.next;if(Qo(a,c,d)>=0)return!1;const g=a.x,y=c.x,x=d.x,S=a.y,T=c.y,I=d.y,R=Math.min(g,y,x),D=Math.min(S,T,I),O=Math.max(g,y,x),W=Math.max(S,T,I),X=Cg(R,D,e,r,o),oe=Cg(O,W,e,r,o);let re=i.prevZ,B=i.nextZ;for(;re&&re.z>=X&&B&&B.z<=oe;){if(re.x>=R&&re.x<=O&&re.y>=D&&re.y<=W&&re!==a&&re!==d&&Tp(g,S,y,T,x,I,re.x,re.y)&&Qo(re.prev,re,re.next)>=0||(re=re.prevZ,B.x>=R&&B.x<=O&&B.y>=D&&B.y<=W&&B!==a&&B!==d&&Tp(g,S,y,T,x,I,B.x,B.y)&&Qo(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;re&&re.z>=X;){if(re.x>=R&&re.x<=O&&re.y>=D&&re.y<=W&&re!==a&&re!==d&&Tp(g,S,y,T,x,I,re.x,re.y)&&Qo(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;B&&B.z<=oe;){if(B.x>=R&&B.x<=O&&B.y>=D&&B.y<=W&&B!==a&&B!==d&&Tp(g,S,y,T,x,I,B.x,B.y)&&Qo(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function Ob(i,e){let r=i;do{const o=r.prev,a=r.next.next;!Xf(o,a)&&T0(o,r,r.next,a)&&Ep(o,a)&&Ep(a,o)&&(e.push(o.i,r.i,a.i),Ip(r),Ip(r.next),r=i=a),r=r.next}while(r!==i);return yf(r)}function Fb(i,e,r,o,a,c){let d=i;do{let g=d.next.next;for(;g!==d.prev;){if(d.i!==g.i&&Ub(d,g)){let y=E0(d,g);return d=yf(d,d.next),y=yf(y,y.next),Sp(d,e,r,o,a,c,0),void Sp(y,e,r,o,a,c,0)}g=g.next}d=d.next}while(d!==i)}function Bb(i,e){let r=i.x-e.x;return r===0&&(r=i.y-e.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),r}function Nb(i,e){const r=function(a,c){let d=c;const g=a.x,y=a.y;let x,S=-1/0;if(Xf(a,d))return d;do{if(Xf(a,d.next))return d.next;if(y<=d.y&&y>=d.next.y&&d.next.y!==d.y){const O=d.x+(y-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(O<=g&&O>S&&(S=O,x=d.x<d.next.x?d:d.next,O===g))return x}d=d.next}while(d!==c);if(!x)return null;const T=x,I=x.x,R=x.y;let D=1/0;d=x;do{if(g>=d.x&&d.x>=I&&g!==d.x&&S0(y<R?g:S,y,I,R,y<R?S:g,y,d.x,d.y)){const O=Math.abs(y-d.y)/(g-d.x);Ep(d,a)&&(O<D||O===D&&(d.x>x.x||d.x===x.x&&Vb(x,d)))&&(x=d,D=O)}d=d.next}while(d!==T);return x}(i,e);if(!r)return e;const o=E0(r,i);return yf(o,o.next),yf(r,r.next)}function Vb(i,e){return Qo(i.prev,i,e.prev)<0&&Qo(e.next,i,i.next)<0}function Cg(i,e,r,o,a){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*a|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jb(i){let e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function S0(i,e,r,o,a,c,d,g){return(a-d)*(e-g)>=(i-d)*(c-g)&&(i-d)*(o-g)>=(r-d)*(e-g)&&(r-d)*(c-g)>=(a-d)*(o-g)}function Tp(i,e,r,o,a,c,d,g){return!(i===d&&e===g)&&S0(i,e,r,o,a,c,d,g)}function Ub(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,o){let a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==o.i&&a.next.i!==o.i&&T0(a,a.next,r,o))return!0;a=a.next}while(a!==r);return!1}(i,e)&&(Ep(i,e)&&Ep(e,i)&&function(r,o){let a=r,c=!1;const d=(r.x+o.x)/2,g=(r.y+o.y)/2;do a.y>g!=a.next.y>g&&a.next.y!==a.y&&d<(a.next.x-a.x)*(g-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==r);return c}(i,e)&&(Qo(i.prev,i,e.prev)||Qo(i,e.prev,e))||Xf(i,e)&&Qo(i.prev,i,i.next)>0&&Qo(e.prev,e,e.next)>0)}function Qo(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Xf(i,e){return i.x===e.x&&i.y===e.y}function T0(i,e,r,o){const a=vm(Qo(i,e,r)),c=vm(Qo(i,e,o)),d=vm(Qo(r,o,i)),g=vm(Qo(r,o,e));return a!==c&&d!==g||!(a!==0||!ym(i,r,e))||!(c!==0||!ym(i,o,e))||!(d!==0||!ym(r,i,o))||!(g!==0||!ym(r,e,o))}function ym(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function vm(i){return i>0?1:i<0?-1:0}function Ep(i,e){return Qo(i.prev,i,i.next)<0?Qo(i,e,i.next)>=0&&Qo(i,i.prev,e)>=0:Qo(i,e,i.prev)<0||Qo(i,i.next,e)<0}function E0(i,e){const r=Mg(i.i,i.x,i.y),o=Mg(e.i,e.x,e.y),a=i.next,c=e.prev;return i.next=e,e.prev=i,r.next=a,a.prev=r,o.next=r,r.prev=o,c.next=o,o.prev=c,o}function I0(i,e,r,o){const a=Mg(i,e,r);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function Ip(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Mg(i,e,r){return{i,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function xm(i,e){const r=i.length;if(r<=1)return[i];const o=[];let a,c;for(let d=0;d<r;d++){const g=Mi(i[d]);g!==0&&(i[d].area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(a&&o.push(a),a=[i[d]]):a.push(i[d]))}if(a&&o.push(a),e>1)for(let d=0;d<o.length;d++)o[d].length<=e||(jl(o[d],e,1,o[d].length-1,qb),o[d]=o[d].slice(0,e));return o}function qb(i,e){return e.area-i.area}function A0(i,e,r=1){if(!i)return null;const o=typeof i=="string"?ve.from(i).getPrimary():i.getPrimary(),a=typeof i=="string"?null:i.getSecondary();for(const c of[o,a]){if(!c)continue;const d=c.id.toString();e.has(d)||e.set(d,[]),c.scaleSelf(r),e.get(d).push(c)}return{primary:o.toString(),secondary:a?a.toString():null}}function Pg(i,e,r,o){const a=o.patternDependencies;let c=!1;for(const d of e){const g=d.paint.get(`${i}-pattern`);g.isConstant()||(c=!0),A0(g.constantOr(null),a,r)&&(c=!0)}return c}function Rg(i,e,r,o,a,c){const d=c.patternDependencies;for(const g of e){const y=g.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:o},r,{},c.availableImages);x=x&&x.name?x.name:x;const S=A0(x,d,a);if(!S)continue;const{primary:T,secondary:I}=S;T&&(r.patterns[g.id]=[T,I].filter(Boolean))}}return r}var Dg,C0,kg,M0,Lg,P0,R0,bm={};function D0(){if(C0)return Dg;C0=1;var i=un();function e(a,c,d,g,y){this.properties={},this.extent=d,this.type=0,this._pbf=a,this._geometry=-1,this._keys=g,this._values=y,a.readFields(r,this,c)}function r(a,c,d){a==1?c.id=d.readVarint():a==2?function(g,y){for(var x=g.readVarint()+g.pos;g.pos<x;){var S=y._keys[g.readVarint()],T=y._values[g.readVarint()];y.properties[S]=T}}(d,c):a==3?c.type=d.readVarint():a==4&&(c._geometry=d.pos)}function o(a){for(var c,d,g=0,y=0,x=a.length,S=x-1;y<x;S=y++)g+=((d=a[S]).x-(c=a[y]).x)*(c.y+d.y);return g}return Dg=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var c,d=a.readVarint()+a.pos,g=1,y=0,x=0,S=0,T=[];a.pos<d;){if(y<=0){var I=a.readVarint();g=7&I,y=I>>3}if(y--,g===1||g===2)x+=a.readSVarint(),S+=a.readSVarint(),g===1&&(c&&T.push(c),c=[]),c.push(new i(x,S));else{if(g!==7)throw new Error("unknown command "+g);c&&c.push(c[0].clone())}}return c&&T.push(c),T},e.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var c=a.readVarint()+a.pos,d=1,g=0,y=0,x=0,S=1/0,T=-1/0,I=1/0,R=-1/0;a.pos<c;){if(g<=0){var D=a.readVarint();d=7&D,g=D>>3}if(g--,d===1||d===2)(y+=a.readSVarint())<S&&(S=y),y>T&&(T=y),(x+=a.readSVarint())<I&&(I=x),x>R&&(R=x);else if(d!==7)throw new Error("unknown command "+d)}return[S,I,T,R]},e.prototype.toGeoJSON=function(a,c,d){var g,y,x=this.extent*Math.pow(2,d),S=this.extent*a,T=this.extent*c,I=this.loadGeometry(),R=e.types[this.type];function D(X){for(var oe=0;oe<X.length;oe++){var re=X[oe];X[oe]=[360*(re.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+T)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(g=0;g<I.length;g++)O[g]=I[g][0];D(I=O);break;case 2:for(g=0;g<I.length;g++)D(I[g]);break;case 3:for(I=function(X){var oe=X.length;if(oe<=1)return[X];for(var re,B,J=[],ie=0;ie<oe;ie++){var ce=o(X[ie]);ce!==0&&(B===void 0&&(B=ce<0),B===ce<0?(re&&J.push(re),re=[X[ie]]):re.push(X[ie]))}return re&&J.push(re),J}(I),g=0;g<I.length;g++)for(y=0;y<I[g].length;y++)D(I[g][y])}I.length===1?I=I[0]:R="Multi"+R;var W={type:"Feature",geometry:{type:R,coordinates:I},properties:this.properties};return"id"in this&&(W.id=this.id),W},Dg}function k0(){if(M0)return kg;M0=1;var i=D0();function e(o,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(r,this,a),this.length=this._features.length}function r(o,a,c){o===15?a.version=c.readVarint():o===1?a.name=c.readString():o===5?a.extent=c.readVarint():o===2?a._features.push(c.pos):o===3?a._keys.push(c.readString()):o===4&&a._values.push(function(d){for(var g=null,y=d.readVarint()+d.pos;d.pos<y;){var x=d.readVarint()>>3;g=x===1?d.readString():x===2?d.readFloat():x===3?d.readDouble():x===4?d.readVarint64():x===5?d.readVarint():x===6?d.readSVarint():x===7?d.readBoolean():null}return g}(c))}return kg=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var a=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,a,this.extent,this._keys,this._values)},kg}function L0(){return R0||(R0=1,bm.VectorTile=function(){if(P0)return Lg;P0=1;var i=k0();function e(r,o,a){if(r===3){var c=new i(a,a.readVarint()+a.pos);c.length&&(o[c.name]=c)}}return Lg=function(r,o){this.layers=r.readFields(e,{},o)},Lg}(),bm.VectorTileFeature=D0(),bm.VectorTileLayer=k0()),bm}var Pd=L0();const vf="3d_elevation_id",z0="level";class Gb{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,o){return this.get(e,!0,r,o)}optional(e,r,o){return this.get(e,!1,r,o)}success(){return this._valid}get(e,r,o,a){const c=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&c!==void 0&&!Number.isNaN(c)?o(a?a(c):c):r&&(this._valid=!1),this}}class O0{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,o){return this.featureFunc(e,r,o)}parseVertex(e,r,o){return this.vertexFunc(e,r,o)}}const Hb=new O0((i,e,r)=>i.reset(e).require(vf,o=>{r.id=o}).optional("fixed_height_relative",o=>{r.constantHeight=o},xf.decodeRelativeHeight).geometry(o=>{r.bounds=o},Xh).success(),(i,e,r)=>i.reset(e).require(vf,o=>{r.id=o}).require("elevation_idx",o=>{r.idx=o}).require("extent",o=>{r.extent=o}).require("height_relative",o=>{r.height=o},xf.decodeRelativeHeight).geometry(o=>{r.position=o},xf.getPoint).success()),$b=new O0((i,e,r)=>i.reset(e).require(vf,o=>{r.id=o}).optional("fixed_height",o=>{r.constantHeight=o},xf.decodeMetricHeight).geometry(o=>{r.bounds=o},Xh).success(),(i,e,r)=>i.reset(e).require(vf,o=>{r.id=o}).require("elevation_idx",o=>{r.idx=o}).require("extent",o=>{r.extent=o}).require("height",o=>{r.height=o},xf.decodeMetricHeight).geometry(o=>{r.position=o},xf.getPoint).success());class xf{static getPoint(e){return Os(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const r=[],o=[],a=e.length,c=new Gb;for(let g=0;g<a;g++){const y=e.feature(g),x=y.properties.hasOwnProperty("version")?String(y.properties.version):void 0,S=(d=x)?d==="1.0.1"?$b:void 0:Hb;if(S===void 0){Jr(`Unknown elevation feature version number ${x||"(unknown)"}`);continue}const T=y.properties.hasOwnProperty("type")?y.properties.type:void 0;if(T){if(Pd.VectorTileFeature.types[y.type]==="Point"&&T==="curve_point"){const I={};S.parseVertex(c,y,I)&&r.push(I)}else if(Pd.VectorTileFeature.types[y.type]==="Polygon"&&T==="curve_meta"){const I={};S.parseFeature(c,y,I)&&o.push(I)}}}var d;return{vertices:r,features:o}}}class F0{constructor(e,r){this.feature=e,this.metersToTile=r,this.index=0}get(){const e=this.feature.vertices[this.index],r=this.feature.vertexProps[this.index].dir,o=r[1],a=-r[0],c=(e.extent+1)*this.metersToTile;return[new Ot(Math.trunc(e.position[0]+o*c),Math.trunc(e.position[1]+a*c)),new Ot(Math.trunc(e.position[0]-o*c),Math.trunc(e.position[1]-a*c))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class zg{constructor(e,r,o,a,c,d){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:o,max:o},this.safeArea=r,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=c,this.edges=this.edges.filter(g=>{return g.a<this.vertices.length&&g.b<this.vertices.length&&!((y=this.vertices[g.a].position)[0]===(x=this.vertices[g.b].position)[0]&&y[1]===x[1]);var y,x}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const g of this.vertices)this.vertexProps.push({dir:Os(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,g.height),this.heightRange.max=Math.max(this.heightRange.max,g.height);for(const g of this.edges){const y=this.vertices[g.a].position,x=this.vertices[g.b].position,S=ms(co(),x,y),T=os(S),I=ra(co(),S,1/T);this.edgeProps.push({vec:S,dir:I,len:T});const R=this.vertexProps[g.a].dir,D=this.vertexProps[g.b].dir;ns(R,R,I),ns(D,D,I)}for(const g of this.vertexProps)g.dir[0]===0&&g.dir[1]===0||ia(g.dir,g.dir);this.tessellate(d)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[o,a]=r;return((c,d,g)=>(1-g)*c+g*d)(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,a)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,o=Number.POSITIVE_INFINITY,a=0;const c=Os(e.x,e.y);for(let d=0;d<this.edges.length;d++){const g=this.edges[d],y=this.edgeProps[d].dir,x=new qa(c,this.edgeProps[d].dir),S=this.vertices[g.a].position,T=this.vertices[g.b].position,I=co(),R=co(),D=x.intersectsPlane(S,this.vertexProps[g.a].dir,I),O=x.intersectsPlane(T,this.vertexProps[g.b].dir,R);if(!D||!O)continue;const W=ms(co(),R,I),X=ms(co(),c,I),oe=Qi(W,W),re=oe>0?Qi(X,W)/oe:0,B=ke(re,0,1),J=Math.abs((re-B)*this.edgeProps[d].len),ie=ms(co(),c,S),ce=J+Math.abs(Qi(ie,Os(y[1],-y[0])));ce<o&&(r=d,o=ce,a=B)}return[r,a]}tessellate(e){for(let r=this.edges.length-1;r>=0;--r){const o=this.edges[r].a,a=this.edges[r].b,{position:c,height:d,extent:g}=this.vertices[o],{position:y,height:x,extent:S}=this.vertices[a],T=this.vertexProps[o].dir,I=this.vertexProps[a].dir,R=Tr(c[0]/e,c[1]/e,d),D=Tr(y[0]/e,y[1]/e,x),O=Tr(T[1],-T[0],0);or(O,O,g);const W=Tr(I[1],-I[0],0);if(or(W,W,S),this.distSqLines(Tr(R[0]+.5*O[0],R[1]+.5*O[1],R[2]+.5*O[2]),Tr(D[0]-.5*W[0],D[1]-.5*W[1],D[2]-.5*W[2]),Tr(R[0]-.5*O[0],R[1]-.5*O[1],R[2]-.5*O[2]),Tr(D[0]+.5*W[0],D[1]+.5*W[1],D[2]+.5*W[2]))<=.0025000000000000005)continue;const X=this.vertices.length,oe=ns(co(),c,y);this.vertices.push({position:ra(oe,oe,.5),height:.5*(d+x),extent:.5*(g+S)});const re=ns(co(),T,I);this.vertexProps.push({dir:ia(re,re)}),this.edges.splice(r,1),this.edgeProps.splice(r,1),this.edges.push({a:o,b:X}),this.edges.push({a:X,b:a});const B=ms(co(),this.vertices[X].position,c),J=os(B),ie={vec:B,dir:ra(co(),B,1/J),len:J};this.edgeProps.push(ie),this.edgeProps.push(ie)}}distSqLines(e,r,o,a){const c=ri(ht(),r,e),d=ri(ht(),a,o),g=ri(ht(),e,o),y=Gr(c,c),x=Gr(c,d),S=Gr(c,g),T=Gr(d,d),I=Gr(d,g),R=y*T-x*x;if(R===0){const W=Gr(g,d)/Gr(d,d);return sr(ji(ht(),o,a,W),e)}const D=(x*I-S*T)/R,O=(y*I-x*S)/R;return sr(ji(ht(),e,r,D),ji(ht(),o,a,O))}}class Og{static parseFrom(e,r){const o=xf.parse(e);if(!o)return[];let{vertices:a,features:c}=o;const d=1/je(r);c.sort((S,T)=>S.id-T.id),a.sort((S,T)=>S.id-T.id||S.idx-T.idx),a=a.filter((S,T,I)=>T===I.findIndex(R=>R.id===S.id&&R.idx===S.idx));const g=new Array;let y=0;const x=a.length;for(const S of c){if(S.constantHeight){g.push(new zg(S.id,S.bounds,S.constantHeight));continue}for(;y!==x&&a[y].id<S.id;)y++;if(y===x||a[y].id!==S.id)continue;const T=new Array,I=new Array,R=y;for(;y!==x&&a[y].id===S.id;){const D=a[y];if(T.push({position:D.position,height:D.height,extent:D.extent}),y!==R&&a[y-1].idx===D.idx-1){const O=y-R;I.push({a:O-1,b:O})}y++}g.push(new zg(S.id,S.bounds,void 0,T,I,d))}return g}static getElevationFeature(e,r){if(!r)return;const o=+e.properties[vf];return Number.isNaN(o)?void 0:r.find(a=>a.id===o)}}class B0{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*Wt,this.yOffset=(e.y*this.zScale-r.y)*Wt)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,o){const a=this.constantElevation(r,o);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),o))}computeBiasedHeight(e,r){return r<=0?e:e+r*Fe(0,r,e>=0?e:Math.abs(.5*e))}}ir(zg,"ElevationFeature");class N0{constructor(){this.polygons=new Map}add(e,...r){this.polygons.has(e)?this.polygons.get(e).push(...r):this.polygons.set(e,r)}merge(e){for(const[r,o]of e.polygons)this.add(r,...o)}}class bf{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new bf;let r=[];for(const x of e)r.push(...x.portals);if(r.length===0)return new bf;const o=(x,S)=>x<=0&&S<=0||x>=Wt&&S>=Wt;for(const x of r){const S=x.va,T=x.vb;(o(S.x,T.x)||o(S.y,T.y))&&(x.type="border")}const a=r.filter(x=>x.type!=="unevaluated"),c=r.filter(x=>x.type==="unevaluated");if(c.length===0)return new bf;c.sort((x,S)=>x.hash===S.hash?x.isTunnel===S.isTunnel?0:x.isTunnel?-1:1:x.hash<S.hash?1:-1),r=a.concat(c);let d=a.length,g=d,y=d;do if(g++,g===r.length||r[d].hash!==r[g].hash){if(g-d==2){y<d&&(r[y]=r[d],r[d]=null);const x=r[y],S=r[g-1];x.type=x.isTunnel!==S.isTunnel?"tunnel":"polygon",x.connection={a:x.connection.a,b:S.connection.a},y++}d=g}while(d!==r.length);return r.splice(y),r.sort((x,S)=>x.hash<S.hash?1:-1),{portals:r}}}ir(bf,"ElevationPortalGraph"),ir(N0,"ElevationPolygons");class Wb{constructor(e,r,o){this.outPositions=e,this.outNormals=r,this.outIndices=o,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,r,o){let a=e[2];o!=null&&(a*=o);const c=this.getVec3Bits(e)<<96n|this.getVec3Bits(r),d=this.vertexLookup.get(c);if(d!=null)return d;const g=this.outPositions.length;this.vertexLookup.set(c,g);const y=Math.trunc(16384*r[0]),x=Math.trunc(16384*r[1]),S=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(y,x,S),g}addVertices(e,r,...o){const a=[];for(const c of o){const d=this.addVertex(c,e,r);a.push(d)}return a}addTriangles(e,r,o){if(r&&o){const a=o.length===1,c=Tr(0,0,0);for(let d=0;d<e.length;d+=3){const g=r[e[d+0]],y=r[e[d+1]],x=r[e[d+2]],S=a?o[0]:o[e[d+1]],T=a?o[0]:o[e[d+2]],I=this.addVertex(Tr(g.x,g.y,a?o[0]:o[e[d+0]]),c),R=this.addVertex(Tr(y.x,y.y,S),c),D=this.addVertex(Tr(x.x,x.y,T),c);this.outIndices.emplaceBack(I,R,D)}}else for(let a=0;a<e.length;a+=3)this.outIndices.emplaceBack(e[a+0],e[a+1],e[a+2])}addQuad(e,r){const o=this.addVertices(r,void 0,...e.map(y=>Tr(y.coord.x,y.coord.y,y.height))),[a,c,d,g]=o;this.addTriangles([a,c,d,d,g,a])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class zl{constructor(e){this.unevaluatedPortals=new bf,this.portalPolygons=new N0,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Ch,this.vertexNormals=new $c,this.indexArray=new ao,this.tileToMeters=je(e)}addVertices(e,r){const o=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(r[a]);return o}addTriangles(e,r,o){const a=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const c of e)a.push(c+r)}addRenderableRing(e,r,o,a,c){const d=[new Ot(c.min.x,c.min.y),new Ot(c.max.x,c.min.y),new Ot(c.max.x,c.max.y),new Ot(c.min.x,c.max.y)];for(let g=0;g<o-1;g++){const y=r+g,x=y+1,S=this.unevalVertices[y],T=this.unevalVertices[x];if(!(S.x>=c.min.x&&S.x<=c.max.x&&S.y>=c.min.y&&S.y<=c.max.y||T.x>=c.min.x&&T.x<=c.max.x&&T.y>=c.min.y&&T.y<=c.max.y||zn(S,T,d))||this.isOnBorder(S.x,T.x)||this.isOnBorder(S.y,T.y))continue;const I=zl.computeEdgeHash(this.unevalVertices[y],this.unevalVertices[x]);let R,D=this.vertexHashLookup.get(zl.computePosHash(S));D!=null?R=D.next:(D=this.vertexHashLookup.get(zl.computePosHash(T)),R=D!=null?D.prev:I),this.unevalEdges.push({polygonIdx:e,a:y,b:x,hash:I,portalHash:R,isTunnel:a,type:"unevaluated"})}}addPortalCandidates(e,r,o,a,c){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:c});const d=r[0];this.vertexHashLookup.clear();let g=zl.computeEdgeHash(d[d.length-2],d[d.length-1]);for(let y=0;y<d.length-1;y++){const x=d[y+0],S=d[y+1],T=Os(S.x-x.x,S.y-x.y),I=os(T);if(I===0)continue;let R="unevaluated";const D=a.pointElevation(x),O=a.pointElevation(S);Math.abs(D)<.01&&Math.abs(O)<.01?R="entrance":(this.isOnBorder(x.x,S.x)||this.isOnBorder(x.y,S.y))&&(R="border");const W=zl.computeEdgeHash(x,S);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:x,vb:S,vab:T,length:I,hash:W,isTunnel:o,type:R});const X=zl.computePosHash(x);this.vertexHashLookup.set(X,{prev:g,next:W}),g=W}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=T=>{T.primitiveLength=this.indexArray.length-T.primitiveOffset},a=new Wb(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const c=r(),d=r(),g=r(),y=(T,I)=>{T.sort((D,O)=>D.type===I&&O.type!==I?-1:D.type!==I&&O.type===I?1:0);const R=T.findIndex(D=>D.type!==I);return R>=0?R:T.length};let x=0;this.unevalEdges.length>0&&(x=y(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},this.tileToMeters));const S=r();if(this.unevalEdges.length>0){const T=this.unevalEdges.splice(x),I=y(T,"tunnel")+x;this.unevalEdges.push(...T),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:x},{min:x,max:I})}o(g),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(S),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(d),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(c),this.maskSegments=Sn.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.depthSegments=Sn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength),this.renderableSegments=Sn.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.shadowCasterSegments=Sn.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Ds.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,qn.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,r,o,a,c){const d=new Map;for(let g=a;g<c;g++){const y=o[g],x=y.a,S=y.b,T=zl.computePosHash(e[x]),I=zl.computePosHash(e[S]);d.has(T)||d.set(T,{}),d.has(I)||d.set(I,{});const R=d.get(T),D=d.get(I);r[x]<=0&&r[S]<=0||(R.to=S,D.from=x)}return d}constructBridgeStructures(e,r,o,a,c,d){const g=this.computeVertexConnections(r,o,a,c.min,c.max),y=1/d,x=.5*y,S=I=>Tr(r[I].x,r[I].y,o[I]*y),T=I=>{const R=g.get(zl.computePosHash(r[I])),D=R.from,O=R.to;if(!D||!O)return;const W=S(D),X=S(I),oe=S(O),re=Tr(0,0,0);if(!xo(W,X)){const J=zi(ht(),X,W);Or(re,re,qr(J,J))}if(!xo(oe,X)){const J=zi(ht(),oe,X);Or(re,re,qr(J,J))}const B=zs(re);return B>0?or(re,re,1/B):void 0};for(let I=c.min;I<c.max;I++){const R=a[I],D=this.prepareEdgePoints(r,o,R,(Vt,$r)=>Vt>$r);if(D==null)continue;const O=D[0],W=D[1],X=Tr(O.coord.x,O.coord.y,y*O.height),oe=Tr(W.coord.x,W.coord.y,y*W.height);if(xo(X,oe))continue;const re=zi(ht(),oe,X);qr(re,re);const B=Vt=>qr(Vt,Vt),J=T(R.a)||re,ie=T(R.b)||re,ce=B(Tr(J[1],-J[0],0)),Ie=B(Tr(ie[1],-ie[0],0)),Pe=B(pi(ht(),ce,J)),Le=B(pi(ht(),Ie,ie)),Ue=ht(),ct=[Or(ht(),X,or(Ue,zi(Ue,ce,Pe),x)),Or(ht(),X,or(Ue,Or(Ue,ce,Pe),x)),Or(ht(),X,or(Ue,Pe,x)),X],Pt=[Or(ht(),oe,or(Ue,zi(Ue,Ie,Le),x)),Or(ht(),oe,or(Ue,Or(Ue,Ie,Le),x)),Or(ht(),oe,or(Ue,Le,x)),oe],[Tt,At]=e.addVertices(ce,d,ct[0],ct[1]),[Nt,at]=e.addVertices(Ie,d,Pt[0],Pt[1]);e.addTriangles([Tt,At,Nt,At,at,Nt]);const[It,nt]=e.addVertices(Pe,d,ct[1],ct[2]),[ut,jt]=e.addVertices(Le,d,Pt[1],Pt[2]);e.addTriangles([It,nt,ut,nt,jt,ut]);const[qt,wr]=e.addVertices(Ai(ce,ce),d,ct[2],ct[3]),[hr,Jt]=e.addVertices(Ai(Ie,Ie),d,Pt[2],Pt[3]);e.addTriangles([qt,wr,hr,wr,Jt,hr])}}constructTunnelStructures(e,r,o,a,c,d){const g=y=>qr(y,y);for(let y=c.min;y<c.max;y++){const x=this.prepareEdgePoints(r,o,a[y],(R,D)=>R<D);if(x==null)continue;const[S,T]=x,I=g(Tr(T.coord.y-S.coord.y,-(T.coord.x-S.coord.x),0));e.addQuad([S,T,{coord:T.coord,height:a[y].isTunnel?-.1:0},{coord:S.coord,height:a[y].isTunnel?-.1:0}],I)}for(let y=d.min;y<d.max;y++){const x=a[y],S=r[x.a],T=r[x.b],I=g(Tr(T.y-S.y,-(T.x-S.x),0));e.addQuad([{coord:T,height:0},{coord:S,height:0},{coord:S,height:o[x.a]+4},{coord:T,height:o[x.b]+4}],I),e.addQuad([{coord:S,height:0},{coord:T,height:0},{coord:T,height:o[x.b]+4},{coord:S,height:o[x.a]+4}],I)}}prepareEdgePoints(e,r,o,a){let c=r[o.a],d=r[o.b];const g=a(c,0),y=a(d,0);if(g&&y)return[{coord:e[o.a],height:c},{coord:e[o.b],height:d}];if(!g&&!y)return;const x=e[o.a].clone(),S=e[o.b].clone();if(g){if(!y){const T=d/(d-c);S.x=Mr(S.x,x.x,T),S.y=Mr(S.y,x.y,T),d=Mr(d,c,T)}}else{const T=c/(c-d);x.x=Mr(x.x,S.x,T),x.y=Mr(x.y,S.y,T),c=Mr(c,d,T)}return[{coord:x,height:c},{coord:S,height:d}]}prepareEdges(e,r){if(r.length===0)return;r.sort((g,y)=>g.hash===y.hash?y.polygonIdx-g.polygonIdx:y.hash>g.hash?1:-1);let o=0,a=0,c=0,d=r[o].polygonIdx;do a++,(a===r.length||r[o].hash!==r[a].hash)&&((a-o==1||r[a-1].polygonIdx!==d)&&(c<o&&(r[c]=r[o],r[o]=null),r[c].type="none",c++),o=a,o!==r.length&&(d=r[o].polygonIdx));while(o!==r.length);if(r.splice(c),r.length!==0&&e.length!==0){r.sort((x,S)=>x.portalHash<S.portalHash?1:-1);let g=0,y=0;for(;g!==r.length&&y!==e.length;){const x=r[g],S=e[y];x.portalHash>S.hash?g++:S.hash>x.portalHash?y++:(x.type=S.type,g++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=Wt&&r>=Wt}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(zl.computePosHash(e))<<32n|BigInt(zl.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var V0,j0={exports:{}},U0=(V0||(V0=1,function(i,e){(function(r){function o(le,de){return le>de?1:le<de?-1:0}var a=function(le,de){le===void 0&&(le=o),de===void 0&&(de=!1),this._compare=le,this._root=null,this._size=0,this._noDuplicates=!!de},c={size:{configurable:!0}};function d(le,de,pt,$t,tr){var er=tr-$t;if(er>0){var vr=$t+Math.floor(er/2),Br={key:de[vr],data:pt[vr],parent:le};return Br.left=d(Br,de,pt,$t,vr),Br.right=d(Br,de,pt,vr+1,tr),Br}return null}function g(le,de,pt,$t,tr){if(!(pt>=$t)){for(var er=le[pt+$t>>1],vr=pt-1,Br=$t+1;;){do vr++;while(tr(le[vr],er)<0);do Br--;while(tr(le[Br],er)>0);if(vr>=Br)break;var Ti=le[vr];le[vr]=le[Br],le[Br]=Ti,Ti=de[vr],de[vr]=de[Br],de[Br]=Ti}g(le,de,pt,Br,tr),g(le,de,Br+1,$t,tr)}}a.prototype.rotateLeft=function(le){var de=le.right;de&&(le.right=de.left,de.left&&(de.left.parent=le),de.parent=le.parent),le.parent?le===le.parent.left?le.parent.left=de:le.parent.right=de:this._root=de,de&&(de.left=le),le.parent=de},a.prototype.rotateRight=function(le){var de=le.left;de&&(le.left=de.right,de.right&&(de.right.parent=le),de.parent=le.parent),le.parent?le===le.parent.left?le.parent.left=de:le.parent.right=de:this._root=de,de&&(de.right=le),le.parent=de},a.prototype._splay=function(le){for(;le.parent;){var de=le.parent;de.parent?de.left===le&&de.parent.left===de?(this.rotateRight(de.parent),this.rotateRight(de)):de.right===le&&de.parent.right===de?(this.rotateLeft(de.parent),this.rotateLeft(de)):de.left===le&&de.parent.right===de?(this.rotateRight(de),this.rotateLeft(de)):(this.rotateLeft(de),this.rotateRight(de)):de.left===le?this.rotateRight(de):this.rotateLeft(de)}},a.prototype.splay=function(le){for(var de,pt,$t,tr,er;le.parent;)(pt=(de=le.parent).parent)&&pt.parent?(($t=pt.parent).left===pt?$t.left=le:$t.right=le,le.parent=$t):(le.parent=null,this._root=le),tr=le.left,er=le.right,le===de.left?(pt&&(pt.left===de?(de.right?(pt.left=de.right,pt.left.parent=pt):pt.left=null,de.right=pt,pt.parent=de):(tr?(pt.right=tr,tr.parent=pt):pt.right=null,le.left=pt,pt.parent=le)),er?(de.left=er,er.parent=de):de.left=null,le.right=de,de.parent=le):(pt&&(pt.right===de?(de.left?(pt.right=de.left,pt.right.parent=pt):pt.right=null,de.left=pt,pt.parent=de):(er?(pt.left=er,er.parent=pt):pt.left=null,le.right=pt,pt.parent=le)),tr?(de.right=tr,tr.parent=de):de.right=null,le.left=de,de.parent=le)},a.prototype.replace=function(le,de){le.parent?le===le.parent.left?le.parent.left=de:le.parent.right=de:this._root=de,de&&(de.parent=le.parent)},a.prototype.minNode=function(le){if(le===void 0&&(le=this._root),le)for(;le.left;)le=le.left;return le},a.prototype.maxNode=function(le){if(le===void 0&&(le=this._root),le)for(;le.right;)le=le.right;return le},a.prototype.insert=function(le,de){var pt=this._root,$t=null,tr=this._compare;if(this._noDuplicates)for(;pt;){if($t=pt,tr(pt.key,le)===0)return;pt=tr(pt.key,le)<0?pt.right:pt.left}else for(;pt;)$t=pt,pt=tr(pt.key,le)<0?pt.right:pt.left;return pt={key:le,data:de,left:null,right:null,parent:$t},$t?tr($t.key,pt.key)<0?$t.right=pt:$t.left=pt:this._root=pt,this.splay(pt),this._size++,pt},a.prototype.find=function(le){for(var de=this._root,pt=this._compare;de;){var $t=pt(de.key,le);if($t<0)de=de.right;else{if(!($t>0))return de;de=de.left}}return null},a.prototype.contains=function(le){for(var de=this._root,pt=this._compare;de;){var $t=pt(le,de.key);if($t===0)return!0;de=$t<0?de.left:de.right}return!1},a.prototype.remove=function(le){var de=this.find(le);if(!de)return!1;if(this.splay(de),de.left)if(de.right){var pt=this.minNode(de.right);pt.parent!==de&&(this.replace(pt,pt.right),pt.right=de.right,pt.right.parent=pt),this.replace(de,pt),pt.left=de.left,pt.left.parent=pt}else this.replace(de,de.left);else this.replace(de,de.right);return this._size--,!0},a.prototype.removeNode=function(le){if(!le)return!1;if(this.splay(le),le.left)if(le.right){var de=this.minNode(le.right);de.parent!==le&&(this.replace(de,de.right),de.right=le.right,de.right.parent=de),this.replace(le,de),de.left=le.left,de.left.parent=de}else this.replace(le,le.left);else this.replace(le,le.right);return this._size--,!0},a.prototype.erase=function(le){var de=this.find(le);if(de){this.splay(de);var pt=de.left,$t=de.right,tr=null;pt&&(pt.parent=null,tr=this.maxNode(pt),this.splay(tr),this._root=tr),$t&&(pt?tr.right=$t:this._root=$t,$t.parent=tr),this._size--}},a.prototype.pop=function(){var le=this._root,de=null;if(le){for(;le.left;)le=le.left;de={key:le.key,data:le.data},this.remove(le.key)}return de},a.prototype.next=function(le){var de=le;if(de)if(de.right)for(de=de.right;de&&de.left;)de=de.left;else for(de=le.parent;de&&de.right===le;)le=de,de=de.parent;return de},a.prototype.prev=function(le){var de=le;if(de)if(de.left)for(de=de.left;de&&de.right;)de=de.right;else for(de=le.parent;de&&de.left===le;)le=de,de=de.parent;return de},a.prototype.forEach=function(le){for(var de=this._root,pt=[],$t=!1,tr=0;!$t;)de?(pt.push(de),de=de.left):pt.length>0?(le(de=pt.pop(),tr++),de=de.right):$t=!0;return this},a.prototype.range=function(le,de,pt,$t){for(var tr=[],er=this._compare,vr=this._root;tr.length!==0||vr;)if(vr)tr.push(vr),vr=vr.left;else{if(er((vr=tr.pop()).key,de)>0)break;if(er(vr.key,le)>=0&&pt.call($t,vr))return this;vr=vr.right}return this},a.prototype.keys=function(){for(var le=this._root,de=[],pt=[],$t=!1;!$t;)le?(de.push(le),le=le.left):de.length>0?(le=de.pop(),pt.push(le.key),le=le.right):$t=!0;return pt},a.prototype.values=function(){for(var le=this._root,de=[],pt=[],$t=!1;!$t;)le?(de.push(le),le=le.left):de.length>0?(le=de.pop(),pt.push(le.data),le=le.right):$t=!0;return pt},a.prototype.at=function(le){for(var de=this._root,pt=[],$t=!1,tr=0;!$t;)if(de)pt.push(de),de=de.left;else if(pt.length>0){if(de=pt.pop(),tr===le)return de;tr++,de=de.right}else $t=!0;return null},a.prototype.load=function(le,de,pt){if(le===void 0&&(le=[]),de===void 0&&(de=[]),pt===void 0&&(pt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var $t=le.length;return pt&&g(le,de,0,$t-1,this._compare),this._root=d(null,le,de,0,$t),this._size=$t,this},a.prototype.min=function(){var le=this.minNode(this._root);return le?le.key:null},a.prototype.max=function(){var le=this.maxNode(this._root);return le?le.key:null},a.prototype.isEmpty=function(){return this._root===null},c.size.get=function(){return this._size},a.createTree=function(le,de,pt,$t,tr){return new a(pt,tr).load(le,de,$t)},Object.defineProperties(a.prototype,c);var y=0,x=1,S=2,T=3,I=0,R=1,D=2,O=3;function W(le,de,pt){de===null?(le.inOut=!1,le.otherInOut=!0):(le.isSubject===de.isSubject?(le.inOut=!de.inOut,le.otherInOut=de.otherInOut):(le.inOut=!de.otherInOut,le.otherInOut=de.isVertical()?!de.inOut:de.inOut),de&&(le.prevInResult=!X(de,pt)||de.isVertical()?de.prevInResult:de));var $t=X(le,pt);le.resultTransition=$t?function(tr,er){var vr,Br=!tr.inOut,Ti=!tr.otherInOut;switch(er){case I:vr=Br&&Ti;break;case R:vr=Br||Ti;break;case O:vr=Br^Ti;break;case D:vr=tr.isSubject?Br&&!Ti:Ti&&!Br}return vr?1:-1}(le,pt):0}function X(le,de){switch(le.type){case y:switch(de){case I:return!le.otherInOut;case R:return le.otherInOut;case D:return le.isSubject&&le.otherInOut||!le.isSubject&&!le.otherInOut;case O:return!0}break;case S:return de===I||de===R;case T:return de===D;case x:return!1}return!1}var oe=function(le,de,pt,$t,tr){this.left=de,this.point=le,this.otherEvent=pt,this.isSubject=$t,this.type=tr||y,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},re={inResult:{configurable:!0}};function B(le,de){return le[0]===de[0]&&le[1]===de[1]}oe.prototype.isBelow=function(le){var de=this.point,pt=this.otherEvent.point;return this.left?(de[0]-le[0])*(pt[1]-le[1])-(pt[0]-le[0])*(de[1]-le[1])>0:(pt[0]-le[0])*(de[1]-le[1])-(de[0]-le[0])*(pt[1]-le[1])>0},oe.prototype.isAbove=function(le){return!this.isBelow(le)},oe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},re.inResult.get=function(){return this.resultTransition!==0},oe.prototype.clone=function(){var le=new oe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return le.contourId=this.contourId,le.resultTransition=this.resultTransition,le.prevInResult=this.prevInResult,le.isExteriorRing=this.isExteriorRing,le.inOut=this.inOut,le.otherInOut=this.otherInOut,le},Object.defineProperties(oe.prototype,re);var J=11102230246251565e-32,ie=134217729,ce=(3+8*J)*J;function Ie(le,de,pt,$t,tr){var er,vr,Br,Ti,Ei=de[0],si=$t[0],tn=0,hn=0;si>Ei==si>-Ei?(er=Ei,Ei=de[++tn]):(er=si,si=$t[++hn]);var Ii=0;if(tn<le&&hn<pt)for(si>Ei==si>-Ei?(Br=er-((vr=Ei+er)-Ei),Ei=de[++tn]):(Br=er-((vr=si+er)-si),si=$t[++hn]),er=vr,Br!==0&&(tr[Ii++]=Br);tn<le&&hn<pt;)si>Ei==si>-Ei?(Br=er-((vr=er+Ei)-(Ti=vr-er))+(Ei-Ti),Ei=de[++tn]):(Br=er-((vr=er+si)-(Ti=vr-er))+(si-Ti),si=$t[++hn]),er=vr,Br!==0&&(tr[Ii++]=Br);for(;tn<le;)Br=er-((vr=er+Ei)-(Ti=vr-er))+(Ei-Ti),Ei=de[++tn],er=vr,Br!==0&&(tr[Ii++]=Br);for(;hn<pt;)Br=er-((vr=er+si)-(Ti=vr-er))+(si-Ti),si=$t[++hn],er=vr,Br!==0&&(tr[Ii++]=Br);return er===0&&Ii!==0||(tr[Ii++]=er),Ii}function Pe(le){return new Float64Array(le)}var Le=33306690738754716e-32,Ue=22204460492503146e-32,ct=11093356479670487e-47,Pt=Pe(4),Tt=Pe(8),At=Pe(12),Nt=Pe(16),at=Pe(4);function It(le,de,pt){var $t=function(tr,er,vr,Br,Ti,Ei){var si=(er-Ei)*(vr-Ti),tn=(tr-Ti)*(Br-Ei),hn=si-tn;if(si===0||tn===0||si>0!=tn>0)return hn;var Ii=Math.abs(si+tn);return Math.abs(hn)>=Le*Ii?hn:-function(Bn,xn,Ji,Qn,En,dn,bn){var rn,di,sn,Nn,zr,Ni,In,Zn,An,Eo,ln,vo,Ga,ks,Ts,Ha,rh,Io,Go=Bn-En,Ls=Ji-En,ta=xn-dn,$s=Qn-dn;Pt[0]=(Ts=(Zn=Go-(In=(Ni=ie*Go)-(Ni-Go)))*(Eo=$s-(An=(Ni=ie*$s)-(Ni-$s)))-((ks=Go*$s)-In*An-Zn*An-In*Eo))-((ln=Ts-(rh=(Zn=ta-(In=(Ni=ie*ta)-(Ni-ta)))*(Eo=Ls-(An=(Ni=ie*Ls)-(Ni-Ls)))-((Ha=ta*Ls)-In*An-Zn*An-In*Eo)))+(zr=Ts-ln))+(zr-rh),Pt[1]=(Ga=ks-((vo=ks+ln)-(zr=vo-ks))+(ln-zr))-((ln=Ga-Ha)+(zr=Ga-ln))+(zr-Ha),Pt[2]=vo-((Io=vo+ln)-(zr=Io-vo))+(ln-zr),Pt[3]=Io;var Od=function(d3,$x){for(var Wx=$x[0],V_=1;V_<4;V_++)Wx+=$x[V_];return Wx}(0,Pt),em=Ue*bn;if(Od>=em||-Od>=em||(rn=Bn-(Go+(zr=Bn-Go))+(zr-En),sn=Ji-(Ls+(zr=Ji-Ls))+(zr-En),di=xn-(ta+(zr=xn-ta))+(zr-dn),Nn=Qn-($s+(zr=Qn-$s))+(zr-dn),rn===0&&di===0&&sn===0&&Nn===0)||(em=ct*bn+ce*Math.abs(Od),(Od+=Go*Nn+$s*rn-(ta*sn+Ls*di))>=em||-Od>=em))return Od;at[0]=(Ts=(Zn=rn-(In=(Ni=ie*rn)-(Ni-rn)))*(Eo=$s-(An=(Ni=ie*$s)-(Ni-$s)))-((ks=rn*$s)-In*An-Zn*An-In*Eo))-((ln=Ts-(rh=(Zn=di-(In=(Ni=ie*di)-(Ni-di)))*(Eo=Ls-(An=(Ni=ie*Ls)-(Ni-Ls)))-((Ha=di*Ls)-In*An-Zn*An-In*Eo)))+(zr=Ts-ln))+(zr-rh),at[1]=(Ga=ks-((vo=ks+ln)-(zr=vo-ks))+(ln-zr))-((ln=Ga-Ha)+(zr=Ga-ln))+(zr-Ha),at[2]=vo-((Io=vo+ln)-(zr=Io-vo))+(ln-zr),at[3]=Io;var RS=Ie(4,Pt,4,at,Tt);at[0]=(Ts=(Zn=Go-(In=(Ni=ie*Go)-(Ni-Go)))*(Eo=Nn-(An=(Ni=ie*Nn)-(Ni-Nn)))-((ks=Go*Nn)-In*An-Zn*An-In*Eo))-((ln=Ts-(rh=(Zn=ta-(In=(Ni=ie*ta)-(Ni-ta)))*(Eo=sn-(An=(Ni=ie*sn)-(Ni-sn)))-((Ha=ta*sn)-In*An-Zn*An-In*Eo)))+(zr=Ts-ln))+(zr-rh),at[1]=(Ga=ks-((vo=ks+ln)-(zr=vo-ks))+(ln-zr))-((ln=Ga-Ha)+(zr=Ga-ln))+(zr-Ha),at[2]=vo-((Io=vo+ln)-(zr=Io-vo))+(ln-zr),at[3]=Io;var DS=Ie(RS,Tt,4,at,At);at[0]=(Ts=(Zn=rn-(In=(Ni=ie*rn)-(Ni-rn)))*(Eo=Nn-(An=(Ni=ie*Nn)-(Ni-Nn)))-((ks=rn*Nn)-In*An-Zn*An-In*Eo))-((ln=Ts-(rh=(Zn=di-(In=(Ni=ie*di)-(Ni-di)))*(Eo=sn-(An=(Ni=ie*sn)-(Ni-sn)))-((Ha=di*sn)-In*An-Zn*An-In*Eo)))+(zr=Ts-ln))+(zr-rh),at[1]=(Ga=ks-((vo=ks+ln)-(zr=vo-ks))+(ln-zr))-((ln=Ga-Ha)+(zr=Ga-ln))+(zr-Ha),at[2]=vo-((Io=vo+ln)-(zr=Io-vo))+(ln-zr),at[3]=Io;var kS=Ie(DS,At,4,at,Nt);return Nt[kS-1]}(tr,er,vr,Br,Ti,Ei,Ii)}(le[0],le[1],de[0],de[1],pt[0],pt[1]);return $t>0?-1:$t<0?1:0}function nt(le,de){var pt=le.point,$t=de.point;return pt[0]>$t[0]?1:pt[0]<$t[0]?-1:pt[1]!==$t[1]?pt[1]>$t[1]?1:-1:function(tr,er,vr,Br){return tr.left!==er.left?tr.left?1:-1:It(vr,tr.otherEvent.point,er.otherEvent.point)!==0?tr.isBelow(er.otherEvent.point)?-1:1:!tr.isSubject&&er.isSubject?1:-1}(le,de,pt)}function ut(le,de,pt){var $t=new oe(de,!1,le,le.isSubject),tr=new oe(de,!0,le.otherEvent,le.isSubject);return B(le.point,le.otherEvent.point)&&console.warn("what is that, a collapsed segment?",le),$t.contourId=tr.contourId=le.contourId,nt(tr,le.otherEvent)>0&&(le.otherEvent.left=!0,tr.left=!1),le.otherEvent.otherEvent=tr,le.otherEvent=$t,pt.push(tr),pt.push($t),pt}function jt(le,de){return le[0]*de[1]-le[1]*de[0]}function qt(le,de){return le[0]*de[0]+le[1]*de[1]}function wr(le,de,pt){var $t=function(Ti,Ei,si,tn,hn){var Ii=[Ei[0]-Ti[0],Ei[1]-Ti[1]],Bn=[tn[0]-si[0],tn[1]-si[1]];function xn(Ni,In,Zn){return[Ni[0]+In*Zn[0],Ni[1]+In*Zn[1]]}var Ji=[si[0]-Ti[0],si[1]-Ti[1]],Qn=jt(Ii,Bn),En=Qn*Qn,dn=qt(Ii,Ii);if(En>0){var bn=jt(Ji,Bn)/Qn;if(bn<0||bn>1)return null;var rn=jt(Ji,Ii)/Qn;return rn<0||rn>1?null:bn===0||bn===1?[xn(Ti,bn,Ii)]:rn===0||rn===1?[xn(si,rn,Bn)]:[xn(Ti,bn,Ii)]}if((En=(Qn=jt(Ji,Ii))*Qn)>0)return null;var di=qt(Ii,Ji)/dn,sn=di+qt(Ii,Bn)/dn,Nn=Math.min(di,sn),zr=Math.max(di,sn);return Nn<=1&&zr>=0?Nn===1?[xn(Ti,Nn>0?Nn:0,Ii)]:zr===0?[xn(Ti,zr<1?zr:1,Ii)]:[xn(Ti,Nn>0?Nn:0,Ii),xn(Ti,zr<1?zr:1,Ii)]:null}(le.point,le.otherEvent.point,de.point,de.otherEvent.point),tr=$t?$t.length:0;if(tr===0||tr===1&&(B(le.point,de.point)||B(le.otherEvent.point,de.otherEvent.point))||tr===2&&le.isSubject===de.isSubject)return 0;if(tr===1)return B(le.point,$t[0])||B(le.otherEvent.point,$t[0])||ut(le,$t[0],pt),B(de.point,$t[0])||B(de.otherEvent.point,$t[0])||ut(de,$t[0],pt),1;var er=[],vr=!1,Br=!1;return B(le.point,de.point)?vr=!0:nt(le,de)===1?er.push(de,le):er.push(le,de),B(le.otherEvent.point,de.otherEvent.point)?Br=!0:nt(le.otherEvent,de.otherEvent)===1?er.push(de.otherEvent,le.otherEvent):er.push(le.otherEvent,de.otherEvent),vr&&Br||vr?(de.type=x,le.type=de.inOut===le.inOut?S:T,vr&&!Br&&ut(er[1].otherEvent,er[0].point,pt),2):Br?(ut(er[0],er[1].point,pt),3):er[0]!==er[3].otherEvent?(ut(er[0],er[1].point,pt),ut(er[1],er[2].point,pt),3):(ut(er[0],er[1].point,pt),ut(er[3].otherEvent,er[2].point,pt),3)}function hr(le,de){if(le===de)return 0;if(It(le.point,le.otherEvent.point,de.point)!==0||It(le.point,le.otherEvent.point,de.otherEvent.point)!==0)return B(le.point,de.point)?le.isBelow(de.otherEvent.point)?-1:1:le.point[0]===de.point[0]?le.point[1]<de.point[1]?-1:1:nt(le,de)===1?de.isAbove(le.point)?-1:1:le.isBelow(de.point)?-1:1;if(le.isSubject!==de.isSubject)return le.isSubject?-1:1;var pt=le.point,$t=de.point;return pt[0]===$t[0]&&pt[1]===$t[1]?(pt=le.otherEvent.point)[0]===($t=de.otherEvent.point)[0]&&pt[1]===$t[1]?0:le.contourId>de.contourId?1:-1:nt(le,de)===1?1:-1}var Jt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Vt(le,de,pt,$t){var tr,er=le+1,vr=de[le].point,Br=de.length;for(er<Br&&(tr=de[er].point);er<Br&&tr[0]===vr[0]&&tr[1]===vr[1];){if(!pt[er])return er;++er<Br&&(tr=de[er].point)}for(er=le-1;pt[er]&&er>$t;)er--;return er}Jt.prototype.isExterior=function(){return this.holeOf==null};var $r=yr,_r=yr;function yr(le,de){if(!(this instanceof yr))return new yr(le,de);if(this.data=le||[],this.length=this.data.length,this.compare=de||Vr,this.length>0)for(var pt=(this.length>>1)-1;pt>=0;pt--)this._down(pt)}function Vr(le,de){return le<de?-1:le>de?1:0}yr.prototype={push:function(le){this.data.push(le),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var le=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),le}},peek:function(){return this.data[0]},_up:function(le){for(var de=this.data,pt=this.compare,$t=de[le];le>0;){var tr=le-1>>1,er=de[tr];if(pt($t,er)>=0)break;de[le]=er,le=tr}de[le]=$t},_down:function(le){for(var de=this.data,pt=this.compare,$t=this.length>>1,tr=de[le];le<$t;){var er=1+(le<<1),vr=er+1,Br=de[er];if(vr<this.length&&pt(de[vr],Br)<0&&(er=vr,Br=de[vr]),pt(Br,tr)>=0)break;de[le]=Br,le=er}de[le]=tr}},$r.default=_r;var Kr=Math.max,ni=Math.min,_i=0;function ci(le,de,pt,$t,tr,er){var vr,Br,Ti,Ei,si,tn;for(vr=0,Br=le.length-1;vr<Br;vr++)if(Ei=le[vr+1],si=new oe(Ti=le[vr],!1,void 0,de),tn=new oe(Ei,!1,si,de),si.otherEvent=tn,Ti[0]!==Ei[0]||Ti[1]!==Ei[1]){si.contourId=tn.contourId=pt,er||(si.isExteriorRing=!1,tn.isExteriorRing=!1),nt(si,tn)>0?tn.left=!0:si.left=!0;var hn=Ti[0],Ii=Ti[1];tr[0]=ni(tr[0],hn),tr[1]=ni(tr[1],Ii),tr[2]=Kr(tr[2],hn),tr[3]=Kr(tr[3],Ii),$t.push(si),$t.push(tn)}}var oi=[];function an(le,de,pt){typeof le[0][0][0]=="number"&&(le=[le]),typeof de[0][0][0]=="number"&&(de=[de]);var $t=function(Ii,Bn,xn){var Ji=null;return Ii.length*Bn.length==0&&(xn===I?Ji=oi:xn===D?Ji=Ii:xn!==R&&xn!==O||(Ji=Ii.length===0?Bn:Ii)),Ji}(le,de,pt);if($t)return $t===oi?null:$t;var tr=[1/0,1/0,-1/0,-1/0],er=[1/0,1/0,-1/0,-1/0],vr=function(Ii,Bn,xn,Ji,Qn){var En,dn,bn,rn,di,sn,Nn=new $r(null,nt);for(bn=0,rn=Ii.length;bn<rn;bn++)for(di=0,sn=(En=Ii[bn]).length;di<sn;di++)(dn=di===0)&&_i++,ci(En[di],!0,_i,Nn,xn,dn);for(bn=0,rn=Bn.length;bn<rn;bn++)for(di=0,sn=(En=Bn[bn]).length;di<sn;di++)dn=di===0,Qn===D&&(dn=!1),dn&&_i++,ci(En[di],!1,_i,Nn,Ji,dn);return Nn}(le,de,tr,er,pt);if($t=function(Ii,Bn,xn,Ji,Qn){var En=null;return(xn[0]>Ji[2]||Ji[0]>xn[2]||xn[1]>Ji[3]||Ji[1]>xn[3])&&(Qn===I?En=oi:Qn===D?En=Ii:Qn!==R&&Qn!==O||(En=Ii.concat(Bn))),En}(le,de,tr,er,pt))return $t===oi?null:$t;for(var Br=function(Ii){var Bn,xn,Ji=function(bn){var rn,di,sn,Nn,zr=[];for(di=0,sn=bn.length;di<sn;di++)((rn=bn[di]).left&&rn.inResult||!rn.left&&rn.otherEvent.inResult)&&zr.push(rn);for(var Ni=!1;!Ni;)for(Ni=!0,di=0,sn=zr.length;di<sn;di++)di+1<sn&&nt(zr[di],zr[di+1])===1&&(Nn=zr[di],zr[di]=zr[di+1],zr[di+1]=Nn,Ni=!1);for(di=0,sn=zr.length;di<sn;di++)(rn=zr[di]).otherPos=di;for(di=0,sn=zr.length;di<sn;di++)(rn=zr[di]).left||(Nn=rn.otherPos,rn.otherPos=rn.otherEvent.otherPos,rn.otherEvent.otherPos=Nn);return zr}(Ii),Qn={},En=[],dn=function(){if(!Qn[Bn]){var bn=En.length,rn=function(zr,Ni,In){var Zn=new Jt;if(zr.prevInResult!=null){var An=zr.prevInResult,Eo=An.outputContourId;if(An.resultTransition>0){var ln=Ni[Eo];if(ln.holeOf!=null){var vo=ln.holeOf;Ni[vo].holeIds.push(In),Zn.holeOf=vo,Zn.depth=Ni[Eo].depth}else Ni[Eo].holeIds.push(In),Zn.holeOf=Eo,Zn.depth=Ni[Eo].depth+1}else Zn.holeOf=null,Zn.depth=Ni[Eo].depth}else Zn.holeOf=null,Zn.depth=0;return Zn}(Ji[Bn],En,bn),di=function(zr){Qn[zr]=!0,zr<Ji.length&&Ji[zr]&&(Ji[zr].outputContourId=bn)},sn=Bn,Nn=Bn;for(rn.points.push(Ji[Bn].point);di(sn),di(sn=Ji[sn].otherPos),rn.points.push(Ji[sn].point),!((sn=Vt(sn,Ji,Qn,Nn))==Nn||sn>=Ji.length)&&Ji[sn];);En.push(rn)}};for(Bn=0,xn=Ji.length;Bn<xn;Bn++)dn();return En}(function(Ii,Bn,xn,Ji,Qn,En){for(var dn,bn,rn,di=new a(hr),sn=[],Nn=Math.min(Ji[2],Qn[2]);Ii.length!==0;){var zr=Ii.pop();if(sn.push(zr),En===I&&zr.point[0]>Nn||En===D&&zr.point[0]>Ji[2])break;if(zr.left){bn=dn=di.insert(zr),dn=dn!==(rn=di.minNode())?di.prev(dn):null,bn=di.next(bn);var Ni=dn?dn.key:null;if(W(zr,Ni,En),bn&&wr(zr,bn.key,Ii)===2&&(W(zr,Ni,En),W(bn.key,zr,En)),dn&&wr(dn.key,zr,Ii)===2){var In=dn;W(Ni,(In=In!==rn?di.prev(In):null)?In.key:null,En),W(zr,Ni,En)}}else bn=dn=di.find(zr=zr.otherEvent),dn&&bn&&(dn=dn!==rn?di.prev(dn):null,bn=di.next(bn),di.remove(zr),bn&&dn&&wr(dn.key,bn.key,Ii))}return sn}(vr,0,0,tr,er,pt)),Ti=[],Ei=0;Ei<Br.length;Ei++){var si=Br[Ei];if(si.isExterior()){for(var tn=[si.points],hn=0;hn<si.holeIds.length;hn++)tn.push(Br[si.holeIds[hn]].points);Ti.push(tn)}}return Ti}var vn={UNION:R,DIFFERENCE:D,INTERSECTION:I,XOR:O};r.diff=function(le,de){return an(le,de,D)},r.intersection=function(le,de){return an(le,de,I)},r.operations=vn,r.union=function(le,de){return an(le,de,R)},r.xor=function(le,de){return an(le,de,O)},Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,j0.exports)),j0.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function wm(i,e,r,o){const a=[],c=o===0?(d,g,y,x,S,T)=>{d.push(new Ot(T,y+(T-g)/(x-g)*(S-y)))}:(d,g,y,x,S,T)=>{d.push(new Ot(g+(T-y)/(S-y)*(x-g),T))};for(const d of i){const g=[];for(const y of d){if(y.length<=2)continue;const x=[];for(let I=0;I<y.length-1;I++){const R=y[I].x,D=y[I].y,O=y[I+1].x,W=y[I+1].y,X=o===0?R:D,oe=o===0?O:W;X<e?oe>e&&c(x,R,D,O,W,e):X>r?oe<r&&c(x,R,D,O,W,r):x.push(y[I]),oe<e&&X>=e&&c(x,R,D,O,W,e),oe>r&&X<=r&&c(x,R,D,O,W,r)}let S=y[y.length-1];const T=o===0?S.x:S.y;T>=e&&T<=r&&x.push(S),x.length&&(S=x[x.length-1],x[0].x===S.x&&x[0].y===S.y||x.push(x[0]),g.push(x))}g.length&&a.push(g)}return a}function Zb(i,e){const r=Fg(i),o=Fg([e]),a=U0.intersection(r,o);return a==null?[]:q0(a)}function Xb(i,e){let o=Fg(i,65536);for(;e.valid();e.next()){const[a,c]=e.get(),d=a.x*65536,g=a.y*65536,y=c.x*65536,x=c.y*65536,S=y-d,T=x-g,I=Math.hypot(S,T),R=Math.trunc(T/I*3),D=-Math.trunc(S/I*3);o=U0.diff(o,[[[d,g],[y,x],[y+R,x+D],[d+R,g+D],[d,g]]])}return q0(o,1/65536)}function Fg(i,e=1){return[i.map(r=>r.map(o=>[o.x*e,o.y*e]))]}function q0(i,e=1){return i.map(r=>r.map((o,a)=>{const c=o.map(d=>new Ot(d[0]*e,d[1]*e).round());return a>0&&c.reverse(),c}))}class Bg{constructor(e,r){this.layoutVertexArray=new Il,this.indexArray=new ao,this.lineIndexArray=new ol,this.triangleSegments=new Sn,this.lineSegments=new Sn,this.programConfigurations=new nu(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new Hc)}update(e,r,o,a,c,d,g){this.programConfigurations.updatePaintArrays(e,r,c,o,a,d,g)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bi.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,$i.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,o,a,c,d){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,o,a,c,d)}}class Ng{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new Bg(e,!1),this.elevationBufferData=new Bg(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,r){}populate(e,r,o,a){this.hasPattern=Pg("fill",this.layers,this.pixelRatio,r);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:g,id:y,index:x,sourceLayerIndex:S}of e){const T=this.layers[0]._featureFilter.needGeometry,I=gr(g,T);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),I,o))continue;const R=c?c.evaluate(I,{},o,r.availableImages):void 0,D={id:y,properties:g.properties,type:g.type,sourceLayerIndex:S,index:x,geometry:T?I.geometry:ur(g,o,a),patterns:{},sortKey:R};d.push(D)}c&&d.sort((g,y)=>g.sortKey-y.sortKey);for(const g of d){const{geometry:y,index:x,sourceLayerIndex:S}=g;if(this.hasPattern){const T=Rg("fill",this.layers,g,this.zoom,this.pixelRatio,r);this.patternFeatures.push(T)}else this.addFeature(g,y,x,o,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[x].feature,y,x,S,this.index)}}update(e,r,o,a,c,d,g){this.bufferData.update(e,r,o,a,c,d,g),this.elevationBufferData.update(e,r,o,a,c,d,g)}addFeatures(e,r,o,a,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,o,a,d,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,o,a,c,d=[],g,y){const x=xm(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,x,a,o,y):this.addGeometry(x,this.bufferData),this.bufferData.populatePaintArrays(e,o,c,d,a,g),this.elevationBufferData.populatePaintArrays(e,o,c,d,a,g)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,r,o,a,c){const d=new Array,g=Og.getElevationFeature(e,c);if(g){{const y=this.clipPolygonsToTile(r,1);y.length>0&&d.push({polygons:y,elevationFeature:g,elevationTileID:o})}for(const y of d)if(y.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new zl(y.elevationTileID));const S=y.elevationFeature.isTunnel();let T=0;e.properties.hasOwnProperty(z0)&&(T=+e.properties[z0]);for(const I of y.polygons)this.elevatedStructures.addPortalCandidates(y.elevationFeature.id,I,S,y.elevationFeature,T)}y.elevationFeature.constantHeight==null&&(y.polygons=this.prepareElevatedPolygons(y.polygons,y.elevationFeature,y.elevationTileID));const x=new B0(o,y.elevationTileID);this.addElevatedGeometry(y.polygons,x,y.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a)}}else this.addGeometry(r,this.bufferData)}addElevatedGeometry(e,r,o,a,c){const d={elevation:o,elevationSampler:r,bias:a,index:c},[g,y]=this.addGeometry(e,this.elevationBufferData,d);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:g,max:y}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,g),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,y))}addGeometry(e,r,o){let a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=null;o&&(d=o.elevationSampler.constantElevation(o.elevation,o.bias),d!=null&&(a=d,c=d));const g=(y,x,S)=>{if(o!=null)if(x.push(y),d!=null)r.elevatedLayoutVertexArray.emplaceBack(d),S.push(d);else{const T=o.elevationSampler.pointElevation(y,o.elevation,o.bias);r.elevatedLayoutVertexArray.emplaceBack(T),S.push(T),a=Math.min(a,T),c=Math.max(c,T)}};for(const y of e){let x=0;for(const re of y)x+=re.length;const S=r.triangleSegments.prepareSegment(x,r.layoutVertexArray,r.indexArray),T=S.vertexLength,I=[],R=[],D=[],O=[],W=[],X=r.layoutVertexArray.length;for(const re of y){if(re.length===0)continue;re!==y[0]&&R.push(I.length/2);const B=r.lineSegments.prepareSegment(re.length,r.layoutVertexArray,r.lineIndexArray),J=B.vertexLength;o&&W.push(r.layoutVertexArray.length-X),g(re[0],D,O),r.layoutVertexArray.emplaceBack(re[0].x,re[0].y),r.lineIndexArray.emplaceBack(J+re.length-1,J),I.push(re[0].x),I.push(re[0].y);for(let ie=1;ie<re.length;ie++)g(re[ie],D,O),r.layoutVertexArray.emplaceBack(re[ie].x,re[ie].y),r.lineIndexArray.emplaceBack(J+ie-1,J+ie),I.push(re[ie].x),I.push(re[ie].y);B.vertexLength+=re.length,B.primitiveLength+=re.length}const oe=Ll(I,R);for(let re=0;re<oe.length;re+=3)r.indexArray.emplaceBack(T+oe[re],T+oe[re+1],T+oe[re+2]);if(oe.length>0&&o&&this.elevationMode==="hd-road-base"){const re=o.elevation.isTunnel(),B=o.elevation.safeArea,J=this.elevatedStructures.addVertices(D,O);this.elevatedStructures.addTriangles(oe,J,re);const ie=W.length;if(ie>0){for(let ce=0;ce<ie-1;ce++)this.elevatedStructures.addRenderableRing(o.index,W[ce]+J,W[ce+1]-W[ce],re,B);this.elevatedStructures.addRenderableRing(o.index,W[ie-1]+J,D.length-W[ie-1],re,B)}}S.vertexLength+=x,S.primitiveLength+=oe.length/3}return[a,c]}prepareElevatedPolygons(e,r,o){const a=1/je(o),c=[];for(const d of e){const g=Xb(d,new F0(r,a));c.push(...g)}return c}clipPolygonsToTile(e,r){const o=-r,a=-r,c=Wt+r,d=Wt+r;let g=0;const y=[],x=[];for(;g<e.length;g++){const I=e[g],R=Xh(I);(R.min.x>=o&&R.max.x<=c&&R.min.y>=a&&R.max.y<=d?y:x).push(I)}if(y.length===e.length)return e;const S=[new Ot(o,a),new Ot(c,a),new Ot(c,d),new Ot(o,d),new Ot(o,a)],T=y;for(const I of x)T.push(...Zb(I,S));return T}}let G0,H0,$0,W0;ir(Ng,"FillBucket",{omit:["layers","patternFeatures"]}),ir(Bg,"FillBufferData"),ir(zl,"ElevatedStructures");class Vg{constructor(e,r,o,a){if(this.triangleCount=r.length/3,this.min=new Ot(0,0),this.max=new Ot(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[c,d]=[e[0].clone(),e[0].clone()];for(let T=1;T<e.length;++T){const I=e[T];c.x=Math.min(c.x,I.x),c.y=Math.min(c.y,I.y),d.x=Math.max(d.x,I.x),d.y=Math.max(d.y,I.y)}if(a){const T=Math.ceil(Math.max(d.x-c.x,d.y-c.y)/a);o=Math.max(o,T)}if(o===0)return;this.min=c,this.max=d;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const y=Math.max(g.x,g.y)/o;this.cellsX=Math.max(1,Math.ceil(g.x/y)),this.cellsY=Math.max(1,Math.ceil(g.y/y)),this.xScale=1/y,this.yScale=1/y;const x=[];for(let T=0;T<this.triangleCount;T++){const I=e[r[3*T+0]].sub(this.min),R=e[r[3*T+1]].sub(this.min),D=e[r[3*T+2]].sub(this.min),O=eh(Math.floor(Math.min(I.x,R.x,D.x)),this.xScale,this.cellsX),W=eh(Math.floor(Math.max(I.x,R.x,D.x)),this.xScale,this.cellsX),X=eh(Math.floor(Math.min(I.y,R.y,D.y)),this.yScale,this.cellsY),oe=eh(Math.floor(Math.max(I.y,R.y,D.y)),this.yScale,this.cellsY),re=new Ot(0,0),B=new Ot(0,0),J=new Ot(0,0),ie=new Ot(0,0);for(let ce=X;ce<=oe;++ce){re.y=B.y=ce*y,J.y=ie.y=(ce+1)*y;for(let Ie=O;Ie<=W;++Ie)re.x=J.x=Ie*y,B.x=ie.x=(Ie+1)*y,(Tn(I,R,D,re,B,ie)||Tn(I,R,D,re,ie,J))&&x.push({cellIdx:ce*this.cellsX+Ie,triIdx:T})}}if(x.length===0)return;x.sort((T,I)=>T.cellIdx-I.cellIdx||T.triIdx-I.triIdx);let S=0;for(;S<x.length;){const T=x[S].cellIdx,I={start:this.payload.length,len:0};for(;S<x.length&&x[S].cellIdx===T;)++I.len,this.payload.push(x[S++].triIdx);this.cells[T]=I}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=eh(e.x-this.min.x,this.xScale,this.cellsX),a=eh(e.y-this.min.y,this.yScale,this.cellsY),c=this.cells[a*this.cellsX+o];if(c){this._lazyInitLookup();for(let d=0;d<c.len;d++){const g=this.payload[c.start+d],y=Math.floor(g/8),x=1<<g%8;if(!(this.lookup[y]&x)&&(this.lookup[y]|=x,r.push(g),r.length===this.triangleCount))return}}}query(e,r,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const a=eh(e.x-this.min.x,this.xScale,this.cellsX),c=eh(r.x-this.min.x,this.xScale,this.cellsX),d=eh(e.y-this.min.y,this.yScale,this.cellsY),g=eh(r.y-this.min.y,this.yScale,this.cellsY);for(let y=d;y<=g;y++)for(let x=a;x<=c;x++){const S=this.cells[y*this.cellsX+x];if(S)for(let T=0;T<S.len;T++){const I=this.payload[S.start+T],R=Math.floor(I/8),D=1<<I%8;if(!(this.lookup[R]&D)&&(this.lookup[R]|=D,o.push(I),o.length===this.triangleCount))return}}}}function eh(i,e,r){return Math.max(0,Math.min(r-1,Math.floor(i*e)))}ir(Vg,"TriangleGridIndex");class Z0{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(const o of this.footprints)r.push({footprint:o,id:e})}populate(e,r,o,a){const c=[];for(const{feature:d,id:g,index:y,sourceLayerIndex:x}of e){const S=this.layers[0]._featureFilter.needGeometry,T=gr(d,S);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),T,o))continue;const I={id:g,properties:d.properties,type:d.type,sourceLayerIndex:x,index:y,geometry:S?T.geometry:ur(d,o,a),patterns:{}};c.push(I)}for(const d of c){const{geometry:g,index:y,sourceLayerIndex:x}=d;this.addFeature(d,g,y,o,{},r.availableImages,r.brightness),r.featureIndex.insert(e[y].feature,g,y,x,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,o,a,c,d,g){}destroy(){}addFeature(e,r,o,a,c,d=[],g){for(const y of xm(r,2)){const x=[],S=[],T=[],I=new Ot(1/0,1/0),R=new Ot(-1/0,-1/0);for(const W of y)if(W.length!==0){W!==y[0]&&T.push(S.length/2);for(let X=0;X<W.length;X++)S.push(W[X].x),S.push(W[X].y),x.push(W[X]),I.x=Math.min(I.x,W[X].x),I.y=Math.min(I.y,W[X].y),R.x=Math.max(R.x,W[X].x),R.y=Math.max(R.y,W[X].y)}const D=Ll(S,T),O=new Vg(x,D,8,256);this.footprints.push({vertices:x,indices:D,grid:O,min:I,max:R})}}}ir(Z0,"ClipBucket",{omit:["layers"]});const Yb=Fi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Kb=Fi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Jb=Fi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Qb=Fi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),ew=Fi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),tw=Fi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:rw}=Yb,Sm=Number.MAX_SAFE_INTEGER;function X0(i,e,r,o){return i.order<e||i.order===Sm||!(i.clipMask&r)||function(a,c){return c.length!==0&&c.find(d=>d===a)===void 0}(o,i.clipScope)}function Tm(i,e){return i.x-e.x||i.y-e.y}function Y0(i,e){return Tm(i.min,e.min)===0&&Tm(i.max,e.max)===0}function jg(i,e){return!(i.min.x>e.max.x||i.max.x<e.min.x||i.min.y>e.max.y||i.max.y<e.min.y)}function Ug(i,e){if(i.length!==e.length)return!1;for(let r=0;r<i.length;r++)if(i[r].sourceId!==e[r].sourceId||!Y0(i[r],e[r])||i[r].order!==e[r].order||i[r].clipMask!==e[r].clipMask||!pn(i[r].clipScope,e[r].clipScope))return!1;return!0}function K0(i,e,r){const o=1/Wt,a=1/(1<<r.canonical.z),c=(e.x*o+r.canonical.x)*a+r.wrap,d=(e.y*o+r.canonical.y)*a;return{min:new Ot((i.x*o+r.canonical.x)*a+r.wrap,(i.y*o+r.canonical.y)*a),max:new Ot(c,d)}}function iw(i,e,r){const o=1<<r.canonical.z,a=((e.x-r.wrap)*o-r.canonical.x)*Wt,c=(e.y*o-r.canonical.y)*Wt;return{min:new Ot(((i.x-r.wrap)*o-r.canonical.x)*Wt,(i.y*o-r.canonical.y)*Wt),max:new Ot(a,c)}}function J0(i,e,r,o,a,c,d){const g=i.indices,y=i.vertices,x=[];for(let S=o;S<o+a;S+=3){const T=e[r[S+0]+c],I=e[r[S+1]+c],R=e[r[S+2]+c],D=Math.min(T.x,I.x,R.x),O=Math.max(T.x,I.x,R.x),W=Math.min(T.y,I.y,R.y),X=Math.max(T.y,I.y,R.y);x.length=0,i.grid.query(new Ot(D,W),new Ot(O,X),x);for(let oe=0;oe<x.length;oe++){const re=x[oe];if(Tn(y[g[3*re+0]],y[g[3*re+1]],y[g[3*re+2]],T,I,R,d))return!0}}return!1}function Q0(i,e,r,o){if(!i||!r)return!1;let a=i.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(r.vertices.length<i.vertices.length)return Q0(r,o,i,e);const c=e.canonical,d=o.canonical,g=Math.pow(2,d.z-c.z);a=i.vertices.map(y=>new Ot((y.x+c.x*Wt)*g-d.x*Wt,(y.y+c.y*Wt)*g-d.y*Wt))}return J0(r,a,i.indices,0,i.indices.length,0,0)}function ey(i,e,r,o){const a=Math.pow(2,o.z-r.z);return new Ot((i+r.x*Wt)*a-o.x*Wt,(e+r.y*Wt)*a-o.y*Wt)}function ty(i,e){const r=[];e.grid.queryPoint(i,r);const o=e.indices,a=e.vertices;for(let c=0;c<r.length;c++){const d=r[c];if(Ki([a[o[3*d+0]],a[o[3*d+1]],a[o[3*d+2]]],i))return!0}return!1}const qg=[new Ot(0,0),new Ot(Wt,0),new Ot(Wt,Wt),new Ot(0,Wt)];function ry(i,e){const r=[];let o=[];if(!e||i.length<2)return[i];if(i.length===2)return zn(i[0],i[1],qg)?[i]:[];for(let a=0;a<i.length+2;a++){const c=i[a%i.length],d=i[(a+1)%i.length],g=zn(a===0?i[i.length-1]:i[(a-1)%i.length],c,qg),y=zn(c,d,qg),x=g||y;x&&o.push(c),x&&y||o.length>0&&(o.length>1&&r.push(o),o=[])}return o.length>1&&r.push(o),r}const Gg=Pd.VectorTileFeature.types,nw=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ow=["fill-extrusion-flood-light-ground-radius"],sw=Math.pow(2,13),aw=Math.pow(2,15)-1,iy=new Ot(0,1),Rd=2147483648;function Ap(i,e,r,o,a,c,d,g){i.emplaceBack((e<<1)+d,(r<<1)+c,(Math.floor(o*sw)<<1)+a,Math.round(g))}function Cp(i,e,r){i.emplaceBack(e.x*Wt,e.y*Wt,r?1:0)}function Em(i,e,r,o,a,c){i.emplaceBack(e.x,e.y,(r.x<<1)+o,(r.y<<1)+a,c)}function Mp(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class ny{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class oy{constructor(){this.centroidXY=new Ot(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ot(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ot(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ot(this.max.x-this.min.x,this.max.y-this.min.y)}}class sy{constructor(){this.acc=new Ot(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,o){this.accCount++,this.acc._add(r);let a=!!this.borders;r.x<e.min.x?(e.min.x=r.x,a=!0):r.x>e.max.x&&(e.max.x=r.x,a=!0),r.y<e.min.y?(e.min.y=r.y,a=!0):r.y>e.max.y&&(e.max.y=r.y,a=!0),((r.x===0||r.x===Wt)&&r.x===o.x)!=((r.y===0||r.y===Wt)&&r.y===o.y)&&this.processBorderOverlap(r,o),a&&this.checkBorderIntersection(r,o)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,Mr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Wt!=e.x>Wt&&this.addBorderIntersection(1,Mr(r.y,e.y,(Wt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Mr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Wt!=e.y>Wt&&this.addBorderIntersection(3,Mr(r.x,e.x,(Wt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];r<o[0]&&(o[0]=r),r>o[1]&&(o[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,r.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,r.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Ot(0,0):new Ot(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function ay(i,e){const r=i.add(e)._unit(),o=ke(i.x*r.x+i.y*r.y,-1,1);var a,c,d;return a=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(a)))/4*aw*((c=i).x*(d=e).y-c.y*d.x<0?-1:1)}const lw=[i=>i.x<0,i=>i.x>Wt,i=>i.y<0,i=>i.y>Wt];function uw(i,e,r,o){const a=[4];if(o===0)return a;r._mult(o);const c=i.sub(r),d=e.sub(r),g=[i,e,c,d];for(let y=0;y<4;y++)for(const x of g)if(lw[y](x)){a.push(y);break}return a}class ly{constructor(e){this.vertexArray=new of,this.indexArray=new ao,this.programConfigurations=new nu(e.layers,{zoom:e.zoom,lut:e.lut},r=>ow.includes(r)),this._segments=new Sn,this.hiddenByLandmarkVertexArray=new Oh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Sn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,o,a=!1){const c=e.length;if(c>2){let d=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let y;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const x=e[0],S=e[1];y=ay(x.sub(e[c-1])._perp()._unit(),S.sub(x)._perp()._unit())}for(let x=0;x<c;x++){const S=x===c-1?0:x+1,T=e[x],I=e[S],R=e[S===c-1?0:S+1],D=I.sub(T)._perp()._unit(),O=ay(D,R.sub(I)._perp()._unit()),W=y,X=O;if(Hg(T,I,r)||a&&hy(T,r)&&hy(I,r)){y=O;continue}const oe=g.vertexLength;Em(this.vertexArray,T,I,1,1,W),Em(this.vertexArray,T,I,1,0,W),Em(this.vertexArray,T,I,0,1,X),Em(this.vertexArray,T,I,0,0,X),g.vertexLength+=4;const re=uw(T,I,D,o);for(const B of re)this._segmentToGroundQuads[d].push({id:oe,region:B}),this._segmentToRegionTriCounts[d][B]+=2,g.primitiveLength+=2;y=O}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let o=0;o<r;o++)this._segmentToGroundQuads[o].sort((a,c)=>a.region-c.region);for(let o=0;o<r;o++){const a=this._segmentToGroundQuads[o],c=e[o],d=this._segmentToRegionTriCounts[o];d.reduce((y,x)=>y+x,0);let g=0;for(let y=0;y<=4;y++){const x=d[y];if(x!==0){let S=this.regionSegments[y];S||(S=this.regionSegments[y]=new Sn);const T={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+g,vertexLength:c.vertexLength,primitiveLength:x};S.get().push(T)}g+=x}for(let y=0;y<a.length;y++){const x=a[y].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,o,a,c,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,o,a,c,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Kb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,o,a,c,d,g){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,o,a,c,d,g)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&Rd?1:0;for(let a=e.groundVertexArrayOffset;a<r;++a)this.hiddenByLandmarkVertexArray.emplace(a,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,ew.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class Im{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ao,this.footprintVertices=new Il,this.footprintSegments=[],this.layoutVertexArray=new Au,this.centroidVertexArray=new cf,this.wallVertexArray=new Bh,this.indexArray=new ao,this.programConfigurations=new nu(e.layers,{zoom:e.zoom,lut:e.lut},r=>nw.includes(r)),this.segments=new Sn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new ly(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,o,a){this.features=[],this.hasPattern=Pg("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=je(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:c,id:d,index:g,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,S=gr(c,x);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),S,o))continue;const T={id:d,sourceLayerIndex:y,index:g,geometry:x?S.geometry:ur(c,o,a),properties:c.properties,type:c.type,patterns:{}},I=this.layoutVertexArray.length,R=Gg[T.type]==="Polygon";if(this.hasPattern)this.features.push(Rg("fill-extrusion",this.layers,T,this.zoom,this.pixelRatio,r));else if(this.wallMode)for(const D of T.geometry)for(const O of ry(D,R))this.addFeature(T,[O],g,o,{},r.availableImages,a,r.brightness);else this.addFeature(T,T.geometry,g,o,{},r.availableImages,a,r.brightness);r.featureIndex.insert(c,T.geometry,g,y,this.index,I)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,o,a,c,d){for(const g of this.features){const y=Gg[g.type]==="Polygon",{geometry:x}=g;if(this.wallMode)for(const S of x)for(const T of ry(S,y))this.addFeature(g,[T],g.index,r,o,a,c,d);else this.addFeature(g,x,g.index,r,o,a,c,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,o,a,c,d,g){this.programConfigurations.updatePaintArrays(e,r,c,o,a,d,g),this.groundEffect.update(e,r,c,o,a,d,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Qb.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tw.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Jb.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,o,a,c,d,g,y){const x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,S=[new Ot(0,0),new Ot(Wt,Wt)],T=g.projection,I=T.name==="globe",R=this.wallMode||Gg[e.type]==="Polygon",D=new sy;D.centroidDataIndex=this.centroidData.length;const O=new oy,W=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,X=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);let oe;if(O.height=X,O.vertexArrayOffset=this.layoutVertexArray.length,O.groundVertexArrayOffset=this.groundEffect.vertexArray.length,I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ic),this.wallMode){if(I)return void Jr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;oe=function(Le){const Ue=Le[0].x===Le[Le.length-1].x&&Le[0].y===Le[Le.length-1].y;(function(Jt){let Vt=0;const $r=Jt.length;for(let _r=0;_r<$r;_r++)Vt+=(Jt[(_r+1)%$r].x-Jt[_r].x)*(Jt[(_r+1)%$r].y+Jt[_r].y);return Vt>=0})(Le)||(Le=Le.reverse());const Pt={geometry:[],joinNormals:[],indices:[]},Tt=[],At=[],Nt=[];let at=Le.length;for(;at>=2&&Le[at-1].equals(Le[at-2]);)at--;if(at<(Ue?3:2))return Pt;let It,nt,ut,jt,qt,wr=0;for(;wr<at-1&&Le[wr].equals(Le[wr+1]);)wr++;Ue&&(It=Le[at-2],qt=Le[wr].sub(It)._unit()._perp());for(let Jt=wr;Jt<at;Jt++){if(ut=Jt===at-1?Ue?Le[wr+1]:void 0:Le[Jt+1],ut&&Le[Jt].equals(ut))continue;qt&&(jt=qt),It&&(nt=It),It=Le[Jt],qt=ut?ut.sub(It)._unit()._perp():jt,jt=jt||qt;let Vt=jt.add(qt);Vt.x===0&&Vt.y===0||Vt._unit();const $r=Vt.x*qt.x+Vt.y*qt.y,_r=$r!==0?1/$r:1/0,yr=jt.x*qt.y-jt.y*qt.x>0;let Vr="miter";const Kr=2;Vr==="miter"&&_r>Kr&&(Vr="bevel"),Vr==="bevel"&&(_r>100&&(Vr="flipbevel"),_r<Kr&&(Vr="miter"));const ni=(_i,ci,oi,an)=>{const vn=new Ot(_i.x,_i.y),le=new Ot(_i.x,_i.y);vn.x+=ci.x*an,vn.y+=ci.y*an,le.x-=ci.x*Math.max(oi,1),le.y-=ci.y*Math.max(oi,1),Nt.push(ci),Tt.push(vn),At.push(le)};if(Vr==="miter")Vt._mult(_r),ni(It,Vt,0,0);else if(Vr==="flipbevel")Vt=qt.mult(-1),ni(It,Vt,0,0),ni(It,Vt.mult(-1),0,0);else{const _i=-Math.sqrt(_r*_r-1),ci=yr?_i:0,oi=yr?0:_i;nt&&ni(It,jt,ci,oi),ut&&ni(It,qt,ci,oi)}}Pt.geometry=[...Tt,...At.reverse(),Tt[0]],Pt.joinNormals=[...Nt,...Nt.reverse(),Nt[Nt.length-1]];const hr=Pt.geometry.length-1;for(let Jt=0;Jt<hr/2;Jt++)if(Jt+1<hr/2){let Vt=Jt,$r=Jt+1,_r=hr-1-Jt,yr=hr-2-Jt;Vt=Vt===0?hr-1:Vt-1,$r=$r===0?hr-1:$r-1,_r=_r===0?hr-1:_r-1,yr=yr===0?hr-1:yr-1,Pt.indices.push(_r),Pt.indices.push($r),Pt.indices.push(Vt),Pt.indices.push(_r),Pt.indices.push(yr),Pt.indices.push($r)}return Pt}(r[0]),r=[oe.geometry]}const re=(Le,Ue)=>Le<(Ue.length-1)/2||Le===Ue.length-1,B=this.wallMode?[r]:xm(r,500);for(let Le=B.length-1;Le>=0;Le--){const Ue=B[Le];(Ue.length===0||(J=Ue[0]).every(ct=>ct.x<=0)||J.every(ct=>ct.x>=Wt)||J.every(ct=>ct.y<=0)||J.every(ct=>ct.y>=Wt))&&B.splice(Le,1)}var J;let ie;if(I)ie=my(B,S,a);else{ie=[];for(const Le of B)ie.push({polygon:Le,bounds:S})}const ce=R?this.edgeRadius:0,Ie=ce>0&&this.zoom<17,Pe=(Le,Ue)=>{if(Le.length===0)return!1;const ct=Le[Le.length-1];return Ue.x===ct.x&&Ue.y===ct.y};for(const{polygon:Le,bounds:Ue}of ie){let ct=0,Pt=0;for(const at of Le)R&&!at[0].equals(at[at.length-1])&&at.push(at[0]),Pt+=R?at.length-1:at.length;const Tt=this.segments.prepareSegment((R?5:4)*Pt,this.layoutVertexArray,this.indexArray);O.footprintSegIdx<0&&(O.footprintSegIdx=this.footprintSegments.length),O.polygonSegIdx<0&&(O.polygonSegIdx=this.polygonSegments.length);const At={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Nt=new ny;if(Nt.vertexOffset=this.footprintVertices.length,Nt.indexOffset=3*this.footprintIndices.length,Nt.ringIndices=[],R){const at=[],It=[];ct=Tt.vertexLength;for(let ut=0;ut<Le.length;ut++){const jt=Le[ut];jt.length&&ut!==0&&It.push(at.length/2);const qt=[];let wr,hr;wr=jt[1].sub(jt[0])._perp()._unit(),Nt.ringIndices.push(jt.length-1);for(let Jt=1;Jt<jt.length;Jt++){const Vt=jt[Jt],$r=jt[Jt===jt.length-1?1:Jt+1],_r=Vt.clone();if(ce){hr=$r.sub(Vt)._perp()._unit();const yr=wr.add(hr)._unit(),Vr=ce*Math.min(4,1/(wr.x*yr.x+wr.y*yr.y));_r.x+=Vr*yr.x,_r.y+=Vr*yr.y,_r.x=Math.round(_r.x),_r.y=Math.round(_r.y),wr=hr}if(!W||ce!==0&&!Ie||Pe(qt,_r)||qt.push(_r),Ap(this.layoutVertexArray,_r.x,_r.y,0,0,1,1,0),this.wallMode){const yr=re(Jt,jt);Cp(this.wallVertexArray,oe.joinNormals[Jt],!yr)}Tt.vertexLength++,this.footprintVertices.emplaceBack(Vt.x,Vt.y),at.push(Vt.x,Vt.y),I&&Mp(this.layoutVertexExtArray,T.projectTilePoint(_r.x,_r.y,a),T.upVector(a,_r.x,_r.y))}W&&(ce===0||Ie)&&(qt.length!==0&&Pe(qt,qt[0])&&qt.pop(),this.groundEffect.addData(qt,Ue,x))}const nt=this.wallMode?oe.indices:Ll(at,It);for(let ut=0;ut<nt.length;ut+=3)this.footprintIndices.emplaceBack(Nt.vertexOffset+nt[ut+0],Nt.vertexOffset+nt[ut+1],Nt.vertexOffset+nt[ut+2]),this.indexArray.emplaceBack(ct+nt[ut],ct+nt[ut+2],ct+nt[ut+1]),Tt.primitiveLength++;Nt.indexCount+=nt.length,Nt.vertexCount+=this.footprintVertices.length-Nt.vertexOffset}for(let at=0;at<Le.length;at++){const It=Le[at];D.startRing(O,It[0]);let nt=It.length>4&&dy(It[It.length-2],It[0],It[1]),ut=ce?cw(It[It.length-2],It[0],It[1],ce):0;const jt=[];let qt,wr,hr;wr=It[1].sub(It[0])._perp()._unit();let Jt=!0;for(let Vt=1,$r=0;Vt<It.length;Vt++){let _r=It[Vt-1],yr=It[Vt];const Vr=It[Vt===It.length-1?1:Vt+1];if(D.appendEdge(O,yr,_r),Hg(yr,_r,Ue)){ce&&(wr=Vr.sub(yr)._perp()._unit(),Jt=!Jt);continue}const Kr=yr.sub(_r)._perp(),ni=Kr.x/(Math.abs(Kr.x)+Math.abs(Kr.y)),_i=Kr.y>0?1:0,ci=_r.dist(yr);if($r+ci>32768&&($r=0),ce){hr=Vr.sub(yr)._perp()._unit();let le=cy(_r,yr,Vr,uy(wr,hr),ce);isNaN(le)&&(le=0);const de=yr.sub(_r)._unit();_r=_r.add(de.mult(ut))._round(),yr=yr.add(de.mult(-le))._round(),ut=le,wr=hr,W&&this.zoom>=17&&(Pe(jt,_r)||jt.push(_r),Pe(jt,yr)||jt.push(yr))}const oi=Tt.vertexLength,an=It.length>4&&dy(_r,yr,Vr);let vn=fy($r,nt,Jt);if(Ap(this.layoutVertexArray,_r.x,_r.y,ni,_i,0,0,vn),Ap(this.layoutVertexArray,_r.x,_r.y,ni,_i,0,1,vn),this.wallMode){const le=re(Vt-1,It),de=oe.joinNormals[Vt-1];Cp(this.wallVertexArray,de,le),Cp(this.wallVertexArray,de,le)}if($r+=ci,vn=fy($r,an,!Jt),nt=an,Ap(this.layoutVertexArray,yr.x,yr.y,ni,_i,0,0,vn),Ap(this.layoutVertexArray,yr.x,yr.y,ni,_i,0,1,vn),this.wallMode){const le=re(Vt,It),de=oe.joinNormals[Vt];Cp(this.wallVertexArray,de,le),Cp(this.wallVertexArray,de,le)}if(Tt.vertexLength+=4,this.indexArray.emplaceBack(oi+0,oi+1,oi+2),this.indexArray.emplaceBack(oi+1,oi+3,oi+2),Tt.primitiveLength+=2,ce){const le=ct+(Vt===1?It.length-2:Vt-2),de=Vt===1?ct:le+1;if(this.indexArray.emplaceBack(oi+1,le,oi+3),this.indexArray.emplaceBack(le,de,oi+3),Tt.primitiveLength+=2,qt===void 0&&(qt=oi),!Hg(Vr,It[Vt],Ue)){const pt=Vt===It.length-1?qt:Tt.vertexLength;this.indexArray.emplaceBack(oi+2,oi+3,pt),this.indexArray.emplaceBack(oi+3,pt+1,pt),this.indexArray.emplaceBack(oi+3,de,pt+1),Tt.primitiveLength+=3}Jt=!Jt}if(I){const le=this.layoutVertexExtArray,de=T.projectTilePoint(_r.x,_r.y,a),pt=T.projectTilePoint(yr.x,yr.y,a),$t=T.upVector(a,_r.x,_r.y),tr=T.upVector(a,yr.x,yr.y);Mp(le,de,$t),Mp(le,de,$t),Mp(le,pt,tr),Mp(le,pt,tr)}}R&&(ct+=It.length-1),W&&ce&&this.zoom>=17&&(jt.length!==0&&Pe(jt,jt[0])&&jt.pop(),this.groundEffect.addData(jt,Ue,x,ce>0))}this.footprintSegments.push(Nt),At.triangleCount=this.indexArray.length-At.triangleArrayOffset,this.polygonSegments.push(At),++O.footprintSegLen,++O.polygonSegLen}if(O.vertexCount=this.layoutVertexArray.length-O.vertexArrayOffset,O.groundVertexCount=this.groundEffect.vertexArray.length-O.groundVertexArrayOffset,O.vertexCount!==0){if(O.centroidXY=D.borders?iy:this.encodeCentroid(D,O),this.centroidData.push(O),D.borders){this.featuresOnBorder.push(D);const Le=this.featuresOnBorder.length-1;for(let Ue=0;Ue<D.borders.length;Ue++)D.borders[Ue][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ue].push(Le)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,c,d,a,y),this.groundEffect.addPaintPropertiesData(e,o,c,d,a,y),this.maxHeight=Math.max(this.maxHeight,X)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,o)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const y=this.centroidData[g],x=+(y.min.y+y.max.y>Wt),S=2*x+(+(y.min.x+y.max.x>Wt)^x);for(let T=0;T<y.polygonSegLen;T++){const I=y.polygonSegIdx+T;e.push({centroidIdx:g,subtile:S,polygonSegmentIdx:I,triangleSegmentIdx:this.polygonSegments[I].triangleSegIdx})}}const r=new ao;e.sort((g,y)=>g.triangleSegmentIdx===y.triangleSegmentIdx?g.subtile-y.subtile:g.triangleSegmentIdx-y.triangleSegmentIdx);let o=0,a=0,c=0;for(const g of e){if(g.triangleSegmentIdx!==o)break;c++}const d=e.length;for(;a!==e.length;){o=e[a].triangleSegmentIdx;let g=0,y=a,x=a;for(let S=y;S<c&&e[S].subtile===g;S++)x++;for(;y!==c;){const S=e[y];g=S.subtile;const T=this.centroidData[S.centroidIdx].min.clone(),I=this.centroidData[S.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=y;D<x;D++){const O=e[D],W=this.polygonSegments[O.polygonSegmentIdx],X=this.centroidData[O.centroidIdx].min,oe=this.centroidData[O.centroidIdx].max,re=this.indexArray.uint16;for(let B=W.triangleArrayOffset;B<W.triangleArrayOffset+W.triangleCount;B++)r.emplaceBack(re[3*B],re[3*B+1],re[3*B+2]);R.primitiveLength+=W.triangleCount,T.x=Math.min(T.x,X.x),T.y=Math.min(T.y,X.y),I.x=Math.max(I.x,oe.x),I.y=Math.max(I.y,oe.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:T,max:I}),y=x;for(let D=y;D<c&&e[D].subtile===e[y].subtile;D++)x++}a=c;for(let S=a;S<d&&e[S].triangleSegmentIdx===e[a].triangleSegmentIdx;S++)c++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,o){const a=new Sn;if(this.wallMode){for(const O of this.triangleSubSegments)a.segments.push(O.segment);return a}let c=0,d=0;const g=1<<e.canonical.z;if(r){const O=r.getMinMaxForTile(e);O&&(c=O.min,d=O.max)}d+=this.maxHeight;const y=e.toUnwrapped();let x;const S=[y.canonical.x/g+y.wrap,y.canonical.y/g],T=[(y.canonical.x+1)/g+y.wrap,(y.canonical.y+1)/g],I=(O,W,X)=>[O[0]*(1-X[0])+W[0]*X[0],O[1]*(1-X[1])+W[1]*X[1]],R=[],D=[];for(const O of this.triangleSubSegments){R[0]=O.min.x/Wt,R[1]=O.min.y/Wt,D[0]=O.max.x/Wt,D[1]=O.max.y/Wt;const W=I(S,T,R),X=I(S,T,D);if(new yn([W[0],W[1],c],[X[0],X[1],d]).intersectsPrecise(o)===0){x&&(a.segments.push(x),x=void 0);continue}const oe=O.segment;x&&x.vertexOffset!==oe.vertexOffset&&(a.segments.push(x),x=void 0),x?(x.vertexLength+=oe.vertexLength,x.primitiveLength+=oe.primitiveLength):x={vertexOffset:oe.vertexOffset,primitiveLength:oe.primitiveLength,vertexLength:oe.vertexLength,primitiveOffset:oe.primitiveOffset,sortKey:void 0,vaos:{}}}return x&&a.segments.push(x),a}encodeCentroid(e,r){const o=e.centroid(),a=r.span(),c=Math.min(7,Math.round(a.x*this.tileToMeter/10)),d=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new Ot(ke(o.x,1,Wt-1)<<3|c,ke(o.y,1,Wt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Ot(0,0);const r=e.borders,o=Number.MAX_VALUE;if(r[0][0]!==o||r[1][0]!==o){const a=r[0][0]!==o?0:1;return new Ot(6|(r[0][0]!==o?0:65528),(r[a][0]+r[a][1])/2<<3|6)}{const a=r[2][0]!==o?2:3;return new Ot((r[a][0]+r[a][1])/2<<3|6,6|(r[2][0]!==o?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=Rd,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,a=e.flags&Rd?iy:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==a.y||c!==a.x){for(let d=r;d<o;++d)this.centroidVertexArray.emplace(d,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,o){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped());if(Ug(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const c=[];for(const d of this.activeReplacements){if(d.order<o)continue;const g=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const y of this.centroidData)if(!(y.flags&Rd||d.min.x>y.max.x||y.min.x>d.max.x||d.min.y>y.max.y||y.min.y>d.max.y))for(let x=0;x<y.footprintSegLen;x++){const S=this.footprintSegments[y.footprintSegIdx+x];if(c.length=0,hw(this.footprintVertices,S.vertexOffset,S.vertexCount,d.footprintTileId.canonical,e.canonical,c),J0(d.footprint,c,this.footprintIndices.uint16,S.indexOffset,S.indexCount,-S.vertexOffset,-g)){y.flags|=Rd;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,o){let a=!1;for(let c=0;c<o.footprintSegLen;c++){const d=this.footprintSegments[o.footprintSegIdx+c];let g=0;for(const y of d.ringIndices){for(let x=g,S=y+g-1;x<y+g;S=x++){const T=this.footprintVertices.int16[2*(x+d.vertexOffset)+0],I=this.footprintVertices.int16[2*(x+d.vertexOffset)+1],R=this.footprintVertices.int16[2*(S+d.vertexOffset)+1];I>r!=R>r&&e<(this.footprintVertices.int16[2*(S+d.vertexOffset)+0]-T)*(r-I)/(R-I)+T&&(a=!a)}g=y}}return a}getHeightAtTileCoord(e,r){let o=Number.NEGATIVE_INFINITY,a=!0;const c=4*(e+Wt)*Wt+(r+Wt);if(this.partLookup.hasOwnProperty(c)){const d=this.partLookup[c];return d?{height:d.height,hidden:!!(d.flags&Rd)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||r>d.max.y||d.min.y>r||this.footprintContainsPoint(e,r,d)&&d&&d.height>o&&(o=d.height,this.partLookup[c]=d,a=!!(d.flags&Rd));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:a};this.partLookup[c]=void 0}}function uy(i,e){const r=i.add(e)._unit();return i.x*r.x+i.y*r.y}function cw(i,e,r,o){const a=e.sub(i)._perp()._unit(),c=r.sub(e)._perp()._unit();return cy(i,e,r,uy(a,c),o)}function cy(i,e,r,o,a){const c=Math.sqrt(1-o*o);return Math.min(i.dist(e)/3,e.dist(r)/3,a*c/o)}function Hg(i,e,r){return i.x<r[0].x&&e.x<r[0].x||i.x>r[1].x&&e.x>r[1].x||i.y<r[0].y&&e.y<r[0].y||i.y>r[1].y&&e.y>r[1].y}function hy(i,e){return i.x<e[0].x||i.x>e[1].x||i.y<e[0].y||i.y>e[1].y}function dy(i,e,r){if(i.x<0||i.x>=Wt||e.x<0||e.x>=Wt||r.x<0||r.x>=Wt)return!1;const o=r.sub(e),a=o.perp(),c=i.sub(e);return(o.x*c.x+o.y*c.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function fy(i,e,r){const o=e?2|i:-3&i;return r?1|o:-2&o}function py(){const i=Math.PI/32,e=Math.tan(i),r=V;return r*Math.sqrt(1+2*e*e)-r}function my(i,e,r){const o=1<<r.z,a=Te(r.x/o),c=Te((r.x+1)/o),d=Ae(r.y/o),g=Ae((r.y+1)/o);return function(y,x,S,T,I=0,R){const D=[];if(!y.length||!S||!T)return D;const O=(ie,ce)=>{for(const Ie of ie)D.push({polygon:Ie,bounds:ce})},W=Math.ceil(Math.log2(S)),X=Math.ceil(Math.log2(T)),oe=W-X,re=[];for(let ie=0;ie<Math.abs(oe);ie++)re.push(oe>0?0:1);for(let ie=0;ie<Math.min(W,X);ie++)re.push(0),re.push(1);let B=y;if(B=wm(B,x[0].y-I,x[1].y+I,1),B=wm(B,x[0].x-I,x[1].x+I,0),!B.length)return D;const J=[];for(re.length?J.push({polygons:B,bounds:x,depth:0}):O(B,x);J.length;){const ie=J.pop(),ce=ie.depth,Ie=re[ce],Pe=ie.bounds[0],Le=ie.bounds[1],Ue=Ie===0?Pe.x:Pe.y,ct=Ie===0?Le.x:Le.y,Pt=R?R(Ie,Ue,ct):.5*(Ue+ct),Tt=wm(ie.polygons,Ue-I,Pt+I,Ie),At=wm(ie.polygons,Pt-I,ct+I,Ie);if(Tt.length){const Nt=[Pe,new Ot(Ie===0?Pt:Le.x,Ie===1?Pt:Le.y)];re.length>ce+1?J.push({polygons:Tt,bounds:Nt,depth:ce+1}):O(Tt,Nt)}if(At.length){const Nt=[new Ot(Ie===0?Pt:Pe.x,Ie===1?Pt:Pe.y),Le];re.length>ce+1?J.push({polygons:At,bounds:Nt,depth:ce+1}):O(At,Nt)}}return D}(i,e,Math.ceil((c-a)/11.25),Math.ceil((d-g)/11.25),1,(y,x,S)=>{if(y===0)return .5*(x+S);{const T=Ae((r.y+x/Wt)/o);return(me(.5*(Ae((r.y+S/Wt)/o)+T))*o-r.y)*Wt}})}function hw(i,e,r,o,a,c){const d=Math.pow(2,o.z-a.z);for(let g=0;g<r;g++){let y=i.int16[2*(g+e)+0],x=i.int16[2*(g+e)+1];y=(y+a.x*Wt)*d-o.x*Wt,x=(x+a.y*Wt)*d-o.y*Wt,c.push(new Ot(y,x))}}let gy,_y;ir(Im,"FillExtrusionBucket",{omit:["layers","features"]}),ir(oy,"PartData"),ir(ny,"FootprintSegment"),ir(sy,"BorderCentroidData"),ir(ly,"GroundEffect");class wf extends Ot{constructor(e,r,o){super(e,r),this.z=o}}class yy extends wf{constructor(e,r,o,a){super(e,r,o),this.w=a}}function vy(i,e,r,o){const a=r==="x"?"y":"x",c=(o-i[r])/(e[r]-i[r]);i[a]=Math.round(i[a]+(e[a]-i[a])*c),i[r]=o,i.hasOwnProperty("z")&&(i.z=Mr(i.z,e.z,c)),i.hasOwnProperty("w")&&(i.w=Mr(i.w,e.w,c))}function xy(i,e,r,o){const a=r,c=o;for(const d of["x","y"]){let g=i,y=e;g[d]>=y[d]&&(g=e,y=i),g[d]<a&&y[d]>a&&vy(g,y,d,a),g[d]<c&&y[d]>c&&vy(y,g,d,c)}}function Am(i,e,r,o,a,c){const d=[];for(let g=0;g<i.length;g++){const y=i[g];let x;const S=d.length;let T=0;for(let I=0;I<y.length-1;I++){let R=y[I],D=y[I+1],O=0;const W=T;let X,oe;c&&(O=Math.hypot(D.x-R.x,D.y-R.y),T+=O,X=R,oe=D),R.x<e&&D.x<e||(R.x<e?R=new Ot(e,R.y+(e-R.x)/(D.x-R.x)*(D.y-R.y))._round():D.x<e&&(D=new Ot(e,R.y+(e-R.x)/(D.x-R.x)*(D.y-R.y))._round()),R.y<r&&D.y<r||(R.y<r?R=new Ot(R.x+(r-R.y)/(D.y-R.y)*(D.x-R.x),r)._round():D.y<r&&(D=new Ot(R.x+(r-R.y)/(D.y-R.y)*(D.x-R.x),r)._round()),R.x>=o&&D.x>=o||(R.x>=o?R=new Ot(o,R.y+(o-R.x)/(D.x-R.x)*(D.y-R.y))._round():D.x>=o&&(D=new Ot(o,R.y+(o-R.x)/(D.x-R.x)*(D.y-R.y))._round()),R.y>=a&&D.y>=a||(R.y>=a?R=new Ot(R.x+(a-R.y)/(D.y-R.y)*(D.x-R.x),a)._round():D.y>=a&&(D=new Ot(R.x+(a-R.y)/(D.y-R.y)*(D.x-R.x),a)._round()),x&&R.equals(x[x.length-1])||(x=[R],d.push(x),c&&c.push({progress:{min:W+by(X,oe,R)*O,max:1},parentIndex:g,prevPoint:X,nextPoint:oe})),x.push(D),c&&(c[c.length-1].progress.max=W+by(X,oe,D)*O,c[c.length-1].nextPoint=oe)))))}if(c&&T>0)for(let I=S;I<d.length;I++)c[I].progress.min/=T,c[I].progress.max/=T}return d}function dw(i,e,r,o,a){if(i.length<2)return void o.push(i);const c=[];for(;e.valid();){const[x,S]=e.get();for(let T=0;T<i.length-1;T++){const I=i[T],R=i[T+1],D=_n(I,R,x,S);if(D){const[O]=D,W=new Ot(Mr(I.x,R.x,O),Mr(I.y,R.y,O));c.push({t:T+O,distance:0,point:W})}}e.next()}if(c.length===0)return void o.push(i);c.sort((x,S)=>x.t-S.t);let d=0,g=0,y=[];for(o.push(y);d!==i.length;){if(g===c.length){for(;d!==i.length;)y.length!==0&&y[y.length-1].equals(i[d])||y.push(i[d]),d++;break}c[g].t<=d?(y.length!==0&&y[y.length-1].equals(c[g].point)||y.push(c[g].point),Math.trunc(c[g].t),g++):(y.length!==0&&y[y.length-1].equals(i[d])||y.push(i[d]),d++)}}function by(i,e,r){return i.x!==e.x?(r.x-i.x)/(e.x-i.x):i.y!==e.y?(r.y-i.y)/(e.y-i.y):0}function Pp(i,e){return i.x*e.x+i.y*e.y}function wy(i,e){if(i.length===1){let r=0;const o=e[r++];let a;for(;!a||o.equals(a);)if(a=e[r++],!a)return 1/0;for(;r<e.length;r++){const c=e[r],d=i[0],g=a.sub(o),y=c.sub(o),x=d.sub(o),S=Pp(g,g),T=Pp(g,y),I=Pp(y,y),R=Pp(x,g),D=Pp(x,y),O=S*I-T*T,W=(I*R-T*D)/O,X=(S*D-T*R)/O,oe=o.z*(1-W-X)+a.z*W+c.z*X;if(isFinite(oe))return oe}return 1/0}{let r=1/0;for(const o of e)r=Math.min(r,o.z);return r}}function Sy(i,e,r,o,a,c,d,g){const y=d*a.getElevationAt(i,e,!0,!0),x=c[0]!==0,S=x?c[1]===0?d*(c[0]/7-450):d*function(T,I,R){const D=Math.floor(I[0]/8),O=Math.floor(I[1]/8),W=10*(I[0]-8*D),X=10*(I[1]-8*O),oe=T.getElevationAt(D,O,!0,!0),re=T.getMeterToDEM(R),B=Math.floor(.5*(W*re-1)),J=Math.floor(.5*(X*re-1)),ie=T.tileCoordToPixel(D,O),ce=2*B+1,Ie=2*J+1,Pe=function(At,Nt,at,It,nt){return[At.getElevationAtPixel(Nt,at,!0),At.getElevationAtPixel(Nt+nt,at,!0),At.getElevationAtPixel(Nt,at+nt,!0),At.getElevationAtPixel(Nt+It,at+nt,!0)]}(T,ie.x-B,ie.y-J,ce,Ie),Le=Math.abs(Pe[0]-Pe[1]),Ue=Math.abs(Pe[2]-Pe[3]),ct=Math.abs(Pe[0]-Pe[2])+Math.abs(Pe[1]-Pe[3]),Pt=Math.min(.25,.5*re*(Le+Ue)/ce),Tt=Math.min(.25,.5*re*ct/Ie);return oe+Math.max(Pt*W,Tt*X)}(a,c,g):y;return{base:y+(r===0?-1:r),top:x?Math.max(S+o,y+r+2):y+o}}const fw=Fi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),pw=Fi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:mw}=fw,gw=Fi([{name:"a_packed",components:3,type:"Float32"}]),{members:_w}=gw,yw=Fi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:vw}=yw;class Ty{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Lt({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const o=this.getKey(e,r);return this.positions[o]}trim(){const e=this.width,r=this.height=lr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,o){const a=[];let c=e.length%2==1?-e[e.length-1]*o:0,d=e[0]*o,g=!0;a.push({left:c,right:d,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let x=1;x<e.length;x++){g=!g;const S=e[x];c=y*o,y+=S,d=y*o,a.push({left:c,right:d,isDash:g,zeroLength:S===0})}return a}addRoundDash(e,r,o){const a=r/2;for(let c=-o;c<=o;c++){const d=this.width*(this.nextRow+o+c);let g=0,y=e[g];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++g]);const S=Math.abs(x-y.left),T=Math.abs(x-y.right),I=Math.min(S,T);let R;const D=c/o*(a+1);if(y.isDash){const O=a-Math.abs(D);R=Math.sqrt(I*I+O*O)}else R=a-Math.sqrt(I*I+D*D);this.image.data[d+x]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,r){for(let y=e.length-1;y>=0;--y){const x=e[y],S=e[y+1];x.zeroLength?e.splice(y,1):S&&S.isDash===x.isDash&&(S.left=x.left,e.splice(y,1))}const o=e[0],a=e[e.length-1];o.isDash===a.isDash&&(o.left=a.left-this.width,a.right=o.right+this.width);const c=this.width*this.nextRow;let d=0,g=e[d];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++d]);const x=Math.abs(y-g.left),S=Math.abs(y-g.right),T=Math.min(x,S);this.image.data[c+y]=Math.max(0,Math.min(255,(g.isDash?T:-T)+r+128))}}addDash(e,r){const o=this.getKey(e,r);if(this.positions[o])return this.positions[o];const a=r==="round",c=a?7:0,d=2*c+1;if(this.nextRow+d>this.height)return Jr("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let S=0;S<e.length;S++)e[S]<0&&(Jr("Negative value is found in line dasharray, replacing values with 0"),e[S]=0),g+=e[S];if(g!==0){const S=this.width/g,T=this.getDashRanges(e,this.width,S);a?this.addRoundDash(T,S,c):this.addRegularDash(T,r==="square"?.5*S:0)}const y=this.nextRow+c;this.nextRow+=d;const x={tl:[y,c],br:[g,0]};return this.positions[o]=x,x}}ir(Ty,"LineAtlas");const xw=Pd.VectorTileFeature.types,bw=Math.cos(Math.PI/180*37.5),ww=Math.cos(Math.PI/180*5);class $g{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new hd,this.layoutVertexArray2=new nl,this.patternVertexArray=new nl,this.indexArray=new ao,this.programConfigurations=new nu(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Sn,this.maxLineLength=0,this.zOffsetVertexArray=new nl,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Wt/64}updateFootprints(e,r){}populate(e,r,o,a){this.hasPattern=Pg("line",this.layers,this.pixelRatio,r);const c=this.layers[0].layout.get("line-sort-key");this.tileToMeter=je(o);const d=this.layers[0].layout.get("line-elevation-reference");if(d==="hd-road-markup")this.elevationType="road";else{const I=this.layers[0].layout.get("line-z-offset"),R=I.isConstant()&&!I.constantOr(0);this.elevationType=d!=="sea"&&d!=="ground"&&R?"none":"offset",this.elevationType==="offset"&&d==="none"&&Jr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&g!==void 0;const y=[];for(const{feature:I,id:R,index:D,sourceLayerIndex:O}of e){const W=this.layers[0]._featureFilter.needGeometry,X=gr(I,W);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),X,o))continue;const oe=c?c.evaluate(X,{},o):void 0,re={id:R,properties:I.properties,type:I.type,sourceLayerIndex:O,index:D,geometry:W?X.geometry:ur(I,o,a),patterns:{},sortKey:oe};y.push(re)}c&&y.sort((I,R)=>I.sortKey-R.sortKey);const{lineAtlas:x,featureIndex:S}=r,T=this.addConstantDashes(x);for(const I of y){const{geometry:R,index:D,sourceLayerIndex:O}=I;if(T&&this.addFeatureDashes(I,x),this.hasPattern){const W=Rg("line",this.layers,I,this.zoom,this.pixelRatio,r);this.patternFeatures.push(W)}else this.addFeature(I,R,D,o,x.positions,r.availableImages,r.brightness,r.elevationFeatures);S.insert(e[D].feature,R,D,O,this.index)}}addConstantDashes(e){let r=!1;for(const o of this.layers){const a=o.paint.get("line-dasharray").value,c=o.layout.get("line-cap").value;if(a.kind!=="constant"||c.kind!=="constant")r=!0;else{const d=c.value,g=a.value;if(!g)continue;e.addDash(g,d)}}return r}addFeatureDashes(e,r){const o=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind==="constant"&&d.kind==="constant")continue;let g,y;if(c.kind==="constant"){if(g=c.value,!g)continue}else g=c.evaluate({zoom:o},e);y=d.kind==="constant"?d.value:d.evaluate({zoom:o},e),r.addDash(g,y),e.patterns[a.id]=[r.getKey(g,y)]}}update(e,r,o,a,c,d,g){this.programConfigurations.updatePaintArrays(e,r,c,o,a,d,g)}addFeatures(e,r,o,a,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,o,a,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,_w)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,vw)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,pw.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,mw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,o,a,c,d,g,y){const x=this.layers[0].layout,S=x.get("line-join").evaluate(e,{}),T=x.get("line-cap").evaluate(e,{}),I=x.get("line-miter-limit"),R=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=x.get("line-z-offset").value;const D=this.layers[0].paint.get("line-width").value;if(D.kind!=="constant"&&D.isLineProgressConstant===!1&&(this.variableWidthValue=D),this.elevationType==="road"){const O=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,r,a,y,S,T,I,R)){const[W,X]=this.clipRuntimeLinesToTile(r,1);for(let oe=0;oe<W.length;oe++){const re=W[oe],B=X[oe],J={progress:{min:B.progress.min,max:B.progress.max},nextDir:this.computeSegNextDir(B,re),prevDir:this.computeSegPrevDir(B,re)};this.addLine(re,e,a,S,T,I,R,J)}this.fillNonElevatedRoadSegment(O)}}else for(const O of r)this.addLine(O,e,a,S,T,I,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,c,d,a,g)}computeSegNextDir(e,r){return e.nextPoint.sub(r.at(-2)).unit()}computeSegPrevDir(e,r){return r[1].sub(e.prevPoint).unit()}clipLinesToTile(e,r){return Am(e,-r,-r,Wt+r,Wt+r)}clipRuntimeLinesToTile(e,r){const o=[];return[Am(e,-r,-r,Wt+r,Wt+r,o),o]}addElevatedRoadFeature(e,r,o,a,c,d,g,y){const x=[],S=Og.getElevationFeature(e,a);if(S){const T=this.clipLinesToTile(r,1),I=this.prepareElevatedLines(T,S,o);for(const R of I)x.push({geometry:R,elevation:S,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(x.length===0)return!1;for(const T of x){const I=this.layoutVertexArray.length;this.addLine(T.geometry,e,o,c,d,g,y);const R=new B0(o,T.elevationTileID);if(T.elevation)for(let D=I;D<this.layoutVertexArray.length;D++){const O=new Ot(this.layoutVertexArray.int16[6*D]>>1,this.layoutVertexArray.int16[6*D+1]>>1),W=R.pointElevation(O,T.elevation,.05);this.updateHeightRange(W),this.zOffsetVertexArray.emplaceBack(W,0,0)}else this.fillNonElevatedRoadSegment(I)}return!0}prepareElevatedLines(e,r,o){if(r.constantHeight!=null)return e;const a=[],c=1/je(o);for(const d of e)dw(d,new F0(r,c),0,a);return a}fillNonElevatedRoadSegment(e){for(let r=e;r<this.layoutVertexArray.length;r++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,r,o,a,c,d,g,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const x=a==="none";this.patternJoinNone=this.hasPattern&&x,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const S=y&&y.progress.min>0,T=y&&y.progress.max<1;if(this.lineClips){let Ie={min:this.lineClips.start,max:this.lineClips.end},Pe=1;if(y){const ct=this.lineClips.end-this.lineClips.start;Ie=function(Pt,Tt,At){return{min:Yn(Pt.min,Tt,At),max:Yn(Pt.max,Tt,At)}}(y.progress,{min:0,max:1},Ie),ct>0&&(Pe=(Ie.max-Ie.min)/ct)}const Le=+r.properties.mapbox_clip_feature_len,Ue=+r.properties.mapbox_clip_seg_len;if(Number.isNaN(Le)||Number.isNaN(Ue)){for(let Pt=0;Pt<e.length-1;Pt++)this.totalDistance+=e[Pt].dist(e[Pt+1]);const ct=this.totalDistance/(Ie.max-Ie.min);this.totalFeatureLength=Number.isFinite(ct)?ct:0,this.lineClips.start=Ie.min,this.lineClips.end=Ie.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Le,this.distance=Ue*Pe,this.lineClips.start=Ie.min,this.lineClips.end=Ie.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const I=xw[r.type]==="Polygon";let R=e.length;for(;R>=2&&e[R-1].equals(e[R-2]);)R--;let D=0;for(;D<R-1&&e[D].equals(e[D+1]);)D++;if(R<(I?3:2))return;a==="bevel"&&(d=1.05);const O=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let W,X,oe,re,B,J,ie,ce;y&&y.prevDir&&(J=y.prevDir.perp()),y&&y.nextDir&&(ie=y.nextDir.perp()),this.e1=this.e2=-1,I&&(W=e[R-2],B=e[D].sub(W)._unit()._perp());for(let Ie=D;Ie<R;Ie++){if(oe=Ie===R-1?I?e[D+1]:void 0:e[Ie+1],oe&&e[Ie].equals(oe))continue;B&&(re=B),W&&(X=W),W=e[Ie],ce=this.evaluateLineProgressFeatures(X?X.dist(W):0),B=oe?oe.sub(W)._unit()._perp():re,re=re||B;const Pe=X&&oe;let Le=Pe?a:I||x?"butt":c;const Ue=re.x*B.x+re.y*B.y;if(x){const nt=function(ut){if(ut.patternJoinNone){const jt=ut.segmentPoints.length/2,qt=ut.lineSoFar-ut.segmentStart;for(let wr=0;wr<jt;++wr){const hr=ut.segmentPoints[2*wr+1],Jt=Math.round(ut.segmentPoints[2*wr])+.5+.25*hr;ut.patternVertexArray.emplaceBack(Jt,qt,ut.segmentStart),ut.patternVertexArray.emplaceBack(Jt,qt,ut.segmentStart)}ut.segmentPoints.length=0}ut.e1=ut.e2=-1};if(Pe&&Ue<ww){this.updateDistance(X,W),this.addCurrentVertex(W,re,1,1,O,ce),nt(this),this.addCurrentVertex(W,B,-1,-1,O,ce);continue}if(X){if(!oe){this.updateDistance(X,W),this.addCurrentVertex(W,re,1,1,O,ce),nt(this);continue}Le="miter"}}let ct=re.add(B);ct.x===0&&ct.y===0||ct._unit();const Pt=ct.x*B.x+ct.y*B.y,Tt=Pt!==0?1/Pt:1/0,At=2*Math.sqrt(2-2*Pt),Nt=Pt<bw&&X&&oe,at=re.x*B.y-re.y*B.x>0,It=this.overscaling<=16?15*Wt/(512*this.overscaling):0;if(Pe&&Le==="round"){if(Tt<g)Le="miter";else if(Tt<=2){const nt=Wg(W,-10,Wt+10);Le=this.elevationType==="offset"&&(nt||this.hasCrossSlope)?"miter":"fakeround"}}if(Le==="miter"&&Tt>d&&(Le="bevel"),Le==="bevel"&&(Tt>2&&(Le="flipbevel"),Tt<d&&(Le="miter")),X&&!(Le==="miter"&&Nt)&&this.updateDistance(X,W),Le==="miter")if(Nt){const nt=W.dist(X);if(nt>2*It){const jt=W.sub(W.sub(X)._mult(It/nt)._round());this.updateDistance(X,jt),this.addCurrentVertex(jt,re,0,0,O,ce),X=jt}this.updateDistance(X,W),ct._mult(Tt),this.addCurrentVertex(W,ct,0,0,O,ce);const ut=W.dist(oe);if(ut>2*It){const jt=W.add(oe.sub(W)._mult(It/ut)._round());this.updateDistance(W,jt),this.addCurrentVertex(jt,B,0,0,O,ce),W=jt}}else ct._mult(Tt),this.addCurrentVertex(W,ct,0,0,O,ce);else if(Le==="flipbevel"){if(Tt>100)ct=B.mult(-1);else{const nt=Tt*re.add(B).mag()/re.sub(B).mag();ct._perp()._mult(nt*(at?-1:1))}this.addCurrentVertex(W,ct,0,0,O,ce),this.addCurrentVertex(W,ct.mult(-1),0,0,O,ce)}else if(Le==="bevel"||Le==="fakeround"){ce!=null&&X&&this.addCurrentVertex(W,ie||re,-1,-1,O,ce);const nt=W.dist(X)<=2*It&&Le!=="bevel",ut=ct.mult(at?1:-1);ut._mult(Tt);const jt=B.mult(at?-1:1),qt=re.mult(at?-1:1),wr=this.evaluateLineProgressFeatures(this.distance);if(ce==null&&(this.addHalfVertex(W,ut.x,ut.y,!1,!at,0,O,wr),nt||this.addHalfVertex(W,ut.x+2*qt.x,ut.y+2*qt.y,!1,at,0,O,wr)),Le==="fakeround"){const hr=Math.round(180*At/Math.PI/20);this.addHalfVertex(W,qt.x,qt.y,!1,at,0,O,wr);for(let Jt=0;Jt<hr;Jt++){let Vt=Jt/hr;if(Vt!==.5){const _r=Vt-.5;Vt+=Vt*_r*(Vt-1)*((1.0904+Ue*(Ue*(3.55645-1.43519*Ue)-3.2452))*_r*_r+(.848013+Ue*(.215638*Ue-1.06021)))}const $r=jt.sub(qt)._mult(Vt)._add(qt)._unit();this.addHalfVertex(W,$r.x,$r.y,!1,at,0,O,wr)}this.addHalfVertex(W,jt.x,jt.y,!1,at,0,O,wr)}nt||ce!=null||this.addHalfVertex(W,ut.x+2*jt.x,ut.y+2*jt.y,!1,at,0,O,wr),ce!=null&&oe&&this.addCurrentVertex(W,J||B,1,1,O,ce)}else if(Le==="butt")this.addCurrentVertex(W,ct,0,0,O,ce);else if(Le==="square"){if(!X){const nt=S?0:-1;this.addCurrentVertex(W,ct,nt,nt,O,ce)}if(this.addCurrentVertex(W,ct,0,0,O,ce),X){const nt=T?0:1;this.addCurrentVertex(W,ct,nt,nt,O,ce)}}else if(Le==="round"){if(X){const nt=!Pe&&ie?ie:re;this.addCurrentVertex(W,nt,0,0,O,ce),!Pe&&T||this.addCurrentVertex(W,nt,1,1,O,ce,!0)}if(oe){const nt=!Pe&&J?J:B;!Pe&&S||this.addCurrentVertex(W,nt,-1,-1,O,ce,!0),this.addCurrentVertex(W,nt,0,0,O,ce)}}}}addVerticesTo(e,r,o,a,c,d,g,y,x,S){const T=(r.w-e.w)/this.tessellationStep|0;let I=0;const R=this.scaledDistance;if(T>1){this.lineSoFar=e.w;const O=(r.x-e.x)/T,W=(r.y-e.y)/T,X=(r.z-e.z)/T,oe=(r.w-e.w)/T;for(let re=1;re<T;++re){e.x+=O,e.y+=W,e.z+=X,this.lineSoFar+=oe,I+=oe;const B=this.evaluateLineProgressFeatures(this.prevDistance+I);this.scaledDistance=(this.prevDistance+I)/this.totalDistance,this.addHalfVertex(e,o,a,S,!1,g,x,B),this.addHalfVertex(e,c,d,S,!0,-y,x,B)}}this.lineSoFar=r.w,this.scaledDistance=R;const D=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,o,a,S,!1,g,x,D),this.addHalfVertex(r,c,d,S,!0,-y,x,D)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Jr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:r}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}}addCurrentVertex(e,r,o,a,c,d,g=!1){const y=r.x+r.y*o,x=r.y-r.x*o,S=r.y*a-r.x,T=-r.y-r.x*a;if(d!=null){const I=this.elevationType==="offset",R=-10,D=Wt+10,O=d.zOffset,W=new yy(e.x,e.y,O,this.lineSoFar),X=!!I&&Wg(e,R,D),oe=this.lineSoFar,re=this.distance;if(this.currentVertex)if(X){const B=this.currentVertexIsOutside,J=this.currentVertex,ie=new yy(e.x,e.y,O,this.lineSoFar);if(xy(J,ie,R,D),!Wg(ie,R,D)){if(B){this.e1=this.e2=-1,this.distance-=J.dist(W),this.lineSoFar=J.w;const ce=this.evaluateLineProgressFeatures(J.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(J,y,x,g,!1,o,c,ce),this.addHalfVertex(J,S,T,g,!0,-a,c,ce),this.prevDistance=this.distance}this.distance=this.prevDistance+J.dist(ie),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(J,ie,y,x,S,T,o,a,c,g),this.distance=re,this.scaledDistance=this.distance/this.totalDistance}}else{const B=this.currentVertex;if(this.currentVertexIsOutside){xy(B,W,R,D),this.e1=this.e2=-1,this.distance-=B.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=B.w;const J=this.evaluateLineProgressFeatures(B.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(B,y,x,g,!1,o,c,J),this.addHalfVertex(B,S,T,g,!0,-a,c,J),this.prevDistance=this.distance,this.distance=re,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(B,W,y,x,S,T,o,a,c,g)}else X||(this.addHalfVertex(e,y,x,g,!1,o,c,d),this.addHalfVertex(e,S,T,g,!0,-a,c,d));this.currentVertex=W,this.currentVertexIsOutside=X,this.lineSoFar=oe}else this.addHalfVertex(e,y,x,g,!1,o,c,d),this.addHalfVertex(e,S,T,g,!0,-a,c,d)}addHalfVertex({x:e,y:r},o,a,c,d,g,y,x){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(r<<1)+(d?1:0),Math.round(63*o)+128,Math.round(63*a)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const T=Mr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,T)}const S=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),y.primitiveLength++),d?this.e2=S:this.e1=S,x!=null&&this.zOffsetVertexArray.emplaceBack(x.zOffset,x.variableWidth,x.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function Wg(i,e,r){return i.x<e||i.x>r||i.y<e||i.y>r}let Ey,Iy;function Ay(i,e,r){return e*(Wt/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}ir($g,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Cy=(i,e,r)=>(1-r)*i+r*e;function My(i,e){return 1/Ay(i,1,e.tileZoom)}function Py(i,e,r,o){return i.translatePosMatrix(o||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const Ry=i=>{const e=[];Dy(i)&&e.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=i.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=i.layout.get("line-join").constantOr("miter")==="none",a=!!i.paint.get("line-pattern").constantOr(1);return o&&a&&e.push("LINE_JOIN_NONE"),e};function Dy(i){const e=i.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Zg;const ky=()=>Zg||(Zg={layout:Ey||(Ey=new kn({"line-cap":new ar(Ze.layout_line["line-cap"]),"line-join":new ar(Ze.layout_line["line-join"]),"line-miter-limit":new Ut(Ze.layout_line["line-miter-limit"]),"line-round-limit":new Ut(Ze.layout_line["line-round-limit"]),"line-sort-key":new ar(Ze.layout_line["line-sort-key"]),"line-z-offset":new ar(Ze.layout_line["line-z-offset"]),"line-elevation-reference":new Ut(Ze.layout_line["line-elevation-reference"]),"line-cross-slope":new Ut(Ze.layout_line["line-cross-slope"]),visibility:new Ut(Ze.layout_line.visibility),"line-width-unit":new Ut(Ze.layout_line["line-width-unit"])})),paint:Iy||(Iy=new kn({"line-opacity":new ar(Ze.paint_line["line-opacity"]),"line-color":new ar(Ze.paint_line["line-color"]),"line-translate":new Ut(Ze.paint_line["line-translate"]),"line-translate-anchor":new Ut(Ze.paint_line["line-translate-anchor"]),"line-width":new ar(Ze.paint_line["line-width"]),"line-gap-width":new ar(Ze.paint_line["line-gap-width"]),"line-offset":new ar(Ze.paint_line["line-offset"]),"line-blur":new ar(Ze.paint_line["line-blur"]),"line-dasharray":new ar(Ze.paint_line["line-dasharray"]),"line-pattern":new ar(Ze.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ut(Ze.paint_line["line-pattern-cross-fade"]),"line-gradient":new So(Ze.paint_line["line-gradient"]),"line-trim-offset":new Ut(Ze.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ut(Ze.paint_line["line-trim-fade-range"]),"line-trim-color":new Ut(Ze.paint_line["line-trim-color"]),"line-emissive-strength":new Ut(Ze.paint_line["line-emissive-strength"]),"line-border-width":new ar(Ze.paint_line["line-border-width"]),"line-border-color":new ar(Ze.paint_line["line-border-color"]),"line-occlusion-opacity":new Ut(Ze.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},Zg);class Sw extends ar{possiblyEvaluate(e,r){return r=new Zi(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,o,a){return r=Je({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,o,a)}}let Rp;function Ly(i,e){return e>0?e+2*i:i}const Tw=Fi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ew=Fi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Iw=Fi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Fi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Aw=Fi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Cw=Fi([{name:"a_texb",components:2,type:"Uint16"}]),Mw=Fi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Pw=Fi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Fi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zy=Fi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Rw=Fi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Fi([{name:"triangle",components:3,type:"Uint16"}]),Fi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Fi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Fi([{type:"Float32",name:"offsetX"}]),Fi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ds=24;function Dw(i,e,r){return i.sections.forEach(o=>{o.text=function(a,c,d){const g=c.layout.get("text-transform").evaluate(d,{});return g==="uppercase"?a=a.toLocaleUpperCase():g==="lowercase"&&(a=a.toLocaleLowerCase()),Js.applyArabicShaping&&(a=Js.applyArabicShaping(a)),a}(o.text,e,r)}),i}const Dp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function kw(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function Lw(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}var Oy,Xg,Fy,Yg={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function zw(){return Oy||(Oy=1,Yg.read=function(i,e,r,o,a){var c,d,g=8*a-o-1,y=(1<<g)-1,x=y>>1,S=-7,T=r?a-1:0,I=r?-1:1,R=i[e+T];for(T+=I,c=R&(1<<-S)-1,R>>=-S,S+=g;S>0;c=256*c+i[e+T],T+=I,S-=8);for(d=c&(1<<-S)-1,c>>=-S,S+=o;S>0;d=256*d+i[e+T],T+=I,S-=8);if(c===0)c=1-x;else{if(c===y)return d?NaN:1/0*(R?-1:1);d+=Math.pow(2,o),c-=x}return(R?-1:1)*d*Math.pow(2,c-o)},Yg.write=function(i,e,r,o,a,c){var d,g,y,x=8*c-a-1,S=(1<<x)-1,T=S>>1,I=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=o?0:c-1,D=o?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,d=S):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+T>=1?I/y:I*Math.pow(2,1-T))*y>=2&&(d++,y/=2),d+T>=S?(g=0,d=S):d+T>=1?(g=(e*y-1)*Math.pow(2,a),d+=T):(g=e*Math.pow(2,T-1)*Math.pow(2,a),d=0));a>=8;i[r+R]=255&g,R+=D,g/=256,a-=8);for(d=d<<a|g,x+=a;x>0;i[r+R]=255&d,R+=D,d/=256,x-=8);i[r+R-D]|=128*O}),Yg}function By(){if(Fy)return Xg;Fy=1,Xg=e;var i=zw();function e(B){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(B)?B:new Uint8Array(B||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,o=1/r,a=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function c(B){return B.type===e.Bytes?B.readVarint()+B.pos:B.pos+1}function d(B,J,ie){return ie?4294967296*J+(B>>>0):4294967296*(J>>>0)+(B>>>0)}function g(B,J,ie){var ce=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));ie.realloc(ce);for(var Ie=ie.pos-1;Ie>=B;Ie--)ie.buf[Ie+ce]=ie.buf[Ie]}function y(B,J){for(var ie=0;ie<B.length;ie++)J.writeVarint(B[ie])}function x(B,J){for(var ie=0;ie<B.length;ie++)J.writeSVarint(B[ie])}function S(B,J){for(var ie=0;ie<B.length;ie++)J.writeFloat(B[ie])}function T(B,J){for(var ie=0;ie<B.length;ie++)J.writeDouble(B[ie])}function I(B,J){for(var ie=0;ie<B.length;ie++)J.writeBoolean(B[ie])}function R(B,J){for(var ie=0;ie<B.length;ie++)J.writeFixed32(B[ie])}function D(B,J){for(var ie=0;ie<B.length;ie++)J.writeSFixed32(B[ie])}function O(B,J){for(var ie=0;ie<B.length;ie++)J.writeFixed64(B[ie])}function W(B,J){for(var ie=0;ie<B.length;ie++)J.writeSFixed64(B[ie])}function X(B,J){return(B[J]|B[J+1]<<8|B[J+2]<<16)+16777216*B[J+3]}function oe(B,J,ie){B[ie]=J,B[ie+1]=J>>>8,B[ie+2]=J>>>16,B[ie+3]=J>>>24}function re(B,J){return(B[J]|B[J+1]<<8|B[J+2]<<16)+(B[J+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(B,J,ie){for(ie=ie||this.length;this.pos<ie;){var ce=this.readVarint(),Ie=ce>>3,Pe=this.pos;this.type=7&ce,B(Ie,J,this),this.pos===Pe&&this.skip(ce)}return J},readMessage:function(B,J){return this.readFields(B,J,this.readVarint()+this.pos)},readFixed32:function(){var B=X(this.buf,this.pos);return this.pos+=4,B},readSFixed32:function(){var B=re(this.buf,this.pos);return this.pos+=4,B},readFixed64:function(){var B=X(this.buf,this.pos)+X(this.buf,this.pos+4)*r;return this.pos+=8,B},readSFixed64:function(){var B=X(this.buf,this.pos)+re(this.buf,this.pos+4)*r;return this.pos+=8,B},readFloat:function(){var B=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,B},readDouble:function(){var B=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,B},readVarint:function(B){var J,ie,ce=this.buf;return J=127&(ie=ce[this.pos++]),ie<128?J:(J|=(127&(ie=ce[this.pos++]))<<7,ie<128?J:(J|=(127&(ie=ce[this.pos++]))<<14,ie<128?J:(J|=(127&(ie=ce[this.pos++]))<<21,ie<128?J:function(Ie,Pe,Le){var Ue,ct,Pt=Le.buf;if(Ue=(112&(ct=Pt[Le.pos++]))>>4,ct<128||(Ue|=(127&(ct=Pt[Le.pos++]))<<3,ct<128)||(Ue|=(127&(ct=Pt[Le.pos++]))<<10,ct<128)||(Ue|=(127&(ct=Pt[Le.pos++]))<<17,ct<128)||(Ue|=(127&(ct=Pt[Le.pos++]))<<24,ct<128)||(Ue|=(1&(ct=Pt[Le.pos++]))<<31,ct<128))return d(Ie,Ue,Pe);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(ie=ce[this.pos]))<<28,B,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var B=this.readVarint();return B%2==1?(B+1)/-2:B/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var B=this.readVarint()+this.pos,J=this.pos;return this.pos=B,B-J>=12&&a?function(ie,ce,Ie){return a.decode(ie.subarray(ce,Ie))}(this.buf,J,B):function(ie,ce,Ie){for(var Pe="",Le=ce;Le<Ie;){var Ue,ct,Pt,Tt=ie[Le],At=null,Nt=Tt>239?4:Tt>223?3:Tt>191?2:1;if(Le+Nt>Ie)break;Nt===1?Tt<128&&(At=Tt):Nt===2?(192&(Ue=ie[Le+1]))==128&&(At=(31&Tt)<<6|63&Ue)<=127&&(At=null):Nt===3?(ct=ie[Le+2],(192&(Ue=ie[Le+1]))==128&&(192&ct)==128&&((At=(15&Tt)<<12|(63&Ue)<<6|63&ct)<=2047||At>=55296&&At<=57343)&&(At=null)):Nt===4&&(ct=ie[Le+2],Pt=ie[Le+3],(192&(Ue=ie[Le+1]))==128&&(192&ct)==128&&(192&Pt)==128&&((At=(15&Tt)<<18|(63&Ue)<<12|(63&ct)<<6|63&Pt)<=65535||At>=1114112)&&(At=null)),At===null?(At=65533,Nt=1):At>65535&&(At-=65536,Pe+=String.fromCharCode(At>>>10&1023|55296),At=56320|1023&At),Pe+=String.fromCharCode(At),Le+=Nt}return Pe}(this.buf,J,B)},readBytes:function(){var B=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,B);return this.pos=B,J},readPackedVarint:function(B,J){if(this.type!==e.Bytes)return B.push(this.readVarint(J));var ie=c(this);for(B=B||[];this.pos<ie;)B.push(this.readVarint(J));return B},readPackedSVarint:function(B){if(this.type!==e.Bytes)return B.push(this.readSVarint());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readSVarint());return B},readPackedBoolean:function(B){if(this.type!==e.Bytes)return B.push(this.readBoolean());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readBoolean());return B},readPackedFloat:function(B){if(this.type!==e.Bytes)return B.push(this.readFloat());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readFloat());return B},readPackedDouble:function(B){if(this.type!==e.Bytes)return B.push(this.readDouble());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readDouble());return B},readPackedFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed32());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readFixed32());return B},readPackedSFixed32:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed32());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readSFixed32());return B},readPackedFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readFixed64());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readFixed64());return B},readPackedSFixed64:function(B){if(this.type!==e.Bytes)return B.push(this.readSFixed64());var J=c(this);for(B=B||[];this.pos<J;)B.push(this.readSFixed64());return B},skip:function(B){var J=7&B;if(J===e.Varint)for(;this.buf[this.pos++]>127;);else if(J===e.Bytes)this.pos=this.readVarint()+this.pos;else if(J===e.Fixed32)this.pos+=4;else{if(J!==e.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(B,J){this.writeVarint(B<<3|J)},realloc:function(B){for(var J=this.length||16;J<this.pos+B;)J*=2;if(J!==this.length){var ie=new Uint8Array(J);ie.set(this.buf),this.buf=ie,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(B){this.realloc(4),oe(this.buf,B,this.pos),this.pos+=4},writeSFixed32:function(B){this.realloc(4),oe(this.buf,B,this.pos),this.pos+=4},writeFixed64:function(B){this.realloc(8),oe(this.buf,-1&B,this.pos),oe(this.buf,Math.floor(B*o),this.pos+4),this.pos+=8},writeSFixed64:function(B){this.realloc(8),oe(this.buf,-1&B,this.pos),oe(this.buf,Math.floor(B*o),this.pos+4),this.pos+=8},writeVarint:function(B){(B=+B||0)>268435455||B<0?function(J,ie){var ce,Ie;if(J>=0?(ce=J%4294967296|0,Ie=J/4294967296|0):(Ie=~(-J/4294967296),4294967295^(ce=~(-J%4294967296))?ce=ce+1|0:(ce=0,Ie=Ie+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ie.realloc(10),function(Pe,Le,Ue){Ue.buf[Ue.pos++]=127&Pe|128,Pe>>>=7,Ue.buf[Ue.pos++]=127&Pe|128,Pe>>>=7,Ue.buf[Ue.pos++]=127&Pe|128,Pe>>>=7,Ue.buf[Ue.pos++]=127&Pe|128,Ue.buf[Ue.pos]=127&(Pe>>>=7)}(ce,0,ie),function(Pe,Le){var Ue=(7&Pe)<<4;Le.buf[Le.pos++]|=Ue|((Pe>>>=3)?128:0),Pe&&(Le.buf[Le.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Le.buf[Le.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Le.buf[Le.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Le.buf[Le.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Le.buf[Le.pos++]=127&Pe)))))}(Ie,ie)}(B,this):(this.realloc(4),this.buf[this.pos++]=127&B|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=127&(B>>>=7)|(B>127?128:0),B<=127||(this.buf[this.pos++]=B>>>7&127))))},writeSVarint:function(B){this.writeVarint(B<0?2*-B-1:2*B)},writeBoolean:function(B){this.writeVarint(!!B)},writeString:function(B){B=String(B),this.realloc(4*B.length),this.pos++;var J=this.pos;this.pos=function(ce,Ie,Pe){for(var Le,Ue,ct=0;ct<Ie.length;ct++){if((Le=Ie.charCodeAt(ct))>55295&&Le<57344){if(!Ue){Le>56319||ct+1===Ie.length?(ce[Pe++]=239,ce[Pe++]=191,ce[Pe++]=189):Ue=Le;continue}if(Le<56320){ce[Pe++]=239,ce[Pe++]=191,ce[Pe++]=189,Ue=Le;continue}Le=Ue-55296<<10|Le-56320|65536,Ue=null}else Ue&&(ce[Pe++]=239,ce[Pe++]=191,ce[Pe++]=189,Ue=null);Le<128?ce[Pe++]=Le:(Le<2048?ce[Pe++]=Le>>6|192:(Le<65536?ce[Pe++]=Le>>12|224:(ce[Pe++]=Le>>18|240,ce[Pe++]=Le>>12&63|128),ce[Pe++]=Le>>6&63|128),ce[Pe++]=63&Le|128)}return Pe}(this.buf,B,this.pos);var ie=this.pos-J;ie>=128&&g(J,ie,this),this.pos=J-1,this.writeVarint(ie),this.pos+=ie},writeFloat:function(B){this.realloc(4),i.write(this.buf,B,this.pos,!0,23,4),this.pos+=4},writeDouble:function(B){this.realloc(8),i.write(this.buf,B,this.pos,!0,52,8),this.pos+=8},writeBytes:function(B){var J=B.length;this.writeVarint(J),this.realloc(J);for(var ie=0;ie<J;ie++)this.buf[this.pos++]=B[ie]},writeRawMessage:function(B,J){this.pos++;var ie=this.pos;B(J,this);var ce=this.pos-ie;ce>=128&&g(ie,ce,this),this.pos=ie-1,this.writeVarint(ce),this.pos+=ce},writeMessage:function(B,J,ie){this.writeTag(B,e.Bytes),this.writeRawMessage(J,ie)},writePackedVarint:function(B,J){J.length&&this.writeMessage(B,y,J)},writePackedSVarint:function(B,J){J.length&&this.writeMessage(B,x,J)},writePackedBoolean:function(B,J){J.length&&this.writeMessage(B,I,J)},writePackedFloat:function(B,J){J.length&&this.writeMessage(B,S,J)},writePackedDouble:function(B,J){J.length&&this.writeMessage(B,T,J)},writePackedFixed32:function(B,J){J.length&&this.writeMessage(B,R,J)},writePackedSFixed32:function(B,J){J.length&&this.writeMessage(B,D,J)},writePackedFixed64:function(B,J){J.length&&this.writeMessage(B,O,J)},writePackedSFixed64:function(B,J){J.length&&this.writeMessage(B,W,J)},writeBytesField:function(B,J){this.writeTag(B,e.Bytes),this.writeBytes(J)},writeFixed32Field:function(B,J){this.writeTag(B,e.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(B,J){this.writeTag(B,e.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(B,J){this.writeTag(B,e.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(B,J){this.writeTag(B,e.Fixed64),this.writeSFixed64(J)},writeVarintField:function(B,J){this.writeTag(B,e.Varint),this.writeVarint(J)},writeSVarintField:function(B,J){this.writeTag(B,e.Varint),this.writeSVarint(J)},writeStringField:function(B,J){this.writeTag(B,e.Bytes),this.writeString(J)},writeFloatField:function(B,J){this.writeTag(B,e.Fixed32),this.writeFloat(J)},writeDoubleField:function(B,J){this.writeTag(B,e.Fixed64),this.writeDouble(J)},writeBooleanField:function(B,J){this.writeVarintField(B,!!J)}},Xg}var Cm=to(By());const Kg=3;function Ow(i,e,r){e.glyphs=[],i===1&&r.readMessage(Fw,e)}function Fw(i,e,r){if(i===3){const{id:o,bitmap:a,width:c,height:d,left:g,top:y,advance:x}=r.readMessage(Bw,{});e.glyphs.push({id:o,bitmap:new Lt({width:c+2*Kg,height:d+2*Kg},a),metrics:{width:c,height:d,left:g,top:y,advance:x}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function Bw(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}const Nw=Kg,cl={horizontal:1,vertical:2,horizontalOnly:3};class kp{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const o=new kp;return o.scale=e||1,o.fontStack=r,o}static forImage(e){const r=new kp;return r.image=e,r}}class Yf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,o){const a=new Yf;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?a.addImageSection(d,o):a.addTextSection(d,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,o){let a="";for(let c=0;c<r.length;c++){const d=r.charCodeAt(c+1)||null,g=r.charCodeAt(c-1)||null;a+=!o&&(d&&eu(d)&&!Dp[r[c+1]]||g&&eu(g)&&!Dp[r[c-1]])||!Dp[r[c]]?r[c]:Dp[r[c]]}return a}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Mm[this.text.charCodeAt(o)];o++)e++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Mm[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const o=new Yf;return o.text=this.text.substring(e,r),o.sectionIndex=this.sectionIndex.slice(e,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(kp.forText(e.scale,e.fontStack||r));const o=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(o)}addImageSection(e,r){const o=e.image?e.image.getPrimary():null;if(!o)return void Jr("Can't add FormattedSection with an empty image.");o.scaleSelf(r);const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(kp.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Jr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Jg(i,e,r,o,a,c,d,g,y,x,S,T,I,R,D,O=1){const W=Yf.fromFeature(i,a,O);T===cl.vertical&&W.verticalizePunctuation(I);let X=[];const oe=function(ce,Ie,Pe,Le,Ue,ct){if(!ce)return[];const Pt=[],Tt=function(It,nt,ut,jt,qt,wr){let hr=0;for(let Jt=0;Jt<It.length();Jt++){const Vt=It.getSection(Jt);hr+=Ny(It.getCodePoint(Jt),Vt,jt,qt,nt,wr)}return hr/Math.max(1,Math.ceil(hr/ut))}(ce,Ie,Pe,Le,Ue,ct),At=ce.text.indexOf("")>=0;let Nt=0;for(let It=0;It<ce.length();It++){const nt=ce.getSection(It),ut=ce.getCodePoint(It);if(Mm[ut]||(Nt+=Ny(ut,nt,Le,Ue,Ie,ct)),It<ce.length()-1){const jt=!((at=ut)<11904||!(Pr["Bopomofo Extended"](at)||Pr.Bopomofo(at)||Pr["CJK Compatibility Forms"](at)||Pr["CJK Compatibility Ideographs"](at)||Pr["CJK Compatibility"](at)||Pr["CJK Radicals Supplement"](at)||Pr["CJK Strokes"](at)||Pr["CJK Symbols and Punctuation"](at)||Pr["CJK Unified Ideographs Extension A"](at)||Pr["CJK Unified Ideographs"](at)||Pr["Enclosed CJK Letters and Months"](at)||Pr["Halfwidth and Fullwidth Forms"](at)||Pr.Hiragana(at)||Pr["Ideographic Description Characters"](at)||Pr["Kangxi Radicals"](at)||Pr["Katakana Phonetic Extensions"](at)||Pr.Katakana(at)||Pr["Vertical Forms"](at)||Pr["Yi Radicals"](at)||Pr["Yi Syllables"](at)));(Vw[ut]||jt||nt.image)&&Pt.push(jy(It+1,Nt,Tt,Pt,jw(ut,ce.getCodePoint(It+1),jt&&At),!1))}}var at;return Uy(jy(ce.length(),Nt,Tt,Pt,0,!0))}(W,x,c,e,o,R),{processBidirectionalText:re,processStyledBidirectionalText:B}=Js;if(re&&W.sections.length===1){const ce=re(W.toString(),oe);for(const Ie of ce){const Pe=new Yf;Pe.text=Ie,Pe.sections=W.sections;for(let Le=0;Le<Ie.length;Le++)Pe.sectionIndex.push(0);X.push(Pe)}}else if(B){const ce=B(W.text,W.sectionIndex,oe);for(const Ie of ce){const Pe=new Yf;Pe.text=Ie[0],Pe.sectionIndex=Ie[1],Pe.sections=W.sections,X.push(Pe)}}else X=function(ce,Ie){const Pe=[],Le=ce.text;let Ue=0;for(const ct of Ie)Pe.push(ce.substring(Ue,ct)),Ue=ct;return Ue<Le.length&&Pe.push(ce.substring(Ue,Le.length)),Pe}(W,oe);const J=[],ie={positionedLines:J,text:W.toString(),top:S[1],bottom:S[1],left:S[0],right:S[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ce,Ie,Pe,Le,Ue,ct,Pt,Tt,At,Nt,at,It){let nt=0,ut=0,jt=0;const qt=Tt==="right"?1:Tt==="left"?0:.5;let wr=!1;for(const yr of Ue){const Vr=yr.getSections();for(const Kr of Vr){if(Kr.image)continue;const ni=Ie[Kr.fontStack];if(ni&&(wr=ni.ascender!==void 0&&ni.descender!==void 0,!wr))break}if(!wr)break}let hr=0;for(const yr of Ue){yr.trim();const Vr=yr.getMaxScale(),Kr=(Vr-1)*ds,ni={positionedGlyphs:[],lineOffset:0};ce.positionedLines[hr]=ni;const _i=ni.positionedGlyphs;let ci=0;if(!yr.length()){ut+=ct,++hr;continue}let oi=0,an=0;for(let le=0;le<yr.length();le++){const de=yr.getSection(le),pt=yr.getSectionIndex(le),$t=yr.getCodePoint(le);let tr=de.scale,er=null,vr=null,Br=null,Ti=ds,Ei=0;At===cl.vertical&&((Jt=$t)===12312||Jt===12313||Jt===12316||Jt===12540||Jt===12448)&&(At=cl.horizontal);const si=!(At===cl.horizontal||!at&&!va($t)||at&&(Mm[$t]||od($t)));if(de.image){const tn=Le.get(de.image.toString());if(!tn)continue;Br=de.image,ce.iconsInText=ce.iconsInText||!0,vr=tn.paddedRect;const hn=tn.displaySize;tr=tr*ds/It,er={width:hn[0],height:hn[1],left:0,top:-3,advance:si?hn[1]:hn[0],localGlyph:!1},Ei=wr?-er.height*tr:Vr*ds-17-hn[1]*tr,Ti=er.advance;const Ii=(si?hn[0]:hn[1])*tr-ds*Vr;Ii>0&&Ii>ci&&(ci=Ii)}else{const tn=Pe[de.fontStack];if(!tn)continue;tn[$t]&&(vr=tn[$t]);const hn=Ie[de.fontStack];if(!hn)continue;const Ii=hn.glyphs[$t];if(!Ii)continue;if(er=Ii.metrics,Ti=$t!==8203?ds:0,wr){const Bn=hn.ascender!==void 0?Math.abs(hn.ascender):0,xn=hn.descender!==void 0?Math.abs(hn.descender):0,Ji=(Bn+xn)*tr;oi<Ji&&(oi=Ji,an=(Bn-xn)/2*tr),Ei=-Bn*tr}else Ei=(Vr-tr)*ds-17}si?(ce.verticalizable=!0,_i.push({glyph:$t,image:Br,x:nt,y:ut+Ei,vertical:si,scale:tr,localGlyph:er.localGlyph,fontStack:de.fontStack,sectionIndex:pt,metrics:er,rect:vr}),nt+=Ti*tr+Nt):(_i.push({glyph:$t,image:Br,x:nt,y:ut+Ei,vertical:si,scale:tr,localGlyph:er.localGlyph,fontStack:de.fontStack,sectionIndex:pt,metrics:er,rect:vr}),nt+=er.advance*tr+Nt)}_i.length!==0&&(jt=Math.max(nt-Nt,jt),wr?qy(_i,qt,ci,an,ct*Vr/2):qy(_i,qt,ci,0,ct/2)),nt=0;const vn=ct*Vr+ci;ni.lineOffset=Math.max(ci,Kr),ut+=vn,++hr}var Jt;const Vt=ut,{horizontalAlign:$r,verticalAlign:_r}=Qg(Pt);(function(yr,Vr,Kr,ni,_i,ci){const oi=(Vr-Kr)*_i,an=-ci*ni;for(const vn of yr)for(const le of vn.positionedGlyphs)le.x+=oi,le.y+=an})(ce.positionedLines,qt,$r,_r,jt,Vt),ce.top+=-_r*Vt,ce.bottom=ce.top+Vt,ce.left+=-$r*jt,ce.right=ce.left+jt,ce.hasBaseline=wr}(ie,e,r,o,X,d,g,y,T,x,I,D),!function(ce){for(const Ie of ce)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(J))return ie}const Mm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Vw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ny(i,e,r,o,a,c){if(e.image){const d=o.get(e.image.toString());return d?d.displaySize[0]*e.scale*ds/c+a:0}{const d=r[e.fontStack],g=d&&d.glyphs[i];return g?g.metrics.advance*e.scale+a:0}}function Vy(i,e,r,o){const a=Math.pow(i-e,2);return o?i<e?a/2:2*a:a+Math.abs(r)*r}function jw(i,e,r){let o=0;return i===10&&(o-=1e4),r&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function jy(i,e,r,o,a,c){let d=null,g=Vy(e,r,a,c);for(const y of o){const x=Vy(e-y.x,r,a,c)+y.badness;x<=g&&(d=y,g=x)}return{index:i,x:e,priorBreak:d,badness:g}}function Uy(i){return i?Uy(i.priorBreak).concat(i.index):[]}function Qg(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function qy(i,e,r,o,a){if(!(e||r||o||a))return;const c=i.length-1,d=i[c],g=(d.x+d.metrics.advance*d.scale)*e;for(let y=0;y<=c;y++)i[y].x-=g,i[y].y+=r+o+a}function Gy(i){return i.imagePrimary!==void 0&&i.top!==void 0&&i.bottom!==void 0&&i.left!==void 0&&i.right!==void 0}function Uw(i,e,r,o){const{horizontalAlign:a,verticalAlign:c}=Qg(o),d=r[0]-i.displaySize[0]*a,g=r[1]-i.displaySize[1]*c;return{imagePrimary:i,imageSecondary:e,top:g,bottom:g+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function Hy(i,e,r,o,a,c){const d=i.imagePrimary;let g;if(d.content){const W=d.content,X=d.pixelRatio||1;g=[W[0]/X,W[1]/X,d.displaySize[0]-W[2]/X,d.displaySize[1]-W[3]/X]}const y=e.left*c,x=e.right*c;let S,T,I,R;r==="width"||r==="both"?(R=a[0]+y-o[3],T=a[0]+x+o[1]):(R=a[0]+(y+x-d.displaySize[0])/2,T=R+d.displaySize[0]);const D=e.top*c,O=e.bottom*c;return r==="height"||r==="both"?(S=a[1]+D-o[0],I=a[1]+O+o[2]):(S=a[1]+(D+O-d.displaySize[1])/2,I=S+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:S,right:T,bottom:I,left:R,collisionPadding:g}}function $y(i){return!i.imagePrimary.stretchX}function Wy(i){return!i.imagePrimary.stretchY}function Zy(i){return{width:i.right-i.left,height:i.bottom-i.top}}const th=128;function Xy(i,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Zi(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:a}=r;let c=0;for(;c<o.length&&o[c]<=i;)c++;c=Math.max(0,c-1);let d=c;for(;d<o.length&&o[d]<i+1;)d++;d=Math.min(o.length-1,d);const g=o[c],y=o[d];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:a}:{kind:"camera",minZoom:g,maxZoom:y,minSize:r.evaluate(new Zi(g)),maxSize:r.evaluate(new Zi(y)),interpolationType:a}}}function e_(i,{uSize:e,uSizeT:r},{lowerSize:o,upperSize:a}){return i.kind==="source"?o/th:i.kind==="composite"?Mr(o/th,a/th,r):e}function Lp(i,e,r=1){let o=0,a=0;if(i.kind==="constant")a=i.layoutSize*r;else if(i.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:g}=i,y=c?ke(wo.interpolationFactor(c,e,d,g),0,1):0;i.kind==="camera"?a=Mr(i.minSize,i.maxSize,y)*r:o=y*r}return{uSizeT:o,uSize:a}}class Vh extends Ot{constructor(e,r,o,a,c){super(e,r),this.angle=a,this.z=o,c!==void 0&&(this.segment=c)}clone(){return new Vh(this.x,this.y,this.z,this.angle,this.segment)}}function Yy(i,e,r,o,a){if(e.segment===void 0)return!0;let c=e,d=e.segment+1,g=0;for(;g>-r/2;){if(d--,d<0)return!1;g-=i[d].dist(c),c=i[d]}g+=i[d].dist(i[d+1]),d++;const y=[];let x=0;for(;g<r/2;){const S=i[d],T=i[d+1];if(!T)return!1;let I=i[d-1].angleTo(S)-S.angleTo(T);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:I}),x+=I;g-y[0].distance>o;)x-=y.shift().angleDelta;if(x>a)return!1;d++,g+=S.dist(T)}return!0}function Ky(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function Jy(i,e,r){return i?.6*e*r:0}function Qy(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function qw(i,e,r,o,a,c){const d=Jy(r,a,c),g=Qy(r,o)*c;let y=0;const x=Ky(i)/2;for(let S=0;S<i.length-1;S++){const T=i[S],I=i[S+1],R=T.dist(I);if(y+R>x){const D=(x-y)/R,O=Mr(T.x,I.x,D),W=Mr(T.y,I.y,D),X=new Vh(O,W,0,I.angleTo(T),S);return!d||Yy(i,X,g,d,e)?X:void 0}y+=R}}function Gw(i,e,r,o,a,c,d,g,y){const x=Jy(o,c,d),S=Qy(o,a),T=S*d,I=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-T<e/4&&(e=T+e/4),ev(i,I?e/2*g%e:(S/2+2*c)*d*g%e,e,x,r,T,I,!1,y)}function ev(i,e,r,o,a,c,d,g,y){const x=c/2,S=Ky(i);let T=0,I=e-r,R=[];for(let D=0;D<i.length-1;D++){const O=i[D],W=i[D+1],X=O.dist(W),oe=W.angleTo(O);for(;I+r<T+X;){I+=r;const re=(I-T)/X,B=Mr(O.x,W.x,re),J=Mr(O.y,W.y,re);if(B>=0&&B<y&&J>=0&&J<y&&I-x>=0&&I+x<=S){const ie=new Vh(B,J,0,oe,D);o&&!Yy(i,ie,c,o,a)||R.push(ie)}}T+=X}return g||R.length||d||(R=ev(i,T/2,r,o,a,c,d,!0,y)),R}function tv(i){let e=0,r=0;for(const d of i)e+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,g)=>g.h-d.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let a=0,c=0;for(const d of i)for(let g=o.length-1;g>=0;g--){const y=o[g];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,c=Math.max(c,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===y.w&&d.h===y.h){const x=o.pop();g<o.length&&(o[g]=x)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(o.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:a,h:c,fill:e/(a*c)||0}}ir(Vh,"Anchor");const Sf=1;class zp{static getImagePositionScale(e,r,o){if(r&&e&&e.options&&e.options.transform){const a=e.options.transform;return{x:a.a,y:a.d}}return{x:o,y:o}}constructor(e,r,o,a){this.paddedRect=e;const{pixelRatio:c,version:d,stretchX:g,stretchY:y,content:x,sdf:S,usvg:T}=r;this.pixelRatio=c,this.stretchX=g,this.stretchY=y,this.content=x,this.version=d,this.padding=o,this.sdf=S,this.scale=zp.getImagePositionScale(a,T,c)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function t_(i,e,r){const o=Q.parse(i),a=function(c,d,g=[1,1]){return{x:0,y:0,w:(c.data?c.data.width:c.width*g[0])+2*d,h:(c.data?c.data.height:c.height*g[1])+2*d}}(e,r,[o.options.transform.a,o.options.transform.d]);return{bin:a,imagePosition:new zp(a,e,r,o),imageVariant:o}}class rv{constructor(e,r,o){const a=new Map,c=new Map;this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,Sf,d),this.addImages(r,c,2,d);const{w:g,h:y}=tv(d),x=new br({width:g||1,height:y||1});for(const[S,T]of e.entries()){const I=a.get(S).paddedRect;br.copy(T.data,x,{x:0,y:0},{x:I.x+Sf,y:I.y+Sf},T.data,o,T.sdf)}for(const[S,T]of r.entries()){const I=c.get(S),R=I.paddedRect;let D=I.padding;const O=R.x+D,W=R.y+D,X=T.data.width,oe=T.data.height;D=D>1?D-1:D,br.copy(T.data,x,{x:0,y:0},{x:O,y:W},T.data,o),br.copy(T.data,x,{x:0,y:oe-D},{x:O,y:W-D},{width:X,height:D},o),br.copy(T.data,x,{x:0,y:0},{x:O,y:W+oe},{width:X,height:D},o),br.copy(T.data,x,{x:X-D,y:0},{x:O-D,y:W},{width:D,height:oe},o),br.copy(T.data,x,{x:0,y:0},{x:O+X,y:W},{width:D,height:oe},o),br.copy(T.data,x,{x:X-D,y:oe-D},{x:O-D,y:W-D},{width:D,height:D},o),br.copy(T.data,x,{x:0,y:oe-D},{x:O+X,y:W-D},{width:D,height:D},o),br.copy(T.data,x,{x:0,y:0},{x:O+X,y:W+oe},{width:D,height:D},o),br.copy(T.data,x,{x:X-D,y:0},{x:O-D,y:W+oe},{width:D,height:D},o)}this.lut=o,this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(e,r,o,a){for(const[c,d]of e.entries()){const{bin:g,imagePosition:y,imageVariant:x}=t_(c,d,o);r.set(c,y),a.push(g),d.hasRenderCallback&&this.haveRenderCallbacks.push(x.id)}}patchUpdatedImages(e,r,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const a of e.getUpdatedImages(o)){for(const c of this.iconPositions.keys()){const d=Q.parse(c);if(vs.isEqual(d.id,a)){const g=e.getImage(a,o);this.patchUpdatedImage(this.iconPositions.get(c),g,r)}}for(const c of this.patternPositions.keys()){const d=Q.parse(c);if(vs.isEqual(d.id,a)){const g=e.getImage(a,o);this.patchUpdatedImage(this.patternPositions.get(c),g,r)}}}}patchUpdatedImage(e,r,o){if(!e||!r||e.version===r.version)return;e.version=r.version;const[a,c]=e.tl,d=e.sdf;if(this.lut||d){const g={width:r.data.width,height:r.data.height},y=new br(g);br.copy(r.data,y,{x:0,y:0},{x:0,y:0},g,this.lut,d),o.update(y,{position:{x:a,y:c}})}else o.update(r.data,{position:{x:a,y:c}})}}ir(zp,"ImagePosition"),ir(rv,"ImageAtlas");const Pm=1e20;function iv(i,e,r,o,a,c,d,g,y){for(let x=e;x<e+o;x++)nv(i,r*c+x,c,a,d,g,y);for(let x=r;x<r+a;x++)nv(i,x*c+e,1,o,d,g,y)}function nv(i,e,r,o,a,c,d){c[0]=0,d[0]=-1e20,d[1]=Pm,a[0]=i[e];for(let g=1,y=0,x=0;g<o;g++){a[g]=i[e+g*r];const S=g*g;do{const T=c[y];x=(a[g]-a[T]+S-T*T)/(g-T)/2}while(x<=d[y]&&--y>-1);y++,c[y]=g,d[y]=x,d[y+1]=Pm}for(let g=0,y=0;g<o;g++){for(;d[y+1]<g;)y++;const x=c[y],S=g-x;i[e+g*r]=a[x]+S*S}}const ac=2,r_={none:0,ideographs:1,all:2};class Kf{constructor(e,r,o){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,o){const a=[],c=this.urls[r]||mn.GLYPHS_URL;for(const d in e)for(const g of e[d])a.push({stack:d,id:g});_t(a,({stack:d,id:g},y)=>{let x=this.entries[d];x||(x=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=x.glyphs[g];if(S!==void 0)return void y(null,{stack:d,id:g,glyph:S});if(S=this._tinySDF(x,d,g),S)return x.glyphs[g]=S,void y(null,{stack:d,id:g,glyph:S});const T=Math.floor(g/256);if(256*T>65535)return Jr("glyphs > 65535 not supported"),void y(null,{stack:d,id:g,glyph:S});if(x.ranges[T])return void y(null,{stack:d,id:g,glyph:S});let I=x.requests[T];I||(I=x.requests[T]=[],Kf.loadGlyphRange(d,T,c,this.requestManager,(R,D)=>{if(D){x.ascender=D.ascender,x.descender=D.descender;for(const O in D.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=D.glyphs[+O]);x.ranges[T]=!0}for(const O of I)O(R,D);delete x.requests[T]})),I.push((R,D)=>{R?y(R):D&&y(null,{stack:d,id:g,glyph:D.glyphs[g]||null})})},(d,g)=>{if(d)o(d);else if(g){const y={};for(const{stack:x,id:S,glyph:T}of g)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[S]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;o(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==r_.none&&(this.localGlyphMode===r_.all?!!this.localFontFamily:!!this.localFontFamily&&(Pr["CJK Unified Ideographs"](e)||Pr["Hangul Syllables"](e)||Pr.Hiragana(e)||Pr.Katakana(e)||Pr["CJK Symbols and Punctuation"](e)||Pr["CJK Unified Ideographs Extension A"](e)||Pr["CJK Unified Ideographs Extension B"](e)||Pr.Osage(e)))}_tinySDF(e,r,o){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(o))return;let c=e.tinySDF;if(!c){let O="400";/bold/i.test(r)?O="900":/medium/i.test(r)?O="500":/light/i.test(r)&&(O="200"),c=e.tinySDF=new Kf.TinySDF({fontFamily:a,fontWeight:O,fontSize:24*ac,buffer:3*ac,radius:8*ac}),c.fontWeight=O}if(this.localGlyphs[c.fontWeight][o])return this.localGlyphs[c.fontWeight][o];const d=String.fromCodePoint(o),{data:g,width:y,height:x,glyphWidth:S,glyphHeight:T,glyphLeft:I,glyphTop:R,glyphAdvance:D}=c.draw(d);return this.localGlyphs[c.fontWeight][o]={id:o,bitmap:new Lt({width:y,height:x},g),metrics:{width:S/ac,height:T/ac,left:I/ac,top:R/ac-27,advance:D/ac,localGlyph:!0}}}}Kf.loadGlyphRange=function(i,e,r,o,a){const c=256*e,d=c+255,g=o.transformRequest(o.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${c}-${d}`),oa.Glyphs);Ta(g,(y,x)=>{if(y)a(y);else if(x){const S={},T=function(I){return new Cm(I).readFields(Ow,{})}(x);for(const I of T.glyphs)S[I.id]=I;a(null,{glyphs:S,ascender:T.ascender,descender:T.descender})}})},Kf.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:o=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=r;const g=this.size=i+4*e,y=this._createCanvas(g),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${d} ${c} ${i}px ${a}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:o,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(i),d=Math.ceil(r),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),y=Math.min(this.size-this.buffer,d+Math.ceil(o)),x=g+2*this.buffer,S=y+2*this.buffer,T=Math.max(x*S,0),I=new Uint8ClampedArray(T),R={data:I,width:x,height:S,glyphWidth:g,glyphHeight:y,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return R;const{ctx:D,buffer:O,gridInner:W,gridOuter:X}=this;D.clearRect(O,O,g,y),D.fillText(i,O,O+d);const oe=D.getImageData(O,O,g,y);X.fill(Pm,0,T),W.fill(0,0,T);for(let re=0;re<y;re++)for(let B=0;B<g;B++){const J=oe.data[4*(re*g+B)+3]/255;if(J===0)continue;const ie=(re+O)*x+B+O;if(J===1)X[ie]=0,W[ie]=Pm;else{const ce=.5-J;X[ie]=ce>0?ce*ce:0,W[ie]=ce<0?ce*ce:0}}iv(X,0,0,x,S,x,this.f,this.v,this.z),iv(W,O,O,g,y,x,this.f,this.v,this.z);for(let re=0;re<T;re++){const B=Math.sqrt(X[re])-Math.sqrt(W[re]);I[re]=Math.round(255-255*(B/this.radius+this.cutoff))}return R}};const Tf=Sf;function ov(i,e){return i+e[1]-e[0]}function sv(i,e,r,o,a=1){const c=[],d=i.imagePrimary,g=d.pixelRatio,y=d.paddedRect.w-2*Tf,x=d.paddedRect.h-2*Tf,S=(i.right-i.left)*a,T=(i.bottom-i.top)*a,I=d.stretchX||[[0,y]],R=d.stretchY||[[0,x]],D=I.reduce(ov,0),O=R.reduce(ov,0),W=y-D,X=x-O;let oe=0,re=D,B=0,J=O,ie=0,ce=W,Ie=0,Pe=X;if(d.content&&o){const Ue=d.content;oe=Rm(I,0,Ue[0]),B=Rm(R,0,Ue[1]),re=Rm(I,Ue[0],Ue[2]),J=Rm(R,Ue[1],Ue[3]),ie=Ue[0]-oe,Ie=Ue[1]-B,ce=Ue[2]-Ue[0]-re,Pe=Ue[3]-Ue[1]-J}const Le=(Ue,ct,Pt,Tt)=>{const At=Dm(Ue.stretch-oe,re,S,i.left*a),Nt=km(Ue.fixed-ie,ce,Ue.stretch,D),at=Dm(ct.stretch-B,J,T,i.top*a),It=km(ct.fixed-Ie,Pe,ct.stretch,O),nt=Dm(Pt.stretch-oe,re,S,i.left*a),ut=km(Pt.fixed-ie,ce,Pt.stretch,D),jt=Dm(Tt.stretch-B,J,T,i.top*a),qt=km(Tt.fixed-Ie,Pe,Tt.stretch,O),wr=new Ot(At,at),hr=new Ot(nt,at),Jt=new Ot(nt,jt),Vt=new Ot(At,jt),$r=new Ot(Nt/g,It/g),_r=new Ot(ut/g,qt/g),yr=e*Math.PI/180;if(yr){const oi=Math.sin(yr),an=Math.cos(yr),vn=[an,-oi,oi,an];wr._matMult(vn),hr._matMult(vn),Vt._matMult(vn),Jt._matMult(vn)}const Vr=Ue.stretch+Ue.fixed,Kr=Pt.stretch+Pt.fixed,ni=ct.stretch+ct.fixed,_i=Tt.stretch+Tt.fixed,ci=i.imageSecondary;return{tl:wr,tr:hr,bl:Vt,br:Jt,texPrimary:{x:d.paddedRect.x+Tf+Vr,y:d.paddedRect.y+Tf+ni,w:Kr-Vr,h:_i-ni},texSecondary:ci?{x:ci.paddedRect.x+Tf+Vr,y:ci.paddedRect.y+Tf+ni,w:Kr-Vr,h:_i-ni}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:$r,pixelOffsetBR:_r,minFontScaleX:ce/g/S,minFontScaleY:Pe/g/T,isSDF:r}};if(o&&(d.stretchX||d.stretchY)){const Ue=av(I,W,D),ct=av(R,X,O);for(let Pt=0;Pt<Ue.length-1;Pt++){const Tt=Ue[Pt],At=Ue[Pt+1];for(let Nt=0;Nt<ct.length-1;Nt++)c.push(Le(Tt,ct[Nt],At,ct[Nt+1]))}}else c.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Rm(i,e,r){let o=0;for(const a of i)o+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]));return o}function av(i,e,r){const o=[{fixed:-1,stretch:0}];for(const[a,c]of i){const d=o[o.length-1];o.push({fixed:a-d.stretch,stretch:d.stretch}),o.push({fixed:a-d.stretch,stretch:d.stretch+(c-a)})}return o.push({fixed:e+Tf,stretch:r}),o}function Dm(i,e,r,o){return i/e*r+o}function km(i,e,r,o){return i-e*r/o}function Hw(i,e,r,o){const a=e+i.positionedLines[o].lineOffset;return o===0?r+a/2:r+(a+(e+i.positionedLines[o-1].lineOffset))/2}function $w(i,e=1,r=!1){let o=1/0,a=1/0,c=-1/0,d=-1/0;const g=i[0];for(let R=0;R<g.length;R++){const D=g[R];(!R||D.x<o)&&(o=D.x),(!R||D.y<a)&&(a=D.y),(!R||D.x>c)&&(c=D.x),(!R||D.y>d)&&(d=D.y)}const y=Math.min(c-o,d-a);let x=y/2;const S=new uh([],Ww);if(y===0)return new Ot(o,a);for(let R=o;R<c;R+=y)for(let D=a;D<d;D+=y)S.push(new Jf(R+x,D+x,x,i));let T=function(R){let D=0,O=0,W=0;const X=R[0];for(let oe=0,re=X.length,B=re-1;oe<re;B=oe++){const J=X[oe],ie=X[B],ce=J.x*ie.y-ie.x*J.y;O+=(J.x+ie.x)*ce,W+=(J.y+ie.y)*ce,D+=3*ce}return new Jf(O/D,W/D,0,R)}(i),I=S.length;for(;S.length;){const R=S.pop();(R.d>T.d||!T.d)&&(T=R,r&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,I)),R.max-T.d<=e||(x=R.h/2,S.push(new Jf(R.p.x-x,R.p.y-x,x,i)),S.push(new Jf(R.p.x+x,R.p.y-x,x,i)),S.push(new Jf(R.p.x-x,R.p.y+x,x,i)),S.push(new Jf(R.p.x+x,R.p.y+x,x,i)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${T.d}`)),T.p}function Ww(i,e){return e.max-i.max}class Jf{constructor(e,r,o,a){this.p=new Ot(e,r),this.h=o,this.d=function(c,d){let g=!1,y=1/0;for(let x=0;x<d.length;x++){const S=d[x];for(let T=0,I=S.length,R=I-1;T<I;R=T++){const D=S[T],O=S[R];D.y>c.y!=O.y>c.y&&c.x<(O.x-D.x)*(c.y-D.y)/(O.y-D.y)+D.x&&(g=!g),y=Math.min(y,wi(c,D,O))}}return(g?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const Zw=Object.keys,i_=Number.POSITIVE_INFINITY,Xw=Math.sqrt(2);function lv(i,[e,r]){let o=0,a=0;if(r===i_){e<0&&(e=0);const c=e/Xw;switch(i){case"top-right":case"top-left":a=c-7;break;case"bottom-right":case"bottom-left":a=7-c;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(i){case"top-right":case"bottom-right":o=-c;break;case"top-left":case"bottom-left":o=c;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),i){case"top-right":case"top-left":case"top":a=r-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-r}switch(i){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,a]}function Lm(i,e,r,o,a,c,d,g,y){if(!e||!e.usvg)return;const x=Zy(o),S=Zy(a),T=c!=="both"&&c!=="width"||!$y(o)?1:Math.max(1,S.width/x.width),I=c!=="both"&&c!=="height"||!Wy(o)?1:Math.max(1,S.height/x.height);r.scaleSelf(T,I);const R=r.toString();d.set(R,r),g.set(R,e);const{imagePosition:D}=t_(R,e,Sf);y.set(R,D)}function uv(i,e,r,o,a,c,d,g){if(!i)return;const y=function(x,S,T,I,R){if(x.kind==="camera")return x.maxSize;if(x.kind==="composite"){const D=S.possiblyEvaluate(new Zi(x.maxZoom),T).evaluate(R,{},T),O=S.possiblyEvaluate(new Zi(x.minZoom),T).evaluate(R,{},T);return Math.max(D,O)}return S.possiblyEvaluate(new Zi(I)).evaluate(R,{},T)}(e,r,o,a,c);return i.scaleSelf(y*g*d)}function cv(i,e,r,o,a,c,d,g){return{iconPrimary:uv(i.getPrimary(),e,r,o,a,c,d,g),iconSecondary:uv(i.getSecondary(),e,r,o,a,c,d,g)}}function hv(i,e,r,o){if(!i)return;const a=e.get(r.toString());if(i.imagePrimary=a,o){const c=e.get(o.toString());i.imageSecondary=c}}function Yw(i,e){for(const r in i.horizontal)dv(i.horizontal[r],e);dv(i.vertical,e)}function dv(i,e){if(i){for(const r of i.positionedLines)for(const o of r.positionedGlyphs)if(o.image!==null){const a=o.image.toString();o.rect=e.get(a).paddedRect}}}function n_(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Kw(i,e,r,o,a,c,d,g,y){const x=o_(c.horizontal)||c.vertical,S=r.get("icon-text-fit-padding").evaluate(o,{},a);let T,I=e;return e&&y!=="none"&&(i.allowVerticalPlacement&&c.vertical&&(T=Hy(e,c.vertical,y,S,g,d)),x&&(I=Hy(e,x,y,S,g,d))),{defaultShapedIcon:I,verticallyShapedIcon:T}}function Jw(i,e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X,oe,re){let B=d.textMaxSize.evaluate(e,{},I);B===void 0?B=g*d.textScaleFactor:B*=d.textScaleFactor;const J=i.layers[0].layout,ie=o_(r.horizontal)||r.vertical,ce=R.name==="globe",Ie=ds,Pe=i.tilePixelRatio*B/Ie,Le=(Nt=i.overscaling,i.zoom>18&&Nt>2&&(Nt>>=1),Math.max(Wt/(512*Nt),1)*J.get("symbol-spacing")),Ue=J.get("text-padding")*i.tilePixelRatio,ct=J.get("icon-padding")*i.tilePixelRatio,Pt=G(J.get("text-max-angle")),Tt=J.get("icon-rotation-alignment")==="map"&&re!=="point",At=Le/2;var Nt;i.hasAnyIconTextFit===!1&&W!=="none"&&(i.hasAnyIconTextFit=!0);const at=e.properties?+e.properties[vf]:null,It=at&&i.elevationFeatureIdToIndex?i.elevationFeatureIdToIndex.get(at):65535,nt=(ut,jt,qt)=>{if(jt.x<0||jt.x>=Wt||jt.y<0||jt.y>=Wt)return;let wr=null;if(ce){const{x:hr,y:Jt,z:Vt}=R.projectTilePoint(jt.x,jt.y,qt);wr={anchor:new Vh(hr,Jt,Vt,0,void 0),up:R.upVector(qt,jt.x,jt.y)}}(function(hr,Jt,Vt,$r,_r,yr,Vr,Kr,ni,_i,ci,oi,an,vn,le,de,pt,$t,tr,er,vr,Br,Ti,Ei,si,tn,hn,Ii,Bn){const xn=hr.addToLineVertexArray(Jt,$r);let Ji,Qn,En,dn,bn,rn,di,sn=0,Nn=0,zr=0,Ni=0,In=-1,Zn=-1;const An={};let Eo=Co("");const ln=Vt?Vt.anchor:Jt,vo=Ii!=="none";let Ga=0,ks=0;if(ni._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Io=ni.layout.get("text-offset").evaluate(vr,{},si);Ga=Io[0]*ds,ks=Io[1]*ds}else Ga=ni.layout.get("text-radial-offset").evaluate(vr,{},si)*ds,ks=i_;if(hr.allowVerticalPlacement&&_r.vertical){const Io=_r.vertical;if(le)rn=s_(Io),Kr&&(di=s_(Kr));else{const Go=ni.layout.get("text-rotate").evaluate(vr,{},si)+90;En=zm(_i,ln,Jt,ci,oi,an,Io,vn,Go,de),Kr&&(dn=zm(_i,ln,Jt,ci,oi,an,Kr,$t,Go))}}if(yr){const Io=hr.iconSizeData,Go=ni.layout.get("icon-rotate").evaluate(vr,{},si),Ls=sv(yr,Go,Ti,vo,Br.iconScaleFactor),ta=Kr?sv(Kr,Go,Ti,vo,Br.iconScaleFactor):void 0;Qn=zm(_i,ln,Jt,ci,oi,an,yr,$t,Go,null),sn=4*Ls.length;let $s=null;Io.kind==="source"?($s=[th*ni.layout.get("icon-size").evaluate(vr,{},si)*Br.iconScaleFactor],$s[0]>Dd&&Jr(`${hr.layerIds[0]}: Value for "icon-size" is >= ${Op}. Reduce your "icon-size".`)):Io.kind==="composite"&&($s=[th*Br.compositeIconSizes[0].evaluate(vr,{},si)*Br.iconScaleFactor,th*Br.compositeIconSizes[1].evaluate(vr,{},si)*Br.iconScaleFactor],($s[0]>Dd||$s[1]>Dd)&&Jr(`${hr.layerIds[0]}: Value for "icon-size" is >= ${Op}. Reduce your "icon-size".`)),hr.addSymbols(hr.icon,Ls,$s,er,tr,vr,void 0,Vt,Jt,xn.lineStartIndex,xn.lineLength,-1,Ei,si,tn,hn),In=hr.icon.placedSymbolArray.length-1,ta&&(Nn=4*ta.length,hr.addSymbols(hr.icon,ta,$s,er,tr,vr,cl.vertical,Vt,Jt,xn.lineStartIndex,xn.lineLength,-1,Ei,si,tn,hn),Zn=hr.icon.placedSymbolArray.length-1)}for(const Io in _r.horizontal){const Go=Io,Ls=_r.horizontal[Go];Ji||(Eo=Co(Ls.text),le?bn=s_(Ls):Ji=zm(_i,ln,Jt,ci,oi,an,Ls,vn,ni.layout.get("text-rotate").evaluate(vr,{},si),de));const ta=Ls.positionedLines.length===1;if(zr+=fv(hr,Vt,Jt,Ls,Vr,ni,le,vr,de,xn,_r.vertical?cl.horizontal:cl.horizontalOnly,ta?Zw(_r.horizontal):[Go],An,In,Br,Ei,si,tn),ta)break}_r.vertical&&(Ni+=fv(hr,Vt,Jt,_r.vertical,Vr,ni,le,vr,de,xn,cl.vertical,["vertical"],An,Zn,Br,Ei,si,tn));let Ts=-1;const Ha=(Io,Go)=>Io?Math.max(Io,Go):Go;Ts=Ha(bn,Ts),Ts=Ha(rn,Ts),Ts=Ha(di,Ts);const rh=Ts>-1?1:0;hr.glyphOffsetArray.length>=65535&&Jr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vr.sortKey!==void 0&&hr.addToSortKeyRanges(hr.symbolInstances.length,vr.sortKey),hr.symbolInstances.emplaceBack(Jt.x,Jt.y,ln.x,ln.y,ln.z,An.right>=0?An.right:-1,An.center>=0?An.center:-1,An.left>=0?An.left:-1,An.vertical>=0?An.vertical:-1,In,Zn,Eo,Ji!==void 0?Ji:hr.collisionBoxArray.length,Ji!==void 0?Ji+1:hr.collisionBoxArray.length,En!==void 0?En:hr.collisionBoxArray.length,En!==void 0?En+1:hr.collisionBoxArray.length,Qn!==void 0?Qn:hr.collisionBoxArray.length,Qn!==void 0?Qn+1:hr.collisionBoxArray.length,dn||hr.collisionBoxArray.length,dn?dn+1:hr.collisionBoxArray.length,ci,zr,Ni,sn,Nn,rh,0,Ga,ks,Ts,0,vo?1:0,Bn)})(i,jt,wr,ut,r,o,c,a,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,Ue,oe,x,0,ct,Tt,X,e,d,S,T,I,D,O,W,It)};if(re==="line")for(const ut of Am(e.geometry,0,0,Wt,Wt)){const jt=Gw(ut,Le,Pt,r.vertical||ie,o,Ie,Pe,i.overscaling,Wt);for(const qt of jt)ie&&Qw(i,ie.text,At,qt)||nt(ut,qt,I)}else if(re==="line-center"){for(const ut of e.geometry)if(ut.length>1){const jt=qw(ut,Pt,r.vertical||ie,o,Ie,Pe);jt&&nt(ut,jt,I)}}else if(e.type==="Polygon")for(const ut of xm(e.geometry,0)){const jt=$w(ut,16);nt(ut[0],new Vh(jt.x,jt.y,0,0,void 0),I)}else if(e.type==="LineString")for(const ut of e.geometry)nt(ut,new Vh(ut[0].x,ut[0].y,0,0,void 0),I);else if(e.type==="Point")for(const ut of e.geometry)for(const jt of ut)nt([jt],new Vh(jt.x,jt.y,0,0,void 0),I)}const Op=255,Dd=Op*th;function fv(i,e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W,X){const oe=function(J,ie,ce,Ie,Pe,Le,Ue,ct){const Pt=[];if(ie.positionedLines.length===0)return Pt;const Tt=Ie.layout.get("text-rotate").evaluate(Le,{})*Math.PI/180,At=function(ut){const jt=ut[0],qt=ut[1],wr=jt*qt;return wr>0?[jt,-qt]:wr<0?[-jt,qt]:jt===0?[qt,jt]:[qt,-jt]}(ce);let Nt=Math.abs(ie.top-ie.bottom);for(const ut of ie.positionedLines)Nt-=ut.lineOffset;const at=ie.positionedLines.length,It=Nt/at;let nt=ie.top-ce[1];for(let ut=0;ut<at;++ut){const jt=ie.positionedLines[ut];nt=Hw(ie,It,nt,ut);for(const qt of jt.positionedGlyphs){if(!qt.rect)continue;const wr=qt.rect||{};let hr=Nw+1,Jt=!0,Vt=1,$r=0;if(qt.image){const vr=Ue.get(qt.image.toString());if(!vr)continue;if(vr.sdf){Jr("SDF images are not supported in formatted text and will be ignored.");continue}Jt=!1,Vt=vr.pixelRatio,hr=Sf/Vt}const _r=(Pe||ct)&&qt.vertical,yr=qt.metrics.advance*qt.scale/2,Vr=qt.metrics,Kr=qt.rect;if(Kr===null)continue;ct&&ie.verticalizable&&($r=qt.image?yr-qt.metrics.width*qt.scale/2:0);const ni=Pe?[qt.x+yr,qt.y]:[0,0];let _i=[0,0],ci=[0,0],oi=!1;Pe||(_r?(ci=[qt.x+yr+At[0],qt.y+At[1]-$r],oi=!0):_i=[qt.x+yr+ce[0],qt.y+ce[1]-$r]);const an=Kr.w*qt.scale/(Vt*(qt.localGlyph?ac:1)),vn=Kr.h*qt.scale/(Vt*(qt.localGlyph?ac:1));let le,de,pt,$t;if(_r){const vr=qt.y-nt,Br=new Ot(-yr,yr-vr),Ti=-Math.PI/2,Ei=new Ot(...ci);le=new Ot(-yr+_i[0],_i[1]),le._rotateAround(Ti,Br)._add(Ei),le.x+=-vr+yr,le.y-=(Vr.left-hr)*qt.scale;const si=qt.image?Vr.advance*qt.scale:ds*qt.scale,tn=String.fromCodePoint(qt.glyph);kw(tn)?le.x+=(1-hr)*qt.scale:Lw(tn)?le.x+=si-Vr.height*qt.scale+(-hr-1)*qt.scale:le.x+=qt.image||Vr.width+2*hr===Kr.w&&Vr.height+2*hr===Kr.h?(si-vn)/2:(si-(Vr.height+2*hr)*qt.scale)/2,de=new Ot(le.x,le.y-an),pt=new Ot(le.x+vn,le.y),$t=new Ot(le.x+vn,le.y-an)}else{const vr=(Vr.left-hr)*qt.scale-yr+_i[0],Br=(-Vr.top-hr)*qt.scale+_i[1],Ti=vr+an,Ei=Br+vn;le=new Ot(vr,Br),de=new Ot(Ti,Br),pt=new Ot(vr,Ei),$t=new Ot(Ti,Ei)}if(Tt){let vr;vr=Pe?new Ot(0,0):oi?new Ot(At[0],At[1]):new Ot(ce[0],ce[1]),le._rotateAround(Tt,vr),de._rotateAround(Tt,vr),pt._rotateAround(Tt,vr),$t._rotateAround(Tt,vr)}const tr=new Ot(0,0),er=new Ot(0,0);Pt.push({tl:le,tr:de,bl:pt,br:$t,texPrimary:wr,texSecondary:void 0,writingMode:ie.writingMode,glyphOffset:ni,sectionIndex:qt.sectionIndex,isSDF:Jt,pixelOffsetTL:tr,pixelOffsetBR:er,minFontScaleX:0,minFontScaleY:0})}}return Pt}(0,o,y,c,d,g,a,i.allowVerticalPlacement),re=i.textSizeData;let B=null;re.kind==="source"?(B=[th*c.layout.get("text-size").evaluate(g,{},W)*D.textScaleFactor],B[0]>Dd&&Jr(`${i.layerIds[0]}: Value for "text-size" is >= ${Op}. Reduce your "text-size".`)):re.kind==="composite"&&(B=[th*D.compositeTextSizes[0].evaluate(g,{},W)*D.textScaleFactor,th*D.compositeTextSizes[1].evaluate(g,{},W)*D.textScaleFactor],(B[0]>Dd||B[1]>Dd)&&Jr(`${i.layerIds[0]}: Value for "text-size" is >= ${Op}. Reduce your "text-size".`)),i.addSymbols(i.text,oe,B,y,d,g,S,e,r,x.lineStartIndex,x.lineLength,R,O,W,X,!1);for(const J of T)I[J]=i.text.placedSymbolArray.length-1;return 4*oe.length}function o_(i){for(const e in i)return i[e];return null}function zm(i,e,r,o,a,c,d,g,y,x){let S=d.top,T=d.bottom,I=d.left,R=d.right;if(Gy(d)&&d.collisionPadding){const D=d.collisionPadding;I-=D[0],S-=D[1],R+=D[2],T+=D[3]}if(y){const D=new Ot(I,S),O=new Ot(R,S),W=new Ot(I,T),X=new Ot(R,T),oe=G(y);let re=new Ot(0,0);x&&(re=new Ot(x[0],x[1])),D._rotateAround(oe,re),O._rotateAround(oe,re),W._rotateAround(oe,re),X._rotateAround(oe,re),I=Math.min(D.x,O.x,W.x,X.x),R=Math.max(D.x,O.x,W.x,X.x),S=Math.min(D.y,O.y,W.y,X.y),T=Math.max(D.y,O.y,W.y,X.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,I,S,R,T,g,o,a,c),i.length-1}function s_(i){Gy(i)&&i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function Qw(i,e,r,o){const a=i.compareText;if(e in a){const c=a[e];for(let d=c.length-1;d>=0;d--)if(o.dist(c[d])<r)return!0}else a[e]=[];return a[e].push(o),!1}function pv(i,e){const r=i.fovAboveCenter,o=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,a=(i._camera.position[2]*i.worldSize-o)/Math.cos(i._pitch),c=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-i._pitch-r,.01));let d=Math.sin(i._pitch)*c+a;const g=a*(1/i._horizonShift);if(!i.elevation||i.elevation.exaggeration()===0){let y=Math.max(i.zoom-17,0);i.isOrthographic&&(y/=10),d*=1+y}return Math.min(1.01*d,g)}function Fp(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};const r=Math.pow(2,-i.z),o=i.x*r,a=(i.x+1)*r,c=i.y*r,d=(i.y+1)*r,g=Te(o),y=Te(a),x=Ae(c),S=Ae(d),T=e.project(g,x),I=e.project(y,x),R=e.project(y,S),D=e.project(g,S);let O=Math.min(T.x,I.x,R.x,D.x),W=Math.min(T.y,I.y,R.y,D.y),X=Math.max(T.x,I.x,R.x,D.x),oe=Math.max(T.y,I.y,R.y,D.y);const re=r/16;function B(ie,ce,Ie,Pe,Le,Ue){const ct=(Ie+Le)/2,Pt=(Pe+Ue)/2,Tt=e.project(Te(ct),Ae(Pt)),At=Math.max(0,O-Tt.x,W-Tt.y,Tt.x-X,Tt.y-oe);O=Math.min(O,Tt.x),X=Math.max(X,Tt.x),W=Math.min(W,Tt.y),oe=Math.max(oe,Tt.y),At>re&&(B(ie,Tt,Ie,Pe,ct,Pt),B(Tt,ce,ct,Pt,Le,Ue))}B(T,I,o,c,a,c),B(I,R,a,c,a,d),B(R,D,a,d,o,d),B(D,T,o,d,o,c),O-=re,W-=re,X+=re,oe+=re;const J=1/Math.max(X-O,oe-W);return{scale:J,x:O*J,y:W*J,x2:X*J,y2:oe*J,projection:e}}function mv(i,{x:e,y:r},o=0){return new Ot(((e-o)*i.scale-i.x)*Wt,(r*i.scale-i.y)*Wt)}const e2=Xe(new Float32Array(16));class kd{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new U(0,0)}projectTilePoint(e,r,o){return{x:e,y:r,z:0}}locationPoint(e,r,o,a=!0){return e._coordinatePoint(e.locationCoordinate(r,o),a)}pixelsPerMeter(e,r){return he(1,e)*r}pixelSpaceConversion(e,r,o){return 1}farthestPixelDistance(e){return pv(e,e.pixelsPerMeter)}pointCoordinate(e,r,o,a){const c=e.horizonLineFromTop(!1),d=new Ot(r,Math.max(c,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,r,o){const a=new Ot(r,o);if(e.elevation)return e.elevation.pointCoordinate(a);{const c=this.pointCoordinate(e,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const o=e.horizonLineFromTop();return r.y<o}createInversionMatrix(e,r){return e2}createTileMatrix(e,r,o){let a,c,d;const g=o.canonical,y=Xe(new Float64Array(16));if(this.isReprojectedInTileSpace){const x=Fp(g,this);a=1,c=x.x+o.wrap*x.scale,d=x.y,et(y,y,[a/x.scale,a/x.scale,e.pixelsPerMeter/r])}else a=r/e.zoomScale(g.z),c=(g.x+Math.pow(2,g.z)*o.wrap)*a,d=g.y*a;return Ke(y,y,[c,d,0]),et(y,y,[a/Wt,a/Wt,1]),y}upVector(e,r,o){return[0,0,1]}upVectorScale(e,r,o){return{metersToTile:1}}}class t2 extends kd{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,o]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(G(r));this.n=(a+Math.sin(G(o)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:o,c:a,r0:c}=this,d=G(e-this.center[0]),g=G(r),y=Math.sqrt(a-2*o*Math.sin(g))/o;return{x:y*Math.sin(d*o),y:y*Math.cos(d*o)-c,z:0}}unproject(e,r){const{n:o,c:a,r0:c}=this,d=c+r;let g=Math.atan2(e,Math.abs(d))*Math.sign(d);d*o<0&&(g-=Math.PI*Math.sign(e)*Math.sign(d));const y=G(this.center[0])*o;g=Qe(g,-Math.PI-y,Math.PI-y);const x=ke(K(g/o)+this.center[0],-180,180),S=Math.asin(ke((a-(e*e+d*d)*o*o)/(2*o),-1,1)),T=ke(K(S),-85.051129,Ge);return new U(x,T)}}const Bp=1.340264,Np=-.081106,Vp=893e-6,jp=.003796,Om=Math.sqrt(3)/2;class r2 extends kd{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Om*Math.sin(r)),a=o*o,c=a*a*a;return{x:.5*(e*Math.cos(o)/(Om*(Bp+3*Np*a+c*(7*Vp+9*jp*a)))/Math.PI+.5),y:1-.5*(o*(Bp+Np*a+c*(Vp+jp*a))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let o=r=(2*(1-r)-1)*Math.PI,a=o*o,c=a*a*a;for(let S,T,I,R=0;R<12&&(T=o*(Bp+Np*a+c*(Vp+jp*a))-r,I=Bp+3*Np*a+c*(7*Vp+9*jp*a),S=T/I,o=ke(o-S,-Math.PI/3,Math.PI/3),a=o*o,c=a*a*a,!(Math.abs(S)<1e-12));++R);const d=Om*e*(Bp+3*Np*a+c*(7*Vp+9*jp*a))/Math.cos(o),g=Math.asin(Math.sin(o)/Om),y=ke(180*d/Math.PI,-180,180),x=ke(180*g/Math.PI,-85.051129,Ge);return new U(y,x)}}class i2 extends kd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const o=360*(e-.5),a=ke(360*(.5-r),-85.051129,Ge);return new U(o,a)}}const Qf=Math.PI/2;function Fm(i){return Math.tan((Qf+i)/2)}class n2 extends kd{constructor(e){super(e),this.center=e.center||[0,30];const[r,o]=this.parallels=e.parallels||[30,30];let a=G(r),c=G(o);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const d=Math.cos(a),g=Fm(a);this.n=a===c?Math.sin(a):Math.log(d/Math.cos(c))/Math.log(Fm(c)/g),this.f=d*Math.pow(Fm(a),this.n)/this.n}project(e,r){r=G(r),this.southernCenter&&(r=-r),e=G(e-this.center[0]);const o=1e-6,{n:a,f:c}=this;c>0?r<-Qf+o&&(r=-Qf+o):r>Qf-o&&(r=Qf-o);const d=c/Math.pow(Fm(r),a);let g=d*Math.sin(a*e),y=c-d*Math.cos(a*e);return g=.5*(g/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:g,y:this.southernCenter?y:1-y,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:o,f:a}=this,c=a-r,d=Math.sign(c),g=Math.sign(o)*Math.sqrt(e*e+c*c);let y=Math.atan2(e,Math.abs(c))*d;c*o<0&&(y-=Math.PI*Math.sign(e)*d);const x=ke(K(y/o)+this.center[0],-180,180),S=ke(K(2*Math.atan(Math.pow(a/g,1/o))-Qf),-85.051129,Ge);return new U(x,this.southernCenter?-S:S)}}class gv extends kd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:ye(e),y:me(r),z:0}}unproject(e,r){const o=Te(e),a=Ae(r);return new U(o,a)}}const _v=G(Ge);class o2 extends kd{project(e,r){const o=(r=G(r))*r,a=o*o;return{x:.5*((e=G(e))*(.8707-.131979*o+a*(a*(.003971*o-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let o=r=(2*(1-r)-1)*Math.PI,a=25,c=0,d=o*o;do{d=o*o;const x=d*d;c=(o*(1.007226+d*(.015085+x*(.028874*d-.044475-.005916*x)))-r)/(1.007226+d*(.045255+x*(.259866*d-.311325-.005916*11*x))),o=ke(o-c,-_v,_v)}while(Math.abs(c)>1e-6&&--a>0);d=o*o;const g=ke(K(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=K(o);return new U(g,y)}}const yv=G(Ge);class s2 extends kd{project(e,r){r=G(r),e=G(e);const o=Math.cos(r),a=2/Math.PI,c=Math.acos(o*Math.cos(e/2)),d=Math.sin(c)/c,g=.5*(e*a+2*o*Math.sin(e/2)/d)||0,y=.5*(r+Math.sin(r)/d)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,r){let o=e=(2*e-.5)*Math.PI,a=r=(2*(1-r)-1)*Math.PI,c=25;const d=1e-6;let g=0,y=0;do{const x=Math.cos(a),S=Math.sin(a),T=2*S*x,I=S*S,R=x*x,D=Math.cos(o/2),O=Math.sin(o/2),W=2*D*O,X=O*O,oe=1-R*D*D,re=oe?1/oe:0,B=oe?Math.acos(x*D)*Math.sqrt(1/oe):0,J=.5*(2*B*x*O+2*o/Math.PI)-e,ie=.5*(B*S+a)-r,ce=.5*re*(R*X+B*x*D*I)+1/Math.PI,Ie=re*(W*T/4-B*S*O),Pe=.125*re*(T*O-B*S*R*W),Le=.5*re*(I*D+B*X*x)+.5,Ue=Ie*Pe-Le*ce;g=(ie*Ie-J*Le)/Ue,y=(J*Pe-ie*ce)/Ue,o=ke(o-g,-Math.PI,Math.PI),a=ke(a-y,-yv,yv)}while((Math.abs(g)>d||Math.abs(y)>d)&&--c>0);return new U(K(o),K(a))}}class vv extends kd{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(G(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:o,cosPhi:a}=this;return{x:G(e)*a*o+.5,y:-Math.sin(G(r))/a*o+.5,z:0}}unproject(e,r){const{scale:o,cosPhi:a}=this,c=-(r-.5)/o,d=ke(K((e-.5)/o)/a,-180,180),g=Math.asin(ke(c*a,-1,1)),y=ke(K(g),-85.051129,Ge);return new U(d,y)}}class a2 extends gv{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,o){const a=Jc(e,r,o);return jr(a,a,gf(ul(o))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,r,o){const a=q(r.lat,r.lng),c=qr([],a),d=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;dt(a,a,c,he(1,0)*Wt*d);const g=Xe(new Float64Array(16));return De(g,e.pixelMatrix,e.globeMatrix),jr(a,a,g),new Ot(a[0],a[1])}pixelsPerMeter(e,r){return he(1,0)*r}pixelSpaceConversion(e,r,o){const a=he(1,e)*r,c=Mr(he(1,45)*r,a,o);return this.pixelsPerMeter(e,r)/c}createTileMatrix(e,r,o){const a=wp(ul(o.canonical));return De(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,r){const{center:o}=e,a=gf(ul(r));return $e(a,a,G(o.lng)),st(a,a,G(o.lat)),et(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,r,o,a){return bp(e,r,o,!0)||new tt(0,0)}pointCoordinate3D(e,r,o){const a=this.pointCoordinate(e,r,o,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,r){return!bp(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(a,c){const d=a.cameraToCenterDistance,g=a._centerAltitude*c,y=a._camera,x=a._camera.forward(),S=Or([],or([],x,-d),[0,0,g]),T=a.worldSize/(2*Math.PI),I=[0,0,-T],R=a.width/a.height,D=Math.tan(a.fovAboveCenter),O=or([],y.up(),D),W=or([],y.right(),D*R),X=qr([],Or([],Or([],x,O),W)),oe=[];let re;if(new ll(S,X).closestPointOnSphere(I,T,oe)){const B=Or([],oe,I),J=zi([],B,S);re=Math.cos(a.fovAboveCenter)*fr(J)}else{const B=zi([],S,I),J=zi([],I,S);qr(J,J);const ie=fr(B)-T;re=Math.sqrt(ie*(ie+2*T));const ce=Math.acos(re/(T+ie))-Math.acos(Gr(x,J));re*=Math.cos(ce)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Qc(e.zoom);if(o>0){const a=pv(e,he(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Mr(r,a+c*(1-Math.cos(d)),Math.pow(o,10))}return r}upVector(e,r,o){return Jc(r,o,e,1)}upVectorScale(e){return{metersToTile:ku(Ad(ul(e)))}}}function xv(i){const e=i.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new gv(i);case"equirectangular":return new i2(i);case"naturalEarth":return new o2(i);case"equalEarth":return new r2(i);case"winkelTripel":return new s2(i);case"albers":return r?new vv(i):new t2(i);case"lambertConformalConic":return r?new vv(i):new n2(i);case"globe":return new a2(i)}throw new Error(`Invalid projection name: ${i.name}`)}const l2=Pd.VectorTileFeature.types,u2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bm(i,e,r,o,a,c,d,g,y,x,S,T,I){const R=g?Math.min(Dd,Math.round(g[0])):0,D=g?Math.min(Dd,Math.round(g[1])):0;i.emplaceBack(e,r,Math.round(32*o),Math.round(32*a),c,d,(R<<1)+(y?1:0),D,16*x,16*S,256*T,256*I)}function Nm(i,e,r){i.emplaceBack(e,r)}function Vm(i,e,r,o,a,c,d){i.emplaceBack(e,r,o,a,c,d)}function jm(i,e,r,o,a){i.emplaceBack(e,r,o,a),i.emplaceBack(e,r,o,a),i.emplaceBack(e,r,o,a),i.emplaceBack(e,r,o,a)}function c2(i){for(const e of i.sections)if(Uf(e.text))return!0;return!1}class a_{constructor(e){this.layoutVertexArray=new Wc,this.indexArray=new ao,this.programConfigurations=e,this.segments=new Sn,this.dynamicLayoutVertexArray=new jo,this.opacityVertexArray=new Mh,this.placedSymbolArray=new gd,this.iconTransitioningVertexArray=new ol,this.globeExtVertexArray=new Gs,this.zOffsetVertexArray=new Hc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,o,a,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tw.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Iw.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,u2,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Cw.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ew.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Aw.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ir(a_,"SymbolBuffers");class l_{constructor(e,r,o){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new o,this.segments=new Sn,this.collisionVertexArray=new Rh,this.collisionVertexArrayExt=new jo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Mw.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Pw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ir(l_,"CollisionBuffers");class Um{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xe([]),this.placementViewportMatrix=Xe([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xy(this.zoom,r["text-size"]),this.iconSizeData=Xy(this.zoom,r["icon-size"]);const o=this.layers[0].layout,a=o.get("symbol-sort-key"),c=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(d=>cl[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new a_(new nu(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new a_(new nu(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new yd,this.lineVertexArray=new uf,this.symbolInstances=new _d}calculateGlyphDependencies(e,r,o,a,c){for(const d of e){const g=d.codePointAt(0);if(g===void 0)break;if(r[g]=!0,a&&c&&g<=65535){const y=Dp[d];y&&(r[y.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const o=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Ug(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,r,o,a){const c=this.layers[0],d=c.layout,g=this.projection.name==="globe",y=d.get("text-font"),x=d.get("text-field"),S=d.get("icon-image"),[T,I]=d.get("icon-size-scale-range"),R=ke(r.scaleFactor||1,T,I),D=(x.value.kind!=="constant"||x.value.value instanceof N&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),O=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,W=d.get("symbol-sort-key");if(this.features=[],!D&&!O)return;const X=r.iconDependencies,oe=r.glyphDependencies,re=r.availableImages,B=new Zi(this.zoom);for(const{feature:J,id:ie,index:ce,sourceLayerIndex:Ie}of e){const Pe=c._featureFilter.needGeometry,Le=gr(J,Pe);if(!c._featureFilter.filter(B,Le,o))continue;if(Pe||(Le.geometry=ur(J,o,a)),g&&J.type!==1&&o.z<=5){const At=Le.geometry,Nt=.98078528056,at=(It,nt)=>Gr(Jc(It.x,It.y,o,1),Jc(nt.x,nt.y,o,1))<Nt;for(let It=0;It<At.length;It++)At[It]=Et(At[It],at)}let Ue,ct;if(D){const At=c.getValueAndResolveTokens("text-field",Le,o,re),Nt=N.factory(At);c2(Nt)&&(this.hasRTLText=!0),(!this.hasRTLText||Kn()==="unavailable"||this.hasRTLText&&Js.isParsed())&&(Ue=Dw(Nt,c,Le))}if(O){const At=c.getValueAndResolveTokens("icon-image",Le,o,re);ct=typeof At=="string"?ve.build(At):At}if(!Ue&&!ct)continue;const Pt=this.sortFeaturesByKey?W.evaluate(Le,{},o):void 0,Tt={id:ie,text:Ue,icon:ct,index:ce,sourceLayerIndex:Ie,geometry:Le.geometry,properties:J.properties,type:l2[J.type],sortKey:Pt};if(this.features.push(Tt),ct){const At=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Nt,iconSecondary:at}=cv(ct,this.iconSizeData,At["icon-size"],o,this.zoom,Tt,this.pixelRatio,R),It=Nt.id.toString();if(X.has(It)?X.get(It).push(Nt):X.set(It,[Nt]),at){const nt=at.id.toString();X.has(nt)?X.get(nt).push(at):X.set(nt,[at])}}if(Ue){const At=y.evaluate(Le,{},o).join(","),Nt=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cl.vertical)>=0;for(const at of Ue.sections)if(at.image){const It=at.image.getPrimary().scaleSelf(this.pixelRatio),nt=It.id.toString(),ut=X.get(nt)||[];ut.push(It),X.set(nt,ut)}else{const It=wl(Ue.toString()),nt=at.fontStack||At,ut=oe[nt]=oe[nt]||{};this.calculateGlyphDependencies(at.text,ut,Nt,this.allowVerticalPlacement,It)}}}if(d.get("symbol-placement")==="line"&&(this.features=function(J){const ie={},ce={},Ie=[];let Pe=0;function Le(Tt){Ie.push(J[Tt]),Pe++}function Ue(Tt,At,Nt){const at=ce[Tt];return delete ce[Tt],ce[At]=at,Ie[at].geometry[0].pop(),Ie[at].geometry[0]=Ie[at].geometry[0].concat(Nt[0]),at}function ct(Tt,At,Nt){const at=ie[At];return delete ie[At],ie[Tt]=at,Ie[at].geometry[0].shift(),Ie[at].geometry[0]=Nt[0].concat(Ie[at].geometry[0]),at}function Pt(Tt,At,Nt){const at=Nt?At[0][At[0].length-1]:At[0][0];return`${Tt}:${at.x}:${at.y}`}for(let Tt=0;Tt<J.length;Tt++){const At=J[Tt],Nt=At.geometry,at=At.text?At.text.toString():null;if(!at){Le(Tt);continue}const It=Pt(at,Nt),nt=Pt(at,Nt,!0);if(It in ce&&nt in ie&&ce[It]!==ie[nt]){const ut=ct(It,nt,Nt),jt=Ue(It,nt,Ie[ut].geometry);delete ie[It],delete ce[nt],ce[Pt(at,Ie[jt].geometry,!0)]=jt,Ie[ut].geometry=null}else It in ce?Ue(It,nt,Nt):nt in ie?ct(It,nt,Nt):(Le(Tt),ie[It]=Pe-1,ce[nt]=Pe-1)}return Ie.filter(Tt=>Tt.geometry)}(this.features)),d.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const J of r.elevationFeatures)this.elevationFeatureIdToIndex.set(J.id,this.elevationFeatures.length),this.elevationFeatures.push(J)}}else d.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((J,ie)=>J.sortKey-ie.sortKey)}update(e,r,o,a,c,d,g){this.text.programConfigurations.updatePaintArrays(e,r,c,o,a,d,g),this.icon.programConfigurations.updatePaintArrays(e,r,c,o,a,d,g)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);if(o.elevationFeatureIndex===65535)continue;const a=this.elevationFeatures[o.elevationFeatureIndex];if(a){const c=.05+a.pointElevation(new Ot(o.tileAnchorX,o.tileAnchorY));o.zOffset!==c&&(e=!0,o.zOffset=c)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(c,d,g)=>{o+=d,o>c.length&&c.resize(o);for(let y=-d;y<0;y++)c.emplace(y+o,g)},r=(c,d,g)=>{a+=d,a>c.length&&c.resize(a);for(let y=-d;y<0;y++)c.emplace(y+a,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,a=0;for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:y,numIconVertices:x}=d,S=d.zOffset,T=x>0;if((g>0||y>0)&&(e(this.text.zOffsetVertexArray,g,S),e(this.text.zOffsetVertexArray,y,S)),T){const{placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:R}=d;I>=0&&r(this.icon.zOffsetVertexArray,x,S),R>=0&&r(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,S)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=xv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:c}of r)this.lineVertexArray.emplaceBack(a,c);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,r,o,a,c,d,g,y,x,S,T,I,R,D,O,W){const X=e.indexArray,oe=e.layoutVertexArray,re=e.globeExtVertexArray,B=e.segments.prepareSegment(4*r.length,oe,X,this.canOverlap?d.sortKey:void 0),J=this.glyphOffsetArray.length,ie=B.vertexLength,ce=this.allowVerticalPlacement&&g===cl.vertical?Math.PI/2:0,Ie=d.text&&d.text.sections;for(let Le=0;Le<r.length;Le++){const{tl:Ue,tr:ct,bl:Pt,br:Tt,texPrimary:At,texSecondary:Nt,pixelOffsetTL:at,pixelOffsetBR:It,minFontScaleX:nt,minFontScaleY:ut,glyphOffset:jt,isSDF:qt,sectionIndex:wr}=r[Le],hr=B.vertexLength,Jt=jt[1];if(Bm(oe,x.x,x.y,Ue.x,Jt+Ue.y,At.x,At.y,o,qt,at.x,at.y,nt,ut),Bm(oe,x.x,x.y,ct.x,Jt+ct.y,At.x+At.w,At.y,o,qt,It.x,at.y,nt,ut),Bm(oe,x.x,x.y,Pt.x,Jt+Pt.y,At.x,At.y+At.h,o,qt,at.x,It.y,nt,ut),Bm(oe,x.x,x.y,Tt.x,Jt+Tt.y,At.x+At.w,At.y+At.h,o,qt,It.x,It.y,nt,ut),y){const{x:Vt,y:$r,z:_r}=y.anchor,[yr,Vr,Kr]=y.up;Vm(re,Vt,$r,_r,yr,Vr,Kr),Vm(re,Vt,$r,_r,yr,Vr,Kr),Vm(re,Vt,$r,_r,yr,Vr,Kr),Vm(re,Vt,$r,_r,yr,Vr,Kr),jm(e.dynamicLayoutVertexArray,Vt,$r,_r,ce)}else jm(e.dynamicLayoutVertexArray,x.x,x.y,x.z,ce);if(W){const Vt=Nt||At;Nm(e.iconTransitioningVertexArray,Vt.x,Vt.y),Nm(e.iconTransitioningVertexArray,Vt.x+Vt.w,Vt.y),Nm(e.iconTransitioningVertexArray,Vt.x,Vt.y+Vt.h),Nm(e.iconTransitioningVertexArray,Vt.x+Vt.w,Vt.y+Vt.h)}X.emplaceBack(hr,hr+1,hr+2),X.emplaceBack(hr+1,hr+2,hr+3),B.vertexLength+=4,B.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(jt[0]),Le!==r.length-1&&wr===r[Le+1].sectionIndex||e.programConfigurations.populatePaintArrays(oe.length,d,d.index,{},R,D,O,Ie&&Ie[wr])}const Pe=y?y.anchor:x;e.placedSymbolArray.emplaceBack(Pe.x,Pe.y,Pe.z,x.x,x.y,J,this.glyphOffsetArray.length-J,ie,S,T,x.segment,o?o[0]:0,o?o[1]:0,a[0],a[1],g,0,0,0,I,0)}_commitLayoutVertex(e,r,o,a,c,d,g){e.emplaceBack(r,o,a,c,d,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,r,o,a,c,d,g){const y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),x=y.vertexLength,S=g.tileAnchorX,T=g.tileAnchorY;for(let R=0;R<4;R++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,r,e.padding,g.zOffset),this._commitLayoutVertex(o.layoutVertexArray,a,c,d,S,T,new Ot(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,c,d,S,T,new Ot(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,c,d,S,T,new Ot(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,a,c,d,S,T,new Ot(e.x1,e.y2)),y.vertexLength+=4;const I=o.indexArray;I.emplaceBack(x,x+1),I.emplaceBack(x+1,x+2),I.emplaceBack(x+2,x+3),I.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,o,a,c,d){for(let g=a;g<c;g++){const y=o.get(g),x=this.getSymbolInstanceTextSize(e,d,r,g);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,r,o,a,c,d){for(let g=a;g<c;g++){const y=o.get(g),x=this.getSymbolInstanceIconSize(e,r,d.placedIconSymbolIndex);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,r,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new l_(Ph,zy.members,ol),this.iconCollisionBox=new l_(Ph,zy.members,ol);const a=Lp(this.iconSizeData,e),c=Lp(this.textSizeData,e,o);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,r,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(c,e,r,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,r,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(a,e,r,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,r,o,a){const c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),d=e_(this.textSizeData,e,c)/ds;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,r,o){const a=this.icon.placedSymbolArray.get(o),c=e_(this.iconSizeData,e,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,r,o,a){e.emplaceBack(r,-o,-o,a),e.emplaceBack(r,o,-o,a),e.emplaceBack(r,o,o,a),e.emplaceBack(r,-o,o,a)}_updateTextDebugCollisionBoxes(e,r,o,a,c,d,g){for(let y=a;y<c;y++){const x=o.get(y),S=this.getSymbolInstanceTextSize(e,d,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,x.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,r,o,a,c,d,g){for(let y=a;y<c;y++){const x=o.get(y),S=this.getSymbolInstanceIconSize(e,r,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,S,x.padding,d.zOffset)}}updateCollisionDebugBuffers(e,r,o,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Lp(this.iconSizeData,e,a),d=Lp(this.textSizeData,e,o);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(d,e,r,y.textBoxStartIndex,y.textBoxEndIndex,y,o),this._updateTextDebugCollisionBoxes(d,e,r,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y,o),this._updateIconDebugCollisionBoxes(c,e,r,y.iconBoxStartIndex,y.iconBoxEndIndex,y,a),this._updateIconDebugCollisionBoxes(c,e,r,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,o,a,c,d,g,y,x){const S={};if(r<o){const{x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B,featureIndex:J}=e.get(r);S.textBox={x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B},S.textFeatureIndex=J}if(a<c){const{x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B,featureIndex:J}=e.get(a);S.verticalTextBox={x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B},S.verticalTextFeatureIndex=J}if(d<g){const{x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B,featureIndex:J}=e.get(d);S.iconBox={x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B},S.iconFeatureIndex=J}if(y<x){const{x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B,featureIndex:J}=e.get(y);S.verticalIconBox={x1:T,y1:I,x2:R,y2:D,padding:O,projectedAnchorX:W,projectedAnchorY:X,projectedAnchorZ:oe,tileAnchorX:re,tileAnchorY:B},S.verticalIconFeatureIndex=J}return S}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const o=e.placedSymbolArray.get(r),a=o.vertexStartIndex+4*o.numGlyphs;for(let c=o.vertexStartIndex;c<a;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),o=Math.cos(e),a=[],c=[],d=[];for(let g=0;g<this.symbolInstances.length;++g){d.push(g);const y=this.symbolInstances.get(g);a.push(0|Math.round(r*y.tileAnchorX+o*y.tileAnchorY)),c.push(y.featureIndex)}return d.sort((g,y)=>a[g]-a[y]||c[y]-c[g]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:x}=o;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&d!==a&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let bv,wv,u_;ir(Um,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Um.addDynamicAttributes=jm;class Sv{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ma,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ir(Sv,"FormatSectionOverride",{omit:["defaultValue"]});const c_=()=>u_||(u_={layout:bv||(bv=new kn({"symbol-placement":new Ut(Ze.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(Ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(Ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ar(Ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(Ze.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ut(Ze.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ut(Ze.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ut(Ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ut(Ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(Ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(Ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new ar(Ze.layout_symbol["icon-size"]),"icon-size-scale-range":new Ut(Ze.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ar(Ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ar(Ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new ar(Ze.layout_symbol["icon-image"]),"icon-rotate":new ar(Ze.layout_symbol["icon-rotate"]),"icon-padding":new Ut(Ze.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(Ze.layout_symbol["icon-keep-upright"]),"icon-offset":new ar(Ze.layout_symbol["icon-offset"]),"icon-anchor":new ar(Ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(Ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(Ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(Ze.layout_symbol["text-rotation-alignment"]),"text-field":new ar(Ze.layout_symbol["text-field"]),"text-font":new ar(Ze.layout_symbol["text-font"]),"text-size":new ar(Ze.layout_symbol["text-size"]),"text-size-scale-range":new Ut(Ze.layout_symbol["text-size-scale-range"]),"text-max-width":new ar(Ze.layout_symbol["text-max-width"]),"text-line-height":new ar(Ze.layout_symbol["text-line-height"]),"text-letter-spacing":new ar(Ze.layout_symbol["text-letter-spacing"]),"text-justify":new ar(Ze.layout_symbol["text-justify"]),"text-radial-offset":new ar(Ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(Ze.layout_symbol["text-variable-anchor"]),"text-anchor":new ar(Ze.layout_symbol["text-anchor"]),"text-max-angle":new Ut(Ze.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(Ze.layout_symbol["text-writing-mode"]),"text-rotate":new ar(Ze.layout_symbol["text-rotate"]),"text-padding":new Ut(Ze.layout_symbol["text-padding"]),"text-keep-upright":new Ut(Ze.layout_symbol["text-keep-upright"]),"text-transform":new ar(Ze.layout_symbol["text-transform"]),"text-offset":new ar(Ze.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(Ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ut(Ze.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(Ze.layout_symbol["text-optional"]),visibility:new Ut(Ze.layout_symbol.visibility)})),paint:wv||(wv=new kn({"icon-opacity":new ar(Ze.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ar(Ze.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ar(Ze.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ar(Ze.paint_symbol["text-emissive-strength"]),"icon-color":new ar(Ze.paint_symbol["icon-color"]),"icon-halo-color":new ar(Ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new ar(Ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ar(Ze.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(Ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(Ze.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ut(Ze.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ar(Ze.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ar(Ze.paint_symbol["text-occlusion-opacity"]),"text-color":new ar(Ze.paint_symbol["text-color"],{runtimeType:zo,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new ar(Ze.paint_symbol["text-halo-color"]),"text-halo-width":new ar(Ze.paint_symbol["text-halo-width"]),"text-halo-blur":new ar(Ze.paint_symbol["text-halo-blur"]),"text-translate":new Ut(Ze.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(Ze.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ut(Ze.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ut(Ze.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ut(Ze.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ut(Ze.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ar(Ze.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},u_);class qm extends hs{constructor(e,r,o,a){super(e,c_(),r,o,a),this._colorAdjustmentMatrix=Xe([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const a=[];for(const c of o)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,o,a){return this._saturation===e&&this._contrast===r&&this._brightnessMin===o&&this._brightnessMax===a||(this._colorAdjustmentMatrix=function(c,d,g,y){c=Fn(c),d=Gn(d);const x=ze(),S=c/3,T=1-2*S,I=[T,S,S,0,S,T,S,0,S,S,T,0,0,0,0,1],R=.5-.5*d,D=y-g;return De(x,[D,0,0,0,0,D,0,0,0,0,D,0,g,g,g,1],[d,0,0,0,0,d,0,0,0,0,d,0,R,R,R,1]),De(x,x,I),x}(e,r,o,a),this._saturation=e,this._contrast=r,this._brightnessMin=o,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,o,a){const c=this.layout.get(e).evaluate(r,{},o,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Wu(d.value)||!c?c:function(g,y){return y.replace(/{([^{}]+)}/g,(x,S)=>S in g?String(g[S]):"")}(r.properties,c)}createBucket(e){return new Um(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of c_().paint.overridableProperties){if(!qm.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),o=new Sv(r),a=new $u(o,r.property.specification,this.scope,this.options);let c=null;c=r.value.kind==="constant"||r.value.kind==="source"?new xu("source",a):new rl("composite",a,r.value.zoomStops,r.value.interpolationType),this.paint._values[e]=new tu(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&qm.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const o=e.get("text-field"),a=c_().paint.properties[r];let c=!1;const d=g=>{for(const y of g)if(a.overrides&&a.overrides.hasOverride(y))return void(c=!0)};if(o.value.kind==="constant"&&o.value.value instanceof N)d(o.value.value.sections);else if(o.value.kind==="source"){const g=x=>{c||(x instanceof Ft&&xt(x.value)===fl?d(x.value.sections):x instanceof Pn?d(x.sections):x.eachChild(g))},y=o.value;y._styleExpression&&g(y._styleExpression.expression)}return c}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,o){return{config:new Pl(this,{zoom:r,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Tv,Ev,Iv,Av;var h_=Fi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function d_(i){switch(i){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function f_(i){switch(i){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class p_{constructor(e,r,o,a){this.context=e,this.format=o,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:a&&a.premultiply})}update(e,r){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:c}=this,{gl:d}=c,{x:g,y}=r&&r.position?r.position:{x:0,y:0},x=g+o,S=y+a;!this.size||this.size[0]===x&&this.size[1]===S||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!r||r.premultiply!==!1));const T=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&x>0&&S>0){const I=this.useMipmap?Math.floor(Math.log2(Math.max(x,S)))+1:1;d.texStorage2D(d.TEXTURE_2D,I,this.format,x,S),this.size=[x,S]}if(this.size)if(T)d.texSubImage2D(d.TEXTURE_2D,0,g,y,d_(this.format),f_(this.format),e);else{const I=e.data;I&&d.texSubImage2D(d.TEXTURE_2D,0,g,y,o,a,d_(this.format),f_(this.format),I)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,r,o=!1){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,o,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,o),this.wrapS=o),a!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Gm{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapS=r)}}function Hm(i,e,r,o,a,c,d,g){const y=[i,e,1,r,o,1,a,c,1],x=[d,g,1],S=Ne([],y),[T,I,R]=Dn(x,x,S);return Ye(y,y,[T,0,0,0,I,0,0,0,R])}function Cv(i,e,r,o,a,c,d,g){const y=function(x,S,T,I,R,D,O,W){const X=Hm(0,0,1,0,1,1,0,1),oe=Hm(x,S,T,I,R,D,O,W);return Ye(oe,oe,Ne([],X))}(i,e,r,o,a,c,d,g);return[y[2]/y[8]/Wt,y[5]/y[8]/Wt]}function $m(i){return[i[0],Math.min(Math.max(i[1],-85.051129),Ge)]}class Mv extends Ca{constructor(e,r,o,a){super(),this.id=e,this.dispatcher=o,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new Ks("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Mn(this.map._requestManager.transformRequest(this.url,oa.Image),(o,a)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new Ou(o)):a&&(this.image=a instanceof HTMLImageElement?we.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Gm(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ks("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Gm||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],o=e[0][1];for(const c of e)c[1]>o&&(o=c[1]),c[1]<r&&(r=c[1]);const a=(o+r)/2;if(a>Ge?this.onNorthPole=!0:a<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(tt.fromLngLat);this.tileID=function(d){let g=1/0,y=1/0,x=-1/0,S=-1/0;for(const O of d)g=Math.min(g,O.x),y=Math.min(y,O.y),x=Math.max(x,O.x),S=Math.max(S,O.y);const T=Math.max(x-g,S-y),I=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),R=Math.pow(2,I);let D=Math.floor((g+x)/2*R);return D>1&&(D-=1),new yi(I,D,Math.floor((y+S)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ks("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const X in this.tiles){const oe=this.tiles[X];oe.state!=="loaded"&&(oe.state="loaded",oe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Fp(new yi(0,0,0),this.map.transform.projection),o=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(X){const oe=X[1].x-X[0].x,re=X[1].y-X[0].y,B=X[2].x-X[1].x,J=X[2].y-X[1].y,ie=X[3].x-X[2].x,ce=X[3].y-X[2].y,Ie=X[0].x-X[3].x,Pe=X[0].y-X[3].y,Le=oe*J-B*re,Ue=B*ce-ie*J,ct=ie*Pe-Ie*ce,Pt=Ie*re-oe*Pe;return Le>0&&Ue>0&&ct>0&&Pt>0||Le<0&&Ue<0&&ct<0&&Pt<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Fp(this.tileID,this.map.transform.projection),[c,d,g,y]=this.coordinates.map(X=>{const oe=a.projection.project(X[0],X[1]);return mv(a,oe)._round()});this.perspectiveTransform=Cv(c.x,c.y,d.x,d.y,g.x,g.y,y.x,y.y);const x=this._boundsArray=new Au;x.emplaceBack(c.x,c.y,0,0),x.emplaceBack(d.x,d.y,Wt,0),x.emplaceBack(y.x,y.y,0,Wt),x.emplaceBack(g.x,g.y,Wt,Wt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,h_.members),this.boundsSegments=Sn.simpleSegment(0,0,4,2);const S=[],T=[$m((I=this.coordinates)[0]),$m(I[1]),$m(I[2]),$m(I[3])];var I;const[R,D,O,W]=function(X){let oe=X[0][0],re=oe,B=X[0][1],J=B;for(let ie=1;ie<X.length;ie++)X[ie][0]<oe?oe=X[ie][0]:X[ie][0]>re&&(re=X[ie][0]),X[ie][1]<B?B=X[ie][1]:X[ie][1]>J&&(J=X[ie][1]);return[oe,B,re-oe,J-B]}(T);{const X=new Au,[oe,re,B,J]=function(at){let It=at[0].x,nt=It,ut=at[0].y,jt=ut;for(let qt=1;qt<at.length;qt++)at[qt].x<It?It=at[qt].x:at[qt].x>nt&&(nt=at[qt].x),at[qt].y<ut?ut=at[qt].y:at[qt].y>jt&&(jt=at[qt].y);return[It,ut,nt-It,jt-ut]}(o),ie=at=>[(at.x-oe)/B,(at.y-re)/J],[ce,Ie,Pe,Le]=o.map(ie),Ue=function(at,It,nt,ut,jt,qt,wr,hr){const Jt=Hm(0,0,1,0,1,1,0,1);return Ye(Jt,Jt,Ne([],Hm(at,It,nt,ut,jt,qt,wr,hr)))}(ce[0],ce[1],Ie[0],Ie[1],Pe[0],Pe[1],Le[0],Le[1]);this.elevatedGlobePerspectiveTransform=Cv(ce[0],ce[1],Ie[0],Ie[1],Pe[0],Pe[1],Le[0],Le[1]);const ct=(at,It)=>{S.push(at.lng);const nt=Math.round((at.lng-R)/O*Wt),ut=Math.round((at.lat-D)/W*Wt),jt=ie(It),qt=Dn([],[jt[0],jt[1],1],Ue),wr=Math.round(qt[0]/qt[2]*Wt),hr=Math.round(qt[1]/qt[2]*Wt);X.emplaceBack(nt,ut,wr,hr)},Pt=o[3].x-o[0].x,Tt=o[3].y-o[0].y,At=o[2].x-o[1].x,Nt=o[2].y-o[1].y;for(let at=0;at<65;at++){const It=at/64,nt=[o[0].x+It*Pt,o[0].y+It*Tt],ut=[o[1].x+It*At,o[1].y+It*Nt],jt=ut[0]-nt[0],qt=ut[1]-nt[1];for(let wr=0;wr<65;wr++){const hr=wr/64,Jt={x:nt[0]+jt*hr,y:nt[1]+qt*hr};ct(r.projection.unproject(Jt.x,Jt.y),Jt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(X,h_.members)}{this.maxLongitudeTriangleSize=0;let X=[],oe=new ao;const re=(B,J,ie)=>{oe.emplaceBack(B,J,ie);const ce=S[B],Ie=S[J],Pe=S[ie],Le=Math.min(Math.min(ce,Ie),Pe),Ue=Math.max(Math.max(ce,Ie),Pe)-Le;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),X.push(Le+Ue/2)};for(let B=0;B<64;B++)for(let J=0;J<64;J++){const ie=65*B+J,ce=ie+1,Ie=ie+65,Pe=Ie+1;re(ie,Ie,ce),re(ce,Ie,Pe)}[X,oe]=function(B,J){const ie=Array.from({length:B.length},(Pe,Le)=>Le);ie.sort((Pe,Le)=>B[Pe]-B[Le]);const ce=[],Ie=new ao;for(let Pe=0;Pe<ie.length;Pe++){const Le=ie[Pe];ce.push(B[Le]);const Ue=3*Le,ct=Ue+1;Ie.emplaceBack(J.uint16[Ue],J.uint16[ct],J.uint16[ct+1])}return[ce,Ie]}(X,oe),this.elevatedGlobeTrianglesCenterLongitudes=X,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(oe)}this.elevatedGlobeSegments=Sn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/Wt,0,W/Wt,0,0,D,R,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,o=r.gl;!this._dirty||this.texture instanceof Gm||(this.texture?this.texture.update(this.image):(this.texture=new p_(r,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let a=(c=e+180)+360*Math.round((o[0]-c)/360);var c;const d=new Sn,g=(T,I)=>{d.segments.push({vertexOffset:0,primitiveOffset:T,vertexLength:r.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-a)<=y){const T=$o(o,0,o.length,a+y);return T===o.length||g(T,go(o,T+1,o.length,a+360-y)-T),d}a<o[0]&&(a+=360);const x=go(o,0,o.length,a-y);if(x===o.length)return g(0,o.length),d;g(0,x-0);const S=$o(o,x+1,o.length,a+y);return S!==o.length&&g(S,o.length-S),d}}const h2=(Math.pow(256,2)-1)/16907520;class Pv extends hs{constructor(e,r,o,a){super(e,{layout:Iv||(Iv=new kn({visibility:new Ut(Ze.layout_raster.visibility)})),paint:Av||(Av=new kn({"raster-opacity":new Ut(Ze.paint_raster["raster-opacity"]),"raster-color":new So(Ze.paint_raster["raster-color"]),"raster-color-mix":new Ut(Ze.paint_raster["raster-color-mix"]),"raster-color-range":new Ut(Ze.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ut(Ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(Ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(Ze.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(Ze.paint_raster["raster-saturation"]),"raster-contrast":new Ut(Ze.paint_raster["raster-contrast"]),"raster-resampling":new Ut(Ze.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(Ze.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ut(Ze.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ut(Ze.paint_raster["raster-array-band"]),"raster-elevation":new Ut(Ze.paint_raster["raster-elevation"]),"raster-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},r,o,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Mv&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[o,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(a)||o===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=Ri({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,a])}}let Rv,Dv,kv,Lv,zv;class Ov extends hs{constructor(e,r,o,a){super(e,{layout:Rv||(Rv=new kn({visibility:new Ut(Ze["layout_raster-particle"].visibility)})),paint:Dv||(Dv=new kn({"raster-particle-array-band":new Ut(Ze["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ut(Ze["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new So(Ze["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ut(Ze["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ut(Ze["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ut(Ze["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ut(Ze["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ut(Ze["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},r,o,a),this._updateColorRamp(),this.lastInvalidatedAt=we.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ri({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=we.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class d2 extends hs{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function m_(i,e,r){const o=[0,0,1],a=ko([]);return oo(a,a,r?-G(i)+Math.PI:G(i)),mo(a,a,-G(e)),Xn(o,o,a),qr(o,o)}function Fv(i,e){const r=Wm(i.projection,i.zoom,i.width,i.height),o=function(c,d,g,y,x){const S=new U(g.lng-180*Ld,g.lat),T=new U(g.lng+180*Ld,g.lat),I=c.project(S.lng,S.lat),R=c.project(T.lng,T.lat),D=-Math.atan2(R.y-I.y,R.x-I.x),O=tt.fromLngLat(g);O.y=ke(O.y,-1+Ld,1-Ld);const W=O.toLngLat(),X=c.project(W.lng,W.lat),oe=tt.fromLngLat(W);oe.x+=Ld;const re=oe.toLngLat(),B=c.project(re.lng,re.lat),J=Nv(B.x-X.x,B.y-X.y,D),ie=tt.fromLngLat(W);ie.y+=Ld;const ce=ie.toLngLat(),Ie=c.project(ce.lng,ce.lat),Pe=Nv(Ie.x-X.x,Ie.y-X.y,D),Le=Math.abs(J.x)/Math.abs(Pe.y),Ue=Xe([]);bt(Ue,Ue,-D*(1-(x?0:y)));const ct=Xe([]);return et(ct,ct,[1,1-(1-Le)*y,1]),ct[4]=-Pe.x/Pe.y*y,bt(ct,ct,D),De(ct,Ue,ct),ct}(i.projection,0,i.center,r,e),a=Bv(i);return et(o,o,[a,a,1]),o}function Bv(i){const e=i.projection,r=Wm(i.projection,i.zoom,i.width,i.height),o=g_(e,i.center),a=g_(e,U.convert(e.center));return Math.pow(2,o*r+(1-r)*a)}function Wm(i,e,r,o,a=1/0){const c=i.range;if(!c)return 0;const d=Math.min(a,Math.max(r,o)),g=Math.log(d/1024)/Math.LN2;return Fe(c[0]+g,c[1]+g,e)}const Ld=1/4e4;function g_(i,e){const r=ke(e.lat,-85.051129,Ge),o=new U(e.lng-180*Ld,r),a=new U(e.lng+180*Ld,r),c=i.project(o.lng,r),d=i.project(a.lng,r),g=tt.fromLngLat(o),y=tt.fromLngLat(a),x=d.x-c.x,S=d.y-c.y,T=y.x-g.x,I=y.y-g.y,R=Math.sqrt((T*T+I*I)/(x*x+S*S));return Math.log(R)/Math.LN2}function Nv(i,e,r){const o=Math.cos(r),a=Math.sin(r);return{x:i*o-e*a,y:i*a+e*o}}function Vv(i,e,r){Xe(i),bt(i,i,G(e[2])),st(i,i,G(e[0])),$e(i,i,G(e[1])),et(i,i,r),De(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Zm(i,e,r,o,a,c,d,g){const y=[r[0]-e[0],r[1]-e[1],0],x=[o[0]-e[0],o[1]-e[1],0];if(fr(y)<1e-12||fr(x)<1e-12)return ko(i);const S=pi([],y,x);qr(S,S),ri(x,o,e),y[2]=(c-a)*g,x[2]=(d-a)*g;const T=y;return pi(T,y,x),qr(T,T),Lo(i,S,T)}function __(i,e,r=!1){const o=Qc(e.zoom),a=function(c,d,g){const y=d.worldSize,x=[c[12],c[13],c[14]],S=Ae(x[1]/y),T=Te(x[0]/y),I=Xe([]),R=he(1,S)*y,D=he(1,0)*y*mt(S,d.zoom),O=1/Cd(y);let W=D*O;if(g){const B=Wm(d.projection,d.zoom,d.width,d.height,1024);W=O*d.projection.pixelSpaceConversion(d.center.lat,y,B)}const X=q(S,T);Or(X,X,or([],qr([],X),R*W*x[2]));const oe=function(B){const J=[B[0],B[1],B[2]];let ie=[0,1,0];const ce=pi([],ie,J);return pi(ie,J,ce),bi(ie)===0&&(ie=[0,1,0],pi(ce,J,ie)),qr(ce,ce),qr(ie,ie),qr(J,J),[ce[0],ce[1],ce[2],0,ie[0],ie[1],ie[2],0,J[0],J[1],J[2],0,B[0],B[1],B[2],1]}(X);et(I,I,[W,W,W*R]),Ke(I,I,[-x[0],-x[1],-x[2]]);const re=De([],d.globeMatrix,oe);return De(re,re,I),De(re,re,c),re}(i,e,r);if(o>0){const c=function(d,g){const y=g.worldSize,x=he(1,0)*y*mt(g.center.lat,g.zoom)/Cd(y),S=he(1,g.center.lat)*y,T=Xe([]);return $e(T,T,G(g.center.lng)),st(T,T,G(g.center.lat)),Ke(T,T,[0,0,m]),et(T,T,[x,x,x*S]),Ke(T,T,[g.point.x-.5*y,g.point.y-.5*y,0]),De(T,T,d),De(T,g.globeMatrix,T)}(i,e);return function(d,g,y){const x=(D,O,W)=>{const X=fr(D),oe=fr(O),re=Lu(D,O,W);return or(re,re,1/fr(re)*Mr(X,oe,W))},S=x([d[0],d[1],d[2]],[g[0],g[1],g[2]],y),T=x([d[4],d[5],d[6]],[g[4],g[5],g[6]],y),I=x([d[8],d[9],d[10]],[g[8],g[9],g[10]],y),R=Lu([d[12],d[13],d[14]],[g[12],g[13],g[14]],y);return[S[0],S[1],S[2],0,T[0],T[1],T[2],0,I[0],I[1],I[2],0,R[0],R[1],R[2],1]}(a,c,o)}return a}function jv(i,e,r,o){const a=yn.projectAabbCorners(o,r);let c=Number.MAX_VALUE,d=-1;for(let x=0;x<a.length;++x){const S=a[x];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<c&&(d=x,c=S[2])}const g=x=>new Ot(a[x][0],a[x][1]);let y;switch(d){case 0:case 6:y=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:y=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:y=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:y=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(Ir(i,y))return c}const f2=Fi([{name:"a_pos_3f",components:3,type:"Float32"}]),p2=Fi([{name:"a_color_3f",components:3,type:"Float32"}]),m2=Fi([{name:"a_color_4f",components:4,type:"Float32"}]),g2=Fi([{name:"a_uv_2f",components:2,type:"Float32"}]),_2=Fi([{name:"a_normal_3f",components:3,type:"Float32"}]),y2=Fi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),v2=Fi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Uv={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Xm{constructor(e,r,o,a){this.message=(e?`${e}: `:"")+o,a&&(this.identifier=a),r!=null&&r.__line__&&(this.line=r.__line__)}}function y_(i,e){const r=i.indexOf("://")===-1;try{return new URL(i,r&&e?"http://example.com":void 0),!0}catch{return!1}}class qv{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Gv{constructor(){this.instancedDataArray=new Zo,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class v_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,r){}populate(e,r,o,a){this.tileToMeter=je(o);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:g,index:y,sourceLayerIndex:x}of e){const S=g??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),T=gr(d,c);if(!this.layers[0]._featureFilter.filter(new Zi(this.zoom),T,o))continue;const I={id:S,sourceLayerIndex:x,index:y,geometry:c?T.geometry:ur(d,o,a),properties:d.properties,type:d.type,patterns:{}},R=this.addFeature(I,I.geometry,T);R&&r.featureIndex.insert(d,I.geometry,y,x,this.index,this.instancesPerModel[R].instancedDataArray.length,Wt/32)}this.lookup=null}update(e,r,o,a){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const g in e)d.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(d.features[d.idToFeaturesIndex[g]],e[g],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const o=this.instancesPerModel[r];for(const a of o.features){const c=this.layers[0],d=a.feature,g=this.canonical,y=c.paint.get("model-rotation").evaluate(d,{},g),x=c.paint.get("model-scale").evaluate(d,{},g),S=c.paint.get("model-translation").evaluate(d,{},g);xo(a.rotation,y)&&xo(a.scale,x)&&xo(a.translation,S)||(this.evaluate(a,a.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,r,o,a){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Ug(this.activeReplacements,c))return!1;this.activeReplacements=c;let d=!1;for(const g in this.instancesPerModel){const y=this.instancesPerModel[g],x=y.instancedDataArray;for(const S of y.features){const T=S.instancedDataOffset,I=S.instancedDataCount;for(let R=0;R<I;R++){const D=16*(R+T);let O=x.float32[D+0];const W=O>Wt;O=W?O-Wt:O;const X=Math.floor(O),oe=x.float32[D+1];let re=!1;for(const B of this.activeReplacements)if(!X0(B,o,Uv.Model,a)&&!(B.min.x>X||X>B.max.x||B.min.y>oe||oe>B.max.y)&&(re=ty(ey(X,oe,e.canonical,B.footprintTileId.canonical),B.footprint),re))break;x.float32[D]=re?O+Wt:O,d=d||re!==W}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const o=this.instancesPerModel[r];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,y2.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const o=this.instancesPerModel[r];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const r of this.modelUris)e.removeModel(r,"",!0)}addFeature(e,r,o){const a=this.layers[0],c=a.layout.get("model-id").evaluate(o,{},this.canonical);if(!c)return Jr(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),c;(y_(c,!1)||this.styleDefinedModelURLs[c]!==void 0)&&(this.modelUris.includes(c)||this.modelUris.push(c)),this.instancesPerModel[c]||(this.instancesPerModel[c]=new Gv);const d=this.instancesPerModel[c],g=d.instancedDataArray,y=new qv(o,g.length);for(const x of r)for(const S of x){if(S.x<0||S.x>=Wt||S.y<0||S.y>=Wt)continue;const T=(this.lookupDim-1)/Wt,I=this.lookupDim*(S.y*T|0)+S.x*T|0;if(this.lookup){if(this.lookup[I]!==0)continue;this.lookup[I]=1}this.instanceCount++;const R=g.length;g.resize(R+1),d.instancesEvaluatedElevation.push(0),g.float32[16*R]=S.x,g.float32[16*R+1]=S.y}return y.instancedDataCount=d.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(y),this.evaluate(y,{},d,!1)),c}getModelUris(){return this.modelUris}evaluate(e,r,o,a){const c=this.layers[0],d=e.feature,g=this.canonical,y=e.rotation=c.paint.get("model-rotation").evaluate(d,r,g),x=e.scale=c.paint.get("model-scale").evaluate(d,r,g),S=e.translation=c.paint.get("model-translation").evaluate(d,r,g),T=c.paint.get("model-color").evaluate(d,r,g);T.a=c.paint.get("model-color-mix-intensity").evaluate(d,r,g);const I=[];this.maxVerticalOffset<S[2]&&(this.maxVerticalOffset=S[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),Vv(I,y,x);const R=Math.round(100*T.a)+T.b/1.05;for(let D=0;D<e.instancedDataCount;++D){const O=e.instancedDataOffset+D,W=16*O,X=o.instancedDataArray.float32;let oe=0;a&&(oe=X[W+6]-o.instancesEvaluatedElevation[O]);const re=0|X[W+1];X[W]=(0|X[W])+T.r/1.05,X[W+1]=re+T.g/1.05,X[W+2]=R,X[W+3]=1/(g.z>10?this.tileToMeter:je(g,re)),X[W+4]=S[0],X[W+5]=S[1],X[W+6]=S[2]+oe,X[W+7]=I[0],X[W+8]=I[1],X[W+9]=I[2],X[W+10]=I[4],X[W+11]=I[5],X[W+12]=I[6],X[W+13]=I[8],X[W+14]=I[9],X[W+15]=I[10],o.instancesEvaluatedElevation[O]=S[2]}}}let Hv,$v;ir(v_,"ModelBucket",{omit:["layers"]}),ir(Gv,"PerModelAttributes"),ir(qv,"ModelFeature");const Ef=64,ep={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Wv(i,e,r,o,a,c,d,g,y,x=!1){const S=r.zoom,T=r.project(o),I=mt(o.lat,S),R=1/I;Xe(i),Ke(i,i,[T.x+d[0]*R,T.y+d[1]*R,d[2]]);let D=1,O=1;const W=r.worldSize;if(x){if(r.projection.name==="mercator"){let B=0;r.elevation&&(B=r.elevation.getAtPointOrZero(new tt(T.x/W,T.y/W),0));const J=eo([],[T.x,T.y,B,1],r.projMatrix)[3]/r.cameraToCenterDistance;D=J,O=J*mt(r.center.lat,S)}else if(r.projection.name==="globe"){const B=__(i,r),J=[0,0,0,1];eo(J,J,De([],r.projMatrix,B));const ie=J[3]/r.cameraToCenterDistance,ce=Qc(S),Ie=r.projection.pixelsPerMeter(o.lat,W)*mt(o.lat,S),Pe=r.projection.pixelsPerMeter(r.center.lat,W)*mt(r.center.lat,S);D=ie/Mr(Ie,ft(r.center.lat),ce),O=ie*I/Ie,D*=Pe,O*=Pe}}else D=R;et(i,i,[D,D,O]);const X=[...i],oe=e.orientation,re=[];if(Vv(re,[oe[0]+a[0],oe[1]+a[1],oe[2]+a[2]],c),De(i,X,re),g&&r.elevation){let B=0;const J=[];if(y&&r.elevation){B=function(ce,Ie,Pe,Le,Ue){const ct=Ie.elevation;if(!ct)return 0;const Pt=yn.projectAabbCorners(Pe,Le),Tt=he(1,Ue.lat)*Ie.worldSize,At=function(Vt,$r){const _r=[0,0,1],yr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Vr of yr){const Kr=Vt[Vr.corners[0]],ni=Vt[Vr.corners[1]],_i=Vt[Vr.corners[2]],ci=[ni[0]-Kr[0],ni[1]-Kr[1],$r*(ni[2]-Kr[2])],oi=pi(ci,ci,[_i[0]-Kr[0],_i[1]-Kr[1],$r*(_i[2]-Kr[2])]);qr(oi,oi),Vr.dotProductWithUp=Gr(oi,_r)}return yr.sort((Vr,Kr)=>Vr.dotProductWithUp-Kr.dotProductWithUp),yr[0].corners}(Pt,Tt),Nt=Pt[At[0]],at=Pt[At[1]],It=Pt[At[2]],nt=Pt[At[3]],ut=ct.getAtPointOrZero(new tt(Nt[0]/Ie.worldSize,Nt[1]/Ie.worldSize),0),jt=ct.getAtPointOrZero(new tt(at[0]/Ie.worldSize,at[1]/Ie.worldSize),0),qt=ct.getAtPointOrZero(new tt(It[0]/Ie.worldSize,It[1]/Ie.worldSize),0),wr=ct.getAtPointOrZero(new tt(nt[0]/Ie.worldSize,nt[1]/Ie.worldSize),0),hr=(ut+wr)/2,Jt=(jt+qt)/2;return hr>Jt?jt<qt?Zm(ce,at,nt,Nt,jt,wr,ut,Tt):Zm(ce,It,Nt,nt,qt,ut,wr,Tt):ut<wr?Zm(ce,Nt,at,It,ut,jt,qt,Tt):Zm(ce,nt,It,at,wr,qt,jt,Tt),Math.max(hr,Jt)}(J,r,e.aabb,i,o);const ie=De([],Fr([],J),re);De(i,X,ie)}else B=r.elevation.getAtPointOrZero(new tt(T.x/W,T.y/W),0);B!==0&&(i[14]+=B)}}function Up(i,e,r=!1){i.uploaded||(i.gfxTexture=new p_(e,i.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:i.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function x2(i,e,r){i.indexBuffer=e.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=e.createVertexBuffer(i.vertexArray,f2.members,!1,!0),i.normalArray&&(i.normalBuffer=e.createVertexBuffer(i.normalArray,_2.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=e.createVertexBuffer(i.texcoordArray,g2.members,!1,!0)),i.colorArray&&(i.colorBuffer=e.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?p2:m2).members,!1,!0)),i.featureArray&&(i.pbrBuffer=e.createVertexBuffer(i.featureArray,v2.members,!0)),i.segments=Sn.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const o=i.material;o.pbrMetallicRoughness.baseColorTexture&&Up(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Up(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Up(o.normalTexture,e),o.occlusionTexture&&Up(o.occlusionTexture,e,r),o.emissionTexture&&Up(o.emissionTexture,e)}function x_(i,e,r){if(i.meshes)for(const o of i.meshes)x2(o,e,r);if(i.children)for(const o of i.children)x_(o,e,r)}function Ym(i){if(i.meshes)for(const e of i.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(i.children)for(const e of i.children)Ym(e)}function b_(i){if(i.meshes)for(const r of i.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(i.children)for(const r of i.children)b_(r)}class tp{constructor(e,r,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=o}static create(e,r,o){const a=o||e.findDEMTileFor(r);if(!a||!a.dem)return;const c=a.dem,d=a.tileID,g=1<<r.canonical.z-d.canonical.z;return new tp(a,c.dim/Wt/g,[(r.canonical.x/g-d.canonical.x)*c.dim,(r.canonical.y/g-d.canonical.y)*c.dim])}tileCoordToPixel(e,r){const o=r*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(o);return new Ot(a,c)}getElevationAt(e,r,o,a){const c=e*this._scale+this._offset[0],d=r*this._scale+this._offset[1],g=Math.floor(c),y=Math.floor(d),x=this._dem;return a=!!a,o?Mr(Mr(x.get(g,y,a),x.get(g,y+1,a),d-y),Mr(x.get(g+1,y,a),x.get(g+1,y+1,a),d-y),c-g):x.get(g,y,a)}getElevationAtPixel(e,r,o){return this._dem.get(e,r,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*he(1,e)*this._dem.stride}}const w_=new Float32Array(262144),If=new Uint8Array(262144);function Zv(i){let e=0;if(i.meshes)for(const r of i.meshes)e=Math.max(e,r.aabb.max[2]);if(i.children)for(const r of i.children)e=Math.max(e,Zv(r));return e}function Xv(i,e,r){if(i.meshes)for(const o of i.meshes){if(o.aabb.min[0]===1/0)continue;const a=yn.applyTransform(o.aabb,i.matrix);r.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(i.children)for(const o of i.children)Xv(o,e,r)}const Yv=["","wall","door","roof","window","lamp","logo"];class Kv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Zv(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=yn.applyTransformFast(o.aabb,this.node.matrix),r.encapsulate(o.transformedAabb)),e++;this.aabb=r}return this.aabb}}class Km{constructor(e,r,o,a,c,d,g){this.id=o,this.layers=e,this.layerIds=this.layers.map(y=>y.fqid),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.modelTraits|=ep.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=ep.HasMapboxMeshFeatures),c&&(this.modelTraits|=ep.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const y of r)this.nodesInfo.push(new Kv(y)),Xv(y,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(const o of this.getNodesInfo()){const a=o.node;a.footprint&&r.push({footprint:a.footprint,id:e})}}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const o=r?this.stateDependentLayers:this.layers;if(!pn(e,this.states))for(const a of o)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const o of r){const a=o.node;this.uploaded?this.updatePbrBuffer(a):x_(a,e,!0)}for(const o of r)Ym(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),r=!0);return r}needsReEvaluation(e,r,o){const a=e.transform.projectionOptions,c=e.style.getBrightness(),d=this.brightness!==c;if(!this.uploaded||this.dirty||a.name!==this.projection.name||qp(o.paint.get("model-color").value,d)||qp(o.paint.get("model-color-mix-intensity").value,d)||qp(o.paint.get("model-roughness").value,d)||qp(o.paint.get("model-emissive-strength").value,d)||qp(o.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=a,this.brightness=c;const g=this.getNodesInfo();for(const y of g)y.state=null;return!0}return!1}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),a=this.id.canonical;for(const c of o){const d=c.feature;c.evaluatedScale=r.paint.get("model-scale").evaluate(d,{},a)}}evaluate(e,r){const o=this.getNodesInfo();for(const a of o){if(!a.node.meshes)continue;const c=a.feature,d=r&&r[c.id];if(pn(d,a.state))continue;a.state=structuredClone(d);const g=a.node.meshes&&a.node.meshes[0].featureData,y=a.evaluatedColor[2],x=a.evaluatedRMEA[2],S=this.id.canonical;if(a.hasTranslucentParts=!1,g){for(let T=0;T<Yv.length;T++){const I=Yv[T];I.length&&(c.properties.part=I);const R=e.paint.get("model-color").evaluate(c,d,S).toRenderColor(null),D=e.paint.get("model-color-mix-intensity").evaluate(c,d,S);a.evaluatedColor[T]=[R.r,R.g,R.b,D],a.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(c,d,S),a.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(c,d,S),a.evaluatedRMEA[T][3]=R.a,a.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,d,S),!a.hasTranslucentParts&&R.a<1&&(a.hasTranslucentParts=!0)}delete c.properties.part,w2(a,y!==a.evaluatedColor[2]||x!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,d,S);a.evaluatedScale=e.paint.get("model-scale").evaluate(c,d,S),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,o,a){const c=e.findDEMTileFor(o);if(c&&(c.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const d=tp.create(e,o,c);if(!d)return;this.modelTraits&ep.HasMapboxMeshFeatures&&this.updateDEM(e,d,o,a);for(const g of this.getNodesInfo()){const y=g.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const x=y.footprint.vertices;let S=d.getElevationAt(x[0].x,x[0].y,!0,!0);for(let T=1;T<x.length;T++)S=Math.min(S,d.getElevationAt(x[T].x,x[T].y,!0,!0));y.elevation=S}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,o,a){let c=r._dem._modifiedForSources[a];if(c===void 0&&(r._dem._modifiedForSources[a]=[],c=r._dem._modifiedForSources[a]),c.includes(o.canonical))return;const d=r._dem.dim;c.push(o.canonical);let g=!1;for(const y of this.getNodesInfo()){const x=y.node;if(!x.footprint||!x.footprint.grid)continue;const S=x.footprint.grid,T=r.tileCoordToPixel(S.min.x,S.min.y),I=r.tileCoordToPixel(S.max.x,S.max.y),R=Math.min(Math.min(d-I.y,T.x),Math.min(T.y,d-I.x));if(R<0)continue;const D=ke(R,2,5);let O=Math.max(0,T.x-D),W=Math.max(0,T.y-D),X=Math.min(I.x+D,d-1),oe=Math.min(I.y+D,d-1);for(let ie=W;ie<=oe;++ie)for(let ce=O;ce<=X;++ce)If[ie*d+ce]=255;let re=0,B=0;for(let ie=0;ie<S.cellsY;++ie)for(let ce=0;ce<S.cellsX;++ce){if(!S.cells[ie*S.cellsX+ce])continue;const Ie=r.tileCoordToPixel(S.min.x+ce/S.xScale,S.min.y+ie/S.yScale),Pe=r.tileCoordToPixel(S.min.x+(ce+1)/S.xScale,S.min.y+(ie+1)/S.yScale);for(let Le=Ie.y;Le<=Math.min(Pe.y+1,d-1);++Le)for(let Ue=Ie.x;Ue<=Math.min(Pe.x+1,d-1);++Ue)If[Le*d+Ue]===255&&(If[Le*d+Ue]=0,re+=r.getElevationAtPixel(Ue,Le),B++)}const J=re/B;O=Math.max(1,T.x-D),W=Math.max(1,T.y-D),X=Math.min(I.x+D,d-2),oe=Math.min(I.y+D,d-2),g=!0;for(let ie=W;ie<=oe;++ie)for(let ce=O;ce<=X;++ce)If[ie*d+ce]===0&&(w_[ie*d+ce]=r._dem.set(ce,ie,J));for(let ie=1;ie<D;++ie){O=Math.max(1,T.x-ie),W=Math.max(1,T.y-ie),X=Math.min(I.x+ie,d-2),oe=Math.min(I.y+ie,d-2);for(let ce=W;ce<=oe;++ce)for(let Ie=O;Ie<=X;++Ie){const Pe=ce*d+Ie;if(If[Pe]===255){let Le=0,Ue=0,ct=-1,Pt=-1;for(let Tt=-1;Tt<=1;++Tt)for(let At=-1;At<=1;++At){const Nt=(ce+Tt)*d+Ie+At;if(If[Nt]>=ie)continue;const at=w_[Nt],It=Math.abs(at);It>Ue&&(Le=at,Ue=It,ct=At,Pt=Tt)}if(Ue>.1){const Tt=1-(ie+.5*Math.abs(ct*Pt))/D;let At=r._dem.get(Ie,ce)+Le*Tt;const Nt=r._dem.get(Ie+ct,ce+Pt),at=r._dem.get(Ie-ct,ce-Pt,!0);(At-Nt)*(At-at)>0&&(At=(Nt+at)/2),w_[Pe]=r._dem.set(Ie,ce,At),If[Pe]=ie}}}}}g&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=we.now())}setFilter(e){this.filter=e?ec(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Zi(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)Ym(r.node),b_(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const o=r.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const d=a[c].node;a[c].hiddenByReplacement=!!d.footprint&&!o.find(g=>g.footprint===d.footprint)}}getHeightAtTileCoord(e,r){const o=this.getNodesInfo(),a=[],c=[0,0,0],d=Xe([]);for(let g=0;g<this.nodesInfo.length;g++){const y=o[g],x=y.node.meshes[0],S=x.transformedAabb;if(e<S.min[0]||r<S.min[1]||e>S.max[0]||r>S.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};We(d,y.node.matrix),c[0]=e,c[1]=r,jr(c,c,d);const T=(c[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*Ef|0,I=Math.min(63,(c[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*Ef|0)*Ef+Math.min(63,T),R=x.heightmap[I];if(!(R<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:R,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new Ot(e,r),new Ot(e,r),a),a.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function qp(i,e){return i instanceof xu&&!i.isLightConstant&&e}function b2(i,e,r,o,a,c,d,g){let y=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,S=240&e|(240&e)>>4;r[3]>0&&(y=Mr(y,255*r[0],r[3]),x=Mr(x,255*r[1],r[3]),S=Mr(S,255*r[2],r[3]));const T=y<<8|x,I=S<<8|Math.floor(255*o[3]),R=function(ie){const ce=ke(ie,0,2);return Math.min(Math.round(.5*ce*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],D=ke(a[0],0,1),O=ke(a[1],0,1),W=ke(a[2],0,1),X=ke(a[3],0,1);let oe,re,B,J;if(D!==O&&d!==c&&O!==D){const ie=d-c;re=1/(ie*(O-D)),B=-(c+ie*D)/(ie*(O-D));const ce=ke(a[4],-1,1);J=Math.pow(10,ce),oe=255*W<<8|255*X}else oe=65535,re=0,B=1,J=1;if(i.emplaceBack(T,I,R,oe,re,B,J),g){const ie=g.length;g.clear();for(let ce=0;ce<ie;ce++)g.emplaceBack(T,I,R,oe,re,B,J)}}function w2(i,e,r){const o=i.node;let a=0;const c=r&ep.HasMeshoptCompression;for(const d of o.meshes){if(o.lights&&o.lightMeshIndex===a||!d.featureData)continue;d.featureArray=new Xo,d.featureArray.reserve(d.featureData.length);let g=e;for(const y of d.featureData){const x=c?65535&y:y>>16&65535,S=c?y>>16&65535:65535&y,T=(15&S)<8?15&S:0,I=i.evaluatedRMEA[T],R=i.evaluatedColor[T],D=i.emissionHeightBasedParams[T];let O;if(g&&T===2&&o.lights&&(O=new Xo,O.resize(10*o.lights.length)),b2(d.featureArray,x,R,I,D,d.aabb.min[2],d.aabb.max[2],O),O&&g){g=!1;const W=o.meshes[o.lightMeshIndex];W.featureArray=O,W.featureArray._trim()}}d.featureArray._trim(),a++}}function Jv(i,e,r,o){const a=1<<i.z;e.lat=Ae((o/Wt+i.y)/a),e.lng=Te((r/Wt+i.x)/a)}ir(Km,"Tiled3dModelBucket",{omit:["layers"]}),ir(Kv,"Tiled3dModelFeature");const S2={circle:class extends hs{constructor(i,e,r,o){super(i,{layout:Gi||(Gi=new kn({"circle-sort-key":new ar(Ze.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ut(Ze.layout_circle["circle-elevation-reference"]),visibility:new Ut(Ze.layout_circle.visibility)})),paint:on||(on=new kn({"circle-radius":new ar(Ze.paint_circle["circle-radius"]),"circle-color":new ar(Ze.paint_circle["circle-color"]),"circle-blur":new ar(Ze.paint_circle["circle-blur"]),"circle-opacity":new ar(Ze.paint_circle["circle-opacity"]),"circle-translate":new Ut(Ze.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(Ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(Ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(Ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ar(Ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ar(Ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ar(Ze.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ut(Ze.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}createBucket(i){return new nr(i)}queryRadius(i){const e=i;return ti("circle-radius",this,e)+ti("circle-stroke-width",this,e)+cn(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,o,a,c,d,g){const y=en(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return pe(i,o,c,d,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,e,r){const o=H(this);return{config:new Pl(this,{zoom:e,lut:r}),defines:o,overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends hs{createBucket(i){return new Rr(i)}constructor(i,e,r,o){super(i,{layout:Er||(Er=new kn({visibility:new Ut(Ze.layout_heatmap.visibility)})),paint:Yr||(Yr=new kn({"heatmap-radius":new ar(Ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ar(Ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(Ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new So(Ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(Ze.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ri({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return ti("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,o,a,c,d,g){const y=this.paint.get("heatmap-radius").evaluate(e,r);return pe(i,o,c,d,g,!0,!0,new Ot(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,e,r){return i==="heatmap"?{config:new Pl(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends hs{constructor(i,e,r,o){super(i,{layout:ui||(ui=new kn({visibility:new Ut(Ze.layout_hillshade.visibility)})),paint:gi||(gi=new kn({"hillshade-illumination-direction":new Ut(Ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ut(Ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(Ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(Ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(Ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(Ze.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ut(Ze.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,e,r){return{overrideFog:!1}}},fill:class extends hs{constructor(i,e,r,o){super(i,{layout:G0||(G0=new kn({"fill-sort-key":new ar(Ze.layout_fill["fill-sort-key"]),visibility:new Ut(Ze.layout_fill.visibility),"fill-elevation-reference":new Ut(Ze.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ar(Ze.layout_fill["fill-construct-bridge-guard-rail"])})),paint:H0||(H0=new kn({"fill-antialias":new Ut(Ze.paint_fill["fill-antialias"]),"fill-opacity":new ar(Ze.paint_fill["fill-opacity"]),"fill-color":new ar(Ze.paint_fill["fill-color"]),"fill-outline-color":new ar(Ze.paint_fill["fill-outline-color"]),"fill-translate":new Ut(Ze.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(Ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new ar(Ze.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ut(Ze.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ut(Ze.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ar(Ze.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ar(Ze.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ar(Ze.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(i,e,r){return{config:new Pl(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(i,e){super.recalculate(i,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Ng(i)}queryRadius(){return cn(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,o,a,c){return!i.queryGeometry.isAboveHorizon&&li(Li(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(i){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return i!=null?e&&!i:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends hs{constructor(i,e,r,o){super(i,{layout:gy||(gy=new kn({visibility:new Ut(Ze["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ut(Ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:_y||(_y=new kn({"fill-extrusion-opacity":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ar(Ze["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ut(Ze["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Im(i)}queryRadius(){return cn(this.paint.get("fill-extrusion-translate"))}is3D(i){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,e,r,o,a,c,d,g,y){const x=en(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),S=this.paint.get("fill-extrusion-height").evaluate(e,r),T=this.paint.get("fill-extrusion-base").evaluate(e,r),I=[0,0],R=g&&c.elevation,D=c.elevation?c.elevation.exaggeration():1,O=i.tile.getBucket(this);if(R&&O instanceof Im){const B=O.centroidVertexArray,J=y+1;J<B.length&&(I[0]=B.geta_centroid_pos0(J),I[1]=B.geta_centroid_pos1(J))}if(I[0]===0&&I[1]===1)return!1;c.projection.name==="globe"&&(o=my([o],[new Ot(0,0),new Ot(Wt,Wt)],i.tileID.canonical).map(B=>B.polygon).flat());const W=R?g:null,[X,oe]=function(B,J,ie,ce,Ie,Pe,Le,Ue,ct,Pt,Tt){return B.projection.name==="globe"?function(At,Nt,at,It,nt,ut,jt,qt,wr,hr,Jt){const Vt=[],$r=[],_r=At.projection.upVectorScale(Jt,At.center.lat,At.worldSize).metersToTile,yr=[0,0,0,1],Vr=[0,0,0,1],Kr=(_i,ci,oi,an)=>{_i[0]=ci,_i[1]=oi,_i[2]=an,_i[3]=1},ni=py();at>0&&(at+=ni),It+=ni;for(const _i of Nt){const ci=[],oi=[];for(const an of _i){const vn=an.x+nt.x,le=an.y+nt.y,de=At.projection.projectTilePoint(vn,le,Jt),pt=At.projection.upVector(Jt,an.x,an.y);let $t=at,tr=It;if(jt){const er=Sy(vn,le,at,It,jt,qt,wr,hr);$t+=er.base,tr+=er.top}at!==0?Kr(yr,de.x+pt[0]*_r*$t,de.y+pt[1]*_r*$t,de.z+pt[2]*_r*$t):Kr(yr,de.x,de.y,de.z),Kr(Vr,de.x+pt[0]*_r*tr,de.y+pt[1]*_r*tr,de.z+pt[2]*_r*tr),jr(yr,yr,ut),jr(Vr,Vr,ut),ci.push(new wf(yr[0],yr[1],yr[2])),oi.push(new wf(Vr[0],Vr[1],Vr[2]))}Vt.push(ci),$r.push(oi)}return[Vt,$r]}(B,J,ie,ce,Ie,Pe,Le,Ue,ct,Pt,Tt):Le?function(At,Nt,at,It,nt,ut,jt,qt,wr){const hr=[],Jt=[],Vt=[0,0,0,1];for(const $r of At){const _r=[],yr=[];for(const Vr of $r){const Kr=Vr.x+It.x,ni=Vr.y+It.y,_i=Sy(Kr,ni,Nt,at,ut,jt,qt,wr);Vt[0]=Kr,Vt[1]=ni,Vt[2]=_i.base,Vt[3]=1,eo(Vt,Vt,nt),Vt[3]=Math.max(Vt[3],1e-5);const ci=new wf(Vt[0]/Vt[3],Vt[1]/Vt[3],Vt[2]/Vt[3]);Vt[0]=Kr,Vt[1]=ni,Vt[2]=_i.top,Vt[3]=1,eo(Vt,Vt,nt),Vt[3]=Math.max(Vt[3],1e-5);const oi=new wf(Vt[0]/Vt[3],Vt[1]/Vt[3],Vt[2]/Vt[3]);_r.push(ci),yr.push(oi)}hr.push(_r),Jt.push(yr)}return[hr,Jt]}(J,ie,ce,Ie,Pe,Le,Ue,ct,Pt):function(At,Nt,at,It,nt){const ut=[],jt=[],qt=nt[8]*Nt,wr=nt[9]*Nt,hr=nt[10]*Nt,Jt=nt[11]*Nt,Vt=nt[8]*at,$r=nt[9]*at,_r=nt[10]*at,yr=nt[11]*at;for(const Vr of At){const Kr=[],ni=[];for(const _i of Vr){const ci=_i.x+It.x,oi=_i.y+It.y,an=nt[0]*ci+nt[4]*oi+nt[12],vn=nt[1]*ci+nt[5]*oi+nt[13],le=nt[2]*ci+nt[6]*oi+nt[14],de=nt[3]*ci+nt[7]*oi+nt[15],pt=an+qt,$t=vn+wr,tr=le+hr,er=Math.max(de+Jt,1e-5),vr=an+Vt,Br=vn+$r,Ti=le+_r,Ei=Math.max(de+yr,1e-5);Kr.push(new wf(pt/er,$t/er,tr/er)),ni.push(new wf(vr/Ei,Br/Ei,Ti/Ei))}ut.push(Kr),jt.push(ni)}return[ut,jt]}(J,ie,ce,Ie,Pe)}(c,o,T,S,x,d,W,I,D,c.center.lat,i.tileID.canonical),re=i.queryGeometry;return function(B,J,ie){let ce=1/0;li(ie,J)&&(ce=wy(ie,J[0]));for(let Ie=0;Ie<J.length;Ie++){const Pe=J[Ie],Le=B[Ie];for(let Ue=0;Ue<Pe.length-1;Ue++){const ct=Pe[Ue],Pt=[ct,Pe[Ue+1],Le[Ue+1],Le[Ue],ct];Ir(ie,Pt)&&(ce=Math.min(ce,wy(ie,Pt)))}}return ce!==1/0&&ce}(X,oe,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends hs{constructor(i,e,r,o){const a=ky();super(i,a,e,r,o),a.layout&&(this.layout=new il(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ju,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=(()=>{if(Rp)return Rp;const r=ky();return Rp=new Sw(r.paint.properties["line-width"].specification),Rp.useIntegerZoom=!0,Rp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new $g(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,e,r){const o=Ry(this);return{config:new Pl(this,{zoom:e,lut:r}),defines:o,overrideFog:!1}}queryRadius(i){const e=i,r=Ly(ti("line-width",this,e),ti("line-gap-width",this,e)),o=ti("line-offset",this,e);return r/2+Math.abs(o)+cn(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,o,a,c){if(i.queryGeometry.isAboveHorizon)return!1;const d=Li(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,i.pixelToTileUnitsFactor),g=i.pixelToTileUnitsFactor/2*Ly(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),y=this.paint.get("line-offset").evaluate(e,r);return y&&(o=function(x,S){const T=[],I=new Ot(0,0);for(let R=0;R<x.length;R++){const D=x[R],O=[];for(let W=0;W<D.length;W++){const X=D[W],oe=D[W+1],re=W===0?I:X.sub(D[W-1])._unit()._perp(),B=W===D.length-1?I:oe.sub(X)._unit()._perp(),J=re._add(B)._unit();J._mult(1/(J.x*B.x+J.y*B.y)),O.push(J._mult(S)._add(X))}T.push(O)}return T}(o,y*i.pixelToTileUnitsFactor)),function(x,S,T){for(let I=0;I<S.length;I++){const R=S[I];if(x.length>=3){for(let D=0;D<R.length;D++)if(Ki(x,R[D]))return!0}if(Xi(x,R,T))return!0}return!1}(d,o,g)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(i){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:qm,background:class extends hs{constructor(i,e,r,o){super(i,{layout:Tv||(Tv=new kn({visibility:new Ut(Ze.layout_background.visibility)})),paint:Ev||(Ev=new kn({"background-pitch-alignment":new Ut(Ze.paint_background["background-pitch-alignment"]),"background-color":new Ut(Ze.paint_background["background-color"]),"background-pattern":new Ut(Ze.paint_background["background-pattern"]),"background-opacity":new Ut(Ze.paint_background["background-opacity"]),"background-emissive-strength":new Ut(Ze.paint_background["background-emissive-strength"]),"background-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,e,r){return{overrideFog:!1}}is3D(i){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Pv,"raster-particle":Ov,sky:class extends hs{constructor(i,e,r,o){super(i,{layout:kv||(kv=new kn({visibility:new Ut(Ze.layout_sky.visibility)})),paint:Lv||(Lv=new kn({"sky-type":new Ut(Ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ut(Ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ut(Ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ut(Ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ut(Ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new So(Ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ut(Ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ut(Ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ut(Ze.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ri({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),a=!o,c=i.style.light,d=c.properties.get("position");return a&&c.properties.get("anchor")==="viewport"&&Jr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?m_(d.azimuthal,90-d.polar,e):m_(o[0],90-o[1],e)}const r=this.paint.get("sky-gradient-center");return m_(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends hs{constructor(i,e,r,o){super(i,{paint:zv||(zv=new kn({}))},e,null)}},model:class extends hs{constructor(i,e,r,o){super(i,{layout:Hv||(Hv=new kn({visibility:new Ut(Ze.layout_model.visibility),"model-id":new ar(Ze.layout_model["model-id"])})),paint:$v||($v=new kn({"model-opacity":new ar(Ze.paint_model["model-opacity"]),"model-rotation":new ar(Ze.paint_model["model-rotation"]),"model-scale":new ar(Ze.paint_model["model-scale"]),"model-translation":new ar(Ze.paint_model["model-translation"]),"model-color":new ar(Ze.paint_model["model-color"]),"model-color-mix-intensity":new ar(Ze.paint_model["model-color-mix-intensity"]),"model-type":new Ut(Ze.paint_model["model-type"]),"model-cast-shadows":new Ut(Ze.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ut(Ze.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ut(Ze.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ar(Ze.paint_model["model-emissive-strength"]),"model-roughness":new ar(Ze.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ar(Ze.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ut(Ze.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ut(Ze.paint_model["model-front-cutoff"]),"model-color-use-theme":new ar({type:"string",default:"default","property-type":"data-driven"})}))},e,r,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new v_(i)}getProgramIds(){return["model"]}is3D(i){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof Km?Wt-1:0}queryIntersectsFeature(i,e,r,o,a,c){if(!this.modelManager)return!1;const d=this.modelManager,g=i.tile.getBucket(this);if(!(g&&g instanceof v_))return!1;for(const y in g.instancesPerModel){const x=g.instancesPerModel[y],S=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(S)){const T=x.features[x.idToFeaturesIndex[S]],I=d.getModel(y,this.scope);if(!I)return!1;let R=ze();const D=new U(0,0),O=g.canonical;let W=Number.MAX_VALUE;for(let X=0;X<T.instancedDataCount;++X){const oe=16*(T.instancedDataOffset+X),re=x.instancedDataArray.float32,B=[re[oe+4],re[oe+5],re[oe+6]];Jv(O,D,re[oe],0|re[oe+1]),Wv(R,I,c,D,T.rotation,T.scale,B,!1,!1,!1),c.projection.name==="globe"&&(R=__(R,c));const J=De([],c.projMatrix,R),ie=i.queryGeometry,ce=jv(ie.isPointQuery()?ie.screenBounds:ie.screenGeometry,c,J,I.aabb);ce!=null&&(W=Math.min(ce,W))}return W!==Number.MAX_VALUE&&W}}return!1}_handleOverridablePaintPropertyUpdate(i,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const e=this._transitionablePaint._values[i];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof rl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends hs{constructor(i,e,r,o){super(i,{layout:$0||($0=new kn({"clip-layer-types":new Ut(Ze.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ut(Ze.layout_clip["clip-layer-scope"])})),paint:W0||(W0=new kn({}))},e,r,o)}recalculate(i,e){super.recalculate(i,e)}createBucket(i){return new Z0(i)}is3D(i){return!0}}};class T2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class E2{constructor(){this.tasks={},this.taskQueue=[],Nr(["process"],this),this.invoker=new T2(this.process),this.nextId=0}add(e,r){const o=this.nextId++,a=function({type:c,isSymbolTile:d,zoom:g}){return g=g||0,c==="message"?0:c!=="maybePrepare"||d?c!=="parseTile"||d?c==="parseTile"&&d?300-g:c==="maybePrepare"&&d?400-g:500:200-g:100-g}(r);if(a===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:r,priority:a,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<r&&(r=c.priority,e=a)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class Qv{constructor(e,r,o){this.target=e,this.parent=r,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Nr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new E2}send(e,r,o,a,c=!1,d){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=d,this.callbacks[g]=o);const y=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!o,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:bl(r,y)},y),{cancel:()=>{o&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const o=r.id;if(o&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const a=this.cancelCallbacks[o];delete this.cancelCallbacks[o],a&&a.cancel()}else if(r.mustQueue||Pi(self)){const a=this.callbacks[o],c=this.scheduler.add(()=>this.processTask(o,r),a&&a.metadata||{type:"message"});c&&(this.cancelCallbacks[o]=c)}else this.processTask(o,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(r.error?o(Ql(r.error)):o(null,Ql(r.data)))}else{const o=new Set,a=r.hasCallback?(d,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?bl(d):null,data:bl(g,o)},o)}:()=>{},c=Ql(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,c,a);else if(this.parent.getWorkerSource){const d=r.type.split("."),{source:g,scope:y}=c;this.parent.getWorkerSource(r.sourceMapId,d[0],g,y)[d[1]](c,a)}else a(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Gp={workerUrl:"",workerClass:null,workerParams:void 0};const S_="mapboxgl_preloaded_worker_pool";class Af{constructor(){this.active={}}acquire(e,r=Af.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(Gp.workerClass!=null?new Gp.workerClass:new self.Worker(Gp.workerUrl,Gp.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[S_]}numActive(){return Object.keys(this.active).length}}Af.workerCount=2;class rp{constructor(e,r,o="Worker",a=Af.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Qt();const c=this.workerPool.acquire(this.id,a);for(let d=0;d<c.length;d++){const g=new rp.Actor(c[d],r,this.id);g.name=`${o} ${d}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,o){_t(this.actors,(a,c)=>{a.send(e,r,c)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Hp,T_;function Jm(){return Hp||(Hp=new Af),Hp}rp.Actor=Qv;const E_=new ai(0,0,0),I_={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},A_={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Qm={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},I2={PAINT_ORDER_FILL_AND_STROKE:1},$p={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},ex={MASK_TYPE_LUMINANCE:1};function A2(i,e,r){i===1&&e.icons.push(function(o,a){return function(c){if(c.usvg_tree.height||(c.usvg_tree.height=c.usvg_tree.width),!c.metadata)return c;const{metadata:d}=c;if(d.content_area){const{content_area:g}=d;g.top==null&&(g.top=g.left),g.width==null&&(g.width=c.usvg_tree.width),g.height==null&&(g.height=g.width)}return d.stretch_x&&d.stretch_x.length&&tx(d,"x"),d.stretch_y&&d.stretch_y.length&&tx(d,"y"),c}(o.readFields(C2,{name:void 0},a))}(r,r.readVarint()+r.pos))}function tx(i,e){const r=[],o=i[`stretch_${e}`];let a=null;for(let c=0;c<o.length;c++)a===null?a=r.length===0?o[0]:r[r.length-1][1]+o[c]:(r.push([a,a+o[c]]),a=null);i[`stretch_${e}_areas`]=r}function C2(i,e,r){i===1?e.name=r.readString():i===2?e.metadata=function(o,a){return o.readFields(M2,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)}(r,r.readVarint()+r.pos):i===3&&(e.usvg_tree=function(o,a){return o.readFields(D2,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function M2(i,e,r){i===1?e.stretch_x=r.readPackedVarint():i===2?e.stretch_y=r.readPackedVarint():i===3?e.content_area=function(o,a){return o.readFields(P2,{left:0},a)}(r,r.readVarint()+r.pos):i===4&&e.variables.push(function(o,a){return o.readFields(R2,{name:void 0},a)}(r,r.readVarint()+r.pos))}function P2(i,e,r){i===1?e.left=r.readVarint():i===2?e.width=r.readVarint():i===3?e.top=r.readVarint():i===4&&(e.height=r.readVarint())}function R2(i,e,r){i===1?e.name=r.readString():i===2&&(e.rgb_color=rg(r.readVarint()),e.value="rgb_color")}function D2(i,e,r){i===1?e.width=e.height=r.readVarint():i===2?e.height=r.readVarint():i===3?e.children.push(eg(r,r.readVarint()+r.pos)):i===4?e.linear_gradients.push(function(o,a){return o.readFields(N2,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)}(r,r.readVarint()+r.pos)):i===5?e.radial_gradients.push(function(o,a){return o.readFields(j2,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)}(r,r.readVarint()+r.pos)):i===7?e.clip_paths.push(function(o,a){return o.readFields(U2,{children:[]},a)}(r,r.readVarint()+r.pos)):i===8&&e.masks.push(function(o,a){const c=o.readFields(q2,{left:0,width:20,mask_type:ex.MASK_TYPE_LUMINANCE,children:[]},a);return c.height==null&&(c.height=c.width),c.top==null&&(c.top=c.left),c}(r,r.readVarint()+r.pos))}function eg(i,e){return i.readFields(k2,{},e)}function k2(i,e,r){i===1?(e.group=function(o,a){return o.readFields(L2,{opacity:255,children:[]},a)}(r,r.readVarint()+r.pos),e.node="group"):i===2&&(e.path=function(o,a){return o.readFields(O2,{paint_order:1,commands:[],step:1,diffs:[],rule:I_.PATH_RULE_NON_ZERO},a)}(r,r.readVarint()+r.pos),e.node="path")}function L2(i,e,r){i===1?e.transform=tg(r,r.readVarint()+r.pos):i===2?e.opacity=r.readVarint():i===5?e.clip_path_idx=r.readVarint():i===6?e.mask_idx=r.readVarint():i===7&&e.children.push(eg(r,r.readVarint()+r.pos))}function tg(i,e){return i.readFields(z2,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function z2(i,e,r){i===1?e.sx=r.readFloat():i===2?e.ky=r.readFloat():i===3?e.kx=r.readFloat():i===4?e.sy=r.readFloat():i===5?e.tx=r.readFloat():i===6&&(e.ty=r.readFloat())}function O2(i,e,r){i===1?e.fill=function(o,a){return o.readFields(F2,{rgb_color:E_,paint:"rgb_color",opacity:255},a)}(r,r.readVarint()+r.pos):i===2?e.stroke=function(o,a){return o.readFields(B2,{rgb_color:E_,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)}(r,r.readVarint()+r.pos):i===3?e.paint_order=r.readVarint():i===5?r.readPackedVarint(e.commands):i===6?e.step=r.readFloat():i===7?r.readPackedSVarint(e.diffs):i===8&&(e.rule=r.readVarint())}function F2(i,e,r){i===1?(e.rgb_color=rg(r.readVarint()),e.paint="rgb_color"):i===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):i===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):i===5&&(e.opacity=r.readVarint())}function rg(i){return new ai((i>>16&255)/255,(i>>8&255)/255,(255&i)/255,1)}function B2(i,e,r){i===1?(e.rgb_color=rg(r.readVarint()),e.paint="rgb_color"):i===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):i===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):i===5?r.readPackedFloat(e.dasharray):i===6?e.dashoffset=r.readFloat():i===7?e.miterlimit=r.readFloat():i===8?e.opacity=r.readVarint():i===9?e.width=r.readFloat():i===10?e.linecap=r.readVarint():i===11&&(e.linejoin=r.readVarint())}function N2(i,e,r){i===1?e.transform=tg(r,r.readVarint()+r.pos):i===2?e.spread_method=r.readVarint():i===3?e.stops.push(rx(r,r.readVarint()+r.pos)):i===4?e.x1=r.readFloat():i===5?e.y1=r.readFloat():i===6?e.x2=r.readFloat():i===7&&(e.y2=r.readFloat())}function rx(i,e){return i.readFields(V2,{offset:0,opacity:255,rgb_color:E_},e)}function V2(i,e,r){i===1?e.offset=r.readFloat():i===2?e.opacity=r.readVarint():i===3&&(e.rgb_color=rg(r.readVarint()))}function j2(i,e,r){i===1?e.transform=tg(r,r.readVarint()+r.pos):i===2?e.spread_method=r.readVarint():i===3?e.stops.push(rx(r,r.readVarint()+r.pos)):i===4?e.cx=r.readFloat():i===5?e.cy=r.readFloat():i===6?e.r=r.readFloat():i===7?e.fx=r.readFloat():i===8?e.fy=r.readFloat():i===9&&(e.fr=r.readFloat())}function U2(i,e,r){i===1?e.transform=tg(r,r.readVarint()+r.pos):i===2?e.clip_path_idx=r.readVarint():i===3&&e.children.push(eg(r,r.readVarint()+r.pos))}function q2(i,e,r){i===1?e.left=e.top=r.readFloat():i===2?e.width=e.height=r.readFloat():i===3?e.top=r.readFloat():i===4?e.height=r.readFloat():i===5?e.mask_type=r.readVarint():i===6?e.mask_idx=r.readVarint():i===7&&e.children.push(eg(r,r.readVarint()+r.pos))}class G2{static calculate(e={},r=[]){const o=new Map,a=new Map;if(Object.keys(e).length===0)return o;r.forEach(c=>{a.set(c.name,c.rgb_color||new ai(0,0,0))});for(const[c,d]of Object.entries(e))a.has(c)?o.set(a.get(c).toStringPremultipliedAlpha(),d):console.warn(`Ignoring unknown image variable "${c}"`);return o}}function ip(i,e=255,r){const o=e/255,a=i.toStringPremultipliedAlpha(),c=r.has(a)?r.get(a).clone():i.clone();return c.a*=o,c.toString()}function Wp(i,e){if(!te()){const r=document.createElement("canvas");return r.width=i,r.height=e,r}return new OffscreenCanvas(i,e)}function H2(i,e){const r=G2.calculate(e.params,i.metadata?i.metadata.variables:[]),o=i.usvg_tree,a=o.width,c=o.height,d=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(a*d.a)),y=Math.max(1,Math.round(c*d.d)),x=new DOMMatrix([g/a,0,0,y/c,0,0]),S=Wp(g,y).getContext("2d");return C_(S,x,o,o,r),S.getImageData(0,0,g,y)}function C_(i,e,r,o,a){for(const c of o.children)ix(i,e,r,c,a)}function ix(i,e,r,o,a){o.group?(i.save(),function(c,d,g,y,x){const S=y.mask_idx!=null?g.masks[y.mask_idx]:null,T=y.clip_path_idx!=null?g.clip_paths[y.clip_path_idx]:null;if(y.transform&&(d=ig(y.transform).preMultiplySelf(d)),!function(D,O,W){return D.opacity!==255||O||W}(y,T!=null,S!=null))return void C_(c,d,g,y,x);const I=Wp(c.canvas.width,c.canvas.height),R=I.getContext("2d");C_(R,d,g,y,x),T&&cx(R,d,g,T),S&&hx(R,d,g,S,x),c.globalAlpha=y.opacity/255,c.drawImage(I,0,0)}(i,e,r,o.group,a),i.restore()):o.path&&(i.save(),function(c,d,g,y,x){const S=dx(y);c.setTransform(d),y.paint_order===I2.PAINT_ORDER_FILL_AND_STROKE?(nx(c,g,y,S,x),sx(c,g,y,S,x)):(sx(c,g,y,S,x),nx(c,g,y,S,x))}(i,e,r,o.path,a),i.restore())}function nx(i,e,r,o,a){const c=r.fill;if(!c)return;const d=c.opacity/255;switch(c.paint){case"rgb_color":i.fillStyle=ip(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":i.fillStyle=ax(i,e.linear_gradients[c.linear_gradient_idx],d,a);break;case"radial_gradient_idx":i.fillStyle=lx(i,e.radial_gradients[c.radial_gradient_idx],d,a)}i.fill(o,ox(r))}function ox(i){return i.rule===I_.PATH_RULE_NON_ZERO?"nonzero":i.rule===I_.PATH_RULE_EVEN_ODD?"evenodd":void 0}function sx(i,e,r,o,a){const c=r.stroke;if(!c)return;i.lineWidth=c.width,i.miterLimit=c.miterlimit,i.setLineDash(c.dasharray),i.lineDashOffset=c.dashoffset;const d=c.opacity/255;switch(c.paint){case"rgb_color":i.strokeStyle=ip(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":i.strokeStyle=ax(i,e.linear_gradients[c.linear_gradient_idx],d,a);break;case"radial_gradient_idx":i.strokeStyle=lx(i,e.radial_gradients[c.radial_gradient_idx],d,a)}switch(c.linejoin){case Qm.LINE_JOIN_MITER_CLIP:case Qm.LINE_JOIN_MITER:i.lineJoin="miter";break;case Qm.LINE_JOIN_ROUND:i.lineJoin="round";break;case Qm.LINE_JOIN_BEVEL:i.lineJoin="bevel"}switch(c.linecap){case A_.LINE_CAP_BUTT:i.lineCap="butt";break;case A_.LINE_CAP_ROUND:i.lineCap="round";break;case A_.LINE_CAP_SQUARE:i.lineCap="square"}i.stroke(o)}function ax(i,e,r,o){if(e.stops.length===1){const I=e.stops[0];return ip(I.rgb_color,I.opacity*r,o)}const a=ig(e.transform),{x1:c,y1:d,x2:g,y2:y}=e,x=a.transformPoint(new DOMPoint(c,d)),S=a.transformPoint(new DOMPoint(g,y)),T=i.createLinearGradient(x.x,x.y,S.x,S.y);for(const I of e.stops)T.addColorStop(I.offset,ip(I.rgb_color,I.opacity*r,o));return T}function lx(i,e,r,o){if(e.stops.length===1){const I=e.stops[0];return ip(I.rgb_color,I.opacity*r,o)}const a=ig(e.transform),{fx:c,fy:d,cx:g,cy:y}=e,x=a.transformPoint(new DOMPoint(c,d)),S=a.transformPoint(new DOMPoint(g,y)),T=i.createRadialGradient(x.x,x.y,0,S.x,S.y,e.r*((a.a+a.d)/2));for(const I of e.stops)T.addColorStop(I.offset,ip(I.rgb_color,I.opacity*r,o));return T}function ux(i,e,r,o){const a=o.transform?ig(o.transform).preMultiplySelf(e):e,c=Wp(i.canvas.width,i.canvas.height),d=c.getContext("2d");for(const y of o.children)if(y.group)ux(d,a,r,y.group);else if(y.path){const x=y.path,S=new Path2D;S.addPath(dx(x),a),d.fill(S,ox(x))}const g=o.clip_path_idx!=null?r.clip_paths[o.clip_path_idx]:null;g&&cx(d,a,r,g),i.globalCompositeOperation="source-over",i.drawImage(c,0,0)}function cx(i,e,r,o){const a=Wp(i.canvas.width,i.canvas.height);ux(a.getContext("2d"),e,r,o),i.globalCompositeOperation="destination-in",i.drawImage(a,0,0)}function hx(i,e,r,o,a){if(o.children.length===0)return;const c=o.mask_idx!=null?r.masks[o.mask_idx]:null;c&&hx(i,e,r,c,a);const d=i.canvas.width,g=i.canvas.height,y=Wp(d,g),x=y.getContext("2d"),S=o.width,T=o.height,I=o.left,R=o.top,D=new Path2D,O=new Path2D;O.rect(I,R,S,T),D.addPath(O,e),x.clip(D);for(const oe of o.children)ix(x,e,r,oe,a);const W=x.getImageData(0,0,d,g),X=W.data;if(o.mask_type===ex.MASK_TYPE_LUMINANCE)for(let oe=0;oe<X.length;oe+=4)X[oe+3]=X[oe+3]/255*(.2126*X[oe]+.7152*X[oe+1]+.0722*X[oe+2]);x.putImageData(W,0,0),i.globalCompositeOperation="destination-in",i.drawImage(y,0,0)}function ig(i){return i?new DOMMatrix([i.sx,i.ky,i.kx,i.sy,i.tx,i.ty]):new DOMMatrix}function dx(i){const e=new Path2D,r=i.step;let o=i.diffs[0]*r,a=i.diffs[1]*r;e.moveTo(o,a);for(let c=0,d=2;c<i.commands.length;c++)switch(i.commands[c]){case $p.PATH_COMMAND_MOVE:o+=i.diffs[d++]*r,a+=i.diffs[d++]*r,e.moveTo(o,a);break;case $p.PATH_COMMAND_LINE:o+=i.diffs[d++]*r,a+=i.diffs[d++]*r,e.lineTo(o,a);break;case $p.PATH_COMMAND_QUAD:{const g=o+i.diffs[d++]*r,y=a+i.diffs[d++]*r;o=g+i.diffs[d++]*r,a=y+i.diffs[d++]*r,e.quadraticCurveTo(g,y,o,a);break}case $p.PATH_COMMAND_CUBIC:{const g=o+i.diffs[d++]*r,y=a+i.diffs[d++]*r,x=g+i.diffs[d++]*r,S=y+i.diffs[d++]*r;o=x+i.diffs[d++]*r,a=S+i.diffs[d++]*r,e.bezierCurveTo(g,y,x,S,o,a);break}case $p.PATH_COMMAND_CLOSE:e.closePath()}return e}class ng{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}ir(ng,"LRUCache");class M_{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new br(e,e.data)}getFromCache(e,r,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new ng(150)),this.cacheMap.get(o).get(El(e.toString(),r))}setInCache(e,r,o,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new ng(150));const c=this.cacheDependenciesMap.get(a),d=El(e.id.toString(),o);c.get(d)||c.set(d,new Set);const g=this.cacheMap.get(a),y=e.toString();c.get(d).add(y),g.put(El(e.toString(),o),r)}removeImagesFromCacheByIds(e,r,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const a=this.cacheMap.get(o),c=this.cacheDependenciesMap.get(o);for(const d of e){const g=El(d.toString(),r);if(c.has(g)){for(const y of c.get(g))a.delete(y);c.delete(g)}}}rasterize(e,r,o,a,c=H2){const d=this.getFromCache(e,o,a);if(d)return d.clone();const g=c(r.icon,e.options),y=M_._getImage(g);return this.setInCache(e,y,o,a),y.clone()}}class fx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const o=this.toIdx(e,r);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function px(i,e,r,o){let a=0,c=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(o[d])<1e-15){if(r[d]<i[d]||r[d]>e[d])return null}else{const g=1/o[d];let y=(i[d]-r[d])*g,x=(e[d]-r[d])*g;if(y>x){const S=y;y=x,x=S}if(y>a&&(a=y),x<c&&(c=x),a>c)return null}return a}function mx(i,e,r,o,a,c,d,g,y,x,S){const T=o-i,I=a-e,R=c-r,D=d-i,O=g-e,W=y-r,X=S[1]*W-S[2]*O,oe=S[2]*D-S[0]*W,re=S[0]*O-S[1]*D,B=T*X+I*oe+R*re;if(Math.abs(B)<1e-15)return null;const J=1/B,ie=x[0]-i,ce=x[1]-e,Ie=x[2]-r,Pe=(ie*X+ce*oe+Ie*re)*J;if(Pe<0||Pe>1)return null;const Le=ce*R-Ie*I,Ue=Ie*T-ie*R,ct=ie*I-ce*T,Pt=(S[0]*Le+S[1]*Ue+S[2]*ct)*J;return Pt<0||Pe+Pt>1?null:(D*Le+O*Ue+W*ct)*J}function gx(i,e,r){return(i-e)/(r-e)}function _x(i,e,r,o,a,c,d,g,y){const x=1<<r,S=c-o,T=d-a,I=(i+1)/x*S+o,R=(e+0)/x*T+a,D=(e+1)/x*T+a;g[0]=(i+0)/x*S+o,g[1]=R,y[0]=I,y[1]=D}class yx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(c){const d=Math.ceil(Math.log2(c.dim/8)),g=[];let y=Math.ceil(Math.pow(2,d));const x=1/y,S=(R,D,O,W,X)=>{const oe=W?1:0,re=(R+1)*O-oe,B=D*O,J=(D+1)*O-oe;X[0]=R*O,X[1]=B,X[2]=re,X[3]=J};let T=new fx(y);const I=[];for(let R=0;R<y*y;R++){S(R%y,Math.floor(R/y),x,!1,I);const D=zd(I[0],I[1],c),O=zd(I[2],I[1],c),W=zd(I[2],I[3],c),X=zd(I[0],I[3],c);T.minimums.push(Math.min(D,O,W,X)),T.maximums.push(Math.max(D,O,W,X)),T.leaves.push(1)}for(g.push(T),y/=2;y>=1;y/=2){const R=g[g.length-1];T=new fx(y);for(let D=0;D<y*y;D++){S(D%y,Math.floor(D/y),2,!0,I);const O=R.getElevation(I[0],I[1]),W=R.getElevation(I[2],I[1]),X=R.getElevation(I[2],I[3]),oe=R.getElevation(I[0],I[3]),re=R.isLeaf(I[0],I[1]),B=R.isLeaf(I[2],I[1]),J=R.isLeaf(I[2],I[3]),ie=R.isLeaf(I[0],I[3]),ce=Math.min(O.min,W.min,X.min,oe.min),Ie=Math.max(O.max,W.max,X.max,oe.max),Pe=re&&B&&J&&ie;T.maximums.push(Ie),T.minimums.push(ce),T.leaves.push(Ie-ce<=5&&Pe?1:0)}g.push(T)}return g}(this.dem),o=r.length-1,a=r[o];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,o,0)}raycastRoot(e,r,o,a,c,d,g=1){return px([e,r,-100],[o,a,this.maximums[0]*g],c,d)}raycast(e,r,o,a,c,d,g=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,r,o,a,c,d,g);if(y==null)return null;const x=[],S=[],T=[],I=[],R=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:D,t:O,nodex:W,nodey:X,depth:oe}=R.pop();if(this.leaves[D]){_x(W,X,oe,e,r,o,a,T,I);const B=1<<oe,J=(W+0)/B,ie=(W+1)/B,ce=(X+0)/B,Ie=(X+1)/B,Pe=zd(J,ce,this.dem)*g,Le=zd(ie,ce,this.dem)*g,Ue=zd(ie,Ie,this.dem)*g,ct=zd(J,Ie,this.dem)*g,Pt=mx(T[0],T[1],Pe,I[0],T[1],Le,I[0],I[1],Ue,c,d),Tt=mx(I[0],I[1],Ue,T[0],I[1],ct,T[0],T[1],Pe,c,d),At=Math.min(Pt!==null?Pt:Number.MAX_VALUE,Tt!==null?Tt:Number.MAX_VALUE);if(At!==Number.MAX_VALUE)return At;{const Nt=dt([],c,d,O);if(vx(Pe,Le,ct,Ue,gx(Nt[0],T[0],I[0]),gx(Nt[1],T[1],I[1]))>=Nt[2])return O}continue}let re=0;for(let B=0;B<this._siblingOffset.length;B++){_x((W<<1)+this._siblingOffset[B][0],(X<<1)+this._siblingOffset[B][1],oe+1,e,r,o,a,T,I),T[2]=-100,I[2]=this.maximums[this.childOffsets[D]+B]*g;const J=px(T,I,c,d);if(J!=null){const ie=J;x[B]=ie;let ce=!1;for(let Ie=0;Ie<re&&!ce;Ie++)ie>=x[S[Ie]]&&(S.splice(Ie,0,B),ce=!0);ce||(S[re]=B),re++}}for(let B=0;B<re;B++){const J=S[B];R.push({idx:this.childOffsets[D]+J,t:x[J],nodex:(W<<1)+this._siblingOffset[J][0],nodey:(X<<1)+this._siblingOffset[J][1],depth:oe+1})}}return null}_addNode(e,r,o){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,o,a,c){if(e[a].isLeaf(r,o)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const d=a-1,g=e[d];let y=0,x=0;for(let S=0;S<this._siblingOffset.length;S++){const T=2*r+this._siblingOffset[S][0],I=2*o+this._siblingOffset[S][1],R=g.getElevation(T,I),D=g.isLeaf(T,I),O=this._addNode(R.min,R.max,D);D&&(y|=1<<S),x||(x=O)}for(let S=0;S<this._siblingOffset.length;S++)y&1<<S||this._construct(e,2*r+this._siblingOffset[S][0],2*o+this._siblingOffset[S][1],d,x+S)}}function vx(i,e,r,o,a,c){return Mr(Mr(i,r,c),Mr(e,o,c),a)}function zd(i,e,r){const o=r.dim,a=ke(i*o-.5,0,o-1),c=ke(e*o-.5,0,o-1),d=Math.floor(a),g=Math.floor(c),y=Math.min(d+1,o-1),x=Math.min(g+1,o-1);return vx(r.get(d,g),r.get(y,g),r.get(d,x),r.get(y,x),a-d,c-g)}const $2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function W2(i,e,r){return(256*i*256+256*e+r)/10-1e4}function Z2(i,e,r){return 256*i+e+r/256-32768}class og{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,o,a=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void Jr(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2,d=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let y=0;y<c;y++)d[this._idx(-1,y)]=d[this._idx(0,y)],d[this._idx(c,y)]=d[this._idx(c-1,y)],d[this._idx(y,-1)]=d[this._idx(y,0)],d[this._idx(y,c)]=d[this._idx(y,c-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(c,-1)]=d[this._idx(c-1,0)],d[this._idx(-1,c)]=d[this._idx(0,c-1)],d[this._idx(c,c)]=d[this._idx(c-1,c-1)]}const g=o==="terrarium"?Z2:W2;for(let y=0;y<d.length;++y){const x=4*y;this.floatView[y]=g(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=we.now()}_buildQuadTree(){this._tree=new yx(this)}get(e,r,o=!1){o&&(e=ke(e,-1,this.dim),r=ke(r,-1,this.dim));const a=this._idx(e,r);return this.floatView[a]}set(e,r,o){const a=this._idx(e,r),c=this.floatView[a];return this.floatView[a]=o,o-c}static getUnpackVector(e){return $2[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const o=[0,0,0,0],a=og.getUnpackVector(r);let c=Math.floor((e+a[3])/a[2]);return o[2]=c%256,c=Math.floor(c/256),o[1]=c%256,c=Math.floor(c/256),o[0]=c,o}getPixels(){return new vi({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,c=r*this.dim+this.dim,d=o*this.dim,g=o*this.dim+this.dim;switch(r){case-1:a=c-1;break;case 1:c=a+1}switch(o){case-1:d=g-1;break;case 1:g=d+1}const y=-r*this.dim,x=-o*this.dim;for(let S=d;S<g;S++)for(let T=a;T<c;T++){const I=4*this._idx(T,S),R=4*this._idx(T+y,S+x);this.pixels[I+0]=e.pixels[R+0],this.pixels[I+1]=e.pixels[R+1],this.pixels[I+2]=e.pixels[R+2],this.pixels[I+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function X2(i,e,r){i===1?e.headerLength=r.readFixed32():i===2?e.x=r.readVarint():i===3?e.y=r.readVarint():i===4?e.z=r.readVarint():i===5&&e.layers.push(function(o,a){return o.readFields(eS,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)}(r,r.readVarint()+r.pos))}function Y2(i,e,r){i===1?(e.delta_filter=function(o,a){return o.readFields(K2,{blockSize:0},a)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):i===2?(r.readVarint(),e.filter="zigzag_filter"):i===3?(r.readVarint(),e.filter="bitshuffle_filter"):i===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function K2(i,e,r){i===1&&(e.blockSize=r.readVarint())}function J2(i,e,r){i===1?(r.readVarint(),e.codec="gzip_data"):i===2?(r.readVarint(),e.codec="jpeg_image"):i===3?(r.readVarint(),e.codec="webp_image"):i===4&&(r.readVarint(),e.codec="png_image")}function Q2(i,e,r){let o=0,a=0;i===1?e.firstByte=r.readFixed64():i===2?e.lastByte=r.readFixed64():i===3?e.filters.push(function(c,d){return c.readFields(Y2,{},d)}(r,r.readVarint()+r.pos)):i===4?e.codec=function(c,d){return c.readFields(J2,{},d)}(r,r.readVarint()+r.pos):i===5?a=r.readFloat():i===6?o=r.readFloat():i===7?e.bands.push(r.readString()):i===8?e.offset=r.readDouble():i===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=o)}function eS(i,e,r){i===1?e.version=r.readVarint():i===2?e.name=r.readString():i===3?e.units=r.readString():i===4?e.tileSize=r.readVarint():i===5?e.buffer=r.readVarint():i===6?e.pixelFormat=r.readVarint():i===7&&e.dataIndex.push(function(o,a){return o.readFields(Q2,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)}(r,r.readVarint()+r.pos))}function tS(i,e,r){if(i===2)(function(o,a,c){o.readFields(rS,c,a)})(r,r.readVarint()+r.pos,e);else if(i===3)throw new Error("Not implemented")}function rS(i,e,r){if(i===1){let o=0;const a=r.readVarint()+r.pos;for(;r.pos<a;)e[o++]=r.readVarint()}}function iS(i,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let o=2;o>=1;o--){const a=o===1?1:0,c=o===2?1:0;for(let d=0;d<e[0];d++){const g=e[1]*d;for(let y=a;y<e[1];y++){const x=e[2]*(y+g);for(let S=c;S<e[2];S++){const T=e[3]*(S+x);for(let I=0;I<e[3];I++){const R=T+I;i[R]+=i[R-r]}}}}r*=e[o]}return i}function nS(i){for(let e=0,r=i.length;e<r;e++)i[e]=i[e]>>>1^-(1&i[e]);return i}function oS(i,e){switch(e){case"uint32":return i;case"uint16":for(let r=0;r<i.length;r+=2){const o=i[r],a=i[r+1];i[r]=(240&o)>>4|(61440&o)>>8|(240&a)<<4|61440&a,i[r+1]=15&o|(3840&o)>>4|(15&a)<<8|(3840&a)<<4}return i;case"uint8":for(let r=0;r<i.length;r+=4){const o=i[r],a=i[r+1],c=i[r+2],d=i[r+3];i[r+0]=(192&o)>>6|(192&a)>>4|(192&c)>>2|192&d,i[r+1]=(48&o)>>4|(48&a)>>2|48&c|(48&d)<<2,i[r+2]=(12&o)>>2|12&a|(12&c)<<2|(12&d)<<4,i[r+3]=3&o|(3&a)<<2|(3&c)<<4|(3&d)<<6}return i;default:throw new Error(`Invalid pixel format, "${e}"`)}}ir(og,"DEMData"),ir(yx,"DemMinMaxQuadTree",{omit:["dem"]});var ou=Uint8Array,Zp=Uint16Array,sS=Int32Array,xx=new ou([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bx=new ou([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),aS=new ou([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),wx=function(i,e){for(var r=new Zp(31),o=0;o<31;++o)r[o]=e+=1<<i[o-1];var a=new sS(r[30]);for(o=1;o<30;++o)for(var c=r[o];c<r[o+1];++c)a[c]=c-r[o]<<5|o;return{b:r,r:a}},Sx=wx(xx,2),Tx=Sx.b,lS=Sx.r;Tx[28]=258,lS[258]=28;for(var uS=wx(bx,0).b,Ex=new Zp(32768),Do=0;Do<32768;++Do){var np=(43690&Do)>>1|(21845&Do)<<1;Ex[Do]=((65280&(np=(61680&(np=(52428&np)>>2|(13107&np)<<2))>>4|(3855&np)<<4))>>8|(255&np)<<8)>>1}var Xp=function(i,e,r){for(var o=i.length,a=0,c=new Zp(e);a<o;++a)i[a]&&++c[i[a]-1];var d,g=new Zp(e);for(a=1;a<e;++a)g[a]=g[a-1]+c[a-1]<<1;d=new Zp(1<<e);var y=15-e;for(a=0;a<o;++a)if(i[a])for(var x=a<<4|i[a],S=e-i[a],T=g[i[a]-1]++<<S,I=T|(1<<S)-1;T<=I;++T)d[Ex[T]>>y]=x;return d},Yp=new ou(288);for(Do=0;Do<144;++Do)Yp[Do]=8;for(Do=144;Do<256;++Do)Yp[Do]=9;for(Do=256;Do<280;++Do)Yp[Do]=7;for(Do=280;Do<288;++Do)Yp[Do]=8;var Ix=new ou(32);for(Do=0;Do<32;++Do)Ix[Do]=5;var cS=Xp(Yp,9),hS=Xp(Ix,5),P_=function(i){for(var e=i[0],r=1;r<i.length;++r)i[r]>e&&(e=i[r]);return e},lc=function(i,e,r){var o=e/8|0;return(i[o]|i[o+1]<<8)>>(7&e)&r},R_=function(i,e){var r=e/8|0;return(i[r]|i[r+1]<<8|i[r+2]<<16)>>(7&e)},dS=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],uc=function(i,e,r){var o=new Error(e||dS[i]);if(o.code=i,Error.captureStackTrace&&Error.captureStackTrace(o,uc),!r)throw o;return o},fS=new ou(0),pS=typeof TextDecoder<"u"&&new TextDecoder;try{pS.decode(fS,{stream:!0})}catch{}const mS={gzip_data:"gzip"};class zu extends Error{constructor(e){super(e),this.name="MRTError"}}const gS={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Ax={uint32:1,uint16:2,uint8:4},_S={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let D_;class sg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new zu(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),o=new DataView(e);if(r[0]!==13)throw new zu("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),o=this.getHeaderLength(e);if(r.length<o)throw new zu(`Expected header with length >= ${o} but got buffer of length ${r.length}`);const a=function(c,d){return c.readFields(X2,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new D_(r.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new zu(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const c of a.layers)this.layers[c.name]=new Cx(c,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],o=this.getLayer(e.layerName);for(let a of e.blockIndices){const c=o.dataIndex[a],d=c.firstByte-e.firstByte,g=c.lastByte-e.firstByte;if(o._blocksInProgress.has(a))continue;const y={layerName:o.name,firstByte:d,lastByte:g,pixelFormat:o.pixelFormat,blockIndex:a,blockShape:[c.bands.length].concat(o.bandShape),buffer:o.buffer,codec:c.codec.codec,filters:c.filters.map(x=>x.filter)};o._blocksInProgress.add(a),r.push(y)}return new Mx(r,()=>{r.forEach(a=>o._blocksInProgress.delete(a.blockIndex))},(a,c)=>{if(r.forEach(d=>o._blocksInProgress.delete(d.blockIndex)),a)throw a;c.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class Cx{constructor({version:e,name:r,units:o,tileSize:a,pixelFormat:c,buffer:d,dataIndex:g},y){if(this.version=e,this.version!==1)throw new zu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=o,this.tileSize=a,this.buffer=d,this.pixelFormat=gS[c],this.dataIndex=g,this.bandShape=[a+2*d,a+2*d,Ax[this.pixelFormat]],this._decodedBlocks=new ng(y?y.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Ax[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[o,a]of this.dataIndex.entries()){for(const[c,d]of a.bands.entries())if(d===e)return{bandIndex:r+c,blockIndex:o,blockBandIndex:c};r+=a.bands.length}break;case"number":for(const[o,a]of this.dataIndex.entries()){if(e>=r&&e<r+a.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-r};r+=a.bands.length}break;default:throw new zu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let r=1/0,o=-1/0;const a=[],c=new Set;for(const d of e){const{blockIndex:g}=this.getBlockForBand(d);if(g<0)throw new zu(`Invalid band: ${JSON.stringify(d)}`);const y=this.dataIndex[g];a.includes(g)||a.push(g),c.add(g),r=Math.min(r,y.firstByte),o=Math.max(o,y.lastByte)}if(c.size>this.cacheSize)throw new zu(`Number of blocks to decode (${c.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:o,blockIndices:a}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:o}=this.getBlockForBand(e);if(r<0)throw new zu(`Band not found: ${JSON.stringify(e)}`);const a=this._decodedBlocks.get(r.toString());if(!a)throw new zu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[r],d=this.bandShape.reduce((x,S)=>x*S,1),g=o*d,y=a.subarray(g,g+d);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:c.offset,scale:c.scale}}}sg.setPbf=function(i){D_=i};class Mx{constructor(e,r,o){this.tasks=e,this._onCancel=r,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}sg.performDecoding=function(i,e){const r=new Uint8Array(i);return Promise.all(e.tasks.map(o=>{const{layerName:a,firstByte:c,lastByte:d,pixelFormat:g,blockShape:y,blockIndex:x,filters:S,codec:T}=o,I=r.subarray(c,d+1),R=new Uint32Array(y[0]*y[1]*y[2]);let D;if(T!=="gzip_data")throw new zu(`Unhandled codec: ${T}`);return D=function(O,W){if(!globalThis.DecompressionStream&&W==="gzip_data")return Promise.resolve(((B=function(ce){ce[0]==31&&ce[1]==139&&ce[2]==8||uc(6,"invalid gzip data");var Ie=ce[3],Pe=10;4&Ie&&(Pe+=2+(ce[10]|ce[11]<<8));for(var Le=(Ie>>3&1)+(Ie>>4&1);Le>0;Le-=!ce[Pe++]);return Pe+(2&Ie)}(re=O))+8>re.length&&uc(6,"invalid gzip data"),function(ce,Ie,Pe,Le){var Ue=ce.length;if(!Ue||Ie.f&&!Ie.l)return Pe||new ou(0);var ct=!Pe,Pt=ct||Ie.i!=2,Tt=Ie.i;ct&&(Pe=new ou(3*Ue));var At,Nt,at=function(Qn){var En=Pe.length;if(Qn>En){var dn=new ou(Math.max(2*En,Qn));dn.set(Pe),Pe=dn}},It=Ie.f||0,nt=Ie.p||0,ut=Ie.b||0,jt=Ie.l,qt=Ie.d,wr=Ie.m,hr=Ie.n,Jt=8*Ue;do{if(!jt){It=lc(ce,nt,1);var Vt=lc(ce,nt+1,3);if(nt+=3,!Vt){var $r=ce[(le=4+((nt+7)/8|0))-4]|ce[le-3]<<8,_r=le+$r;if(_r>Ue){Tt&&uc(0);break}Pt&&at(ut+$r),Pe.set(ce.subarray(le,_r),ut),Ie.b=ut+=$r,Ie.p=nt=8*_r,Ie.f=It;continue}if(Vt==1)jt=cS,qt=hS,wr=9,hr=5;else if(Vt==2){var yr=lc(ce,nt,31)+257,Vr=lc(ce,nt+10,15)+4,Kr=yr+lc(ce,nt+5,31)+1;nt+=14;for(var ni=new ou(Kr),_i=new ou(19),ci=0;ci<Vr;++ci)_i[aS[ci]]=lc(ce,nt+3*ci,7);nt+=3*Vr;var oi=P_(_i),an=(1<<oi)-1,vn=Xp(_i,oi);for(ci=0;ci<Kr;){var le,de=vn[lc(ce,nt,an)];if(nt+=15&de,(le=de>>4)<16)ni[ci++]=le;else{var pt=0,$t=0;for(le==16?($t=3+lc(ce,nt,3),nt+=2,pt=ni[ci-1]):le==17?($t=3+lc(ce,nt,7),nt+=3):le==18&&($t=11+lc(ce,nt,127),nt+=7);$t--;)ni[ci++]=pt}}var tr=ni.subarray(0,yr),er=ni.subarray(yr);wr=P_(tr),hr=P_(er),jt=Xp(tr,wr),qt=Xp(er,hr)}else uc(1);if(nt>Jt){Tt&&uc(0);break}}Pt&&at(ut+131072);for(var vr=(1<<wr)-1,Br=(1<<hr)-1,Ti=nt;;Ti=nt){var Ei=(pt=jt[R_(ce,nt)&vr])>>4;if((nt+=15&pt)>Jt){Tt&&uc(0);break}if(pt||uc(2),Ei<256)Pe[ut++]=Ei;else{if(Ei==256){Ti=nt,jt=null;break}var si=Ei-254;Ei>264&&(si=lc(ce,nt,(1<<(Ii=xx[ci=Ei-257]))-1)+Tx[ci],nt+=Ii);var tn=qt[R_(ce,nt)&Br],hn=tn>>4;if(tn||uc(3),nt+=15&tn,er=uS[hn],hn>3){var Ii=bx[hn];er+=R_(ce,nt)&(1<<Ii)-1,nt+=Ii}if(nt>Jt){Tt&&uc(0);break}Pt&&at(ut+131072);var Bn=ut+si;if(ut<er){var xn=0-er,Ji=Math.min(er,Bn);for(xn+ut<0&&uc(3);ut<Ji;++ut)Pe[ut]=(void 0)[xn+ut]}for(;ut<Bn;++ut)Pe[ut]=Pe[ut-er]}}Ie.l=jt,Ie.p=Ti,Ie.b=ut,Ie.f=It,jt&&(It=1,Ie.m=wr,Ie.d=qt,Ie.n=hr)}while(!It);return ut!=Pe.length&&ct?(At=Pe,((Nt=ut)==null||Nt>At.length)&&(Nt=At.length),new ou(At.subarray(0,Nt))):Pe.subarray(0,ut)}(re.subarray(B,-8),{i:2},new ou(((X=re)[(oe=X.length)-4]|X[oe-3]<<8|X[oe-2]<<16|X[oe-1]<<24)>>>0))));var X,oe,re,B;const J=mS[W];if(!J)throw new Error(`Unhandled codec: ${W}`);const ie=new globalThis.DecompressionStream(J);return new Response(new Blob([O]).stream().pipeThrough(ie)).arrayBuffer().then(ce=>new Uint8Array(ce))}(I,T).then(O=>(function(W,X){W.readFields(tS,X)}(new D_(O),R),new _S[g](R.buffer))),D.then(O=>{for(let W=S.length-1;W>=0;W--)switch(S[W]){case"delta_filter":iS(O,y);break;case"zigzag_filter":nS(O);break;case"bitshuffle_filter":oS(O,g);break;default:throw new zu(`Unhandled filter "${S[W]}"`)}return{layerName:a,blockIndex:x,data:O}}).catch(O=>{throw O})}))},ir(Mx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ir(sg,"MapboxRasterTile"),ir(Cx,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Kp,k_,cc,op,L_,sp=null;function Px(){return Pi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:k_||mn.DRACO_URL}function Rx(){if(Pi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(op)return op;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return op=WebAssembly.validate(i)?mn.MESHOPT_SIMD_URL:mn.MESHOPT_URL,op}const ag={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yS={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Jp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Dx(i,e,r){const o=r.json.bufferViews.length,a=r.buffers.length;e.bufferView=o,r.json.bufferViews[o]={buffer:a,byteLength:i.byteLength},r.buffers[a]=i}const z_="KHR_draco_mesh_compression";function vS(i,e){const r=i.extensions&&i.extensions[z_];if(!r)return;const o=new cc.Decoder,a=Ox(e,r.bufferView),c=new cc.Mesh;if(!o.DecodeArrayToMesh(a,a.byteLength,c))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[i.indices],g=ag[d.componentType],y=d.count*g.BYTES_PER_ELEMENT,x=cc._malloc(y);g===Uint16Array?o.GetTrianglesUInt16Array(c,y,x):o.GetTrianglesUInt32Array(c,y,x),Dx(cc.memory.buffer.slice(x,x+y),d,e),cc._free(x);for(const S of Object.keys(r.attributes)){const T=o.GetAttributeByUniqueId(c,r.attributes[S]),I=e.json.accessors[i.attributes[S]],R=yS[I.componentType],D=I.count*Jp[I.type]*ag[I.componentType].BYTES_PER_ELEMENT,O=cc._malloc(D);o.GetAttributeDataArrayForAllPoints(c,T,cc[R],D,O),Dx(cc.memory.buffer.slice(O,O+D),I,e),cc._free(O)}o.destroy(),c.destroy(),delete i.extensions[z_]}const lg="EXT_meshopt_compression";function xS(i,e){if(!i.extensions||!i.extensions[lg])return;const r=i.extensions[lg],o=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),a=new Uint8Array(r.count*r.byteStride);L_.decodeGltfBuffer(a,r.count,r.byteStride,o,r.mode,r.filter),i.buffer=e.buffers.length,i.byteOffset=0,e.buffers[i.buffer]=a.buffer,delete i.extensions[lg]}const kx=1179937895,Lx=new TextDecoder("utf8");function zx(i,e){return new URL(i,e).href}function bS(i,e,r,o){return fetch(zx(i.uri,o)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[r]=a})}function Ox(i,e){const r=i.json.bufferViews[e];return new Uint8Array(i.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function wS(i,e,r,o){if(i.uri){const a=zx(i.uri,o);return fetch(a).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[r]=c})}if(i.bufferView!==void 0){const a=Ox(e,i.bufferView),c=new Blob([a],{type:i.mimeType});return createImageBitmap(c).then(d=>{e.images[r]=d})}}function Fx(i,e=0,r){const o={json:null,images:[],buffers:[]};if(new Uint32Array(i,e,1)[0]===kx){const S=new Uint32Array(i,e);let T=2;const I=(S[T++]>>2)-3,R=S[T++]>>2;if(T++,o.json=JSON.parse(Lx.decode(S.subarray(T,T+R))),T+=R,T<I){const D=S[T++];T++;const O=e+(T<<2);o.buffers[0]=i.slice(O,O+D)}}else o.json=JSON.parse(Lx.decode(new Uint8Array(i,e)));const{buffers:a,images:c,meshes:d,extensionsUsed:g,bufferViews:y}=o.json;let x=Promise.resolve();if(a){const S=[];for(let T=0;T<a.length;T++){const I=a[T];I.uri?S.push(bS(I,o,T,r)):o.buffers[T]||(o.buffers[T]=null)}x=Promise.all(S)}return x.then(()=>{const S=[],T=g&&g.includes(z_),I=g&&g.includes(lg);if(T&&S.push(function(){if(!cc)return Kp??(Kp=function(R){let D,O=null;function W(){D=new Uint8Array(O.buffer)}function X(){throw new Error("Unexpected Draco error.")}const oe={a:{a:X,d:function(re,B,J){return D.copyWithin(re,B,B+J)},c:function(re){const B=D.length,J=Math.max(re>>>0,Math.ceil(1.2*B)),ie=Math.ceil((J-B)/65536);try{return O.grow(ie),W(),!0}catch{return!1}},b:X}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,oe):R.then(re=>re.arrayBuffer()).then(re=>WebAssembly.instantiate(re,oe))).then(re=>{const{Rb:B,Qb:J,P:ie,T:ce,X:Ie,Ja:Pe,La:Le,Qa:Ue,Va:ct,Wa:Pt,eb:Tt,jb:At,f:Nt,e:at,yb:It,zb:nt,Ab:ut,Bb:jt,Db:qt,Gb:wr}=re.instance.exports;O=at;const hr=(()=>{let Jt=0,Vt=0,$r=0,_r=0;return yr=>{$r&&(B(_r),B(Jt),Vt+=$r,$r=Jt=0),Jt||(Vt+=128,Jt=J(Vt));const Vr=yr.length+7&-8;let Kr=Jt;Vr>=Vt&&($r=Vr,Kr=_r=J(Vr));for(let ni=0;ni<yr.length;ni++)D[Kr+ni]=yr[ni];return Kr}})();return W(),Nt(),{memory:at,_free:B,_malloc:J,Mesh:class{constructor(){this.ptr=ie()}destroy(){ce(this.ptr)}},Decoder:class{constructor(){this.ptr=Pe()}destroy(){At(this.ptr)}DecodeArrayToMesh(Jt,Vt,$r){const _r=hr(Jt),yr=Le(this.ptr,_r,Vt,$r.ptr);return!!Ie(yr)}GetAttributeByUniqueId(Jt,Vt){return{ptr:Ue(this.ptr,Jt.ptr,Vt)}}GetTrianglesUInt16Array(Jt,Vt,$r){ct(this.ptr,Jt.ptr,Vt,$r)}GetTrianglesUInt32Array(Jt,Vt,$r){Pt(this.ptr,Jt.ptr,Vt,$r)}GetAttributeDataArrayForAllPoints(Jt,Vt,$r,_r,yr){Tt(this.ptr,Jt.ptr,Vt.ptr,$r,_r,yr)}},DT_INT8:It(),DT_UINT8:nt(),DT_INT16:ut(),DT_UINT16:jt(),DT_UINT32:qt(),DT_FLOAT32:wr()}})}(fetch(Px())),Kp.then(R=>{cc=R,Kp=void 0}))}()),I&&S.push(function(){if(L_)return;const R=function(D){let O;const W=WebAssembly.instantiateStreaming(D,{}).then(re=>{O=re.instance,O.exports.__wasm_call_ctors()}),X={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},oe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:W,supported:!0,decodeGltfBuffer(re,B,J,ie,ce,Ie){(function(Pe,Le,Ue,ct,Pt,Tt,At){const Nt=Pe.exports.sbrk,at=ct+3&-4,It=Nt(at*Pt),nt=Nt(Tt.length),ut=new Uint8Array(Pe.exports.memory.buffer);ut.set(Tt,nt);const jt=Le(It,ct,Pt,nt,Tt.length);if(jt===0&&At&&At(It,at,Pt),Ue.set(ut.subarray(It,It+ct*Pt)),Nt(It-Nt(0)),jt!==0)throw new Error(`Malformed buffer data: ${jt}`)})(O,O.exports[oe[ce]],re,B,J,ie,O.exports[X[Ie]])}}}(fetch(Rx()));return R.ready.then(()=>{L_=R})}()),c)for(let R=0;R<c.length;R++)S.push(wS(c[R],o,R,r));return(S.length?Promise.all(S):Promise.resolve()).then(()=>{if(T&&d)for(const{primitives:R}of d)for(const D of R)vS(D,o);if(I&&d&&y)for(const R of y)xS(R,o);return o})})}function Cf(i,e){const r=i.json.bufferViews[e.bufferView],o=ag[e.componentType];return new o(i.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Jp[e.type]*o.BYTES_PER_ELEMENT?r.byteStride/o.BYTES_PER_ELEMENT:Jp[e.type]))}function O_(i,e,r,o){const a=ag[e.componentType],c=function(S){switch(S){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),d=i.json.bufferViews[e.bufferView],g=d.byteStride?d.byteStride/a.BYTES_PER_ELEMENT:Jp[e.type],y=r.float32,x=y.length/r.capacity;for(let S=0,T=0;S<e.count*g;S+=g,T+=x)for(let I=0;I<x;I++)y[T+I]=o[S+I]*c;r._trim()}function SS(i,e,r){const o=i.indices,a=i.attributes,c={};c.indexArray=new ao;const d=e.json.accessors[o],g=d.count/3;c.indexArray.reserve(g);const y=Cf(e,d);for(let I=0;I<g;I++)c.indexArray.emplaceBack(y[3*I],y[3*I+1],y[3*I+2]);c.indexArray._trim(),c.vertexArray=new nl;const x=e.json.accessors[a.POSITION];c.vertexArray.reserve(x.count);const S=Cf(e,x);for(let I=0;I<x.count;I++)c.vertexArray.emplaceBack(S[3*I],S[3*I+1],S[3*I+2]);if(c.vertexArray._trim(),c.aabb=new yn(x.min,x.max),c.centroid=function(I,R){const D=[0,0,0],O=I.length;if(O>0){for(let W=0;W<O;W++){const X=3*I[W];D[0]+=R[X],D[1]+=R[X+1],D[2]+=R[X+2]}D[0]/=O,D[1]/=O,D[2]/=O}return D}(y,S),a.COLOR_0!==void 0){const I=e.json.accessors[a.COLOR_0],R=Jp[I.type],D=Cf(e,I);c.colorArray=R===3?new nl:new jo,c.colorArray.resize(I.count),O_(e,I,c.colorArray,D)}if(a.NORMAL!==void 0){c.normalArray=new nl;const I=e.json.accessors[a.NORMAL];c.normalArray.resize(I.count);const R=Cf(e,I);O_(e,I,c.normalArray,R)}if(a.TEXCOORD_0!==void 0&&r.length>0){c.texcoordArray=new Mu;const I=e.json.accessors[a.TEXCOORD_0];c.texcoordArray.resize(I.count);const R=Cf(e,I);O_(e,I,c.texcoordArray,R)}if(a._FEATURE_ID_RGBA4444!==void 0){const I=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=Cf(e,I))}a._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(Cf(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const T=i.material;return c.material=function(I,R){const{emissiveFactor:D=[0,0,0],alphaMode:O="OPAQUE",alphaCutoff:W=.5,normalTexture:X,occlusionTexture:oe,emissiveTexture:re,doubleSided:B}=I,{baseColorFactor:J=[1,1,1,1],metallicFactor:ie=1,roughnessFactor:ce=1,baseColorTexture:Ie,metallicRoughnessTexture:Pe}=I.pbrMetallicRoughness||{},Le=oe?R[oe.index]:void 0;if(oe&&oe.extensions&&oe.extensions.KHR_texture_transform&&Le){const Ue=oe.extensions.KHR_texture_transform;Le.offsetScale=[Ue.offset[0],Ue.offset[1],Ue.scale[0],Ue.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new ai(...J),metallicFactor:ie,roughnessFactor:ce,baseColorTexture:Ie?R[Ie.index]:void 0,metallicRoughnessTexture:Pe?R[Pe.index]:void 0},doubleSided:B,emissiveFactor:D,alphaMode:O,alphaCutoff:W,normalTexture:X?R[X.index]:void 0,occlusionTexture:Le,emissionTexture:re?R[re.index]:void 0,defined:I.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},r),c}function Bx(i,e,r){const{matrix:o,rotation:a,translation:c,scale:d,mesh:g,extras:y,children:x}=i,S={};if(S.matrix=o||function(T,I,R,D){var O=I[0],W=I[1],X=I[2],oe=I[3],re=O+O,B=W+W,J=X+X,ie=O*re,ce=O*B,Ie=O*J,Pe=W*B,Le=W*J,Ue=X*J,ct=oe*re,Pt=oe*B,Tt=oe*J,At=D[0],Nt=D[1],at=D[2];return T[0]=(1-(Pe+Ue))*At,T[1]=(ce+Tt)*At,T[2]=(Ie-Pt)*At,T[3]=0,T[4]=(ce-Tt)*Nt,T[5]=(1-(ie+Ue))*Nt,T[6]=(Le+ct)*Nt,T[7]=0,T[8]=(Ie+Pt)*at,T[9]=(Le-ct)*at,T[10]=(1-(ie+Pe))*at,T[11]=0,T[12]=R[0],T[13]=R[1],T[14]=R[2],T[15]=1,T}([],a||[0,0,0,1],c||[0,0,0],d||[1,1,1]),g!==void 0){S.meshes=r[g];const T=S.anchor=[0,0];for(const I of S.meshes){const{min:R,max:D}=I.aabb;T[0]+=R[0]+D[0],T[1]+=R[1]+D[1]}T[0]=Math.floor(T[0]/S.meshes.length/2),T[1]=Math.floor(T[1]/S.meshes.length/2)}if(y&&(y.id&&(S.id=y.id),y.lights&&(S.lights=function(T){if(!T.length)return[];const I=function(X){const oe=atob(X),re=new Uint8Array(oe.length);for(let B=0;B<oe.length;B++)re[B]=oe.codePointAt(B);return re}(T),R=[],D=I.length/24,O=new Uint16Array(I.buffer),W=new Float32Array(I.buffer);for(let X=0;X<D;X++){const oe=O[2*X*6]/30,re=O[2*X*6+1]/30,B=O[2*X*6+10]/100,J=W[6*X+1],ie=W[6*X+2],ce=W[6*X+3],Ie=W[6*X+4],Pe=ce-J,Le=Ie-ie,Ue=Math.hypot(Pe,Le);R.push({pos:[J+.5*Pe,ie+.5*Le,re],normal:[Le/Ue,-Pe/Ue,0],width:Ue,height:oe,depth:B,points:[J,ie,ce,Ie]})}return R}(y.lights))),x){const T=[];for(const I of x)T.push(Bx(e.json.nodes[I],e,r));S.children=T}return S}function TS(i){if(i.vertices.length===0||i.indices.length===0)return null;const e=new Vg(i.vertices,i.indices,8,256),[r,o]=[e.min.clone(),e.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:e,min:r,max:o}}function ES(i){if(!i.extras||!i.extras.ground)return null;const e=i.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const o=[];for(const d of r){if(!Array.isArray(d)||d.length!==2)continue;const g=d[0],y=d[1];typeof g=="number"&&typeof y=="number"&&o.push(new Ot(g,y))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let a=0;for(let d=0;d<o.length;d++){const g=o[d],y=o[(d+1)%o.length],x=o[(d+2)%o.length];a+=(g.x-y.x)*(x.y-y.y)-(x.x-y.x)*(g.y-y.y)}a>0&&o.reverse();const c=Ll(o.flatMap(d=>[d.x,d.y]),[]);return c.length===0?null:{vertices:o,indices:c}}function IS(i,e){const r=[],o=[];let a=0;const c=[];for(const d of i){a=r.length;const g=d.vertexArray.float32,y=d.indexArray.uint16;for(let x=0;x<d.vertexArray.length;x++)c[0]=g[3*x+0],c[1]=g[3*x+1],c[2]=g[3*x+2],jr(c,c,e),r.push(new Ot(c[0],c[1]));for(let x=0;x<3*d.indexArray.length;x++)o.push(y[x]+a)}if(o.length%3!=0)return null;for(let d=0;d<o.length;d+=3){const g=r[o[d+0]],y=r[o[d+1]],x=r[o[d+2]];(g.x-y.x)*(x.y-y.y)-(x.x-y.x)*(g.y-y.y)>0&&([o[d+1],o[d+2]]=[o[d+2],o[d+1]])}return{vertices:r,indices:o}}function Nx(i){const e=function(y,x){const S=[],T=WebGL2RenderingContext;if(y.json.textures)for(const I of y.json.textures){const R={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};I.sampler!==void 0&&Object.assign(R,y.json.samplers[I.sampler]),S.push({image:x[I.source],sampler:R,uploaded:!1})}return S}(i,i.images),r=function(y,x){const S=[];for(const T of y.json.meshes){const I=[];for(const R of T.primitives)I.push(SS(R,y,x));S.push(I)}return S}(i,e),{scenes:o,scene:a,nodes:c}=i.json,d=o?o[a||0].nodes:c,g=[];for(const y of d)g.push(Bx(c[y],i,r));return function(y,x,S){const T={},I=new Set;for(let R=0;R<y.length;R++){const D=S[x[R]];if(!D.extras)continue;const O=D.extras["mapbox:footprint:version"],W=D.extras["mapbox:footprint:id"];(O||W)&&I.add(R),O==="1.0.0"&&W&&(T[W]=R)}for(let R=0;R<y.length;R++){if(I.has(R))continue;const D=y[R],O=S[x[R]];if(!O.extras)continue;let W=null;D.id in T&&(W=IS(y[T[D.id]].meshes,D.matrix)),W||(W=ES(O)),W&&(D.footprint=TS(W))}if(I.size>0){const R=Array.from(I.values()).sort((D,O)=>D-O);for(let D=R.length-1;D>=0;D--)y.splice(R[D],1)}}(g,d,i.json.nodes),g}function AS(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const e=i.vertexArray.float32,r=i.aabb.min[0]-1,o=i.aabb.min[1]-1,a=Ef/(i.aabb.max[0]-r+2),c=Ef/(i.aabb.max[1]-o+2);for(let d=0;d<e.length;d+=3){const g=e[d+2],y=(e[d+0]-r)*a|0,x=(e[d+1]-o)*c|0;g>i.heightmap[x*Ef+y]&&(i.heightmap[x*Ef+y]=g)}}function CS(i,e){const r={};r.indexArray=new ao,r.indexArray.reserve(4*i.length),r.vertexArray=new nl,r.vertexArray.reserve(10*i.length),r.colorArray=new jo,r.vertexArray.reserve(10*i.length);let o=0;for(const d of i){const g=Math.min(10,Math.max(4,1.3*d.height))*e,y=[-d.normal[1],d.normal[0],0],x=Math.min(.29,.1*d.width/d.depth),S=d.width-2*d.depth*e*(x+.01),T=dt([],d.pos,y,S/2),I=dt([],d.pos,y,-S/2),R=[T[0],T[1],T[2]+d.height],D=[I[0],I[1],I[2]+d.height],O=dt([],d.normal,y,x);or(O,O,g);const W=dt([],d.normal,y,-x);or(W,W,g),Or(O,T,O),Or(W,I,W),T[2]+=.1,I[2]+=.1,r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(W[0],W[1],W[2]),r.vertexArray.emplaceBack(T[0],T[1],T[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(R[0],R[1],R[2]),r.vertexArray.emplaceBack(D[0],D[1],D[2]),r.vertexArray.emplaceBack(T[0],T[1],T[2]),r.vertexArray.emplaceBack(I[0],I[1],I[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(W[0],W[1],W[2]);const X=S/g/2;r.colorArray.emplaceBack(-X-x,-1,X,.8),r.colorArray.emplaceBack(X+x,-1,X,.8),r.colorArray.emplaceBack(-X,0,X,1.3),r.colorArray.emplaceBack(X,0,X,1.3),r.colorArray.emplaceBack(X+x,-.8,X,.7),r.colorArray.emplaceBack(X+x,-.8,X,.7),r.colorArray.emplaceBack(0,0,X,1.3),r.colorArray.emplaceBack(0,0,X,1.3),r.colorArray.emplaceBack(X+x,-1.2,X,.8),r.colorArray.emplaceBack(X+x,-1.2,X,.8),r.indexArray.emplaceBack(6+o,4+o,8+o),r.indexArray.emplaceBack(7+o,9+o,5+o),r.indexArray.emplaceBack(0+o,1+o,2+o),r.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const a={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=ai.white,a.pbrMetallicRoughness=c,r.material=a,r.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class Vx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const o=e[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const MS=["id","tile","layer","source","sourceLayer","state"];class ap{constructor(e,r,o,a,c){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=o,this._y=a,this.properties=e.properties,this.id=c}clone(){const e=new ap(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of MS)this[r]!==void 0&&(e[r]=this[r]);return e}}class jx{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Su(Wt,16,0),this.featureIndexArray=new xd,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,o,a,c,d=0,g=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,a,c,d);const x=this.grid;for(let S=0;S<r.length;S++){const T=r[S],I=[1/0,1/0,-1/0,-1/0];for(let R=0;R<T.length;R++){const D=T[R];I[0]=Math.min(I[0],D.x),I[1]=Math.min(I[1],D.y),I[2]=Math.max(I[2],D.x),I[3]=Math.max(I[3],D.y)}g!==0&&(I[0]-=g,I[1]-=g,I[2]+=g,I[3]+=g),I[0]<Wt&&I[1]<Wt&&I[2]>=0&&I[3]>=0&&x.insert(y,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Pd.VectorTile(new Cm(this.rawTileData)).layers,this.sourceLayerCoder=new Vx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:o,transform:a,tileTransform:c,pixelPosMatrix:d,availableImages:g}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const y=o.bufferedTilespaceBounds,x=this.grid.query(y.min.x,y.min.y,y.max.x,y.max.y,(R,D,O,W)=>uo(o.bufferedTilespaceGeometry,R,D,O,W));x.sort(PS);let S=null;a.elevation&&x.length>0&&(S=tp.create(a.elevation,this.tileID));const T={};let I;for(let R=0;R<x.length;R++){const D=x[R];if(D===I)continue;I=D;const O=this.featureIndexArray.get(D);let W=null;this.is3DTile?this.loadMatchingModelFeature(T,O,e,o,a):this.loadMatchingFeature(T,O,e,g,(X,oe,re,B=0)=>(W||(W=ur(X,this.tileID.canonical,c)),oe.queryIntersectsFeature(o,X,re,W,this.z,a,d,S,B)))}return T}loadMatchingFeature(e,r,o,a,c){const{featureIndex:d,bucketIndex:g,sourceLayerIndex:y,layoutVertexArrayOffset:x}=r,S=this.bucketLayerIDs[g],T=o.layers,I=Object.keys(T);if(I.length&&!function(X,oe){for(let re=0;re<X.length;re++)if(oe.indexOf(X[re])>=0)return!0;return!1}(I,S))return;const R=o.sourceCache,D=this.sourceLayerCoder.decode(y),O=this.vtLayers[D].feature(d),W=this.getId(O,D);for(let X=0;X<S.length;X++){const oe=S[X];if(!T[oe])continue;const{styleLayer:re,targets:B}=T[oe];let J={};W!==void 0&&(J=R.getFeatureState(re.sourceLayer,W));const ie=!c||c(O,re,J,x);if(!ie)continue;const ce=new ap(O,this.z,this.x,this.y,W);ce.tile=this.tileID.canonical,ce.state=J;let Ie=this.serializedLayersCache.get(oe);Ie||(Ie=re.serialize(),Ie.id=oe,this.serializedLayersCache.set(oe,Ie)),ce.source=Ie.source,ce.sourceLayer=Ie["source-layer"],ce.layer=Je({},Ie),ce.layer.paint=Ux(Ie.paint,re.paint,O,J,a),ce.layer.layout=Ux(Ie.layout,re.layout,O,J,a);let Pe=!1;for(const Le of B){this.updateFeatureProperties(ce,Le);const{filter:Ue}=Le;if(Ue){if(O.properties=ce.properties,Ue.needGeometry){const ct=gr(O,!0);if(!Ue.filter(new Zi(this.tileID.overscaledZ),ct,this.tileID.canonical))continue}else if(!Ue.filter(new Zi(this.tileID.overscaledZ),O))continue}Pe=!0,Le.targetId&&this.addFeatureVariant(ce,Le)}Pe&&this.appendToResult(e,oe,d,ce,ie)}}loadMatchingModelFeature(e,r,o,a,c){const d=this.bucketLayerIDs[0][0],g=o.layers;if(!g[d])return;const{styleLayer:y,targets:x}=g[d];if(y.type!=="model")return;const S=a.tile,T=r.featureIndex,I=S.getBucket(y);if(!(I&&I instanceof Km))return;const R=function(Ie,Pe,Le,Ue){const ct=Ie.getNodesInfo()[Pe];if(ct.hiddenByReplacement||!ct.node.meshes)return;let Pt=Number.MAX_VALUE;const Tt=ct.node,At=Le.tile,Nt=Ue.calculatePosMatrix(At.tileID.toUnwrapped(),Ue.worldSize),at=ct.evaluatedScale;let It=0;Ue.elevation&&Tt.elevation&&(It=Tt.elevation*Ue.elevation.exaggeration()),Ke(Nt,Nt,[(Tt.anchor?Tt.anchor[0]:0)*(at[0]-1),(Tt.anchor?Tt.anchor[1]:0)*(at[1]-1),It]),et(Nt,Nt,at);const nt=Le.queryGeometry,ut=nt.isPointQuery()?nt.screenBounds:nt.screenGeometry,jt=function(wr){const hr=De([],Nt,wr.matrix);De(hr,Ue.expandedFarZProjMatrix,hr);for(let Jt=0;Jt<wr.meshes.length;++Jt){const Vt=wr.meshes[Jt];if(Jt===wr.lightMeshIndex)continue;const $r=jv(ut,Ue,hr,Vt.aabb);$r!=null&&(Pt=Math.min($r,Pt))}if(wr.children)for(const Jt of wr.children)jt(Jt)};if(jt(Tt),Pt===Number.MAX_VALUE)return;const qt=new U(0,0);return Jv(At.tileID.canonical,qt,ct.node.anchor[0],ct.node.anchor[1]),{intersectionZ:Pt,position:qt,feature:ct.feature}}(I,T,a,c);if(!R)return;const{z:D,x:O,y:W}=S.tileID.canonical,{feature:X,intersectionZ:oe,position:re}=R;let B={};X.id!==void 0&&(B=o.sourceCache.getFeatureState(y.sourceLayer,X.id));const J=new ap({},D,O,W,X.id);J.tile=this.tileID.canonical,J.state=B,J.properties=X.properties,J.geometry={type:"Point",coordinates:[re.lng,re.lat]};let ie=this.serializedLayersCache.get(d);ie||(ie=y.serialize(),ie.id=d,this.serializedLayersCache.set(d,ie)),J.source=ie.source,J.sourceLayer=ie["source-layer"],J.layer=Je({},ie);let ce=!1;for(const Ie of x){this.updateFeatureProperties(J,Ie);const{filter:Pe}=Ie;if(Pe){if(X.properties=J.properties,Pe.needGeometry){if(!Pe.filter(new Zi(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!Pe.filter(new Zi(this.tileID.overscaledZ),X))continue}ce=!0,Ie.targetId&&this.addFeatureVariant(J,Ie)}ce&&this.appendToResult(e,d,T,J,oe)}updateFeatureProperties(e,r,o){if(r.properties){const a={};for(const c in r.properties){const d=r.properties[c].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);d!=null&&(a[c]=d)}e.properties=a}}addFeatureVariant(e,r,o){const a={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(a)}appendToResult(e,r,o,a,c){let d=e[r];d===void 0&&(d=e[r]=[]),d.push({featureIndex:o,feature:a,intersectionZ:c})}lookupSymbolFeatures(e,r,o,a,c){const d={};this.loadVTLayers();for(const g of e)this.loadMatchingFeature(d,{bucketIndex:r,sourceLayerIndex:o,featureIndex:g,layoutVertexArrayOffset:0},a,c);return d}loadFeature(e){const{featureIndex:r,sourceLayerIndex:o}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(o),c=this.vtFeatures[a];if(c[r])return c[r];const d=this.vtLayers[a].feature(r);return c[r]=d,d}hasLayer(e){for(const r of this.bucketLayerIDs)for(const o of r)if(e===o)return!0;return!1}getId(e,r){let o=e.id;if(this.promoteId){const a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){const c=Zu(a);if(c.result!=="success"){const d=c.value.map(g=>`${g.key}: ${g.message}`).join(", ");return void Jr(`Failed to create expression for promoteId: ${d}`)}this.promoteIdExpression=c.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new ha),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[a];typeof o=="boolean"&&(o=Number(o))}return o}}function Ux(i,e,r,o,a){return Wr(i,(c,d)=>{const g=e instanceof il?e.get(d):null;return g&&g.evaluate?g.evaluate(r,o,void 0,a):g})}function PS(i,e){return e-i}ir(jx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const qx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class F_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=o>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const c=qx[15&o];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new F_(g,d,c,e)}constructor(e,r=64,o=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=qx.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-g%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+g+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=r,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return B_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,o,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:g}=this,y=[0,c.length-1,0],x=[];for(;y.length;){const S=y.pop()||0,T=y.pop()||0,I=y.pop()||0;if(T-I<=g){for(let W=I;W<=T;W++){const X=d[2*W],oe=d[2*W+1];X>=e&&X<=o&&oe>=r&&oe<=a&&x.push(c[W])}continue}const R=I+T>>1,D=d[2*R],O=d[2*R+1];D>=e&&D<=o&&O>=r&&O<=a&&x.push(c[R]),(S===0?e<=D:r<=O)&&(y.push(I),y.push(R-1),y.push(1-S)),(S===0?o>=D:a>=O)&&(y.push(R+1),y.push(T),y.push(1-S))}return x}within(e,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:c,nodeSize:d}=this,g=[0,a.length-1,0],y=[],x=o*o;for(;g.length;){const S=g.pop()||0,T=g.pop()||0,I=g.pop()||0;if(T-I<=d){for(let W=I;W<=T;W++)Hx(c[2*W],c[2*W+1],e,r)<=x&&y.push(a[W]);continue}const R=I+T>>1,D=c[2*R],O=c[2*R+1];Hx(D,O,e,r)<=x&&y.push(a[R]),(S===0?e-o<=D:r-o<=O)&&(g.push(I),g.push(R-1),g.push(1-S)),(S===0?e+o>=D:r+o>=O)&&(g.push(R+1),g.push(T),g.push(1-S))}return y}}function B_(i,e,r,o,a,c){if(a-o<=r)return;const d=o+a>>1;Gx(i,e,d,o,a,c),B_(i,e,r,o,d-1,1-c),B_(i,e,r,d+1,a,1-c)}function Gx(i,e,r,o,a,c){for(;a>o;){if(a-o>600){const x=a-o+1,S=r-o+1,T=Math.log(x),I=.5*Math.exp(2*T/3),R=.5*Math.sqrt(T*I*(x-I)/x)*(S-x/2<0?-1:1);Gx(i,e,r,Math.max(o,Math.floor(r-S*I/x+R)),Math.min(a,Math.floor(r+(x-S)*I/x+R)),c)}const d=e[2*r+c];let g=o,y=a;for(Qp(i,e,o,r),e[2*a+c]>d&&Qp(i,e,o,a);g<y;){for(Qp(i,e,g,y),g++,y--;e[2*g+c]<d;)g++;for(;e[2*y+c]>d;)y--}e[2*o+c]===d?Qp(i,e,o,y):(y++,Qp(i,e,y,a)),y<=r&&(o=y+1),r<=y&&(a=y-1)}}function Qp(i,e,r,o){N_(i,r,o),N_(e,2*r,2*o),N_(e,2*r+1,2*o+1)}function N_(i,e,r){const o=i[e];i[e]=i[r],i[r]=o}function Hx(i,e,r,o){const a=i-r,c=e-o;return a*a+c*c}s.$=bs,s.A=Ks,s.B=Q,s.C=El,s.D=rp,s.E=Ca,s.F=2,s.G=zp,s.H=tv,s.I=vs,s.J=class extends Xm{},s.K=Dr,s.L=ua,s.M=xa,s.N=xh,s.O=io,s.P=Ot,s.Q=id,s.R=oa,s.S=Wu,s.T=p_,s.U=ba,s.V=Xm,s.W=Nc,s.X=Zu,s.Y=Cc,s.Z=yu,s._=_u,s.a=function(i){return mn.API_CDN_URL_REGEX.test(i)},s.a$=Qt,s.a0=Xa,s.a1=qs,s.a2=Fc,s.a3=Oa,s.a4=function(i){const e=i.value;let r=[];if(!e)return r;const o=Dr(e);return o!=="string"?(r=r.concat([new Xm(i.key,e,`string expected, "${o}" found`)]),r):(y_(e,!0)||(r=r.concat([new Xm(i.key,e,`invalid url "${e}"`)])),r)},s.a5=Ze,s.a6=Eu,s.a7=kn,s.a8=Ut,s.a9=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return ii(i.expression.evaluate(e))}interpolate(i,e,r){return{x:Mr(i.x,e.x,r),y:Mr(i.y,e.y,r),z:Mr(i.z,e.z,r),azimuthal:Mr(i.azimuthal,e.azimuthal,r),polar:Mr(i.polar,e.polar,r)}}},s.aA=eo,s.aB=Ki,s.aC=vt,s.aD=ke,s.aE=m,s.aF=function(i,e){const r={};for(let o=0;o<e.length;o++){const a=e[o];a in i&&(r[a]=i[a])}return r},s.aG=ee,s.aH=me,s.aI=class{constructor(i){this.entries={},this.scheduler=i}request(i,e,r,o){const a=this.entries[i]=this.entries[i]||{callbacks:[]};if(a.result){const[c,d]=a.result;return this.scheduler?this.scheduler.add(()=>{o(c,d)},e):o(c,d),()=>{}}return a.callbacks.push(o),a.cancel||(a.cancel=r((c,d)=>{a.result=[c,d];for(const g of a.callbacks)this.scheduler?this.scheduler.add(()=>{g(c,d)},e):g(c,d);setTimeout(()=>delete this.entries[i],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(c=>c!==o),a.callbacks.length||(a.cancel(),delete this.entries[i]))}}},s.aJ=function(i,e,r){const o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},a=>{const c=Ta(i.request,(d,g,y,x)=>{d?a(d):g&&a(null,{vectorTile:r?void 0:new Pd.VectorTile(new Cm(g)),rawData:g,cacheControl:y,expires:x})});return()=>{c.cancel(),a()}},e)},s.aK=function(i){ss++,ss>Cr&&(i.getActor().send("enforceCacheSizeLimit",Yt),ss=0)},s.aL=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},s.aM=Jn,s.aN=Pv,s.aO=Ov,s.aP=Mv,s.aQ=function(i,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let o=0;o<i.length;o++){const a=document.createElement("source");Vd(i[o])||(r.crossOrigin="Anonymous"),a.src=i[o],r.appendChild(a)}return{cancel:()=>{}}},s.aR=Gm,s.aS=function(i){return fetch(i).then(e=>e.arrayBuffer()).then(e=>Fx(e,0,i))},s.aT=Nx,s.aU=class{constructor(i,e,r,o){this.id=i,this.position=e!=null?new U(e[0],e[1]):new U(0,0),this.orientation=r??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new yn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,e){if(De(i.matrix,e,i.matrix),i.meshes)for(const r of i.meshes){const o=yn.applyTransformFast(r.aabb,i.matrix);this.aabb.encapsulate(o)}if(i.children)for(const r of i.children)this._applyTransformations(r,i.matrix)}computeBoundsAndApplyParent(){const i=Xe([]);for(const e of this.nodes)this._applyTransformations(e,i)}computeModelMatrix(i,e,r,o,a,c,d=!1){Wv(this.matrix,this,i.transform,this.position,e,r,o,a,c,d)}upload(i){if(!this.uploaded){for(const e of this.nodes)x_(e,i);for(const e of this.nodes)Ym(e);this.uploaded=!0}}destroy(){for(const i of this.nodes)b_(i)}},s.aV=Nr,s.aW=Fp,s.aX=Te,s.aY=Ae,s.aZ=Au,s.a_=ao,s.aa=Zi,s.ab=rl,s.ac=tt,s.ad=jr,s.ae=fr,s.af=Fe,s.ag=il,s.ah=Qc,s.ai=Mr,s.aj=Wt,s.ak=au,s.al=G,s.am=ai,s.an=class{constructor(i){this.specification=i}possiblyEvaluate(i,e){return function([r,o]){const a=ii([1,r,o]);return{x:a.x,y:a.y,z:a.z}}(i.expression.evaluate(e))}interpolate(i,e,r){return{x:Mr(i.x,e.x,r),y:Mr(i.y,e.y,r),z:Mr(i.z,e.z,r)}}},s.ao=function(i,e,r=0,o=!0){const a=new Ot(r,r),c=i.sub(a),d=e.add(a),g=[c,new Ot(d.x,c.y),d,new Ot(c.x,d.y)];return o&&g.push(c.clone()),g},s.ap=function(i,e){const r=[];for(let o=0;o<i.length;o++){const a=Qe(o-1,-1,i.length-1),c=Qe(o+1,-1,i.length-1),d=i[o],g=i[c],y=i[a].sub(d).unit(),x=g.sub(d).unit(),S=x.angleWithSep(y.x,y.y),T=y.add(x).unit().mult(-1*e/Math.sin(S/2));r.push(d.add(T))}return r},s.aq=mv,s.ar=uo,s.as=function(i,e,r=0){return Tr(((e.x-r)*i.scale-i.x)*Wt,(e.y*i.scale-i.y)*Wt,rt(e.z,e.y))},s.at=zi,s.au=qr,s.av=ll,s.aw=Ay,s.ax=function(i){let e=1/0,r=1/0,o=-1/0,a=-1/0;for(const c of i)e=Math.min(e,c.x),r=Math.min(r,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y);return{min:new Ot(e,r),max:new Ot(o,a)}},s.ay=ye,s.az=De,s.b=function(i){return mn.API_FONTS_REGEX.test(i)},s.b$=or,s.b0=Fh,s.b1=Um,s.b2=function(){Js.isLoading()||Js.isLoaded()||Kn()!=="deferred"||Th()},s.b3=ec,s.b4=gr,s.b5=ap,s.b6=wn,s.b7=$g,s.b8=Ng,s.b9=ur,s.bA=function(i,e){const{x:r,y:o}=i.point,a=Md(r,o,i.worldSize/i._pixelsPerMercatorPixel,0,0);return De(a,a,wp(ul(e)))},s.bB=fe,s.bC=function(i){return i[0]=0,i[1]=0,i[2]=0,i},s.bD=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},s.bE=Gr,s.bF=dt,s.bG=pi,s.bH=Lp,s.bI=cl,s.bJ=e_,s.bK=function(i,e,r,o,a){const c=5*e+2;i.float32[c+0]=r,i.float32[c+1]=o,i.float32[c+2]=a},s.bL=jm,s.bM=Am,s.bN=Ir,s.bO=ds,s.bP=X0,s.bQ=Uv,s.bR=ey,s.bS=ty,s.bT=n_,s.bU=lv,s.bV=Qg,s.bW=F_,s.bX=Qe,s.bY=ko,s.bZ=function(i,e,r){r*=.5;var o=e[0],a=e[1],c=e[2],d=e[3],g=Math.sin(r),y=Math.cos(r);return i[0]=o*y+a*g,i[1]=a*y-o*g,i[2]=c*y+d*g,i[3]=d*y-c*g,i},s.b_=mo,s.ba=Il,s.bb=zh,s.bc=Ro,s.bd=Sn,s.be=Ll,s.bf=h_,s.bg=function(i,e){const r=Qc(e.zoom);if(r===0)return ul(i);const o=ff(i),a=pf(o),c=ye(o.getWest())*e.worldSize,d=ye(o.getEast())*e.worldSize,g=me(o.getNorth())*e.worldSize,y=me(o.getSouth())*e.worldSize,x=[c,g,0],S=[d,g,0],T=[c,y,0],I=[d,y,0],R=We([],e.globeMatrix);return jr(x,x,R),jr(S,S,R),jr(T,T,R),jr(I,I,R),a[0]=Lu(a[0],T,r),a[1]=Lu(a[1],I,r),a[2]=Lu(a[2],S,r),a[3]=Lu(a[3],x,r),yn.fromPoints(a)},s.bh=gf,s.bi=We,s.bj=Jc,s.bk=Lu,s.bl=Ah,s.bm=Ua,s.bn=St,s.bo=Ke,s.bp=sg,s.bq=Cm,s.br=Ta,s.bs=function(i,e){const r=[];for(const o in i)o in e||r.push(o);return r},s.bt=_t,s.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bv=pn,s.bw=function(i){var e=new F(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},s.bx=Xe,s.by=bt,s.bz=ze,s.c=na,s.c$=function(i){return i({pluginStatus:No,pluginURL:Sl}),jc.on("pluginStateChange",i),i},s.c0=zs,s.c1=Vn,s.c2=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},s.c3=Fr,s.c4=function(i,e,r,o,a){var c,d=1/Math.tan(e/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(i[10]=(a+o)*(c=1/(o-a)),i[14]=2*a*o*c):(i[10]=-1,i[14]=-2*o),i},s.c5=function(i,e,r,o,a,c,d){var g=1/(e-r),y=1/(o-a),x=1/(c-d);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+r)*g,i[13]=(a+o)*y,i[14]=(d+c)*x,i[15]=1,i},s.c6=he,s.c7=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},s.c8=Cl,s.c9=sl,s.cA=Wm,s.cB=hi,s.cC=Fv,s.cD=function(i){const e=Fv(i,!0);return fe([],[e[0],e[1],e[4],e[5]])},s.cE=et,s.cF=wa,s.cG=st,s.cH=function(i){const{x:e,y:r}=i.point,{lng:o,lat:a}=i._center;return Md(e,r,i.worldSize,o,a)},s.cI=fi,s.cJ=K,s.cK=Jo,s.cL=_,s.cM=function(i,e,r){let o=0;for(let a=0;a<2;++a)i[a]>0&&(o+=(i[a]-0)*(i[a]-0)),e[a]<0&&(o+=(0-e[a])*(0-e[a]));return o},s.cN=45,s.cO=lu,s.cP=xe,s.cQ=Ko,s.cR=function(i,e,r){const o=Math.sqrt(i*i+e*e+r*r),a=o>0?Math.acos(r/o)*ot:0;let c=i!==0||e!==0?Math.atan2(-e,-i)*ot+90:0;return c<0&&(c+=360),[o,c,a]},s.cS=Tr,s.cT=je,s.cU=Or,s.cV=yn,s.cW=ii,s.cX=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},s.cY=ri,s.cZ=y_,s.c_=function(i,e){return i.readFields(A2,{icons:[]},e)},s.ca=Pu,s.cb=lo,s.cc=Yo,s.cd=U,s.ce=xv,s.cf=function(){var i=new F(4);return F!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},s.cg=function(i,e,r){var o=e[0],a=e[1],c=e[2],d=e[3],g=Math.sin(r),y=Math.cos(r);return i[0]=o*y+c*g,i[1]=a*y+d*g,i[2]=o*-g+c*y,i[3]=a*-g+d*y,i},s.ch=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},s.ci=xo,s.cj=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},s.ck=is,s.cl=Xn,s.cm=Uo,s.cn=sc,s.co=Bv,s.cp=yi,s.cq=mm,s.cr=function(i,e,r,o,a,c,d,g,y){if(y.name==="globe")return mm(i,e,new yi(r,o,a),!1);const x=Fp({z:r,x:o,y:a},y);return new yn([(c+x.x/x.scale)*e,e*(x.y/x.scale),d],[(c+x.x2/x.scale)*e,e*(x.y2/x.scale),g])},s.cs=function(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i[3]=Math.min(e[3],r[3]),i},s.ct=function(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i[3]=Math.max(e[3],r[3]),i},s.cu=function(i){const e=Math.round((i+45+360)%360/90)%4;return ge[e]},s.cv=Ge,s.cw=fs,s.cx=v,s.cy=function(i){const e=Xe(new Float64Array(16));De(e,i.pixelMatrix,i.globeMatrix);const r=[0,P,0],o=[0,M,0];return jr(r,r,e),jr(o,o,e),[r[0]>0&&r[0]<=i.width&&r[1]>0&&r[1]<=i.height&&!h(i,new U(i.center.lat,90)),o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!h(i,new U(i.center.lat,-90))]},s.cz=function(i,e){const{scale:r}=i.tileTransform,o=r*Wt/(i.tileSize*Math.pow(2,e.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return function(a,c,d){var g=c[1],y=c[2],x=c[3],S=d[0],T=d[1];return a[0]=c[0]*S,a[1]=g*S,a[2]=y*T,a[3]=x*T,a}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},s.d=function(i){return mn.API_TILEJSON_REGEX.test(i)},s.d$=md,s.d0=Jm,s.d1=Kf,s.d2=r_,s.d3=ki,s.d4=Ba,s.d5=Ct,s.d6=Co,s.d7=Xr,s.d8=function(i){const e=i.indexOf(Uc);return e>=0?i.slice(0,e):i},s.d9=function(i){return i.indexOf(Uc)>=0},s.dA=gm,s.dB=Fn,s.dC=Gn,s.dD=256,s.dE=function(i,e){const r=[0,0,0];return jr(r,r,gf(ul(e.canonical))),jr(r,r,i),r},s.dF=i=>({u_camera_to_center_distance:new lo(i),u_extrude_scale:new Na(i),u_device_pixel_ratio:new lo(i),u_matrix:new Cl(i),u_inv_rot_matrix:new Cl(i),u_merc_center:new sl(i),u_tile_id:new Pu(i),u_zoom_transition:new lo(i),u_up_dir:new Pu(i),u_emissive_strength:new lo(i)}),s.dG=i=>({u_matrix:new Cl(i),u_pixels_to_tile_units:new Na(i),u_device_pixel_ratio:new lo(i),u_width_scale:new lo(i),u_floor_width_scale:new lo(i),u_units_to_pixels:new sl(i),u_dash_image:new Yo(i),u_gradient_image:new Yo(i),u_image_height:new lo(i),u_texsize:new sl(i),u_tile_units_to_pixels:new lo(i),u_alpha_discard_threshold:new lo(i),u_trim_offset:new sl(i),u_trim_fade_range:new sl(i),u_trim_color:new Ko(i),u_emissive_strength:new lo(i),u_zbias_factor:new lo(i),u_tile_to_meter:new lo(i),u_ground_shadow_factor:new Pu(i)}),s.dH=i=>({u_matrix:new Cl(i),u_texsize:new sl(i),u_pixels_to_tile_units:new Na(i),u_device_pixel_ratio:new lo(i),u_width_scale:new lo(i),u_floor_width_scale:new lo(i),u_image:new Yo(i),u_units_to_pixels:new sl(i),u_tile_units_to_pixels:new lo(i),u_alpha_discard_threshold:new lo(i),u_trim_offset:new sl(i),u_trim_fade_range:new sl(i),u_trim_color:new Ko(i),u_emissive_strength:new lo(i),u_zbias_factor:new lo(i),u_tile_to_meter:new lo(i),u_ground_shadow_factor:new Pu(i),u_pattern_transition:new lo(i)}),s.dI=Zc,s.dJ=Rw,s.dK=H,s.dL=(i,e,r,o,a,c)=>{const d=i.transform,g=d.projection.name==="globe";let y;if(c.paint.get("circle-pitch-alignment")==="map")if(g){const S=gm(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;y=Float32Array.from([S,0,0,S])}else y=d.calculatePixelsToTileUnitsMatrix(r);else y=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const x={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(d.projection),u_matrix:i.translatePosMatrix(e.projMatrix,r,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:we.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:z,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(g){x.u_inv_rot_matrix=o,x.u_merc_center=a,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=Qc(d.zoom);const S=a[0]*Wt,T=a[1]*Wt;x.u_up_dir=d.projection.upVector(new yi(0,0,0),S,T)}return x},s.dM=Ry,s.dN=ve,s.dO=(i,e,r,o,a,c,d,g,y,x)=>{const S=i.transform,T=S.pitch<15?Cy(.07,.7,ke((14-S.zoom)/5,0,1)):.07,I=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Py(i,e,r,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:S.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:c,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:My(e,S),u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(I?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:T,u_tile_to_meter:je(e.tileID.canonical,0),u_ground_shadow_factor:y,u_pattern_transition:x}},s.dP=(i,e,r,o,a,c,d,g,y,x)=>{const S=i.transform,T=S.calculatePixelsToTileUnitsMatrix(e),I=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",R=S.pitch<15?Cy(.07,.7,ke((14-S.zoom)/5,0,1)):.07;return{u_matrix:Py(i,e,r,o),u_pixels_to_tile_units:T,u_device_pixel_ratio:c,u_width_scale:d,u_floor_width_scale:g,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:Dy(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:My(e,i.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(I?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:R,u_tile_to_meter:je(e.tileID.canonical,0),u_ground_shadow_factor:x}},s.dQ=lr,s.dR=Ri,s.dS=rt,s.dT=py,s.dU=al,s.dV=Im,s.dW=Rd,s.dX=450,s.dY=7,s.dZ=h2,s.d_=Fi,s.da=function(i){const e=i.lastIndexOf(Uc);return e>=0?i.slice(e+1):""},s.db=function(i){const e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dc=function(i,e,r,o){return i.type==="custom"?new d2(i,e):new S2[i.type](i,e,r,o)},s.dd=Zr,s.de=function(i){const e=i.indexOf(Uc);return e>=0?i.slice(e+1):""},s.df=class extends ap{constructor(i,e){super(i._vectorTileFeature,i._z,i._x,i._y,i.id),i.state&&(this.state=Object.assign({},i.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=i.source,this.sourceLayer=i.sourceLayer,this.layer=i.layer)}toJSON(){const i=super.toJSON();return i.target=this.target,i.namespace=this.namespace,i}},s.dg=jc,s.dh=Bl,s.di=Wf,s.dj=class extends ea{constructor(i){super(i),this.current=Td}set(i,e,r){if(this.fetchUniformLocation(i,e)){for(let o=0;o<9;o++)if(r[o]!==this.current[o]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},s.dk=Ce,s.dl=function(i,e,r){const o=Qc(r.zoom),a=i.style.map._antialias,c=i.terrain&&i.terrain.exaggeration()>0;return o===0&&!a&&!c},s.dm=function(i){const e=i.pixelsPerMeter,r=e/he(1,i.center.lat),o=Xe(new Float64Array(16));return Ke(o,o,[i.point.x,i.point.y,0]),et(o,o,[r,r,e]),Float32Array.from(o)},s.dn=ff,s.dp=function(i){const e=Ge-5;i=ke(i,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(G(i))),3);return Math.round(r*(A.length-1))},s.dq=function(i,e,r,o){const a=e.getNorth(),c=e.getSouth(),d=e.getWest(),g=e.getEast(),y=1<<i.z,x=g-d,S=a-c,T=x/E,I=-S/A[r],R=[0,T,0,I,0,0,a,d,0];if(i.z>0){const D=180/o;Ye(R,R,[D/x+1,0,0,0,D/S+1,0,-.5*D/T,.5*D/I,1])}return R[2]=y,R[5]=i.x,R[8]=i.y,R},s.dr=ul,s.ds=function(i,e,r){const o=Xe(new Float64Array(16)),a=(e/(1<<i)-.5)*Math.PI*2;return $e(o,r.globeMatrix,a),Float32Array.from(o)},s.dt=class{isDataAvailableAtPoint(i){const e=this._source();if(this.isUsingMockSource()||!e||i.y<0||i.y>1)return!1;const r=e.getSource().maxzoom,o=1<<r,a=Math.floor(i.x),c=Math.floor((i.x-a)*o),d=Math.floor(i.y*o),g=this.findDEMTileFor(new Jn(r,a,r,c,d));return!(!g||!g.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||i.y<0||i.y>1)return e;const a=o.getSource().maxzoom,c=1<<a,d=Math.floor(i.x),g=i.x-d,y=new Jn(a,d,a,Math.floor(g*c),Math.floor(i.y*c)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;const S=x.dem,T=1<<x.tileID.canonical.z,I=(g*T-x.tileID.canonical.x)*S.dim,R=(i.y*T-x.tileID.canonical.y)*S.dim,D=Math.floor(I),O=Math.floor(R);return(r?this.exaggeration():1)*Mr(Mr(S.get(D,O),S.get(D,O+1),R-O),Mr(S.get(D+1,O),S.get(D+1,O+1),R-O),I-D)}getAtTileOffset(i,e,r){const o=1<<i.canonical.z;return this.getAtPointOrZero(new tt(i.wrap+(i.canonical.x+e/Wt)/o,(i.canonical.y+r/Wt)/o))}getAtTileOffsetFunc(i,e,r,o){return a=>{const c=this.getAtTileOffset(i,a.x,a.y),d=o.upVector(i.canonical,a.x,a.y);return or(d,d,c*o.upVectorScale(i.canonical,e,r).metersToTile),d}}getForTilePoints(i,e,r,o){if(this.isUsingMockSource())return!1;const a=tp.create(this,i,o);return!!a&&(e.forEach(c=>{c[2]=this.exaggeration()*a.getElevationAt(c[0],c[1],r)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const r=e.dem.tree,o=e.tileID,a=1<<i.canonical.z-o.canonical.z;let c=i.canonical.x/a-o.canonical.x,d=i.canonical.y/a-o.canonical.y,g=0;for(let y=0;y<i.canonical.z-o.canonical.z&&!r.leaves[g];y++){c*=2,d*=2;const x=2*Math.floor(d)+Math.floor(c);g=r.childOffsets[g]+x,c%=1,d%=1}return{min:this.exaggeration()*r.minimums[g],max:this.exaggeration()*r.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let e=!1,r=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const a of i){const c=this.getMinMaxForTile(a.tileID);c&&(r=Math.min(r,c.min),o=Math.max(o,c.max),e=!0)}return e?{min:r,max:o}:null}},s.du=vi,s.dv=ku,s.dw=function(i,e){return[Math.pow(i[0],2.2)*e,Math.pow(i[1],2.2)*e,Math.pow(i[2],2.2)*e]},s.dx=qe,s.dy=function(i,e){var r=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=r,i[2]=0,i[3]=-r,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},s.dz=Dn,s.e=mn,s.e$=Vx,s.e0=256,s.e1=wp,s.e2=nl,s.e3=$e,s.e4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},s.e5=Cu,s.e6=Xc,s.e7=function(i,e,r,o,a){return ke((i-e)/(r-e)*(a-o)+o,o,a)},s.e8=oo,s.e9=function(i,e){var r=e[0],o=e[1],a=e[2],c=e[3],d=e[4],g=e[5],y=e[6],x=e[7],S=e[8],T=S*d-g*x,I=-S*c+g*y,R=x*c-d*y,D=r*T+o*I+a*R;return D?(i[0]=T*(D=1/D),i[1]=(-S*o+a*x)*D,i[2]=(g*o-a*d)*D,i[3]=I*D,i[4]=(S*r-a*y)*D,i[5]=(-g*r+a*c)*D,i[6]=R*D,i[7]=(-x*r+o*y)*D,i[8]=(d*r-o*c)*D,i):null},s.eA=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},s.eB=ts,s.eC=q,s.eD=bi,s.eE=function(i,e,r,o){return i[0]=e,i[1]=r,i[2]=o,i},s.eF=function([i,e,r]){const o=Math.hypot(i,e,r),a=Math.atan2(i,r),c=.5*Math.PI-Math.acos(-e/o);return new U(K(a),K(c))},s.eG=rs,s.eH=g_,s.eI=function(i){const e=i.navigator?i.navigator.userAgent:null;return!!function(r){if(On==null){const o=r.navigator?r.navigator.userAgent:null;On=!!r.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return On}(i)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.eJ=function(i,e){Yt=i,Cr=e},s.eK=h,s.eL=_f,s.eM=function(i){const e=[0,0,0],r=Xe(new Float64Array(16));return De(r,i.pixelMatrix,i.globeMatrix),jr(e,e,r),new Ot(e[0],e[1])},s.eN=function(i,e,r=!1){if(No===Ku||No===Fa||No===Ju)throw new Error("setRTLTextPlugin cannot be called multiple times.");Sl=we.resolveURL(i),No=Ku,Qu=e,Sh(),r||Th()},s.eO=Kn,s.eP=function(){Jm().acquire(S_)},s.eQ=function(){const i=Hp;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(S_),Hp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.eR=Af,s.eS=function(i){const e=jn();if(!e)return;const r=e.delete(wt);i&&r.then(()=>i()).catch(i)},s.eT=Gp,s.eU=Px,s.eV=function(i){k_=we.resolveURL(i),sp||(sp=new rp(Jm(),new Ca)),sp.broadcast("setDracoUrl",k_)},s.eW=Rx,s.eX=function(i){op=we.resolveURL(i),sp||(sp=new rp(Jm(),new Ca)),sp.broadcast("setMeshoptUrl",op)},s.eY=ir,s.eZ=Lt,s.e_=ac,s.ea=ga,s.eb=Ai,s.ec=mt,s.ed=class{constructor(i,e,r,o){this.context=i,this.format=o,this.size=r,this.texture=i.gl.createTexture();const[a,c,d]=this.size,{gl:g}=i;g.bindTexture(g.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,a,c,d,0,d_(this.format),f_(this.format),e.data)}bind(i,e){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_3D,this.texture),i!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,i),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,i),this.minFilter=i),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},s.ee=function(i,e){if(i===e){var r=e[1],o=e[2],a=e[3],c=e[6],d=e[7],g=e[11];i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=r,i[6]=e[9],i[7]=e[13],i[8]=o,i[9]=c,i[11]=e[14],i[12]=a,i[13]=d,i[14]=g}else i[0]=e[0],i[1]=e[4],i[2]=e[8],i[3]=e[12],i[4]=e[1],i[5]=e[5],i[6]=e[9],i[7]=e[13],i[8]=e[2],i[9]=e[6],i[10]=e[10],i[11]=e[14],i[12]=e[3],i[13]=e[7],i[14]=e[11],i[15]=e[15];return i},s.ef=__,s.eg=ht,s.eh=[1,1,1],s.ei=function(i,e,r,o){var a=new F(4);return a[0]=i,a[1]=e,a[2]=r,a[3]=o,a},s.ej=no,s.ek=function(i,e,r,o){var a=e[0],c=e[1],d=e[2],g=e[3];return i[0]=a+o*(r[0]-a),i[1]=c+o*(r[1]-c),i[2]=d+o*(r[2]-d),i[3]=g+o*(r[3]-g),i},s.el=tp,s.em=ep,s.en=ol,s.eo=Mu,s.ep=function(i,e,r,o,a,c,d,g,y,x,S,T,I,R,D,O){var W=new F(16);return W[0]=i,W[1]=e,W[2]=r,W[3]=o,W[4]=a,W[5]=c,W[6]=d,W[7]=g,W[8]=y,W[9]=x,W[10]=S,W[11]=T,W[12]=I,W[13]=R,W[14]=D,W[15]=O,W},s.eq=V,s.er=Lh,s.es=fd,s.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ot(1/0,1/0),max:new Ot(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,e=!1){const r=K0(new Ot(0,0),new Ot(Wt,Wt),i),o=[];if(e&&!jg(r,this._globalClipBounds))return o;for(const a of this._activeRegions){if(a.hiddenByOverlap||!jg(r,a))continue;const c=iw(a.min,a.max,i);o.push({min:c.min,max:c.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return o}setSources(i){this._setSources(i.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const o of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(o).buckets[e.layer];a&&a.updateFootprints(o.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(i){const e=i.getFootprints();if(e.length===0)return;const r=i.getOrder(),o=i.getClipMask(),a=i.getClipScope();for(const c of e){if(!c.footprint)continue;const d=K0(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:r,clipMask:o,clipScope:a})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||Tm(e.min,r.min)||Tm(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(o,a){const c=(d,g)=>d+g;return o.length-a.length||o.reduce(c,"").localeCompare(a.reduce(c,""))}(e.clipScope,r.clipScope));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let e=0;for(;!i&&e!==this._activeRegions.length;){const r=this._activeRegions[e],o=this._prevRegions[e];i=r.priority!==o.priority||!Y0(r,o)||r.order!==o.order||r.clipMask!==o.clipMask||!pn(r.clipScope,o.clipScope),++e}}if(i){++this._updateTime;for(const r of this._activeRegions)r.order!==Sm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const o=this._activeRegions;if(r>=o.length)return r;const a=o[r].priority;for(;r<o.length&&o[r].priority===a;)++r;return r};if(this._sourceIds.length>1){let r=0,o=e(r);for(;r!==o;){let a=r;const c=r;for(;a!==o;){const d=this._activeRegions[a];d.hiddenByOverlap=!1;for(let g=0;g<c;g++){const y=this._activeRegions[g];if(!y.hiddenByOverlap&&d.order===Sm&&jg(d,y)&&(d.hiddenByOverlap=Q0(d.footprint,d.tileId,y.footprint,y.tileId),d.hiddenByOverlap))break}++a}r=o,o=e(r)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=i.length-1;e>=0;e--)this._addSource(i[e]);this._computeReplacement()}},s.eu=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,e){const r=new Il,o=new ao,a=[],c=i+1+2,d=e[0]+1,g=e[0]+1+(1+e.length),y=(x,S,T)=>{let I=x===c-1?x-2:x===0?x:x-1;return I+=T?24575:0,[I,S]};for(let x=0;x<c;++x)r.emplaceBack(...y(x,0,!0));for(let x=0;x<d;++x)for(let S=0;S<c;++S)r.emplaceBack(...y(S,x,(S===0||S===c-1)&&!0));for(let x=0;x<e.length;++x){const S=e[x];for(let T=0;T<c;++T)r.emplaceBack(...y(T,S,!0))}for(let x=0;x<e.length;++x){const S=o.length,T=e[x]+1+2,I=new ao;for(let O=0;O<T-1;O++){const W=O===T-2,X=W?c*(g-e.length+x-O):c;for(let oe=0;oe<c-1;oe++){const re=O*c+oe;O===0||W||oe===0||oe===c-2?(I.emplaceBack(re+1,re,re+X),I.emplaceBack(re+X,re+X+1,re+1)):(o.emplaceBack(re+1,re,re+X),o.emplaceBack(re+X,re+X+1,re+1))}}const R=Sn.simpleSegment(0,S,r.length,o.length-S);for(let O=0;O<I.uint16.length;O+=3)o.emplaceBack(I.uint16[O],I.uint16[O+1],I.uint16[O+2]);const D=Sn.simpleSegment(0,S,r.length,o.length-S);a.push({withoutSkirts:R,withSkirts:D})}return{vertices:r,indices:o,segments:a}}_createGrid(i){const e=this._fillGridMeshWithLods(E,A);this._gridSegments=e.segments,this._gridBuffer=i.createVertexBuffer(e.vertices,Ro.members),this._gridIndexBuffer=i.createIndexBuffer(e.indices,!0)}_createPoles(i){const e=new ao;for(let d=0;d<=E;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);const r=new Cu,o=new Cu,a=new Cu,c=new Cu;this._poleSegments=[];for(let d=0,g=0;d<_;d++){const y=360/(1<<d);r.emplaceBack(0,-m,0,.5,0),o.emplaceBack(0,-m,0,.5,1),a.emplaceBack(0,-m,0,.5,.5),c.emplaceBack(0,-m,0,.5,.5);for(let x=0;x<=E;x++){let S=x/E,T=0;const I=Mr(0,y,S),[R,D,O]=k(b,C,I,m);r.emplaceBack(R,D,O,S,T),o.emplaceBack(R,D,O,S,1-T);const W=G(I);S=.5+.5*Math.sin(W),T=.5+.5*Math.cos(W),a.emplaceBack(R,D,O,S,T),c.emplaceBack(R,D,O,S,1-T)}this._poleSegments.push(Sn.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,Hs,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(o,Hs,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(a,Hs,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(c,Hs,!1)}getGridBuffers(i,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},s.ev=Sm,s.ew=Me,s.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.ey=Re,s.ez=Bt,s.f=function(i){return i.indexOf("mapbox:")===0},s.f0=jx,s.f1=Ty,s.f2=vf,s.f3="hd_road_elevation",s.f4=Og,s.f5=Wr,s.f6=bf,s.f7=t_,s.f8=Sf,s.f9=function(i,e,r,o,a,c,d,g=1,y,x){i.createArrays(),i.tilePixelRatio=Wt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const S=i.layers[0].layout,T=i.layers[0]._unevaluatedLayout._values,I={};I.scaleFactor=g,I.textSizeScaleRange=S.get("text-size-scale-range"),I.iconSizeScaleRange=S.get("icon-size-scale-range");const[R,D]=I.textSizeScaleRange,[O,W]=I.iconSizeScaleRange;I.textScaleFactor=ke(I.scaleFactor,R,D),I.iconScaleFactor=ke(I.scaleFactor,O,W);const X=T["text-size"],oe=T["icon-size"];if(i.textSizeData.kind==="composite"){const{minZoom:Ie,maxZoom:Pe}=i.textSizeData;I.compositeTextSizes=[X.possiblyEvaluate(new Zi(Ie),c),X.possiblyEvaluate(new Zi(Pe),c)]}if(i.iconSizeData.kind==="composite"){const{minZoom:Ie,maxZoom:Pe}=i.iconSizeData;I.compositeIconSizes=[oe.possiblyEvaluate(new Zi(Ie),c),oe.possiblyEvaluate(new Zi(Pe),c)]}I.layoutTextSize=X.possiblyEvaluate(new Zi(d+1),c),I.layoutIconSize=oe.possiblyEvaluate(new Zi(d+1),c),I.textMaxSize=X.possiblyEvaluate(new Zi(18),c);const re=S.get("symbol-placement"),B=S.get("text-rotation-alignment")==="map"&&re!=="point",J=S.get("text-size");let ie=!1;const ce=[];for(const Ie of i.features){const Pe=S.get("text-font").evaluate(Ie,{},c).join(","),Le=J.evaluate(Ie,{},c)*I.textScaleFactor,Ue=I.layoutTextSize.evaluate(Ie,{},c)*I.textScaleFactor,ct=I.layoutIconSize.evaluate(Ie,{},c)*I.iconScaleFactor,Pt={horizontal:{},vertical:void 0},Tt=Ie.text;let At,Nt=[0,0];if(Tt){const yr=Tt.toString(),Vr=S.get("text-letter-spacing").evaluate(Ie,{},c)*ds,Kr=S.get("text-line-height").evaluate(Ie,{},c)*ds,ni=Qd(yr)?Vr:0,_i=S.get("text-anchor").evaluate(Ie,{},c),ci=S.get("text-variable-anchor");if(!ci){const de=S.get("text-radial-offset").evaluate(Ie,{},c);if(de)Nt=lv(_i,[de*ds,i_]);else{const pt=S.get("text-offset").evaluate(Ie,{},c);Nt=[pt[0]*ds,pt[1]*ds]}}let oi=B?"center":S.get("text-justify").evaluate(Ie,{},c);const an=re==="point",vn=an?S.get("text-max-width").evaluate(Ie,{},c)*ds:1/0,le=de=>{i.allowVerticalPlacement&&wl(yr)&&(Pt.vertical=Jg(Tt,e,r,a,Pe,vn,Kr,_i,de,ni,Nt,cl.vertical,!0,Ue,Le,y))};if(!B&&ci){const de=oi==="auto"?ci.map($t=>n_($t)):[oi];let pt=!1;for(let $t=0;$t<de.length;$t++){const tr=de[$t];if(!Pt.horizontal[tr])if(pt)Pt.horizontal[tr]=Pt.horizontal[0];else{const er=Jg(Tt,e,r,a,Pe,vn,Kr,"center",tr,ni,Nt,cl.horizontal,!1,Ue,Le,y);er&&(Pt.horizontal[tr]=er,pt=er.positionedLines.length===1)}}le("left")}else{if(oi==="auto"&&(oi=n_(_i)),an||S.get("text-writing-mode").indexOf("horizontal")>=0||!wl(yr)){const de=Jg(Tt,e,r,a,Pe,vn,Kr,_i,oi,ni,Nt,cl.horizontal,!1,Ue,Le,y);de&&(Pt.horizontal[oi]=de)}le(an?"left":oi)}}let at,It,nt,ut,jt,qt,wr,hr=!1;if(Ie.icon&&Ie.icon.hasPrimary()){const yr=cv(Ie.icon,i.iconSizeData,T["icon-size"],c,i.zoom,Ie,y,I.iconScaleFactor);at=yr.iconPrimary,nt=yr.iconSecondary;const Vr=at.toString();if(It=o.get(Vr),It&&(jt=S.get("icon-offset").evaluate(Ie,{},c),qt=S.get("icon-anchor").evaluate(Ie,{},c),wr=S.get("icon-text-fit").evaluate(Ie,{},c),At=Uw(a.get(Vr),nt?a.get(nt.toString()):void 0,jt,qt),hr=It.sdf,i.sdfIcons===void 0?i.sdfIcons=It.sdf:i.sdfIcons!==It.sdf&&Jr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(It.pixelRatio!==i.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0)),nt){const Kr=nt.toString();ut=o.get(Kr)}}ie=ie||!(!Ie.icon||!Ie.icon.hasSecondary());const Jt=o_(Pt.horizontal)||Pt.vertical;i.iconsInText||(i.iconsInText=!!Jt&&Jt.iconsInText);const Vt=Ue*I.textScaleFactor/ds,{defaultShapedIcon:$r,verticallyShapedIcon:_r}=Kw(i,At,S,Ie,c,Pt,Vt,jt,wr);wr!=="none"&&At&&($y(At)||Wy(At))&&(Lm(0,It,at,At,$r,wr,x,o,a),Lm(0,ut,nt,At,$r,wr,x,o,a),_r&&(Lm(0,It,at,At,_r,wr,x,o,a),Lm(0,ut,nt,At,_r,wr,x,o,a))),At=$r,ce.push({feature:Ie,shapedTextOrientations:Pt,shapedText:Jt,shapedIcon:At,iconPrimary:at,iconSecondary:nt,iconOffset:jt,iconAnchor:qt,verticallyShapedIcon:_r,layoutTextSize:Ue,layoutIconSize:ct,textOffset:Nt,isSDFIcon:hr,iconTextFit:wr})}return{featureData:ce,sizes:I,hasAnySecondaryIcon:ie,textAlongLine:B,symbolPlacement:re}},s.fa=rv,s.fb=function(i,e,r,o,a,c,d,g,y,x){const{featureData:S,hasAnySecondaryIcon:T,sizes:I,textAlongLine:R,symbolPlacement:D}=e;for(const O of S){const{shapedIcon:W,verticallyShapedIcon:X,feature:oe,shapedTextOrientations:re,shapedText:B,layoutTextSize:J,textOffset:ie,isSDFIcon:ce,iconPrimary:Ie,iconSecondary:Pe,iconTextFit:Le,iconOffset:Ue}=O;hv(W,x.iconPositions,Ie,Pe),hv(X,x.iconPositions,Ie,Pe),Yw(re,x.iconPositions),(B||W)&&Jw(i,oe,re,W,X,y,I,J,0,ie,ce,o,a,d,g,T,Le,Ue,R,D)}r&&i.generateCollisionDebugBuffers(c,i.collisionBoxArray,I.textScaleFactor)},s.fc=Pd,s.fd=og,s.fe=un,s.ff=L0,s.fg=By,s.fh=to,s.fi=function(i){let e=0;if(new Uint32Array(i,0,1)[0]!==kx){const r=new Uint32Array(i,0,7),[,,o,a,c,d]=r;e=r.byteLength+a+c+d+c,(o!==i.byteLength||e>=i.byteLength)&&Jr("Invalid b3dm header information.")}return Fx(i,e)},s.fj=function(i,e){const r=Nx(i);for(const o of r){for(const a of o.meshes)AS(a);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(CS(o.lights,e)))}return r},s.fk=Km,s.fl=Pi,s.fm=Qv,s.fn=Js,s.fo=function(i){bo(),mi!=null&&mi.then(e=>{e.keys().then(r=>{for(let o=0;o<r.length-i;o++)e.delete(r[o]).catch(a=>Jr(a.message))}).catch(r=>Jr(r.message))}).catch(e=>Jr(e.message))},s.g=function(i,e){return Bl(Je(i,{method:"GET"}),e)},s.h=Is,s.i=function(i){return mn.API_STYLE_REGEX.test(i)&&!na(i)},s.j=function(i){return decodeURIComponent(atob(i).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},s.k=function(i){return btoa(encodeURIComponent(i).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},s.l=Je,s.m=as,s.n=function(i,e){return Bl(Je(i,{type:"json"}),e)},s.o=Mn,s.p=function(i,e){return Bl(Je(i,{method:"POST"}),e)},s.q=we,s.r=br,s.s=function(i){try{const e=self[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=te,s.u=function(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()},s.v=function(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)},s.w=Jr,s.x=function(){return T_||(T_=new Af),T_},s.y=M_,s.z=Ou}),_e(["./shared"],function(s){function ne(ot){const G=ot?ot.url.toString():void 0;return G?performance.getEntriesByName(G):[]}function F(ot){if(typeof ot=="number"||typeof ot=="boolean"||typeof ot=="string"||ot==null)return JSON.stringify(ot);if(Array.isArray(ot)){let K="[";for(const ge of ot)K+=`${F(ge)},`;return`${K}]`}let G="{";for(const K of Object.keys(ot).sort())G+=`${K}:${F(ot[K])},`;return`${G}}`}function fe(ot){let G="";for(const K of s.bu)(ot.type!=="model"||K!=="minzoom"&&K!=="maxzoom")&&(G+=`/${F(ot[K])}`);return G}class qe{constructor(G){this.keyCache={},this._layers={},this._layerConfigs={},G&&this.replace(G)}replace(G,K){this._layerConfigs={},this._layers={},this.update(G,[],K)}update(G,K,ge){this._options=ge;for(const Me of G)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=s.dc(Me,this.scope,null,this._options)).compileFilter(ge),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of K)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const Ce=function(Me,Re){const ke={};for(let Qe=0;Qe<Me.length;Qe++){const _t=Me[Qe];let Je=Re&&Re[_t.id];Je||(_t.type==="symbol"?Je=_t.id:(Je=fe(_t),_t.type==="line"&&_t.paint&&function Qt(lr){return typeof lr=="string"&&lr==="line-progress"||(Array.isArray(lr)?lr.some(Qt):!(!lr||typeof lr!="object")&&Object.values(lr).some(Qt))}(_t.paint["line-width"])&&(Je+=`/${F(_t.paint["line-width"])}`))),Re&&(Re[_t.id]=Je);let Ht=ke[Je];Ht||(Ht=ke[Je]=[]),Ht.push(_t)}const Fe=[];for(const Qe in ke)Fe.push(ke[Qe]);return Fe}(Object.values(this._layerConfigs),this.keyCache);for(const Me of Ce){const Re=Me.map(Ht=>this._layers[Ht.id]),ke=Re[0];if(ke.visibility==="none")continue;const Fe=ke.source||"";let Qe=this.familiesBySource[Fe];Qe||(Qe=this.familiesBySource[Fe]={});const _t=ke.sourceLayer||"_geojsonTileLayer";let Je=Qe[_t];Je||(Je=Qe[_t]=[]),Je.push(Re)}}}const Ne=1*s.e_;class Ye{constructor(G){const K={},ge=[];for(const ke in G){const Fe=G[ke],Qe=K[ke]={};for(const _t in Fe.glyphs){const Je=Fe.glyphs[+_t];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const Ht=Je.metrics.localGlyph?Ne:1,Qt={x:0,y:0,w:Je.bitmap.width+2*Ht,h:Je.bitmap.height+2*Ht};ge.push(Qt),Qe[_t]=Qt}}const{w:Ce,h:Me}=s.H(ge),Re=new s.eZ({width:Ce||1,height:Me||1});for(const ke in G){const Fe=G[ke];for(const Qe in Fe.glyphs){const _t=Fe.glyphs[+Qe];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;const Je=K[ke][Qe],Ht=_t.metrics.localGlyph?Ne:1;s.eZ.copy(_t.bitmap,Re,{x:0,y:0},{x:Je.x+Ht,y:Je.y+Ht},_t.bitmap)}}this.image=Re,this.positions=K}}s.eY(Ye,"GlyphAtlas");class ze{constructor(G){this.tileID=new s.aM(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.lut=G.lut,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.scope=G.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.request&&G.request.collectResourceTiming,this.promoteId=G.promoteId,this.isSymbolTile=G.isSymbolTile,this.tileTransform=s.aW(G.tileID.canonical,G.projection),this.projection=G.projection,this.worldview=G.worldview,this.localizableLayerIds=G.localizableLayerIds,this.brightness=G.brightness,this.extraShadowCaster=!!G.extraShadowCaster,this.tessellationStep=G.tessellationStep,this.scaleFactor=G.scaleFactor}parse(G,K,ge,Ce,Me,Re){this.status="parsing",this.data=G,this.collisionBoxArray=new s.b0;const ke=new s.e$(Object.keys(G.layers).sort()),Fe=new s.f0(this.tileID,this.promoteId);Fe.bucketLayerIDs=[];const Qe={},_t=new s.f1(256,256),Je={featureIndex:Fe,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:_t,availableImages:ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Ht=K.familiesBySource[this.source];for(const Mi in Ht){const ii=G.layers[Mi];if(!ii)continue;let Pi=!1,wn=!1,On=!1;for(const Gn of Ht[Mi])Gn[0].type==="symbol"?Pi=!0:wn=!0,Gn[0].is3D()&&Gn[0].type!=="model"&&(On=!0);if(this.extraShadowCaster&&!On||this.isSymbolTile===!0&&!Pi||this.isSymbolTile===!1&&!wn)continue;ii.version===1&&s.w(`Vector tile source "${this.source}" layer "${Mi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Vn=ke.encode(Mi),go=[];let $o=!1;for(let Gn=0,Fn=0;Gn<ii.length;Gn++){const Yn=ii.feature(Gn),mn=Fe.getId(Yn,Mi);if(this.localizableLayerIds&&this.localizableLayerIds.has(Mi)){const Is=Yn.properties?Yn.properties.worldview:null;if(this.worldview&&typeof Is=="string")if(Is==="all")Yn.properties.$localized=!0;else{if(!Is.split(",").includes(this.worldview))continue;Yn.properties.$localized=!0,Yn.properties.worldview=this.worldview}}!$o&&Yn.properties&&Yn.properties.hasOwnProperty(s.f2)&&($o=!0),go.push({feature:Yn,id:mn,index:Fn,sourceLayerIndex:Vn}),Fn++}$o&&!Je.elevationFeatures&&G.layers.hasOwnProperty(s.f3)&&(Je.elevationFeatures=s.f4.parseFrom(G.layers[s.f3],this.canonical));for(const Gn of Ht[Mi]){const Fn=Gn[0];(!this.extraShadowCaster||Fn.is3D()&&Fn.type!=="model")&&(this.isSymbolTile!==void 0&&Fn.type==="symbol"!==this.isSymbolTile||Fn.minzoom&&this.zoom<Math.floor(Fn.minzoom)||Fn.maxzoom&&this.zoom>=Fn.maxzoom||Fn.visibility!=="none"&&(Xe(Gn,this.zoom,Je.brightness,ge),(Qe[Fn.id]=Fn.createBucket({index:Fe.bucketLayerIDs.length,layers:Gn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Vn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ce})).populate(go,Je,this.tileID.canonical,this.tileTransform),Fe.bucketLayerIDs.push(Gn.map(Yn=>s.C(Yn.id,Yn.scope)))))}}let Qt,lr,Nr,Wr,Zr,Xr;_t.trim();const nn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Jr=()=>{if(Qt)return this.status="done",Re(Qt);if(this.extraShadowCaster)this.status="done",Re(null,{buckets:Object.values(Qe).filter(Mi=>!Mi.isEmpty()),featureIndex:Fe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Je.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(lr&&Nr&&Wr){const Mi=new Ye(lr),ii=new Map;for(const[On,Vn]of Nr.entries()){const{imagePosition:go}=s.f7(On,Vn,s.f8);ii.set(On,go)}const Pi={};for(const On in Qe){const Vn=Qe[On];Vn instanceof s.b1&&(Xe(Vn.layers,this.zoom,Je.brightness,ge),Pi[On]=s.f9(Vn,lr,Mi.positions,Nr,ii,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Zr))}const wn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Me,Nr,Zr,()=>{wn.iconsPending=!1,Wi(Pi,Mi,wn)}),this.rasterizeIfNeeded(Me,Wr,Xr,()=>{wn.patternsPending=!1,Wi(Pi,Mi,wn)})}},Wi=(Mi,ii,Pi,wn)=>{if(Pi.iconsPending||Pi.patternsPending)return;const On=new s.fa(Nr,Wr,this.lut);for(const Vn in Qe){const go=Qe[Vn];if(Vn in Mi)s.fb(go,Mi[Vn],this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Nr,On);else if(go.hasPattern&&(go instanceof s.b7||go instanceof s.b8||go instanceof s.dV)){Xe(go.layers,this.zoom,Je.brightness,ge);const $o=Object.fromEntries(On.patternPositions);go.addFeatures(Je,this.tileID.canonical,$o,ge,this.tileTransform,this.brightness)}}this.status="done",Re(null,{buckets:Object.values(Qe).filter(Vn=>!Vn.isEmpty()),featureIndex:Fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ii.image,lineAtlas:_t,imageAtlas:On,brightness:Je.brightness})};if(!this.extraShadowCaster){const Mi=s.f5(Je.glyphDependencies,wn=>Object.keys(wn).map(Number));Object.keys(Mi).length?Me.send("getGlyphs",{uid:this.uid,stacks:Mi,scope:this.scope},(wn,On)=>{Qt||(Qt=wn,lr=On,Jr())},void 0,!1,nn):lr={};const ii=Array.from(Je.iconDependencies.keys()).map(wn=>s.I.parse(wn));ii.length?Me.send("getImages",{images:ii,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(wn,On)=>{Qt||(Qt=wn,Nr=new Map,Zr=this.updateImageMapAndGetImageTaskQueue(Nr,On,Je.iconDependencies),Jr())},void 0,!1,nn):(Nr=new Map,Zr=new Map);const Pi=Array.from(Je.patternDependencies.keys()).map(wn=>s.I.parse(wn));Pi.length?Me.send("getImages",{images:Pi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(wn,On)=>{Qt||(Qt=wn,Wr=new Map,Xr=this.updateImageMapAndGetImageTaskQueue(Wr,On,Je.patternDependencies),Jr())},void 0,!1,nn):(Wr=new Map,Xr=new Map)}if(Je.elevationFeatures&&Je.elevationFeatures.length>0){const Mi=[];for(const Pi of Object.values(Qe))if(Pi instanceof s.b8){const wn=Pi.getUnevaluatedPortalGraph();wn&&Mi.push(wn)}const ii=s.f6.evaluate(Mi);for(const Pi of Object.values(Qe))Pi instanceof s.b8&&Pi.setEvaluatedPortalGraph(ii)}Jr()}rasterizeIfNeeded(G,K,ge,Ce){Array.from(K.values()).some(Me=>Me.usvg)?this.rasterize(G,K,ge,Ce):Ce()}updateImageMapAndGetImageTaskQueue(G,K,ge){const Ce=new Map;for(const Me of K.keys()){const Re=ge.get(Me)||[];for(const ke of Re){const Fe=ke.toString(),Qe=K.get(ke.id.toString());Qe.usvg?Ce.has(Fe)||(Ce.set(Fe,ke),G.set(Fe,Object.assign({},Qe))):G.set(Fe,Qe)}}return Ce}rasterize(G,K,ge,Ce){this.rasterizeTask=G.send("rasterizeImages",{scope:this.scope,tasks:ge},(Me,Re)=>{if(!Me)for(const[ke,Fe]of Re.entries()){const Qe=Object.assign(K.get(ke),{data:Fe});K.set(ke,Qe)}Ce()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Xe(ot,G,K,ge){const Ce=new s.aa(G,{brightness:K});for(const Me of ot)Me.recalculate(Ce,ge)}class We extends s.E{constructor(G,K,ge,Ce,Me,Re,ke){super(),this.actor=G,this.layerIndex=K,this.availableImages=ge,this.availableModels=Ce,this.loadVectorData=Re||s.aJ,this.loading={},this.loaded={},this.deduped=new s.aI(G.scheduler),this.isSpriteLoaded=Me,this.scheduler=G.scheduler,this.brightness=ke}loadTile(G,K){const ge=G.uid,Ce=G&&G.request,Me=Ce&&Ce.collectResourceTiming,Re=this.loading[ge]=new ze(G);Re.abort=this.loadVectorData(G,(ke,Fe)=>{const Qe=!this.loading[ge];if(delete this.loading[ge],Re.cancelRasterize(),Qe||ke||!Fe)return Re.status="done",Qe||(this.loaded[ge]=Re),K(ke);const _t=Fe.rawData,Je={};Fe.expires&&(Je.expires=Fe.expires),Fe.cacheControl&&(Je.cacheControl=Fe.cacheControl),Re.vectorTile=Fe.vectorTile||new s.fc.VectorTile(new s.bq(_t));const Ht=()=>{Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Qt,lr)=>{if(Qt||!lr)return K(Qt);const Nr={};if(Me){const Wr=ne(Ce);Wr.length>0&&(Nr.resourceTiming=JSON.parse(JSON.stringify(Wr)))}K(null,s.l({rawTileData:_t.slice(0)},lr,Je,Nr))})};this.isSpriteLoaded?Ht():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ht,{type:"parseTile",isSymbolTile:G.isSymbolTile,zoom:G.tileZoom}):Ht()}),this.loaded=this.loaded||{},this.loaded[ge]=Re})}reloadTile(G,K){const ge=this.loaded,Ce=G.uid;if(ge&&ge[Ce]){const Me=ge[Ce];Me.scaleFactor=G.scaleFactor,Me.showCollisionBoxes=G.showCollisionBoxes,Me.projection=G.projection,Me.brightness=G.brightness,Me.tileTransform=s.aW(G.tileID.canonical,G.projection),Me.extraShadowCaster=G.extraShadowCaster,Me.lut=G.lut;const Re=(ke,Fe)=>{const Qe=Me.reloadCallback;Qe&&(delete Me.reloadCallback,Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Qe)),K(ke,Fe)};Me.status==="parsing"?Me.reloadCallback=Re:Me.status==="done"&&(Me.vectorTile?Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Re):Re())}else K(null,void 0)}abortTile(G,K){const ge=G.uid,Ce=this.loading[ge];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ge]),K()}removeTile(G,K){const ge=this.loaded,Ce=G.uid;ge&&ge[Ce]&&delete ge[Ce],K()}}class De{loadTile(G,K){const{uid:ge,encoding:Ce,rawImageData:Me,padding:Re}=G,ke=ImageBitmap&&Me instanceof ImageBitmap?this.getImageData(Me,Re):Me;K(null,new s.fd(ge,ke,Ce,Re<1))}reloadTile(G,K){K(null,null)}abortTile(G,K){K()}removeTile(G,K){K()}getImageData(G,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const ge=this.offscreenCanvasContext.getImageData(-K,-K,G.width+2*K,G.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}s.bp.setPbf(s.bq);class Ke{constructor(G){this._mrt=new s.bp(G.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=G.uid,this.tileID=G.tileID,this.source=G.source}parse(G,K){const ge=this._mrt;this.status="parsing",this._entireBuffer=G;try{ge.parseHeader(G),this._isHeaderLoaded=!0;const Ce=[];for(const Me in ge.layers){const Re=ge.getLayer(Me),ke=Re.getDataRange(Re.getBandList()),Fe=ge.createDecodingTask(ke),Qe=G.slice(ke.firstByte,ke.lastByte+1),_t=s.bp.performDecoding(Qe,Fe).then(Je=>Fe.complete(null,Je)).catch(Je=>Fe.complete(Je,null));Ce.push(_t)}Promise.allSettled(Ce).then(()=>K(null,ge)).catch(Me=>K(Me))}catch(Ce){K(Ce)}}}class et{constructor(G){this.actor=G,this.loading={},this.loaded={}}loadTile(G,K){const ge=G.uid,Ce=G.request,Me=this.loading[ge]=new Ke(G),{cancel:Re}=s.br(Ce,(ke,Fe,Qe,_t)=>{const Je=!this.loading[ge];if(delete this.loading[ge],Je||ke||!Fe)return Me.status="done",Je||(this.loaded[ge]=Me),K(ke);Me.parse(Fe,(Ht,Qt)=>{if(Ht||!Qt)return K(Ht);K(null,Qt,Qe,_t)}),this.loaded[ge]=Me});Me.abort=Re}reloadTile(G,K){K(null,void 0)}abortTile(G,K){const ge=G.uid,Ce=this.loading[ge];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ge]),K()}removeTile(G,K){const ge=G.uid;this.loaded[ge]&&delete this.loaded[ge],K()}decodeRasterArray(G,K){s.bp.performDecoding(G.buffer,G.task).then(ge=>K(null,ge)).catch(ge=>K(ge))}}const st=s.fc.VectorTileFeature.prototype.toGeoJSON;class $e{constructor(G){this._feature=G,this.extent=s.aj,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))}loadGeometry(){if(this._feature.type===1){const G=[];for(const K of this._feature.geometry)G.push([new s.P(K[0],K[1])]);return G}{const G=[];for(const K of this._feature.geometry){const ge=[];for(const Ce of K)ge.push(new s.P(Ce[0],Ce[1]));G.push(ge)}return G}}toGeoJSON(G,K,ge){return st.call(this,G,K,ge)}}class bt{constructor(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.aj,this.length=G.length,this._features=G}feature(G){return new $e(this._features[G])}}const St=64/4096,dr=128;class Fr{constructor(){this.features=new Map}clear(){this.features.clear()}load(G=[],K){for(const ge of G){const Ce=ge.id;if(Ce==null)continue;let Me=this.features.get(Ce);Me&&this.updateCache(Me,K),ge.geometry?(Me=ht(ge),this.updateCache(Me,K),this.features.set(Ce,Me)):this.features.delete(Ce),this.updateCache(Me,K)}}updateCache(G,K){for(const{canonical:ge,uid:Ce}of Object.values(K)){const{z:Me,x:Re,y:ke}=ge;hi(G,Math.pow(2,Me),Re,ke)&&delete K[Ce]}}getTile(G,K,ge){const Ce=Math.pow(2,G),Me=[];for(const Re of this.features.values())hi(Re,Ce,K,ge)&&Me.push(Or(Re,Ce,K,ge));return{features:Me}}getFeatures(){return[...this.features.values()]}}function hi({minX:ot,minY:G,maxX:K,maxY:ge},Ce,Me,Re){return ot<(Me+1+St)/Ce&&G<(Re+1+St)/Ce&&K>(Me-St)/Ce&&ge>(Re-St)/Ce}function ht(ot){const{id:G,geometry:K,properties:ge}=ot;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ce,coordinates:Me}=K,Re={id:G,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ke=Re.geometry;if(Ce==="Point")Zt(Me,ke,Re);else if(Ce==="MultiPoint")for(const Fe of Me)Zt(Fe,ke,Re);else if(Ce==="LineString")Re.type=2,fr(Me,ke,Re);else if(Ce==="MultiLineString")Re.type=2,Tr(Me,ke,Re);else if(Ce==="Polygon")Re.type=3,Tr(Me,ke,Re,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Re.type=3;for(const Fe of Me)Tr(Fe,ke,Re,!0)}return Re}function Zt([ot,G],K,ge){const Ce=s.ay(ot);let Me=s.aH(G);Me=Me<0?0:Me>1?1:Me,K.push(Ce,Me),ge.minX=Math.min(ge.minX,Ce),ge.minY=Math.min(ge.minY,Me),ge.maxX=Math.max(ge.maxX,Ce),ge.maxY=Math.max(ge.maxY,Me)}function fr(ot,G,K,ge=!1,Ce=!1){const Me=[];for(const Re of ot)Zt(Re,Me,K);G.push(Me),ge&&function(Re,ke){let Fe=0;for(let Qe=0,_t=Re.length,Je=_t-2;Qe<_t;Je=Qe,Qe+=2)Fe+=(Re[Qe]-Re[Je])*(Re[Qe+1]+Re[Je+1]);if(Fe>0===ke)for(let Qe=0,_t=Re.length;Qe<_t/2;Qe+=2){const Je=Re[Qe],Ht=Re[Qe+1];Re[Qe]=Re[_t-2-Qe],Re[Qe+1]=Re[_t-1-Qe],Re[_t-2-Qe]=Je,Re[_t-1-Qe]=Ht}}(Me,Ce)}function Tr(ot,G,K,ge=!1){for(let Ce=0;Ce<ot.length;Ce++)fr(ot[Ce],G,K,ge,Ce===0)}function Or(ot,G,K,ge){const{id:Ce,type:Me,geometry:Re,tags:ke}=ot,Fe=[];if(Me===1)(function(Qe,_t,Je,Ht,Qt){for(let lr=0;lr<Qe.length;lr+=2){const Nr=Math.round(s.aj*(Qe[lr+0]*_t-Je)),Wr=Math.round(s.aj*(Qe[lr+1]*_t-Ht));Qt.push([Nr,Wr])}})(Re,G,K,ge,Fe);else for(const Qe of Re)ri(Qe,G,K,ge,Fe);return{id:Ce,type:Me,geometry:Fe,tags:ke}}function ri(ot,G,K,ge,Ce){const Re=s.aj+dr;let ke;for(let Fe=0;Fe<ot.length-2;Fe+=2){let Qe=Math.round(s.aj*(ot[Fe+0]*G-K)),_t=Math.round(s.aj*(ot[Fe+1]*G-ge)),Je=Math.round(s.aj*(ot[Fe+2]*G-K)),Ht=Math.round(s.aj*(ot[Fe+3]*G-ge));const Qt=Je-Qe,lr=Ht-_t;Qe<-128&&Je<-128||(Qe<-128?(_t+=Math.round(lr*((-128-Qe)/Qt)),Qe=-128):Je<-128&&(Ht=_t+Math.round(lr*((-128-Qe)/Qt)),Je=-128),_t<-128&&Ht<-128||(_t<-128?(Qe+=Math.round(Qt*((-128-_t)/lr)),_t=-128):Ht<-128&&(Je=Qe+Math.round(Qt*((-128-_t)/lr)),Ht=-128),Qe>=Re&&Je>=Re||(Qe>=Re?(_t+=Math.round(lr*((Re-Qe)/Qt)),Qe=Re):Je>=Re&&(Ht=_t+Math.round(lr*((Re-Qe)/Qt)),Je=Re),_t>=Re&&Ht>=Re||(_t>=Re?(Qe+=Math.round(Qt*((Re-_t)/lr)),_t=Re):Ht>=Re&&(Je=Qe+Math.round(Qt*((Re-_t)/lr)),Ht=Re),ke&&Qe===ke[ke.length-1][0]&&_t===ke[ke.length-1][1]||(ke=[[Qe,_t]],Ce.push(ke)),ke.push([Je,Ht])))))}}var fi,mr,Lr,or={exports:{}},dt=function(){if(Lr)return or.exports;Lr=1;var ot=s.fg(),G=function(){if(mr)return fi;mr=1;var _t=s.fe(),Je=s.ff().VectorTileFeature;function Ht(lr,Nr){this.options=Nr||{},this.features=lr,this.length=lr.length}function Qt(lr,Nr){this.id=typeof lr.id=="number"?lr.id:void 0,this.type=lr.type,this.rawGeometry=lr.type===1?[lr.geometry]:lr.geometry,this.properties=lr.tags,this.extent=Nr||4096}return fi=Ht,Ht.prototype.feature=function(lr){return new Qt(this.features[lr],this.options.extent)},Qt.prototype.loadGeometry=function(){var lr=this.rawGeometry;this.geometry=[];for(var Nr=0;Nr<lr.length;Nr++){for(var Wr=lr[Nr],Zr=[],Xr=0;Xr<Wr.length;Xr++)Zr.push(new _t(Wr[Xr][0],Wr[Xr][1]));this.geometry.push(Zr)}return this.geometry},Qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var lr=this.geometry,Nr=1/0,Wr=-1/0,Zr=1/0,Xr=-1/0,nn=0;nn<lr.length;nn++)for(var Jr=lr[nn],Wi=0;Wi<Jr.length;Wi++){var Mi=Jr[Wi];Nr=Math.min(Nr,Mi.x),Wr=Math.max(Wr,Mi.x),Zr=Math.min(Zr,Mi.y),Xr=Math.max(Xr,Mi.y)}return[Nr,Zr,Wr,Xr]},Qt.prototype.toGeoJSON=Je.prototype.toGeoJSON,fi}();function K(_t){var Je=new ot;return function(Ht,Qt){for(var lr in Ht.layers)Qt.writeMessage(3,ge,Ht.layers[lr])}(_t,Je),Je.finish()}function ge(_t,Je){var Ht;Je.writeVarintField(15,_t.version||1),Je.writeStringField(1,_t.name||""),Je.writeVarintField(5,_t.extent||4096);var Qt={keys:[],values:[],keycache:{},valuecache:{}};for(Ht=0;Ht<_t.length;Ht++)Qt.feature=_t.feature(Ht),Je.writeMessage(2,Ce,Qt);var lr=Qt.keys;for(Ht=0;Ht<lr.length;Ht++)Je.writeStringField(3,lr[Ht]);var Nr=Qt.values;for(Ht=0;Ht<Nr.length;Ht++)Je.writeMessage(4,Qe,Nr[Ht])}function Ce(_t,Je){var Ht=_t.feature;Ht.id!==void 0&&Je.writeVarintField(1,Ht.id),Je.writeMessage(2,Me,_t),Je.writeVarintField(3,Ht.type),Je.writeMessage(4,Fe,Ht)}function Me(_t,Je){var Ht=_t.feature,Qt=_t.keys,lr=_t.values,Nr=_t.keycache,Wr=_t.valuecache;for(var Zr in Ht.properties){var Xr=Ht.properties[Zr],nn=Nr[Zr];if(Xr!==null){nn===void 0&&(Qt.push(Zr),Nr[Zr]=nn=Qt.length-1),Je.writeVarint(nn);var Jr=typeof Xr;Jr!=="string"&&Jr!=="boolean"&&Jr!=="number"&&(Xr=JSON.stringify(Xr));var Wi=Jr+":"+Xr,Mi=Wr[Wi];Mi===void 0&&(lr.push(Xr),Wr[Wi]=Mi=lr.length-1),Je.writeVarint(Mi)}}}function Re(_t,Je){return(Je<<3)+(7&_t)}function ke(_t){return _t<<1^_t>>31}function Fe(_t,Je){for(var Ht=_t.loadGeometry(),Qt=_t.type,lr=0,Nr=0,Wr=Ht.length,Zr=0;Zr<Wr;Zr++){var Xr=Ht[Zr],nn=1;Qt===1&&(nn=Xr.length),Je.writeVarint(Re(1,nn));for(var Jr=Qt===3?Xr.length-1:Xr.length,Wi=0;Wi<Jr;Wi++){Wi===1&&Qt!==1&&Je.writeVarint(Re(2,Jr-1));var Mi=Xr[Wi].x-lr,ii=Xr[Wi].y-Nr;Je.writeVarint(ke(Mi)),Je.writeVarint(ke(ii)),lr+=Mi,Nr+=ii}Qt===3&&Je.writeVarint(Re(7,1))}}function Qe(_t,Je){var Ht=typeof _t;Ht==="string"?Je.writeStringField(1,_t):Ht==="boolean"?Je.writeBooleanField(7,_t):Ht==="number"&&(_t%1!=0?Je.writeDoubleField(3,_t):_t<0?Je.writeSVarintField(6,_t):Je.writeVarintField(5,_t))}return or.exports=K,or.exports.fromVectorTileJs=K,or.exports.fromGeojsonVt=function(_t,Je){Je=Je||{};var Ht={};for(var Qt in _t)Ht[Qt]=new G(_t[Qt].features,Je),Ht[Qt].name=Qt,Ht[Qt].version=Je.version,Ht[Qt].extent=Je.extent;return K({layers:Ht})},or.exports.GeoJSONWrapper=G,or.exports}(),sr=s.fh(dt);const bi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ot=>ot},Ai=Math.fround||(qr=new Float32Array(1),ot=>(qr[0]=+ot,qr[0]));var qr;const Gr=3,pi=5,ji=6;class jr{constructor(G){this.options=Object.assign(Object.create(bi),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:K,minZoom:ge,maxZoom:Ce}=this.options;K&&console.time("total time");const Me=`prepare ${G.length} points`;K&&console.time(Me),this.points=G;const Re=[];for(let Fe=0;Fe<G.length;Fe++){const Qe=G[Fe];if(!Qe.geometry)continue;const[_t,Je]=Qe.geometry.coordinates,Ht=Ai(xo(_t)),Qt=Ai(zi(Je));Re.push(Ht,Qt,1/0,Fe,-1,1),this.options.reduce&&Re.push(0)}let ke=this.trees[Ce+1]=this._createTree(Re);K&&console.timeEnd(Me);for(let Fe=Ce;Fe>=ge;Fe--){const Qe=+Date.now();ke=this.trees[Fe]=this._createTree(this._cluster(ke,Fe)),K&&console.log("z%d: %d clusters in %dms",Fe,ke.numItems,+Date.now()-Qe)}return K&&console.timeEnd("total time"),this}getClusters(G,K){let ge=((G[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,G[1]));let Me=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)ge=-180,Me=180;else if(ge>Me){const Je=this.getClusters([ge,Ce,180,Re],K),Ht=this.getClusters([-180,Ce,Me,Re],K);return Je.concat(Ht)}const ke=this.trees[this._limitZoom(K)],Fe=ke.range(xo(ge),zi(Re),xo(Me),zi(Ce)),Qe=ke.data,_t=[];for(const Je of Fe){const Ht=this.stride*Je;_t.push(Qe[Ht+pi]>1?Dn(Qe,Ht,this.clusterProps):this.points[Qe[Ht+Gr]])}return _t}getChildren(G){const K=this._getOriginId(G),ge=this._getOriginZoom(G),Ce="No cluster with the specified id.",Me=this.trees[ge];if(!Me)throw new Error(Ce);const Re=Me.data;if(K*this.stride>=Re.length)throw new Error(Ce);const ke=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Fe=Me.within(Re[K*this.stride],Re[K*this.stride+1],ke),Qe=[];for(const _t of Fe){const Je=_t*this.stride;Re[Je+4]===G&&Qe.push(Re[Je+pi]>1?Dn(Re,Je,this.clusterProps):this.points[Re[Je+Gr]])}if(Qe.length===0)throw new Error(Ce);return Qe}getLeaves(G,K,ge){const Ce=[];return this._appendLeaves(Ce,G,K=K||10,ge=ge||0,0),Ce}getTile(G,K,ge){const Ce=this.trees[this._limitZoom(G)],Me=Math.pow(2,G),{extent:Re,radius:ke}=this.options,Fe=ke/Re,Qe=(ge-Fe)/Me,_t=(ge+1+Fe)/Me,Je={features:[]};return this._addTileFeatures(Ce.range((K-Fe)/Me,Qe,(K+1+Fe)/Me,_t),Ce.data,K,ge,Me,Je),K===0&&this._addTileFeatures(Ce.range(1-Fe/Me,Qe,1,_t),Ce.data,Me,ge,Me,Je),K===Me-1&&this._addTileFeatures(Ce.range(0,Qe,Fe/Me,_t),Ce.data,-1,ge,Me,Je),Je.features.length?Je:null}getClusterExpansionZoom(G){let K=this._getOriginZoom(G)-1;for(;K<=this.options.maxZoom;){const ge=this.getChildren(G);if(K++,ge.length!==1)break;G=ge[0].properties.cluster_id}return K}_appendLeaves(G,K,ge,Ce,Me){const Re=this.getChildren(K);for(const ke of Re){const Fe=ke.properties;if(Fe&&Fe.cluster?Me+Fe.point_count<=Ce?Me+=Fe.point_count:Me=this._appendLeaves(G,Fe.cluster_id,ge,Ce,Me):Me<Ce?Me++:G.push(ke),G.length===ge)break}return Me}_createTree(G){const K=new s.bW(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<G.length;ge+=this.stride)K.add(G[ge],G[ge+1]);return K.finish(),K.data=G,K}_addTileFeatures(G,K,ge,Ce,Me,Re){for(const ke of G){const Fe=ke*this.stride,Qe=K[Fe+pi]>1;let _t,Je,Ht;if(Qe)_t=Xn(K,Fe,this.clusterProps),Je=K[Fe],Ht=K[Fe+1];else{const Nr=this.points[K[Fe+Gr]];_t=Nr.properties;const[Wr,Zr]=Nr.geometry.coordinates;Je=xo(Wr),Ht=zi(Zr)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(Je*Me-ge)),Math.round(this.options.extent*(Ht*Me-Ce))]],tags:_t};let lr;lr=Qe||this.options.generateId?K[Fe+Gr]:this.points[K[Fe+Gr]].id,lr!==void 0&&(Qt.id=lr),Re.features.push(Qt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,K){const{radius:ge,extent:Ce,reduce:Me,minPoints:Re}=this.options,ke=ge/(Ce*Math.pow(2,K)),Fe=G.data,Qe=[],_t=this.stride;for(let Je=0;Je<Fe.length;Je+=_t){if(Fe[Je+2]<=K)continue;Fe[Je+2]=K;const Ht=Fe[Je],Qt=Fe[Je+1],lr=G.within(Fe[Je],Fe[Je+1],ke),Nr=Fe[Je+pi];let Wr=Nr;for(const Zr of lr){const Xr=Zr*_t;Fe[Xr+2]>K&&(Wr+=Fe[Xr+pi])}if(Wr>Nr&&Wr>=Re){let Zr,Xr=Ht*Nr,nn=Qt*Nr,Jr=-1;const Wi=(Je/_t<<5)+(K+1)+this.points.length;for(const Mi of lr){const ii=Mi*_t;if(Fe[ii+2]<=K)continue;Fe[ii+2]=K;const Pi=Fe[ii+pi];Xr+=Fe[ii]*Pi,nn+=Fe[ii+1]*Pi,Fe[ii+4]=Wi,Me&&(Zr||(Zr=this._map(Fe,Je,!0),Jr=this.clusterProps.length,this.clusterProps.push(Zr)),Me(Zr,this._map(Fe,ii)))}Fe[Je+4]=Wi,Qe.push(Xr/Wr,nn/Wr,1/0,Wi,-1,Wr),Me&&Qe.push(Jr)}else{for(let Zr=0;Zr<_t;Zr++)Qe.push(Fe[Je+Zr]);if(Wr>1)for(const Zr of lr){const Xr=Zr*_t;if(!(Fe[Xr+2]<=K)){Fe[Xr+2]=K;for(let nn=0;nn<_t;nn++)Qe.push(Fe[Xr+nn])}}}}return Qe}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,K,ge){if(G[K+pi]>1){const Re=this.clusterProps[G[K+ji]];return ge?Object.assign({},Re):Re}const Ce=this.points[G[K+Gr]].properties,Me=this.options.map(Ce);return ge&&Me===Ce?Object.assign({},Me):Me}}function Dn(ot,G,K){return{type:"Feature",id:ot[G+Gr],properties:Xn(ot,G,K),geometry:{type:"Point",coordinates:[(ge=ot[G],360*(ge-.5)),ts(ot[G+1])]}};var ge}function Xn(ot,G,K){const ge=ot[G+pi],Ce=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Me=ot[G+ji],Re=Me===-1?{}:Object.assign({},K[Me]);return Object.assign(Re,{cluster:!0,cluster_id:ot[G+Gr],point_count:ge,point_count_abbreviated:Ce})}function xo(ot){return ot/360+.5}function zi(ot){const G=Math.sin(ot*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function ts(ot){const G=(180-360*ot)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function zs(ot,G,K,ge){let Ce=ge;const Me=G+(K-G>>1);let Re,ke=K-G;const Fe=ot[G],Qe=ot[G+1],_t=ot[K],Je=ot[K+1];for(let Ht=G+3;Ht<K;Ht+=3){const Qt=no(ot[Ht],ot[Ht+1],Fe,Qe,_t,Je);if(Qt>Ce)Re=Ht,Ce=Qt;else if(Qt===Ce){const lr=Math.abs(Ht-Me);lr<ke&&(Re=Ht,ke=lr)}}Ce>ge&&(Re-G>3&&zs(ot,G,Re,ge),ot[Re+2]=Ce,K-Re>3&&zs(ot,Re,K,ge))}function no(ot,G,K,ge,Ce,Me){let Re=Ce-K,ke=Me-ge;if(Re!==0||ke!==0){const Fe=((ot-K)*Re+(G-ge)*ke)/(Re*Re+ke*ke);Fe>1?(K=Ce,ge=Me):Fe>0&&(K+=Re*Fe,ge+=ke*Fe)}return Re=ot-K,ke=G-ge,Re*Re+ke*ke}function fs(ot,G,K,ge){const Ce={id:ot??null,type:G,geometry:K,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(G==="Point"||G==="MultiPoint"||G==="LineString")rs(Ce,K);else if(G==="Polygon")rs(Ce,K[0]);else if(G==="MultiLineString")for(const Me of K)rs(Ce,Me);else if(G==="MultiPolygon")for(const Me of K)rs(Ce,Me[0]);return Ce}function rs(ot,G){for(let K=0;K<G.length;K+=3)ot.minX=Math.min(ot.minX,G[K]),ot.minY=Math.min(ot.minY,G[K+1]),ot.maxX=Math.max(ot.maxX,G[K]),ot.maxY=Math.max(ot.maxY,G[K+1])}function eo(ot,G,K,ge){if(!G.geometry)return;const Ce=G.geometry.coordinates;if(Ce&&Ce.length===0)return;const Me=G.geometry.type,Re=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let ke=[],Fe=G.id;if(K.promoteId?Fe=G.properties[K.promoteId]:K.generateId&&(Fe=ge||0),Me==="Point")po(Ce,ke);else if(Me==="MultiPoint")for(const Qe of Ce)po(Qe,ke);else if(Me==="LineString")ko(Ce,ke,Re,!1);else if(Me==="MultiLineString"){if(K.lineMetrics){for(const Qe of Ce)ke=[],ko(Qe,ke,Re,!1),ot.push(fs(Fe,"LineString",ke,G.properties));return}mo(Ce,ke,Re,!1)}else if(Me==="Polygon")mo(Ce,ke,Re,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(const Qe of G.geometry.geometries)eo(ot,{id:Fe,geometry:Qe,properties:G.properties},K,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of Ce){const _t=[];mo(Qe,_t,Re,!0),ke.push(_t)}}ot.push(fs(Fe,Me,ke,G.properties))}function po(ot,G){G.push(oo(ot[0]),yo(ot[1]),0)}function ko(ot,G,K,ge){let Ce,Me,Re=0;for(let Fe=0;Fe<ot.length;Fe++){const Qe=oo(ot[Fe][0]),_t=yo(ot[Fe][1]);G.push(Qe,_t,0),Fe>0&&(Re+=ge?(Ce*_t-Qe*Me)/2:Math.sqrt(Math.pow(Qe-Ce,2)+Math.pow(_t-Me,2))),Ce=Qe,Me=_t}const ke=G.length-3;G[2]=1,zs(G,0,ke,K),G[ke+2]=1,G.size=Math.abs(Re),G.start=0,G.end=G.size}function mo(ot,G,K,ge){for(let Ce=0;Ce<ot.length;Ce++){const Me=[];ko(ot[Ce],Me,K,ge),G.push(Me)}}function oo(ot){return ot/360+.5}function yo(ot){const G=Math.sin(ot*Math.PI/180),K=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return K<0?0:K>1?1:K}function Ao(ot,G,K,ge,Ce,Me,Re,ke){if(ge/=G,Me>=(K/=G)&&Re<ge)return ot;if(Re<K||Me>=ge)return null;const Fe=[];for(const Qe of ot){const _t=Qe.geometry;let Je=Qe.type;const Ht=Ce===0?Qe.minX:Qe.minY,Qt=Ce===0?Qe.maxX:Qe.maxY;if(Ht>=K&&Qt<ge){Fe.push(Qe);continue}if(Qt<K||Ht>=ge)continue;let lr=[];if(Je==="Point"||Je==="MultiPoint")Ws(_t,lr,K,ge,Ce);else if(Je==="LineString")ps(_t,lr,K,ge,Ce,!1,ke.lineMetrics);else if(Je==="MultiLineString")is(_t,lr,K,ge,Ce,!1);else if(Je==="Polygon")is(_t,lr,K,ge,Ce,!0);else if(Je==="MultiPolygon")for(const Nr of _t){const Wr=[];is(Nr,Wr,K,ge,Ce,!0),Wr.length&&lr.push(Wr)}if(lr.length){if(ke.lineMetrics&&Je==="LineString"){for(const Nr of lr)Fe.push(fs(Qe.id,Je,Nr,Qe.tags));continue}Je!=="LineString"&&Je!=="MultiLineString"||(lr.length===1?(Je="LineString",lr=lr[0]):Je="MultiLineString"),Je!=="Point"&&Je!=="MultiPoint"||(Je=lr.length===3?"Point":"MultiPoint"),Fe.push(fs(Qe.id,Je,lr,Qe.tags))}}return Fe.length?Fe:null}function Ws(ot,G,K,ge,Ce){for(let Me=0;Me<ot.length;Me+=3){const Re=ot[Me+Ce];Re>=K&&Re<=ge&&Lo(G,ot[Me],ot[Me+1],ot[Me+2])}}function ps(ot,G,K,ge,Ce,Me,Re){let ke=Ho(ot);const Fe=Ce===0?co:Os;let Qe,_t,Je=ot.start;for(let Wr=0;Wr<ot.length-3;Wr+=3){const Zr=ot[Wr],Xr=ot[Wr+1],nn=ot[Wr+2],Jr=ot[Wr+3],Wi=ot[Wr+4],Mi=Ce===0?Zr:Xr,ii=Ce===0?Jr:Wi;let Pi=!1;Re&&(Qe=Math.sqrt(Math.pow(Zr-Jr,2)+Math.pow(Xr-Wi,2))),Mi<K?ii>K&&(_t=Fe(ke,Zr,Xr,Jr,Wi,K),Re&&(ke.start=Je+Qe*_t)):Mi>ge?ii<ge&&(_t=Fe(ke,Zr,Xr,Jr,Wi,ge),Re&&(ke.start=Je+Qe*_t)):Lo(ke,Zr,Xr,nn),ii<K&&Mi>=K&&(_t=Fe(ke,Zr,Xr,Jr,Wi,K),Pi=!0),ii>ge&&Mi<=ge&&(_t=Fe(ke,Zr,Xr,Jr,Wi,ge),Pi=!0),!Me&&Pi&&(Re&&(ke.end=Je+Qe*_t),G.push(ke),ke=Ho(ot)),Re&&(Je+=Qe)}let Ht=ot.length-3;const Qt=ot[Ht],lr=ot[Ht+1],Nr=Ce===0?Qt:lr;Nr>=K&&Nr<=ge&&Lo(ke,Qt,lr,ot[Ht+2]),Ht=ke.length-3,Me&&Ht>=3&&(ke[Ht]!==ke[0]||ke[Ht+1]!==ke[1])&&Lo(ke,ke[0],ke[1],ke[2]),ke.length&&G.push(ke)}function Ho(ot){const G=[];return G.size=ot.size,G.start=ot.start,G.end=ot.end,G}function is(ot,G,K,ge,Ce,Me){for(const Re of ot)ps(Re,G,K,ge,Ce,Me,!1)}function Lo(ot,G,K,ge){ot.push(G,K,ge)}function co(ot,G,K,ge,Ce,Me){const Re=(Me-G)/(ge-G);return Lo(ot,Me,K+(Ce-K)*Re,1),Re}function Os(ot,G,K,ge,Ce,Me){const Re=(Me-K)/(Ce-K);return Lo(ot,G+(ge-G)*Re,Me,1),Re}function ns(ot,G){const K=[];for(let ge=0;ge<ot.length;ge++){const Ce=ot[ge],Me=Ce.type;let Re;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")Re=ms(Ce.geometry,G);else if(Me==="MultiLineString"||Me==="Polygon"){Re=[];for(const ke of Ce.geometry)Re.push(ms(ke,G))}else if(Me==="MultiPolygon"){Re=[];for(const ke of Ce.geometry){const Fe=[];for(const Qe of ke)Fe.push(ms(Qe,G));Re.push(Fe)}}K.push(fs(Ce.id,Me,Re,Ce.tags))}return K}function ms(ot,G){const K=[];K.size=ot.size,ot.start!==void 0&&(K.start=ot.start,K.end=ot.end);for(let ge=0;ge<ot.length;ge+=3)K.push(ot[ge]+G,ot[ge+1],ot[ge+2]);return K}function ra(ot,G){if(ot.transformed)return ot;const K=1<<ot.z,ge=ot.x,Ce=ot.y;for(const Me of ot.features){const Re=Me.geometry,ke=Me.type;if(Me.geometry=[],ke===1)for(let Fe=0;Fe<Re.length;Fe+=2)Me.geometry.push(os(Re[Fe],Re[Fe+1],G,K,ge,Ce));else for(let Fe=0;Fe<Re.length;Fe++){const Qe=[];for(let _t=0;_t<Re[Fe].length;_t+=2)Qe.push(os(Re[Fe][_t],Re[Fe][_t+1],G,K,ge,Ce));Me.geometry.push(Qe)}}return ot.transformed=!0,ot}function os(ot,G,K,ge,Ce,Me){return[Math.round(K*(ot*ge-Ce)),Math.round(K*(G*ge-Me))]}function ia(ot,G,K,ge,Ce){const Me=G===Ce.maxZoom?0:Ce.tolerance/((1<<G)*Ce.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:ot.length,source:null,x:K,y:ge,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ke of ot)Qi(Re,ke,Me,Ce);return Re}function Qi(ot,G,K,ge){const Ce=G.geometry,Me=G.type,Re=[];if(ot.minX=Math.min(ot.minX,G.minX),ot.minY=Math.min(ot.minY,G.minY),ot.maxX=Math.max(ot.maxX,G.maxX),ot.maxY=Math.max(ot.maxY,G.maxY),Me==="Point"||Me==="MultiPoint")for(let ke=0;ke<Ce.length;ke+=3)Re.push(Ce[ke],Ce[ke+1]),ot.numPoints++,ot.numSimplified++;else if(Me==="LineString")to(Re,Ce,ot,K,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(let ke=0;ke<Ce.length;ke++)to(Re,Ce[ke],ot,K,Me==="Polygon",ke===0);else if(Me==="MultiPolygon")for(let ke=0;ke<Ce.length;ke++){const Fe=Ce[ke];for(let Qe=0;Qe<Fe.length;Qe++)to(Re,Fe[Qe],ot,K,!0,Qe===0)}if(Re.length){let ke=G.tags||null;if(Me==="LineString"&&ge.lineMetrics){ke={};for(const Qe in G.tags)ke[Qe]=G.tags[Qe];ke.mapbox_clip_start=Ce.start/Ce.size,ke.mapbox_clip_end=Ce.end/Ce.size}const Fe={geometry:Re,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:ke};G.id!==null&&(Fe.id=G.id),ot.features.push(Fe)}}function to(ot,G,K,ge,Ce,Me){const Re=ge*ge;if(ge>0&&G.size<(Ce?Re:ge))return void(K.numPoints+=G.length/3);const ke=[];for(let Fe=0;Fe<G.length;Fe+=3)(ge===0||G[Fe+2]>Re)&&(K.numSimplified++,ke.push(G[Fe],G[Fe+1])),K.numPoints++;Ce&&function(Fe,Qe){let _t=0;for(let Je=0,Ht=Fe.length,Qt=Ht-2;Je<Ht;Qt=Je,Je+=2)_t+=(Fe[Je]-Fe[Qt])*(Fe[Je+1]+Fe[Qt+1]);if(_t>0===Qe)for(let Je=0,Ht=Fe.length;Je<Ht/2;Je+=2){const Qt=Fe[Je],lr=Fe[Je+1];Fe[Je]=Fe[Ht-2-Je],Fe[Je+1]=Fe[Ht-1-Je],Fe[Ht-2-Je]=Qt,Fe[Ht-1-Je]=lr}}(ke,Me),ot.push(ke)}const Es={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class so{constructor(G,K){const ge=(K=this.options=function(Me,Re){for(const ke in Re)Me[ke]=Re[ke];return Me}(Object.create(Es),K)).debug;if(ge&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(Me,Re){const ke=[];if(Me.type==="FeatureCollection")for(let Fe=0;Fe<Me.features.length;Fe++)eo(ke,Me.features[Fe],Re,Fe);else eo(ke,Me.type==="Feature"?Me:{geometry:Me},Re);return ke}(G,K);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(Me,Re){const ke=Re.buffer/Re.extent;let Fe=Me;const Qe=Ao(Me,1,-1-ke,ke,0,-1,2,Re),_t=Ao(Me,1,1-ke,2+ke,0,-1,2,Re);return(Qe||_t)&&(Fe=Ao(Me,1,-ke,1+ke,0,-1,2,Re)||[],Qe&&(Fe=ns(Qe,1).concat(Fe)),_t&&(Fe=Fe.concat(ns(_t,-1)))),Fe}(Ce,K),Ce.length&&this.splitTile(Ce,0,0,0),ge&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(G,K,ge,Ce,Me,Re,ke){const Fe=[G,K,ge,Ce],Qe=this.options,_t=Qe.debug;for(;Fe.length;){Ce=Fe.pop(),ge=Fe.pop(),K=Fe.pop(),G=Fe.pop();const Je=1<<K,Ht=xr(K,ge,Ce);let Qt=this.tiles[Ht];if(!Qt&&(_t>1&&console.time("creation"),Qt=this.tiles[Ht]=ia(G,K,ge,Ce,Qe),this.tileCoords.push({z:K,x:ge,y:Ce}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,ge,Ce,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Pi=`z${K}`;this.stats[Pi]=(this.stats[Pi]||0)+1,this.total++}if(Qt.source=G,Me==null){if(K===Qe.indexMaxZoom||Qt.numPoints<=Qe.indexMaxPoints)continue}else{if(K===Qe.maxZoom||K===Me)continue;if(Me!=null){const Pi=Me-K;if(ge!==Re>>Pi||Ce!==ke>>Pi)continue}}if(Qt.source=null,G.length===0)continue;_t>1&&console.time("clipping");const lr=.5*Qe.buffer/Qe.extent,Nr=.5-lr,Wr=.5+lr,Zr=1+lr;let Xr=null,nn=null,Jr=null,Wi=null,Mi=Ao(G,Je,ge-lr,ge+Wr,0,Qt.minX,Qt.maxX,Qe),ii=Ao(G,Je,ge+Nr,ge+Zr,0,Qt.minX,Qt.maxX,Qe);G=null,Mi&&(Xr=Ao(Mi,Je,Ce-lr,Ce+Wr,1,Qt.minY,Qt.maxY,Qe),nn=Ao(Mi,Je,Ce+Nr,Ce+Zr,1,Qt.minY,Qt.maxY,Qe),Mi=null),ii&&(Jr=Ao(ii,Je,Ce-lr,Ce+Wr,1,Qt.minY,Qt.maxY,Qe),Wi=Ao(ii,Je,Ce+Nr,Ce+Zr,1,Qt.minY,Qt.maxY,Qe),ii=null),_t>1&&console.timeEnd("clipping"),Fe.push(Xr||[],K+1,2*ge,2*Ce),Fe.push(nn||[],K+1,2*ge,2*Ce+1),Fe.push(Jr||[],K+1,2*ge+1,2*Ce),Fe.push(Wi||[],K+1,2*ge+1,2*Ce+1)}}getTile(G,K,ge){G=+G,K=+K,ge=+ge;const Ce=this.options,{extent:Me,debug:Re}=Ce;if(G<0||G>24)return null;const ke=1<<G,Fe=xr(G,K=K+ke&ke-1,ge);if(this.tiles[Fe])return ra(this.tiles[Fe],Me);Re>1&&console.log("drilling down to z%d-%d-%d",G,K,ge);let Qe,_t=G,Je=K,Ht=ge;for(;!Qe&&_t>0;)_t--,Je>>=1,Ht>>=1,Qe=this.tiles[xr(_t,Je,Ht)];return Qe&&Qe.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",_t,Je,Ht),console.time("drilling down")),this.splitTile(Qe.source,_t,Je,Ht,G,K,ge),Re>1&&console.timeEnd("drilling down"),this.tiles[Fe]?ra(this.tiles[Fe],Me):null):null}}function xr(ot,G,K){return 32*((1<<ot)*K+G)+ot}function Oi(ot,G){const K=ot.tileID.canonical;if(!this._geoJSONIndex)return void G(null,null);const ge=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ge)return void G(null,null);const Ce=new bt(ge.features);let Me=sr(Ce);Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),G(null,{vectorTile:Ce,rawData:Me.buffer})}class un extends We{constructor(G,K,ge,Ce,Me,Re,ke){super(G,K,ge,Ce,Me,Oi,ke),Re&&(this.loadGeoJSON=Re),this._dynamicIndex=new Fr}loadData(G,K){const ge=G&&G.request,Ce=ge&&ge.collectResourceTiming;this.loadGeoJSON(G,(Me,Re)=>{if(Me||!Re)return K(Me);if(typeof Re!="object")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{try{if(G.filter){const Fe=s.X(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Fe.result==="error")throw new Error(Fe.value.map(Qe=>`${Qe.key}: ${Qe.message}`).join(", "));Re.features=Re.features.filter(Qe=>Fe.value.evaluate({zoom:0},Qe))}G.dynamic?(Re.type==="Feature"&&(Re={type:"FeatureCollection",features:[Re]}),G.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Re.features,this.loaded),G.cluster&&(Re.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=G.cluster?new jr(function({superclusterOptions:Fe,clusterProperties:Qe}){if(!Qe||!Fe)return Fe;const _t={},Je={},Ht={accumulated:null,zoom:0},Qt={properties:null},lr=Object.keys(Qe);for(const Nr of lr){const[Wr,Zr]=Qe[Nr],Xr=s.X(Zr),nn=s.X(typeof Wr=="string"?[Wr,["accumulated"],["get",Nr]]:Wr);_t[Nr]=Xr.value,Je[Nr]=nn.value}return Fe.map=Nr=>{Qt.properties=Nr;const Wr={};for(const Zr of lr)Wr[Zr]=_t[Zr].evaluate(Ht,Qt);return Wr},Fe.reduce=(Nr,Wr)=>{Qt.properties=Wr;for(const Zr of lr)Ht.accumulated=Nr[Zr],Nr[Zr]=Je[Zr].evaluate(Ht,Qt)},Fe}(G)).load(Re.features):G.dynamic?this._dynamicIndex:function(Fe,Qe){return new so(Fe,Qe)}(Re,G.geojsonVtOptions)}catch(Fe){return K(Fe)}const ke={};if(Ce){const Fe=ne(ge);Fe&&(ke.resourceTiming={},ke.resourceTiming[G.source]=JSON.parse(JSON.stringify(Fe)))}K(null,ke)}})}reloadTile(G,K){const ge=this.loaded;return ge&&ge[G.uid]?G.partial?K(null,void 0):super.reloadTile(G,K):this.loadTile(G,K)}loadGeoJSON(G,K){if(G.request)s.n(G.request,K);else{if(typeof G.data!="string")return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(G.data))}catch{return K(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(ge){K(ge)}}getClusterChildren(G,K){try{K(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(ge){K(ge)}}getClusterLeaves(G,K){try{K(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(ge){K(ge)}}}class Ot{constructor(G,K){this.tileID=new s.aM(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.tileZoom=G.tileZoom,this.uid=G.uid,this.zoom=G.zoom,this.canonical=G.tileID.canonical,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=G.projection,this.brightness=K}parse(G,K,ge,Ce){this.status="parsing";const Me=new s.aM(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),Re=[],ke=K.familiesBySource[ge.source],Fe=new s.f0(Me,ge.promoteId);Fe.bucketLayerIDs=[],Fe.is3DTile=!0,s.fi(G).then(Qe=>{if(!Qe)return Ce(new Error("Could not parse tile"));const _t=s.fj(Qe,1/s.cT(ge.tileID.canonical)),Je=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Qe.json.asset.extras&&Qe.json.asset.extras.MAPBOX_mesh_features,Ht=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("EXT_meshopt_compression"),Qt=new s.aa(this.zoom,{brightness:this.brightness});for(const lr in ke)for(const Nr of ke[lr]){const Wr=Nr[0];Fe.bucketLayerIDs.push(Nr.map(Xr=>s.C(Xr.id,Xr.scope))),Wr.recalculate(Qt,[]);const Zr=new s.fk(Nr,_t,Me,Je,Ht,this.brightness,Fe);Je||(Zr.needsUpload=!0),Re.push(Zr),Zr.evaluate(Wr)}this.status="done",Ce(null,{buckets:Re,featureIndex:Fe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Qe=>Ce(new Error(Qe.message)))}}class pn{constructor(G,K,ge,Ce,Me,Re,ke){this.actor=G,this.layerIndex=K,this.availableImages=ge,this.availableModels=Ce,this.brightness=ke,this.loading={},this.loaded={}}loadTile(G,K){const ge=G.uid,Ce=this.loading[ge]=new Ot(G,this.brightness);s.br(G.request,(Me,Re)=>{const ke=!this.loading[ge];return delete this.loading[ge],ke||Me?(Ce.status="done",ke||(this.loaded[ge]=Ce),K(Me)):Re&&Re.byteLength!==0?void Ce.parse(Re,this.layerIndex,G,(Fe,Qe)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Ce,Fe||!Qe?K(Fe):K(null,Qe)}):(Ce.status="done",this.loaded[ge]=Ce,K())})}reloadTile(G,K){const ge=this.loaded,Ce=G.uid;if(ge&&ge[Ce]){const Me=ge[Ce];Me.projection=G.projection,Me.brightness=G.brightness;const Re=(ke,Fe)=>{Me.reloadCallback&&(delete Me.reloadCallback,this.loadTile(G,K)),K(ke,Fe)};Me.status==="parsing"?Me.reloadCallback=Re:Me.status==="done"&&this.loadTile(G,K)}}abortTile(G,K){const ge=G.uid;this.loading[ge]&&delete this.loading[ge],K()}removeTile(G,K){const ge=this.loaded,Ce=G.uid;ge&&ge[Ce]&&delete ge[Ce],K()}}class gs{constructor(G){this.self=G,this.actor=new s.fm(G,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.y,this.projections={},this.defaultProjection=s.ce({name:"mercator"}),this.workerSourceTypes={vector:We,geojson:un,"raster-dem":De,"raster-array":et,"batched-model":pn},this.workerSources={},this.self.registerWorkerSource=(K,ge)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ge},this.self.registerRTLTextPlugin=K=>{if(s.fn.isParsed())throw new Error("RTL text plugin already registered.");s.fn.applyArabicShaping=K.applyArabicShaping,s.fn.processBidirectionalText=K.processBidirectionalText,s.fn.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(G,K,ge){delete this.layerIndexes[G],delete this.availableImages[G],delete this.availableModels[G],delete this.workerSources[G],ge()}checkIfReady(G,K,ge){ge()}setReferrer(G,K){this.referrer=K}spriteLoaded(G,K){this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={});const{scope:ge,isLoaded:Ce}=K;if(this.isSpriteLoaded[G][ge]=Ce,this.workerSources[G]&&this.workerSources[G][ge])for(const Me in this.workerSources[G][ge]){const Re=this.workerSources[G][ge][Me];for(const ke in Re){const Fe=Re[ke];Fe instanceof We&&(Fe.isSpriteLoaded=Ce,Fe.fire(new s.A("isSpriteLoaded")))}}}setImages(G,K,ge){this.availableImages[G]||(this.availableImages[G]={});const{scope:Ce,images:Me}=K;if(this.availableImages[G][Ce]=Me,this.workerSources[G]&&this.workerSources[G][Ce]){for(const Re in this.workerSources[G][Ce]){const ke=this.workerSources[G][Ce][Re];for(const Fe in ke)ke[Fe].availableImages=Me}ge()}else ge()}setModels(G,{scope:K,models:ge},Ce){if(this.availableModels[G]||(this.availableModels[G]={}),this.availableModels[G][K]=ge,this.workerSources[G]&&this.workerSources[G][K]){for(const Me in this.workerSources[G][K]){const Re=this.workerSources[G][K][Me];for(const ke in Re)Re[ke].availableModels=ge}Ce()}else Ce()}setProjection(G,K){this.projections[G]=s.ce(K)}setBrightness(G,K,ge){this.brightness=K,ge()}setLayers(G,K,ge){this.getLayerIndex(G,K.scope).replace(K.layers,K.options),ge()}updateLayers(G,K,ge){this.getLayerIndex(G,K.scope).update(K.layers,K.removedIds,K.options),ge()}loadTile(G,K,ge){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).loadTile(K,ge)}decodeRasterArray(G,K,ge){this.getWorkerSource(G,K.type,K.source,K.scope).decodeRasterArray(K,ge)}reloadTile(G,K,ge){K.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,K.type,K.source,K.scope).reloadTile(K,ge)}abortTile(G,K,ge){this.getWorkerSource(G,K.type,K.source,K.scope).abortTile(K,ge)}removeTile(G,K,ge){this.getWorkerSource(G,K.type,K.source,K.scope).removeTile(K,ge)}removeSource(G,K,ge){if(!(this.workerSources[G]&&this.workerSources[G][K.scope]&&this.workerSources[G][K.scope][K.type]&&this.workerSources[G][K.scope][K.type][K.source]))return;const Ce=this.workerSources[G][K.scope][K.type][K.source];delete this.workerSources[G][K.scope][K.type][K.source],Ce.removeSource!==void 0?Ce.removeSource(K,ge):ge()}loadWorkerSource(G,K,ge){try{this.self.importScripts(K.url),ge()}catch(Ce){ge(Ce.toString())}}syncRTLPluginState(G,K,ge){try{s.fn.setState(K);const Ce=s.fn.getPluginURL();if(s.fn.isLoaded()&&!s.fn.isParsed()&&Ce!=null){this.self.importScripts(Ce);const Me=s.fn.isParsed();ge(Me?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ce}`),Me)}}catch(Ce){ge(Ce.toString())}}setDracoUrl(G,K){this.dracoUrl=K}getAvailableImages(G,K){this.availableImages[G]||(this.availableImages[G]={});let ge=this.availableImages[G][K];return ge||(ge=[]),ge}getAvailableModels(G,K){this.availableModels[G]||(this.availableModels[G]={});let ge=this.availableModels[G][K];return ge||(ge={}),ge}getLayerIndex(G,K){this.layerIndexes[G]||(this.layerIndexes[G]={});let ge=this.layerIndexes[G][K];return ge||(ge=this.layerIndexes[G][K]=new qe,ge.scope=K),ge}getWorkerSource(G,K,ge,Ce){const Me=this.workerSources;return Me[G]||(Me[G]={}),Me[G][Ce]||(Me[G][Ce]={}),Me[G][Ce][K]||(Me[G][Ce][K]={}),this.isSpriteLoaded[G]||(this.isSpriteLoaded[G]={}),Me[G][Ce][K][ge]||(Me[G][Ce][K][ge]=new this.workerSourceTypes[K]({send:(Re,ke,Fe,Qe,_t,Je)=>this.actor.send(Re,ke,Fe,G,_t,Je),scheduler:this.actor.scheduler},this.getLayerIndex(G,Ce),this.getAvailableImages(G,Ce),this.getAvailableModels(G,Ce),this.isSpriteLoaded[G][Ce],void 0,this.brightness)),Me[G][Ce][K][ge]}rasterizeImagesWorker(G,K,ge){const Ce=new Map;for(const[Me,{image:Re,imageVariant:ke}]of K.tasks.entries()){const Fe=this.imageRasterizer.rasterize(ke,Re,K.scope,G);Ce.set(Me,Fe)}ge(void 0,Ce)}removeRasterizedImages(G,K,ge){this.imageRasterizer.removeImagesFromCacheByIds(K.imageIds,K.scope,G),ge()}enforceCacheSizeLimit(G,K){s.fo(K)}getWorkerPerformanceMetrics(G,K,ge){ge(void 0,void 0)}}return s.fl(self)&&(self.worker=new gs(self)),gs}),_e(["./shared"],function(s){var ne="3.12.0";const F={create:"create",load:"load",fullLoad:"fullLoad"},fe={mark(l){performance.mark(l)},measure(l,t,n){performance.measure(l,t,n)}};function qe(l){const t=l.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var Ne,Ye={},ze=function(){if(Ne)return Ye;function l(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,_,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{_=new Worker(w),m=!0}catch{m=!1}return _&&_.terminate(),URL.revokeObjectURL(w),m}()?function(){var m=document.createElement("canvas");m.width=m.height=1;var _=m.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===m.width}()?(n[f=u&&u.failIfMajorPerformanceCaveat]===void 0&&(n[f]=function(m){var _,v=function(w){var E=document.createElement("canvas"),A=Object.create(l.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=w,E.getContext("webgl2",A)}(m);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(f)),n[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}Ne=1,Ye.supported=l,Ye.notSupportedReason=t;var n={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Ye}();function Xe(l,t,n){const u=document.createElement(l);return t!=null&&(u.className=t),n&&n.appendChild(u),u}function We(l,t,n){const u=document.createElementNS("http://www.w3.org/2000/svg",l);for(const f of Object.keys(t))u.setAttributeNS(null,f,String(t[f]));return n&&n.appendChild(u),u}const De=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ke=De&&De.userSelect!==void 0?"userSelect":"WebkitUserSelect";let et;function st(){De&&Ke&&(et=De[Ke],De[Ke]="none")}function $e(){De&&Ke&&(De[Ke]=et)}function bt(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",bt,!0)}function St(){window.addEventListener("click",bt,!0),window.setTimeout(()=>{window.removeEventListener("click",bt,!0)},0)}function dr(l,t){const n=l.getBoundingClientRect();return ht(l,n,t)}function Fr(l,t){const n=l.getBoundingClientRect(),u=[];for(let f=0;f<t.length;f++)u.push(ht(l,n,t[f]));return u}function hi(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function ht(l,t,n){const u=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new s.P((n.clientX-t.left)*u,(n.clientY-t.top)*u)}const Zt="01",fr="NO_ACCESS_TOKEN";class Tr{constructor(t,n,u){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let u=0;u<10;u++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Zt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!s.f(t))return t;const u=ri(t);return u.params.push(`sdk=js-${ne}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!s.f(t))return t;const u=ri(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeModelURL(t,n){if(!s.f(t))return t;const u=ri(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||n)}normalizeSourceURL(t,n,u,f){if(!s.f(t))return t;const m=ri(t);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),u&&m.params.push(`language=${u}`),f&&m.params.push(`worldview=${f}`),this._makeAPIURL(m,this._customAccessToken||n)}normalizeIconsetURL(t,n){const u=ri(t);return s.f(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||n)):fi(u)}normalizeSpriteURL(t,n,u,f){const m=ri(t);return s.f(t)?(m.path=`/styles/v1${m.path}/sprite${n}${u}`,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=`${n}${u}`,fi(m))}normalizeTileURL(t,n,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.f(t))return t;const f=ri(t);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||u&&f.authority!=="raster"&&u===512?"@2x":""}${s.m.supported?".webp":"$1"}`),f.authority==="raster"?f.path=`/${s.e.RASTER_URL_PREFIX}${f.path}`:f.authority==="rasterarrays"?f.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${f.path}`:f.authority==="3dtiles"?f.path=`/${s.e.TILES3D_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${s.e.TILE_URL_VERSION}${f.path}`);const m=this._customAccessToken||function(_){for(const v of _){const w=v.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(f.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,m)}canonicalizeTileURL(t,n){const u=ri(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let f="mapbox://";u.path.match(/^\/raster\/v1\//)?f+=`raster/${u.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?f+=`rasterarrays/${u.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:f+=`tiles/${u.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let m=u.params;return n&&(m=m.filter(_=>!_.match(/^access_token=/))),m.length&&(f+=`?${m.join("&")}`),f}canonicalizeTileset(t,n){const u=!!n&&s.f(n),f=[];for(const m of t.tiles||[])s.h(m)?f.push(this.canonicalizeTileURL(m,u)):f.push(m);return f}_makeAPIURL(t,n){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",f=ri(s.e.API_URL);if(t.protocol=f.protocol,t.authority=f.authority,t.protocol==="http"){const m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(f.path!=="/"&&(t.path=`${f.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return fi(t);if(n=n||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(m=>m.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),fi(t)}}const Or=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ri(l){const t=l.match(Or);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function fi(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const mr="mapbox.eventData";function Lr(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.j(t[1]))}catch{return null}}class or{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Lr(s.e.ACCESS_TOKEN);let u="";return u=n&&n.u?s.k(n.u):s.e.ACCESS_TOKEN||"",t?`${mr}.${t}:${u}`:`${mr}:${u}`}fetchEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const f=localStorage.getItem(n);f&&(this.eventData=JSON.parse(f));const m=localStorage.getItem(u);m&&(this.anonId=m)}catch{s.w("Unable to read from LocalStorage")}}saveEventData(){const t=s.s("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid"),f=this.anonId;if(t&&f)try{localStorage.setItem(u,f),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,u,f){if(!s.e.EVENTS_URL)return;const m=ri(s.e.EVENTS_URL);m.params.push(`access_token=${f||s.e.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(t).toISOString()},v=n?s.l(_,n):_,w={url:fi(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=s.p(w,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(f)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}const dt=new class extends or{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(n=>s.f(n)||s.h(n))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Lr(s.e.ACCESS_TOKEN),n=t?t.u:s.e.ACCESS_TOKEN;let u=n!==this.eventData.tokenU;s.v(this.anonId)||(this.anonId=s.u(),u=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(f),v=(f-this.eventData.lastSuccess)/864e5;u=u||v>=1||v<-1||m.getDate()!==_.getDate()}else u=!0;u?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ne,skuId:Zt,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=f,this.eventData.tokenU=n)},l):this.processRequests()}},sr=dt.postTurnstileEvent.bind(dt),bi=new class extends or{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,n,u){this.skuToken=t,this.errorCb=u,s.e.EVENTS_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(fr)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),s.v(this.anonId)||(this.anonId=s.u()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ne,skuId:Zt,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},Ai=bi.postMapLoadEvent.bind(bi),qr=new class extends or{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=s.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:n,style:u,importedStyles:f}=t;if(!s.e.EVENTS_URL||!l&&!s.e.ACCESS_TOKEN)return;const m=this.getMapInstanceId(n),_={mapInstanceId:m,eventId:this.getEventId(m),style:u};f.length&&(_.importedStyles=f),this.queueRequest({timestamp:Date.now(),payload:_},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},l)}},Gr=qr.postStyleLoadEvent.bind(qr),pi=new class extends or{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){s.e.EVENTS_URL&&(l||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),u=function(f){const m=performance.getEntriesByType("resource"),_=performance.getEntriesByType("mark"),v=function(k){const q={};if(k){for(const V in k)if(V!=="other")for(const $ of k[V]){const U=`${V}ResolveRangeMin`,ee=`${V}ResolveRangeMax`,se=`${V}RequestCount`,ae=`${V}RequestCachedCount`;q[U]=Math.min(q[U]||1/0,$.startTime),q[ee]=Math.max(q[ee]||-1/0,$.responseEnd);const xe=ye=>{q[ye]===void 0&&(q[ye]=0),++q[ye]};$.transferSize!==void 0&&$.transferSize===0&&xe(ae),xe(se)}}return q}(function(k,q){const V={};if(k)for(const $ of k){const U=q($);V[U]===void 0&&(V[U]=[]),V[U].push($)}return V}(m,qe)),w=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=E?E.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},M=(k,q,V)=>{V!=null&&k.push({name:q,value:V.toString()})};for(const k in v)M(P.counters,k,v[k]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(M(P.counters,"interactionRangeMin",f.interactionRange[0]),M(P.counters,"interactionRangeMax",f.interactionRange[1])),_)for(const k of Object.keys(F)){const q=F[k],V=_.find($=>$.name===q);V&&M(P.counters,q,V.startTime)}return M(P.counters,"visibilityHidden",f.visibilityHidden),M(P.attributes,"style",function(k){if(k)for(const q of k){const V=q.name.split("?")[0];if(s.i(V)){const $=V.split("/").slice(-2);if($.length===2)return`mapbox://styles/${$[0]}/${$[1]}`}}}(m)),M(P.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),M(P.attributes,"fogEnabled",f.fogEnabled?"true":"false"),M(P.attributes,"projection",f.projection),M(P.attributes,"zoom",f.zoom),M(P.metadata,"devicePixelRatio",w),M(P.metadata,"connectionEffectiveType",A),M(P.metadata,"navigatorUserAgent",navigator.userAgent),M(P.metadata,"screenWidth",window.screen.width),M(P.metadata,"screenHeight",window.screen.height),M(P.metadata,"windowWidth",window.innerWidth),M(P.metadata,"windowHeight",window.innerHeight),M(P.metadata,"mapWidth",f.width/w),M(P.metadata,"mapHeight",f.height/w),M(P.metadata,"webglRenderer",f.renderer),M(P.metadata,"webglVendor",f.vendor),M(P.metadata,"sdkVersion",ne),M(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(n);for(const f of u.metadata);for(const f of u.counters);for(const f of u.attributes);this.postEvent(t,u,()=>{},l)}},ji=pi.postPerformanceEvent.bind(pi),jr=new class extends or{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,n,u){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const f=ri(s.e.API_URL+s.e.SESSION_PATH);f.params.push(`sku=${t||""}`),f.params.push(`access_token=${u||s.e.ACCESS_TOKEN||""}`);const m={url:fi(f),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(m,_=>{this.pendingRequest=null,n(_),this.saveEventData(),this.processRequests(u)})}getSessionAPI(l,t,n,u){this.skuToken=t,this.errorCb=u,s.e.SESSION_PATH&&s.e.API_URL&&(n||s.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(fr)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},Dn=jr.getSessionAPI.bind(jr),Xn=new Set;function xo(l,t){t?Xn.add(l):Xn.delete(l)}class zi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,n){this._updatedImages[n]=this._updatedImages[n]||new Set,this._updatedImages[n].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ts(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class zs extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.t()&&(this.imageRasterizerDispatcher=new s.D(s.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const n=this.atlasTexture.get(t);n&&(n.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,n){this.imageProviders.has(n)||this.imageProviders.set(n,new Map),this.imageProviders.get(n).set(t.id,t)}removeImageProvider(t,n){this.imageProviders.has(n)&&this.imageProviders.get(n).delete(t)}getPendingImageProviders(){const t=[];for(const n of this.imageProviders.values())for(const u of n.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,n){if(this.loaded.get(n)!==t&&(this.loaded.set(n,t),t)){for(const{ids:u,callback:f}of this.requestors)this._notify(u,n,f);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images.get(n).get(t.toString())}addImage(t,n,u){this._validate(t,u)&&this.images.get(n).set(t.toString(),u)}_validate(t,n){let u=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(n.content,n)||(this.fire(new s.z(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,n){if(!t)return!0;let u=0;for(const f of t){if(f[0]<u||f[1]<f[0]||n<f[1])return!1;u=f[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,u){const f=this.images.get(n).get(t.toString());u.version=f.version+1,this.images.get(n).set(t.toString(),u),this.updatedImages.get(n).add(t),this.removeFromImageRasterizerCache(t,n)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,n){this.spriteFormat!=="raster"&&(s.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(t,n){const u=this.images.get(n),f=u.get(t.toString());u.delete(t.toString()),this.patterns.get(n).delete(t.toString()),this.removeFromImageRasterizerCache(t,n),f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(n=>s.I.from(n))}getImages(t,n,u){const f=[],m=[],_=this.imageProviders.get(n);for(const A of t){if(!A.iconsetId){f.push(A);continue}const P=_.get(A.iconsetId);P&&(this.getImage(A,n)?m.push(A):P.addPendingRequest(A))}if(f.length===0)return void this._notify(m,n,u);let v=!0;const w=!!this.loaded.get(n),E=this.images.get(n);if(!w)for(const A of f)E.has(A.toString())||(v=!1);w||v?this._notify(f,n,u):this.requestors.push({ids:f,scope:n,callback:u})}rasterizeImages(t,n){const u=new Map,{tasks:f,scope:m}=t;for(const[_,v]of f.entries()){const w=this.getImage(v.id,m);w&&u.set(_,{image:w,imageVariant:v})}this._rasterizeImages(m,u,n)}_rasterizeImages(t,n,u){if(s.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:n,scope:t},u);else{const f=new Map;for(const[m,{image:_,imageVariant:v}]of n.entries())f.set(m,this.imageRasterizer.rasterize(v,_,t,0));u(void 0,f)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,n,u){const f=this.images.get(n),m=new Map;for(const _ of t){if(!f.get(_.toString())){if(_.iconsetId)continue;this.fire(new s.A("styleimagemissing",{id:_.name}))}const v=f.get(_.toString());if(!v){s.w(`Image "${_.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const w={data:v.usvg?null:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,usvg:v.usvg,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)};v.usvg&&Object.assign(w,{width:v.icon.usvg_tree.width,height:v.icon.usvg_tree.height}),m.set(s.I.toString(_),w)}u(null,m)}getPixelSize(t){const{width:n,height:u}=this.atlasImage.get(t);return{width:n,height:u}}getPattern(t,n,u){const f=t.toString(),m=this.patterns.get(n),_=m.get(f),v=this.getImage(t,n);if(!v)return null;if(_){if(_.position.version===v.version)return _.position;_.position.version=v.version}else{if(v.usvg&&!v.data){const w=this.getPatternInFlightId(f,n);if(this.patternsInFlight.has(w))return null;this.patternsInFlight.add(w);const E=new s.B(t).scaleSelf(s.q.devicePixelRatio),A=new Map([[E.toString(),{image:v,imageVariant:E}]]);return this._rasterizeImages(n,A,(P,M)=>this.storePatternImage(E,n,v,u,M)),null}this.storePattern(t,n,v)}return this._updatePatternAtlas(n,u),m.get(f).position}getPatternInFlightId(t,n){return s.C(t,n)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,n,u,f,m){const _=t.toString(),v=m?m.get(_):void 0;v&&(u.data=v,this.storePattern(t.id,n,u),this._updatePatternAtlas(n,f),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),n)))}storePattern(t,n,u){const f={w:u.data.width+2*s.F,h:u.data.height+2*s.F,x:0,y:0},m=new s.G(f,u,s.F);this.patterns.get(n).set(t.toString(),{bin:f,position:m})}bind(t,n){const u=t.gl;let f=this.atlasTexture.get(n);f?this.dirty&&(f.update(this.atlasImage.get(n)),this.dirty=!1):(f=new s.T(t,this.atlasImage.get(n),u.RGBA8),this.atlasTexture.set(n,f)),f.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const u=this.patterns.get(t),f=Array.from(u.values()).map(({bin:E})=>E),{w:m,h:_}=s.H(f),v=this.atlasImage.get(t);v.resize({width:m||1,height:_||1});const w=this.images.get(t);for(const[E,{bin:A,position:P}]of u.entries()){let M=P.padding;const k=A.x+M,q=A.y+M,V=w.get(E).data,$=V.width,U=V.height;M=M>1?M-1:M,s.r.copy(V,v,{x:0,y:0},{x:k,y:q},{width:$,height:U},n),s.r.copy(V,v,{x:0,y:U-M},{x:k,y:q-M},{width:$,height:M},n),s.r.copy(V,v,{x:0,y:0},{x:k,y:q+U},{width:$,height:M},n),s.r.copy(V,v,{x:$-M,y:0},{x:k-M,y:q},{width:M,height:U},n),s.r.copy(V,v,{x:0,y:0},{x:k+$,y:q},{width:M,height:U},n),s.r.copy(V,v,{x:$-M,y:U-M},{x:k-M,y:q-M},{width:M,height:M},n),s.r.copy(V,v,{x:0,y:U-M},{x:k+$,y:q-M},{width:M,height:M},n),s.r.copy(V,v,{x:0,y:0},{x:k+$,y:q+U},{width:M,height:M},n),s.r.copy(V,v,{x:$-M,y:0},{x:k-M,y:q+U},{width:M,height:M},n)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,n){const u=this.images.get(n);for(const f of t){if(this.callbackDispatchedThisFrame.get(n).has(f.toString()))continue;this.callbackDispatchedThisFrame.get(n).add(f.toString());const m=u.get(f.toString());ts(m)&&this.updateImage(f,n,m)}}}function no(l){const t=l.key,n=l.value,u=l.valueSpec||{},f=l.objectElementValidators||{},m=l.style,_=l.styleSpec;let v=[];const w=s.K(n);if(w!=="object")return[new s.V(t,n,`object expected, ${w} found`)];for(const E in n){const A=E.split(".")[0];let P;f[A]?P=f[A]:u[A]?P=Qi:f["*"]?P=f["*"]:u["*"]&&(P=Qi),P?v=v.concat(P({key:(t&&`${t}.`)+E,value:n[E],valueSpec:u[A]||u["*"],style:m,styleSpec:_,object:n,objectKey:E},n)):v.push(new s.J(t,n[E],`unknown property "${E}"`))}for(const E in u)f[E]||u[E].required&&u[E].default===void 0&&n[E]===void 0&&v.push(new s.V(t,n,`missing required property "${E}"`));return v}function fs(l){const t=l.value,n=l.valueSpec,u=l.style,f=l.styleSpec,m=l.key,_=l.arrayElementValidator||Qi;if(s.K(t)!=="array")return[new s.V(m,t,`array expected, ${s.K(t)} found`)];if(n.length&&t.length!==n.length)return[new s.V(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new s.V(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};f.$version<7&&(v.function=n.function),s.K(n.value)==="object"&&(v=n.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(_({array:t,arrayIndex:E,value:t[E],valueSpec:v,style:u,styleSpec:f,key:`${m}[${E}]`},!0));return w}function rs(l){const t=l.key,n=l.value,u=l.valueSpec;let f=s.K(n);if(f==="number"&&n!=n&&(f="NaN"),f!=="number")return[new s.V(t,n,`number expected, ${f} found`)];if("minimum"in u){let m=u.minimum;if(s.K(u.minimum)==="array"&&(m=u.minimum[l.arrayIndex]),n<m)return[new s.V(t,n,`${n} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if(s.K(u.maximum)==="array"&&(m=u.maximum[l.arrayIndex]),n>m)return[new s.V(t,n,`${n} is greater than the maximum value ${m}`)]}return[]}function eo(l){const t=l.valueSpec,n=s.M(l.value.type);let u,f,m,_={};const v=n!=="categorical"&&l.value.property===void 0,w=!v,E=s.K(l.value.stops)==="array"&&s.K(l.value.stops[0])==="array"&&s.K(l.value.stops[0][0])==="object",A=no({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(k){if(n==="identity")return[new s.V(k.key,k.value,'identity function may not have a "stops" property')];let q=[];const V=k.value;return q=q.concat(fs({key:k.key,value:V,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:P})),s.K(V)==="array"&&V.length===0&&q.push(new s.V(k.key,V,"array must have at least one stop")),q},default:function(k){return Qi({key:k.key,value:k.value,valueSpec:t,style:k.style,styleSpec:k.styleSpec})}}});return n==="identity"&&v&&A.push(new s.V(l.key,l.value,'missing required property "property"')),n==="identity"||l.value.stops||A.push(new s.V(l.key,l.value,'missing required property "stops"')),n==="exponential"&&l.valueSpec.expression&&!s.N(l.valueSpec)&&A.push(new s.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(w&&!s.O(l.valueSpec)?A.push(new s.V(l.key,l.value,"property functions not supported")):v&&!s.Q(l.valueSpec)&&A.push(new s.V(l.key,l.value,"zoom functions not supported"))),n!=="categorical"&&!E||l.value.property!==void 0||A.push(new s.V(l.key,l.value,'"property" property is required')),A;function P(k){let q=[];const V=k.value,$=k.key;if(s.K(V)!=="array")return[new s.V($,V,`array expected, ${s.K(V)} found`)];if(V.length!==2)return[new s.V($,V,`array length 2 expected, length ${V.length} found`)];if(E){if(s.K(V[0])!=="object")return[new s.V($,V,`object expected, ${s.K(V[0])} found`)];if(V[0].zoom===void 0)return[new s.V($,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new s.V($,V,"object stop key must have value")];const U=s.M(V[0].zoom);if(typeof U!="number")return[new s.V($,V[0].zoom,"stop zoom values must be numbers")];if(m&&m>U)return[new s.V($,V[0].zoom,"stop zoom values must appear in ascending order")];U!==m&&(m=U,f=void 0,_={}),q=q.concat(no({key:`${$}[0]`,value:V[0],valueSpec:{zoom:{}},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:rs,value:M}}))}else q=q.concat(M({key:`${$}[0]`,value:V[0],style:k.style,styleSpec:k.styleSpec},V));return s.S(s.U(V[1]))?q.concat([new s.V(`${$}[1]`,V[1],"expressions are not allowed in function stops.")]):q.concat(Qi({key:`${$}[1]`,value:V[1],valueSpec:t,style:k.style,styleSpec:k.styleSpec}))}function M(k,q){const V=s.K(k.value),$=s.M(k.value),U=k.value!==null?k.value:q;if(u){if(V!==u)return[new s.V(k.key,U,`${V} stop domain type must match previous stop domain type ${u}`)]}else u=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new s.V(k.key,U,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&n!=="categorical"){let ee=`number expected, ${V} found`;return s.O(t)&&n===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(k.key,U,ee)]}return n!=="categorical"||V!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?n!=="categorical"&&V==="number"&&typeof $=="number"&&typeof f=="number"&&f!==void 0&&$<f?[new s.V(k.key,U,"stop domain values must appear in ascending order")]:(f=$,n==="categorical"&&$ in _?[new s.V(k.key,U,"stop domain values must be unique")]:(_[$]=!0,[])):[new s.V(k.key,U,`integer expected, found ${String($)}`)]}}function po(l){const t=(l.expressionContext==="property"?s.W:s.X)(s.U(l.value),l.valueSpec);if(t.result==="error")return t.value.map(u=>new s.V(`${l.key}${u.key}`,l.value,u.message));const n=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!n.outputDefined())return[new s.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!s.Y(n))return[new s.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return ko(n,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!s.Z(n,["zoom","feature-state"]))return[new s.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!s._(n))return[new s.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ko(l,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const f of t.valueSpec.expression.parameters)n.delete(f);if(n.size===0)return[];const u=[];return l instanceof s.$&&n.has(l.name)?[new s.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(f=>{u.push(...ko(f,t))}),u)}function mo(l){const t=l.key,n=l.value,u=l.valueSpec,f=[];return Array.isArray(u.values)?u.values.indexOf(s.M(n))===-1&&f.push(new s.V(t,n,`expected one of [${u.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(u.values).indexOf(s.M(n))===-1&&f.push(new s.V(t,n,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function oo(l){return s.a1(s.U(l.value))?po(s.L({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):yo(l)}function yo(l){const t=l.value,n=l.key;if(s.K(t)!=="array")return[new s.V(n,t,`array expected, ${s.K(t)} found`)];const u=l.styleSpec;let f,m=[];if(t.length<1)return[new s.V(n,t,"filter array must have at least 1 element")];switch(m=m.concat(mo({key:`${n}[0]`,value:t[0],valueSpec:u.filter_operator,style:l.style,styleSpec:l.styleSpec})),s.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.M(t[1])==="$type"&&m.push(new s.V(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new s.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=s.K(t[1]),f!=="string"&&m.push(new s.V(`${n}[1]`,t[1],`string expected, ${f} found`)));for(let _=2;_<t.length;_++)f=s.K(t[_]),s.M(t[1])==="$type"?m=m.concat(mo({key:`${n}[${_}]`,value:t[_],valueSpec:u.geometry_type,style:l.style,styleSpec:l.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&m.push(new s.V(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)m=m.concat(yo({key:`${n}[${_}]`,value:t[_],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":f=s.K(t[1]),t.length!==2?m.push(new s.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&m.push(new s.V(`${n}[1]`,t[1],`string expected, ${f} found`))}return m}function Ao(l,t){const n=l.key,u=l.style,f=l.layer,m=l.styleSpec,_=l.value,v=l.objectKey,w=m[`${t}_${l.layerType}`];if(!w)return[];const E=v.match(/^(.*)-use-theme$/);if(t==="paint"&&E&&w[E[1]])return s.S(_)?[].concat(Qi({key:l.key,value:_,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:v})):Qi({key:n,value:_,valueSpec:{type:"string"},style:u,styleSpec:m});const A=v.match(/^(.*)-transition$/);if(t==="paint"&&A&&w[A[1]]&&w[A[1]].transition)return Qi({key:n,value:_,valueSpec:m.transition,style:u,styleSpec:m});const P=l.valueSpec||w[v];if(!P)return[new s.J(n,_,`unknown property "${v}"`)];let M;if(s.K(_)==="string"&&s.O(P)&&!P.tokens&&(M=/^{([^}]+)}$/.exec(_))){const q=`\`{ "type": "identity", "property": ${M?JSON.stringify(M[1]):'"_"'} }\``;return[new s.V(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: ${q}.`)]}const k=[];if(l.layerType==="symbol")v!=="text-field"||!u||u.glyphs||u.imports||k.push(new s.V(n,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&s.a2(s.U(_))&&s.M(_.type)==="identity"&&k.push(new s.V(n,_,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&s.O(P)&&(s.a3(P)||s.Q(P))){const q=s.W(s.U(_),P),V=q.value.expression||q.value._styleExpression.expression;V&&!s.Z(V,["measure-light"])&&(v==="model-emissive-strength"&&s._(V)&&s.Y(V)||k.push(new s.V(n,_,`${v} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return k.concat(Qi({key:l.key,value:_,valueSpec:P,style:u,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:v}))}function Ws(l){return Ao(l,"paint")}function ps(l){return Ao(l,"layout")}function Ho(l){let t=[];const n=l.value,u=l.key,f=l.style,m=l.styleSpec;n.type||n.ref||t.push(new s.V(u,n,'either "type" or "ref" is required'));let _=s.M(n.type);const v=s.M(n.ref);if(n.id){const w=s.M(n.id);for(let E=0;E<l.arrayIndex;E++){const A=f.layers[E];s.M(A.id)===w&&t.push(new s.V(u,n.id,`duplicate layer id "${n.id}", previously used at line ${A.id.__line__}`))}}if("ref"in n){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&t.push(new s.V(u,n[E],`"${E}" is prohibited for ref layers`))}),f.layers.forEach(E=>{s.M(E.id)===v&&(w=E)}),w?w.ref?t.push(new s.V(u,n.ref,"ref cannot reference another ref layer")):_=s.M(w.type):typeof v=="string"&&t.push(new s.V(u,n.ref,`ref layer "${v}" not found`))}else if(_!=="background"&&_!=="sky"&&_!=="slot")if(n.source){const w=f.sources&&f.sources[n.source],E=w&&s.M(w.type);w?E==="vector"&&_==="raster"?t.push(new s.V(u,n.source,`layer "${n.id}" requires a raster source`)):E==="raster"&&_!=="raster"?t.push(new s.V(u,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&_!=="hillshade"?t.push(new s.V(u,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="raster-array"||["raster","raster-particle"].includes(_)?_==="line"&&n.paint&&(n.paint["line-gradient"]||n.paint["line-trim-offset"])&&E==="geojson"&&!w.lineMetrics?t.push(new s.V(u,n,`layer "${n.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):_==="raster-particle"&&E!=="raster-array"&&t.push(new s.V(u,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new s.V(u,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(u,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new s.V(u,n.source,`source "${n.source}" not found`))}else t.push(new s.V(u,n,'missing required property "source"'));return t=t.concat(no({key:u,value:n,valueSpec:m.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Qi({key:`${u}.type`,value:n.type,valueSpec:m.layer.type,style:l.style,styleSpec:l.styleSpec,object:n,objectKey:"type"}),filter:w=>oo(s.L({layerType:_},w)),layout:w=>no({layer:n,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>ps(s.L({layerType:_},E))}}),paint:w=>no({layer:n,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Ws(s.L({layerType:_,layer:n},E))}})}})),t}function is(l){const t=l.value,n=l.key,u=s.K(t);return u!=="string"?[new s.V(n,t,`string expected, ${u} found`)]:[]}const Lo={promoteId:function l({key:t,value:n}){if(s.K(n)==="string")return is({key:t,value:n});if(Array.isArray(n)){const u=[],f=s.U(n),m=s.X(f);return m.result==="error"&&m.value.forEach(_=>{u.push(new s.V(`${t}${_.key}`,null,`${_.message}`))}),s.Z(m.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const f in n)u.push(...l({key:`${t}.${f}`,value:n[f]}));return u}}};function co(l){const t=l.value,n=l.key,u=l.styleSpec,f=l.style;if(!t.type)return[new s.V(n,t,'"type" is required')];const m=s.M(t.type);let _=[];switch(["vector","raster","raster-dem","raster-array"].includes(m)&&(t.url||t.tiles||_.push(new s.J(n,t,'Either "url" or "tiles" is required.'))),m){case"vector":case"raster":case"raster-dem":case"raster-array":return _=_.concat(no({key:n,value:t,valueSpec:u[`source_${m.replace("-","_")}`],style:l.style,styleSpec:u,objectElementValidators:Lo})),_;case"geojson":if(_=no({key:n,value:t,valueSpec:u.source_geojson,style:f,styleSpec:u,objectElementValidators:Lo}),t.cluster)for(const v in t.clusterProperties){const[w,E]=t.clusterProperties[v],A=typeof w=="string"?[w,["accumulated"],["get",v]]:w;_.push(...po({key:`${n}.${v}.map`,value:E,expressionContext:"cluster-map"})),_.push(...po({key:`${n}.${v}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return _;case"video":return no({key:n,value:t,valueSpec:u.source_video,style:f,styleSpec:u});case"image":return no({key:n,value:t,valueSpec:u.source_image,style:f,styleSpec:u});case"canvas":return[new s.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return mo({key:`${n}.type`,value:t.type,valueSpec:{values:Os(u)}})}}function Os(l){return l.source.reduce((t,n)=>{const u=l[n];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function ns(l){const t=l.value,n=l.styleSpec,u=n.light,f=l.style;let m=[];const _=s.K(t);if(t===void 0)return m;if(_!=="object")return m=m.concat([new s.V("light",t,`object expected, ${_} found`)]),m;for(const v in t){const w=v.match(/^(.*)-transition$/),E=v.match(/^(.*)-use-theme$/);m=m.concat(E&&u[E[1]]?Qi({key:v,value:t[v],valueSpec:{type:"string"},style:f,styleSpec:n}):w&&u[w[1]]&&u[w[1]].transition?Qi({key:v,value:t[v],valueSpec:n.transition,style:f,styleSpec:n}):u[v]?Qi({key:v,value:t[v],valueSpec:u[v],style:f,styleSpec:n}):[new s.V(v,t[v],`unknown property "${v}"`)])}return m}function ms(l){const t=l.value;let n=[];if(!t)return n;const u=s.K(t);if(u!=="object")return n=n.concat([new s.V("light-3d",t,`object expected, ${u} found`)]),n;const f=l.styleSpec,m=f["light-3d"],_=l.key,v=l.style,w=l.style.lights;for(const P of["type","id"])if(!(P in t))return n=n.concat([new s.V("light-3d",t,`missing property ${P} on light`)]),n;if(t.type&&w)for(let P=0;P<l.arrayIndex;P++){const M=s.M(t.type),k=w[P];s.M(k.type)===M&&n.push(new s.V(_,t.id,`duplicate light type "${t.type}", previously defined at line ${k.id.__line__}`))}const E=`properties_light_${t.type}`;if(!(E in f))return n=n.concat([new s.V("light-3d",t,`Invalid light type ${t.type}`)]),n;const A=f[E];for(const P in t)if(P==="properties"){const M=t[P],k=s.K(M);if(k!=="object")return n=n.concat([new s.V("properties",M,`object expected, ${k} found`)]),n;for(const q in M)n=n.concat(A[q]?Qi({key:q,value:M[q],valueSpec:A[q],style:v,styleSpec:f}):[new s.J(l.key,M[q],`unknown property "${q}"`)])}else{const M=P.match(/^(.*)-transition$/),k=P.match(/^(.*)-use-theme$/);n=n.concat(k&&m[k[1]]?Qi({key:P,value:t[P],valueSpec:{type:"string"},style:v,styleSpec:f}):M&&m[M[1]]&&m[M[1]].transition?Qi({key:P,value:t[P],valueSpec:f.transition,style:v,styleSpec:f}):m[P]?Qi({key:P,value:t[P],valueSpec:m[P],style:v,styleSpec:f}):[new s.J(P,t[P],`unknown property "${P}"`)])}return n}function ra(l){const t=l.value,n=l.key,u=l.style,f=l.styleSpec,m=f.terrain;let _=[];const v=s.K(t);if(t===void 0||v==="null")return _;if(v!=="object")return _=_.concat([new s.V("terrain",t,`object expected, ${v} found`)]),_;for(const w in t){const E=w.match(/^(.*)-transition$/),A=w.match(/^(.*)-use-theme$/);_=_.concat(A&&m[A[1]]?Qi({key:w,value:t[w],valueSpec:{type:"string"},style:u,styleSpec:f}):E&&m[E[1]]&&m[E[1]].transition?Qi({key:w,value:t[w],valueSpec:f.transition,style:u,styleSpec:f}):m[w]?Qi({key:w,value:t[w],valueSpec:m[w],style:u,styleSpec:f}):[new s.J(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=u.sources&&u.sources[t.source],E=w&&s.M(w.type);w?E!=="raster-dem"&&_.push(new s.V(n,t.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):_.push(new s.V(n,t.source,`source "${t.source}" not found`))}else _.push(new s.V(n,t,'terrain is missing required property "source"'));return _}function os(l){const t=l.value,n=l.style,u=l.styleSpec,f=u.fog;let m=[];const _=s.K(t);if(t===void 0)return m;if(_!=="object")return m=m.concat([new s.V("fog",t,`object expected, ${_} found`)]),m;for(const v in t){const w=v.match(/^(.*)-transition$/),E=v.match(/^(.*)-use-theme$/);m=m.concat(E&&f[E[1]]?Qi({key:v,value:t[v],valueSpec:{type:"string"},style:n,styleSpec:u}):w&&f[w[1]]&&f[w[1]].transition?Qi({key:v,value:t[v],valueSpec:u.transition,style:n,styleSpec:u}):f[v]?Qi({key:v,value:t[v],valueSpec:f[v],style:n,styleSpec:u}):[new s.J(v,t[v],`unknown property "${v}"`)])}return m}const ia={"*":()=>[],array:fs,boolean:function(l){const t=l.value,n=l.key,u=s.K(t);return u!=="boolean"?[new s.V(n,t,`boolean expected, ${u} found`)]:[]},number:rs,color:function(l){const t=l.key,n=l.value,u=s.K(n);return u!=="string"?[new s.V(t,n,`color expected, ${u} found`)]:s.a0.parseCSSColor(n)===null?[new s.V(t,n,`color expected, "${n}" found`)]:[]},enum:mo,filter:oo,function:eo,layer:Ho,object:no,source:co,model:s.a4,light:ns,"light-3d":ms,terrain:ra,fog:os,string:is,formatted:function(l){return is(l).length===0?[]:po(l)},resolvedImage:function(l){return is(l).length===0?[]:po(l)},projection:function(l){const t=l.value,n=l.styleSpec,u=n.projection,f=l.style;let m=[];const _=s.K(t);if(_==="object")for(const v in t)m=m.concat(Qi({key:v,value:t[v],valueSpec:u[v],style:f,styleSpec:n}));else _!=="string"&&(m=m.concat([new s.V("projection",t,`object or string expected, ${_} found`)]));return m},import:function(l){const{value:t,styleSpec:n}=l,{data:u,...f}=t;Object.defineProperty(f,"__line__",{value:t.__line__,enumerable:!1});let m=no(s.L({},l,{value:f,valueSpec:n.import}));return s.M(f.id)===""&&m.push(new s.V(`${l.key}.id`,f,"import id can't be an empty string")),u&&(m=m.concat(Es(u,n,{key:`${l.key}.data`}))),m},iconset:function(l){const t=l.value,n=l.key,u=l.styleSpec,f=l.style;if(!t.type)return[new s.V(n,t,'"type" is required')];const m=s.M(t.type);let _=[];if(_=_.concat(no({key:n,value:t,valueSpec:u[`iconset_${m}`],style:f,styleSpec:u})),m==="source"&&t.source){const v=f.sources&&f.sources[t.source],w=v&&s.M(v.type);v?w!=="raster-array"&&_.push(new s.V(n,t.source,`iconset cannot be used with a source of type ${String(w)}, it only be used with a "raster-array" source type`)):_.push(new s.V(n,t.source,`source "${t.source}" not found`))}return _}};function Qi(l,t=!1){const n=l.value,u=l.valueSpec,f=l.styleSpec;if(u.expression&&s.a2(s.M(n)))return eo(l);if(u.expression&&s.S(s.U(n)))return po(l);if(u.type&&ia[u.type]){const m=ia[u.type](l);return t===!0&&m.length>0&&s.K(l.value)==="array"?po(l):m}return no(s.L({},l,{valueSpec:u.type?f[u.type]:u}))}function to(l){const t=l.value,n=l.key,u=is(l);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new s.V(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new s.V(n,t,'"glyphs" url must include a "{range}" token'))),u}function Es(l,t=s.a5,n={}){return Qi({key:n.key||"",value:l,valueSpec:t.$root,styleSpec:t,style:l,objectElementValidators:{glyphs:to,"*":()=>[]}})}function so(l,t=s.a5){return Re(Es(l,t))}const xr=l=>Re(co(l)),Oi=l=>Re(ns(l)),un=l=>Re(ms(l)),Ot=l=>Re(ra(l)),pn=l=>Re(os(l)),gs=l=>Re(function(t){const n=t.value,u=t.style,f=t.styleSpec,m=f.snow;let _=[];const v=s.K(n);if(n===void 0)return _;if(v!=="object")return _=_.concat([new s.V("snow",n,`object expected, ${v} found`)]),_;for(const w in n){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&m[E[1]]&&m[E[1]].transition?Qi({key:w,value:n[w],valueSpec:f.transition,style:u,styleSpec:f}):m[w]?Qi({key:w,value:n[w],valueSpec:m[w],style:u,styleSpec:f}):[new s.J(w,n[w],`unknown property "${w}"`)])}return _}(l)),ot=l=>Re(function(t){const n=t.value,u=t.style,f=t.styleSpec,m=f.rain;let _=[];const v=s.K(n);if(n===void 0)return _;if(v!=="object")return _=_.concat([new s.V("rain",n,`object expected, ${v} found`)]),_;for(const w in n){const E=w.match(/^(.*)-transition$/);_=_.concat(E&&m[E[1]]&&m[E[1]].transition?Qi({key:w,value:n[w],valueSpec:f.transition,style:u,styleSpec:f}):m[w]?Qi({key:w,value:n[w],valueSpec:m[w],style:u,styleSpec:f}):[new s.J(w,n[w],`unknown property "${w}"`)])}return _}(l)),G=l=>Re(Ho(l)),K=l=>Re(oo(l)),ge=l=>Re(Ws(l)),Ce=l=>Re(ps(l)),Me=l=>Re(s.a4(l));function Re(l){return l.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function ke(l,t){let n=!1;if(t&&t.length)for(const u of t)u instanceof s.J?s.w(u.message):(l.fire(new s.z(new Error(u.message))),n=!0);return n}let Fe;class Qe extends s.E{constructor(t,n="flat"){super(),this._transitionable=new s.a6(Fe||(Fe=new s.a7({anchor:new s.a8(s.a5.light.anchor),position:new s.a9(s.a5.light.position),color:new s.a8(s.a5.light.color),intensity:new s.a8(s.a5.light.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,u={}){this._validate(Oi,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&ke(this,t.call(so,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let _t=class extends s.E{constructor(l,t,n,u){super(),this.scope=n,this._transitionable=new s.a6(new s.a7({source:new s.a8(s.a5.terrain.source),exaggeration:new s.a8(s.a5.terrain.exaggeration)}),n,u),this._transitionable.setTransitionOrValue(l,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new s.aa(l)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let n=-1,u=-1,f=1;for(const m of t.zoomStops)f=t.evaluate(new s.aa(m)),f>.01?(n=m,u=-1):u=m;return f<.01&&n>0&&u>n?[n,u]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof s.ab}};const Je=45,Ht=65,Qt=.05;function lr(l,t,n,u){const f=s.af(Je,Ht,n),[m,_]=Nr(l,u);let v=1-Math.min(1,Math.exp((t-m)/(_-m)*-6));return v*=v*v,v=Math.min(1,1.00747*v),v*f*l.alpha}function Nr(l,t){const n=.5/Math.tan(.5*t);return[l.range[0]+n,l.range[1]+n]}function Wr(l,t,n,u,f){const m=s.ad([],[t,n,u],f.mercatorFogMatrix);return lr(l,s.ae(m),f.pitch,f._fov)}function Zr(l,t,n,u,f,m,_){const v=[[n,u,0],[f,u,0],[f,m,0],[n,m,0]];let w=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(const A of v){const P=s.ad([],A,t),M=s.ae(P);w=Math.min(w,M),E=Math.max(E,M)}return[lr(l,w,_.pitch,_._fov),lr(l,E,_.pitch,_._fov)]}class Xr extends s.E{constructor(t,n,u,f){super();const m=new s.a7({range:new s.a8(s.a5.fog.range),color:new s.a8(s.a5.fog.color),"color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.a8(s.a5.fog["high-color"]),"high-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.a8(s.a5.fog["space-color"]),"space-color-use-theme":new s.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.a8(s.a5.fog["horizon-blend"]),"star-intensity":new s.a8(s.a5.fog["star-intensity"]),"vertical-range":new s.a8(s.a5.fog["vertical-range"])});this._transitionable=new s.a6(m,u,new Map(f)),this.set(t,f),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new s.ag(m),this.scope=u}get state(){const t=this._transform,n=t.projection.name==="globe",u=s.ah(t.zoom),f=this.properties.get("range"),m=[.5,3];return{range:n?[s.ai(m[0],f[0],u),s.ai(m[1],f[1],u)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,u={}){if(this._validate(pn,t,u))return;const f=s.l({},t);for(const m of Object.keys(s.a5.fog))f[m]===void 0&&(f[m]=s.a5.fog[m].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.af(Je,Ht,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(u,f,m){const _=s.ac.fromLngLat(f),v=m.elevation?m.elevation.getAtPointOrZero(_):0;return Wr(u,_.x,_.y,v,m)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Zr(this.state,n,0,0,s.aj,s.aj,this._transform)}getOpacityForBounds(t,n,u,f,m){return this._transform.projection.supportsFog?Zr(this.state,t,n,u,f,m,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Nr(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const u of n){const f=t.points[u];let m;if(f[2]>=0)m=f;else{const _=t.points[u-4];m=s.ak(_,f,_[2]/(_[2]-f[2]))}if(Wr(this.state,m[0],m[1],0,this._transform)>=Qt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,u){return(!u||u.validate!==!1)&&ke(this,t.call(so,s.l({value:n,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}}let nn,Jr,Wi,Mi,ii=class extends s.E{constructor(l,t,n,u){super();const f=nn||(nn=new s.a7({density:new s.a8(s.a5.snow.density),intensity:new s.a8(s.a5.snow.intensity),color:new s.a8(s.a5.snow.color),opacity:new s.a8(s.a5.snow.opacity),vignette:new s.a8(s.a5.snow.vignette),"vignette-color":new s.a8(s.a5.snow["vignette-color"]),"center-thinning":new s.a8(s.a5.snow["center-thinning"]),direction:new s.a8(s.a5.snow.direction),"flake-size":new s.a8(s.a5.snow["flake-size"])}));this._transitionable=new s.a6(f,n,new Map(u)),this.set(l,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(f),this.scope=n}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=s.al(n[0]),f=-Math.max(s.al(n[1]),.01),m=[Math.cos(u)*Math.cos(f),Math.sin(u)*Math.cos(f),Math.sin(f)],_=this.properties.get("vignette"),v=this.properties.get("vignette-color");return v.a=_,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*l),direction:m,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(l,t,n={}){if(this._validate(gs,l,n))return;const u=s.l({},l);for(const f of Object.keys(s.a5.snow))u[f]===void 0&&(u[f]=s.a5.snow[f].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,n){return(!n||n.validate!==!1)&&ke(this,l.call(so,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}},Pi=class extends s.E{constructor(l,t,n,u){super();const f=Jr||(Jr=new s.a7({density:new s.a8(s.a5.rain.density),intensity:new s.a8(s.a5.rain.intensity),color:new s.a8(s.a5.rain.color),opacity:new s.a8(s.a5.rain.opacity),vignette:new s.a8(s.a5.rain.vignette),"vignette-color":new s.a8(s.a5.rain["vignette-color"]),"center-thinning":new s.a8(s.a5.rain["center-thinning"]),direction:new s.a8(s.a5.rain.direction),"droplet-size":new s.a8(s.a5.rain["droplet-size"]),"distortion-strength":new s.a8(s.a5.rain["distortion-strength"])}));this._transitionable=new s.a6(f,n,new Map(u)),this.set(l,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ag(f),this.scope=n}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),u=s.al(n[0]),f=-Math.max(s.al(n[1]),.01),m=[Math.cos(u)*Math.cos(f),Math.sin(u)*Math.cos(f),Math.sin(f)],_=this.properties.get("vignette-color");return _.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.am(t.r,t.g,t.b,t.a*l),direction:m,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:_}}get(){return this._transitionable.serialize()}set(l,t,n={}){if(this._validate(ot,l,n))return;const u=s.l({},l);for(const f of Object.keys(s.a5.rain))u[f]===void 0&&(u[f]=s.a5.rain[f].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,n){return(!n||n.validate!==!1)&&ke(this,l.call(so,s.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a5})))}};class wn extends s.E{constructor(t,n,u,f){super(),this.scope=u,this._options=t,this.properties=new s.ag(n),this._transitionable=new s.a6(n,u,new Map(f)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class On{constructor(t,n,u,f){this.screenBounds=t,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(t,n){let u,f;if(t instanceof s.P||typeof t[0]=="number"){const m=s.P.convert(t);u=[m],f=n.isPointAboveHorizon(m)}else{const m=s.P.convert(t[0]),_=s.P.convert(t[1]),v=m.add(_)._div(2);u=[m,_],f=s.ao(m,_).every(w=>n.isPointAboveHorizon(w))&&n.isPointAboveHorizon(v)}return new On(u,n.getCameraPoint(),f,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.ao(n,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<u.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?f[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(f[3]=this.cameraPoint)),s.ap(f,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],f=s.ao(n,u,t),m=this.cameraPoint.clone();switch(3*((m.y>n.y)+(m.y>u.y))+((m.x>n.x)+(m.x>u.x))){case 0:f[0]=m,f[4]=m.clone();break;case 1:f.splice(1,0,m);break;case 2:f[1]=m;break;case 3:f.splice(4,0,m);break;case 5:f.splice(2,0,m);break;case 6:f[3]=m;break;case 7:f.splice(3,0,m);break;case 8:f[2]=m}return f}containsTile(t,n,u,f=0){const m=t.queryPadding/n._pixelsPerMercatorPixel+1,_=u?this._bufferedCameraMercator(m,n):this._bufferedScreenMercator(m,n);let v=t.tileID.wrap+(_.unwrapped?f:0);const w=_.polygon.map($=>s.aq(t.tileTransform,$,v));if(!s.ar(w,0,0,s.aj,s.aj))return;v=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const E=this.screenGeometryMercator.polygon.map($=>s.as(t.tileTransform,$,v)),A=E.map($=>new s.P($[0],$[1])),P=n.getFreeCameraOptions().position||new s.ac(0,0,0),M=s.as(t.tileTransform,P,v),k=E.map($=>{const U=s.at($,$,M);return s.au(U,U),new s.av(M,U)}),q=s.aw(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:k,bufferedTilespaceGeometry:w,bufferedTilespaceBounds:(V=s.ax(w),V.min.x=s.aD(V.min.x,0,s.aj),V.min.y=s.aD(V.min.y,0,s.aj),V.max.x=s.aD(V.max.x,0,s.aj),V.max.y=s.aD(V.max.y,0,s.aj),V),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:q};var V}_bufferedScreenMercator(t,n){const u=$o(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let f;return f=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(m=>n.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[u]=f,f}}_bufferedCameraMercator(t,n){const u=$o(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let f;return f=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(m=>n.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[u]=f,f}}_projectAndResample(t,n){const u=function(m,_){const v=s.az([],_.pixelMatrix,_.globeMatrix),w=[0,-s.aE,0,1],E=[0,s.aE,0,1],A=[0,0,0,1];s.aA(w,w,v),s.aA(E,E,v),s.aA(A,A,v);const P=new s.P(w[0]/w[3],w[1]/w[3]),M=new s.P(E[0]/E[3],E[1]/E[3]),k=s.aB(m,P)&&w[3]<A[3],q=s.aB(m,M)&&E[3]<A[3];if(!k&&!q)return null;const V=function(me,he,Te){for(let Ae=1;Ae<me.length;Ae++){const rt=go(he.pointCoordinate3D(me[Ae-1]).x),Ge=go(he.pointCoordinate3D(me[Ae]).x);if(Te<0){if(rt<Ge)return{idx:Ae,t:-rt/(Ge-1-rt)}}else if(Ge<rt)return{idx:Ae,t:(1-rt)/(Ge+1-rt)}}return null}(m,_,k?-1:1);if(!V)return null;const{idx:$,t:U}=V;let ee=$>1?Vn(m.slice(0,$),_):[],se=$<m.length?Vn(m.slice($),_):[];ee=ee.map(me=>new s.P(go(me.x),me.y)),se=se.map(me=>new s.P(go(me.x),me.y));const ae=[...ee];ae.length===0&&ae.push(se[se.length-1]);const xe=s.ai(ae[ae.length-1].y,(se.length===0?ee[0]:se[0]).y,U);let ye;return ye=k?[new s.P(0,xe),new s.P(0,0),new s.P(1,0),new s.P(1,xe)]:[new s.P(1,xe),new s.P(1,1),new s.P(0,1),new s.P(0,xe)],ae.push(...ye),se.length===0?ae.push(ee[0]):ae.push(...se),{polygon:ae.map(me=>new s.ac(me.x,me.y)),unwrapped:!1}}(t,n);if(u)return u;const f=function(m,_){let v=!1,w=-1/0,E=0;for(let P=0;P<m.length-1;P++)m[P].x>w&&(w=m[P].x,E=P);for(let P=0;P<m.length-1;P++){const M=(E+P)%(m.length-1),k=m[M],q=m[M+1];Math.abs(k.x-q.x)>.5&&(k.x<q.x?(k.x+=1,M===0&&(m[m.length-1].x+=1)):(q.x+=1,M+1===m.length-1&&(m[0].x+=1)),v=!0)}const A=s.ay(_.center.lng);return v&&A<Math.abs(A-1)&&m.forEach(P=>{P.x-=1}),{polygon:m,unwrapped:v}}(Vn(t,n).map(m=>new s.P(go(m.x),m.y)),n);return{polygon:f.polygon.map(m=>new s.ac(m.x,m.y)),unwrapped:f.unwrapped}}}function Vn(l,t){return s.aC(l,n=>{const u=t.pointCoordinate3D(n);n.x=u.x,n.y=u.y},1/256)}function go(l){return l<0?1+l%1:l%1}function $o(l){return 100*l|0}function Gn(l,t,n,u,f){const m=function(v,w){if(v)return f(v);if(w){if(l.url&&w.tiles&&l.tiles&&delete l.tiles,w.variants){if(!Array.isArray(w.variants))return f(new Error("variants must be an array"));for(const A of w.variants){if(A==null||typeof A!="object"||A.constructor!==Object)return f(new Error("variant must be an object"));if(!Array.isArray(A.capabilities))return f(new Error("capabilities must be an array"));if(A.capabilities.length===1&&A.capabilities[0]==="meshopt"){w=s.l(w,A);break}}}const E=s.aF(s.l({},w,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);E.tiles=t.canonicalizeTileset(E,l.url),f(null,E)}},_=function(v,w,E){if(!v)return null;if(!w&&!E)return v;E=E||v.worldview_default;const A=Object.values(v.language||{});if(A.length===0)return null;const P=Object.values(v.worldview||{});if(P.length===0)return null;const M=A.every(q=>q===w),k=P.every(q=>q===E);return M&&k?v:w in(v.language_options||{})||E in(v.worldview_options||{})?null:v.language_options&&v.worldview_options?v:null}(l.data,n,u);return _?s.q.frame(()=>m(null,_)):l.url?s.n(t.transformRequest(t.normalizeSourceURL(l.url,null,n,u),s.R.Source),m):s.q.frame(()=>{const{data:v,...w}=l;m(null,w)})}function Fn(l,t){const n=Math.pow(2,t.z),u=Math.floor(s.ay(l.getWest())*n),f=Math.floor(s.aH(l.getNorth())*n),m=Math.ceil(s.ay(l.getEast())*n),_=Math.ceil(s.aH(l.getSouth())*n);return t.x>=u&&t.x<m&&t.y>=f&&t.y<_}class Yn{constructor(t,n,u){this.bounds=t?s.aG.convert(this.validateBounds(t)):null,this.minzoom=n||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const n of t)this.extraBounds.push(s.aG.convert(this.validateBounds(n)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Fn(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const n of this.extraBounds)if(Fn(n,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const n=new Yn(t.bounds,t.minzoom,t.maxzoom);return n.addExtraBounds(t.extra_bounds),n}}class mn extends s.E{constructor(t,n,u,f){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.l(this,s.aF(n,["url","scheme","tileSize","promoteId"])),this._options=s.l({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new s.aI}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Gn(this._options,this.map._requestManager,n,u,(f,m)=>{if(this._tileJSONRequest=null,this._loaded=!0,f)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new s.z(f));else if(m){if(s.l(this,m),this.hasWorldviews=!!m.worldview_options,m.worldview_default&&(this.worldviewDefault=m.worldview_default),m.vector_layers){this.vectorLayers=m.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const _ of m.vector_layers)this.vectorLayerIds.push(_.id),m.worldview&&m.worldview[_.source]&&this.localizableLayerIds.add(_.id)}this.tileBounds=Yn.fromTileJSON(m),sr(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(f)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}loadTile(t,n){const u=t.tileID.canonical.url(this.tiles,this.scheme),f=this.map._requestManager.normalizeTileURL(u),m=this.map._requestManager.transformRequest(f,s.R.Tile),_=this.map.style?this.map.style.getLut(this.scope):null,v=_?{image:_.image.clone()}:null,w={request:m,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:v,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&s.f(u)&&(w.worldview=this.map.getWorldview()||this.worldviewDefault,w.localizableLayerIds=this.localizableLayerIds),w.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",w,E.bind(this));else if(t.actor=this._tileWorkers[f]=this._tileWorkers[f]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",w,E.bind(this),void 0,!0);else{const A=s.aJ.call({deduped:this._deduped},w,(P,M)=>{P||!M?E.call(this,P):(w.data={cacheControl:M.cacheControl,expires:M.expires,rawData:M.rawData.slice(0)},t.actor&&t.actor.send("loadTile",w,E.bind(this),void 0,!0))},!0);t.request={cancel:A}}function E(A,P){return delete t.request,t.aborted?n(null):A&&A.status!==404?n(A):(P&&P.resourceTiming&&(t.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&t.setExpiryData(P),t.loadVectorData(P,this.map.painter),s.aK(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Is extends s.E{constructor(t,n,u,f){super(),this.id=t,this.dispatcher=u,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.l({type:"raster"},n),s.l(this,s.aF(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Gn(this._options,this.map._requestManager,null,null,(n,u)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new s.z(n)):u&&(s.l(this,u),u.raster_layers&&(this.rasterLayers=u.raster_layers,this.rasterLayerIds=this.rasterLayers.map(f=>f.id)),this.tileBounds=Yn.fromTileJSON(u),sr(u.tiles),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return s.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const u=s.q.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=s.o(this.map._requestManager.transformRequest(f,s.R.Tile),(m,_,v,w)=>(delete t.request,t.aborted?(t.state="unloaded",n(null)):m?(t.state="errored",n(m)):_?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:v,expires:w}),t.setTexture(_,this.map.painter),t.state="loaded",s.aK(this.dispatcher),void n(null)):n(null)))}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class na extends Is{constructor(t,n,u,f){super(t,n,u,f),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=s.l({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);n&&n.enabled&&u&&n._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(u,s.R.Tile),m={request:f,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=f,t.actor||(t.actor=this.dispatcher.getActor());const _=(v,w,E,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(v)return v.name==="AbortError"?void 0:(t.state="errored",n(v));if(this.map._refreshExpiredTiles&&w&&t.setExpiryData({cacheControl:E,expires:A}),this.partial)t.state="empty";else{if(!w)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=w}n(null)};t.request=this.partial?t.fetchHeader(void 0,_.bind(this)):t.actor.send("loadTile",m,_.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){const u=t.texture;u&&u instanceof s.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,n,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(n,u,(f,m)=>{if(f)return t.state="errored",this.fire(new s.z(f)),void this.triggerRepaint(t);m&&(t._isHeaderLoaded=!0,t.setTexture(m,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:m})=>m===t),u=n&&n.fields,f=u&&u.bands&&u.bands;return f?f[0]:0}getTextureDescriptor(t,n,u){if(!t)return;const f=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let m=null;n instanceof s.aN?m=n.paint.get("raster-array-band"):n instanceof s.aO&&(m=n.paint.get("raster-particle-array-band"));const _=m||this.getInitialBand(f);if(_!=null)if(t.textureDescriptor){if(!t.updateNeeded(f,_)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,f,_)}getImages(t,n){const u=new Map;for(const f of t)for(const m of n){const[_,v]=m.split("/"),w=f.getLayer(_);if(!w||!w.hasBand(v)||!w.hasDataForBand(v))continue;const{bytes:E,tileSize:A,buffer:P}=w.getBandView(v),M=A+2*P,k={data:new s.r({width:M,height:M},E),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(m,k)}return u}}const $a={vector:mn,raster:Is,"raster-dem":class extends Is{constructor(l,t,n,u){super(l,t,n,u),this.type="raster-dem",this.maxzoom=22,this._options=s.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(f,m){f&&(l.state="errored",t(f)),m&&(l.dem=m,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=s.o(this.map._requestManager.transformRequest(n,s.R.Tile),(function(f,m,_,v){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(f)l.state="errored",t(f);else if(m){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:_,expires:v});const w=ImageBitmap&&m instanceof ImageBitmap&&s.t(),E=1-(m.width-s.aL(m.width))/2;E<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const A=w?m:s.q.getImageData(m,E),P={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:A,encoding:this.encoding,padding:E};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",P,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,n=Math.pow(2,t.z),u=(t.x-1+n)%n,f=t.x===0?l.wrap-1:l.wrap,m=(t.x+1+n)%n,_=t.x+1===n?l.wrap+1:l.wrap,v={};return v[new s.aM(l.overscaledZ,f,t.z,u,t.y).key]={backfilled:!1},v[new s.aM(l.overscaledZ,_,t.z,m,t.y).key]={backfilled:!1},t.y>0&&(v[new s.aM(l.overscaledZ,f,t.z,u,t.y-1).key]={backfilled:!1},v[new s.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},v[new s.aM(l.overscaledZ,_,t.z,m,t.y-1).key]={backfilled:!1}),t.y+1<n&&(v[new s.aM(l.overscaledZ,f,t.z,u,t.y+1).key]={backfilled:!1},v[new s.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},v[new s.aM(l.overscaledZ,_,t.z,m,t.y+1).key]={backfilled:!1}),v}},"raster-array":na,geojson:class extends s.E{constructor(l,t,n,u){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(u),this._data=t.data,this._options=s.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const f=s.aj/this.tileSize;this.workerOptions=s.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*f,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*f,extent:s.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*f,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new s.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new s.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of l.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,n,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:n},u),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=s.l({append:l},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(s.q.resolveURL(n),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,f)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new s.z(u));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&f&&f.resourceTiming&&f.resourceTiming[this.id]&&(m.resourceTiming=f.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new s.A("data",m)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const l=s.C(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const n=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,f=u?{image:u.image.clone()}:null,m=this._partialReload,_={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:f,scope:this.scope,pixelRatio:s.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:m};l.request=this.actor.send(n,_,(v,w)=>m&&!w?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):v?t(v):(l.loadVectorData(w,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aP{constructor(l,t,n,u){super(l,t,n,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aQ(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new s.z(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new s.z(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aP,model:class extends s.E{constructor(l,t,n,u){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const l=[];for(const t in this._options.models){const n=this._options.models[t],u=s.aS(this.map._requestManager.transformRequest(n.uri,s.R.Model).url).then(f=>{if(!f)return;const m=s.aT(f),_=new s.aU(t,n.position,n.orientation,m);_.computeBoundsAndApplyParent(),this.models.push(_)}).catch(f=>{this.fire(new s.z(new Error(`Could not load model ${t} from ${n.uri}: ${f.message}`)))});l.push(u)}Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new s.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,t){}serialize(){return this._options}},"batched-model":class extends s.E{constructor(l,t,n,u){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=s.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Gn(this._options,this.map._requestManager,t,n,(u,f)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new s.z(u))):f&&(s.l(this,f),f.bounds&&(this.tileBounds=new Yn(f.bounds,this.minzoom,this.maxzoom)),sr(f.tiles,this.map._requestManager._customAccessToken),this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))),l&&l(u)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(n,s.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.q.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const m=Object.values(l.buckets);for(const _ of m)_.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",u,f.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",u,f.bind(this),void 0,!0);function f(m,_){return l.aborted?t(null):m&&m.status!==404?t(m):(this.map._refreshExpiredTiles&&_&&l.setExpiryData(_),l.loadModelData(_,this.map.painter),l.state="loaded",void t(null))}}serialize(){return s.l({},this._options)}},canvas:class extends s.aP{constructor(l,t,n,u){super(l,t,n,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(m=>typeof m!="number"))||this.fire(new s.z(new s.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.z(new s.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.z(new s.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.z(new s.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.z(new s.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof s.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends s.E{constructor(l,t,n,u){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Yn(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),s.l(this,s.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new s.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:n,z:u}=l.canonical;return this._implementation.hasTile({x:t,y:n,z:u})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:n,y:u,z:f}=l.tileID.canonical,m=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:n,y:u,z:f},{signal:m.signal})).then((function(_){return delete l.request,l.aborted?(l.state="unloaded",t(null)):_===void 0?(l.state="errored",t(null)):_===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(v){return v instanceof ImageData||v instanceof HTMLCanvasElement||v instanceof ImageBitmap||v instanceof HTMLImageElement}(_)?(this.loadTileData(l,_),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(_=>{_.name!=="AbortError"&&(l.state="errored",t(_))}),l.request.cancel=()=>m.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof s.T?(l.destroy(!0),l.texture&&l.texture instanceof s.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:n,y:u,z:f}=l.tileID.canonical;this._implementation.unloadTile({x:n,y:u,z:f})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=s.C(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new s.A("data",{dataType:"source",sourceDataType:"content"}))}}},As=function(l,t,n,u){const f=new $a[t.type](l,t,n,u);if(f.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${f.id}`);return s.aV(["load","abort","unload","serialize","prepare"],f),f};function Sa(l,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:f,importId:m}=u;return`featureset:${f}${m?`:import:${m}`:""}`}}(l.target)}`}function Zs(l,t,n,u=""){if(l.uniqueFeatureID){const f=Sa(l,t,u);if(n.has(f))return!0;n.add(f)}return!1}function Cs(l,t,n,u,f=!1){const m=t.sourceCache.transform,_=t.sourceCache.tilesIn(l,t.has3DLayers,f);_.sort(we);const v=[];for(const w of _){const E=w.tile.queryRenderedFeatures(t,w,n,u,m,f);Object.keys(E).length&&v.push({wrappedTileID:w.tile.tileID.wrapped().key,queryResults:E})}return v.length===0?{}:function(w){const E={},A={};for(const P of w){const M=P.queryResults,k=P.wrappedTileID,q=A[k]=A[k]||{};for(const V in M){const $=M[V],U=q[V]=q[V]||{},ee=E[V]=E[V]||[];for(const se of $)U[se.featureIndex]||(U[se.featureIndex]=!0,ee.push(se))}}return E}(v)}function j(l,t,n,u,f){const m={},_=u.queryRenderedSymbols(l),v=[];for(const w of Object.keys(_).map(Number))v.push(f[w]);v.sort(we);for(const w of v){const E=w.featureIndex.lookupSymbolFeatures(_[w.bucketInstanceId],w.bucketIndex,w.sourceLayerIndex,t,n);for(const A in E){const P=m[A]=m[A]||[],M=E[A];M.sort((k,q)=>{const V=w.featureSortOrder;if(V){const $=V.indexOf(k.featureIndex);return V.indexOf(q.featureIndex)-$}return q.featureIndex-k.featureIndex});for(const k of M)P.push(k)}}return m}function te(l,t){const n=l.getRenderableIds().map(m=>l.getTileByID(m)),u=[],f={};for(let m=0;m<n.length;m++){const _=n[m],v=_.tileID.canonical.key;f[v]||(f[v]=!0,_.querySourceFeatures(u,t))}return u}function we(l,t){const n=l.tileID,u=t.tileID;return n.overscaledZ-u.overscaledZ||n.canonical.y-u.canonical.y||n.wrap-u.wrap||n.canonical.x-u.canonical.x}function Be(l,t){const n={};if(!t)return n;for(const u of l){const f=u.layerIds.map(m=>t.getLayer(m)).filter(Boolean);if(f.length!==0){u.layers=f,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(m=>f.filter(_=>_.id===m)[0]));for(const m of f)n[m.fqid]=u}}return n}const Ct=32,wt=33,Yt=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,n=0,u=0,f=0,m=0,_=0,v=0;for(1&t?f=m=_=Ct:n=u=v=Ct;(t>>=1)>1;){const E=n+f>>1,A=u+m>>1;1&t?(f=n,m=u,n=_,u=v):(n=f,u=m,f=_,m=v),_=E,v=A}const w=4*l;Yt[w+0]=n,Yt[w+1]=u,Yt[w+2]=f,Yt[w+3]=m}const Cr=new Uint16Array(2178),kr=new Uint8Array(1089),mi=new Uint16Array(1089);function Vi(l){return l===0?-.03125:l===32?.03125:0}const jn={type:2,extent:s.aj,loadGeometry:()=>[[new s.P(0,0),new s.P(s.aj+1,0),new s.P(s.aj+1,s.aj+1),new s.P(0,s.aj+1),new s.P(0,0)]]};class bo{constructor(t,n,u,f,m){this.tileID=t,this.uid=s.a$(),this.uses=0,this.tileSize=n,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(t){const n=t+this.timeAdded;n<s.q.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Be(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const m=this.buckets[f];if(m instanceof s.b1){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const m=this.buckets[f];if(m instanceof s.b1&&m.hasRTLText){this.hasRTLText=!0,s.b2();break}}this.queryPadding=0;for(const f in this.buckets){const m=this.buckets[f],_=n.style.getOwnLayer(f);if(!_)continue;const v=_.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,v)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Be(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(t)}const n=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new s.T(t,u.image,n.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const f=n.style.getBrightness();(this._lastUpdatedBrightness||f)&&(this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==f),this._lastUpdatedBrightness=f))}queryRenderedFeatures(t,n,u,f,m,_){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const v=function(w,E){const A=s.bn([],[.5*w.width,.5*-w.height,1]);return s.bo(A,A,[1,-1,0]),s.az(A,A,w.calculateProjMatrix(E.toUnwrapped())),Float32Array.from(A)}(m,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:v,transform:f,availableImages:u,tileTransform:this.tileTransform})}querySourceFeatures(t,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const f=u.loadVTLayers(),m=n?n.sourceLayer:"",_=f._geojsonTileLayer||f[m];if(!_)return;const v=s.b3(n&&n.filter),{z:w,x:E,y:A}=this.tileID.canonical,P={z:w,x:E,y:A};for(let M=0;M<_.length;M++){const k=_.feature(M);if(v.needGeometry){const $=s.b4(k,!0);if(!v.filter(new s.aa(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!v.filter(new s.aa(this.tileID.overscaledZ),k))continue;const q=u.getId(k,m),V=new s.b5(k,w,E,A,q);V.tile=P,t.push(V)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const u=s.b6(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let f=!1;if(this.expirationTime>u)f=!1;else if(n)if(this.expirationTime<n)f=!0;else{const m=this.expirationTime-n;m?this.expirationTime=u+Math.max(m,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),f=t.style.listImages(),m=t.style.getBrightness();for(const _ in this.buckets){if(!t.style.hasLayer(_))continue;const v=this.buckets[_],w=v.layers[0],E=w.sourceLayer||"_geojsonTileLayer",A=u[E],P=t.style.getLayerSourceCache(w);let M={};P&&(M=P._state.getState(E,void 0));const k=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},q=Object.keys(M).length>0&&!n;q&&!v.stateDependentLayers.length&&!n||v.update(M,A,f,k,q?v.stateDependentLayers:v.layers,n,m),(v instanceof s.b7||v instanceof s.b8)&&t._terrain&&t._terrain.enabled&&P&&v.uploadPending()&&t._terrain._clearRenderCacheForTile(P.id,this.tileID);const V=t&&t.style&&t.style.getOwnLayer(_);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.q.now()+t}setTexture(t,n){const u=n.context,f=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(u,t,f.RGBA8,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(t,n){const u={};for(const f of n)u[f]=!0;this.dependencies[t]=u}hasDependency(t,n){for(const u of t){const f=this.dependencies[u];if(f){for(const m of n)if(f[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const u=s.b9(jn,this.tileID.canonical,this.tileTransform)[0],f=new s.ba,m=new s.bb;for(let _=0;_<u.length;_++){const{x:v,y:w}=u[_];f.emplaceBack(v,w),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(m),this._tileDebugBuffer=t.createVertexBuffer(f,s.bc.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,f.length,m.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const u=s.b9(jn,this.tileID.canonical,this.tileTransform)[0];let f,m;if(this.isRaster){const _=function(v,w){const E=s.aW(v,w),A=Math.pow(2,v.z);for(let $=0;$<wt;$++)for(let U=0;U<wt;U++){const ee=s.aX((v.x+(U+Vi(U))/Ct)/A),se=s.aY((v.y+($+Vi($))/Ct)/A),ae=w.project(ee,se),xe=$*wt+U;Cr[2*xe+0]=Math.round((ae.x*E.scale-E.x)*s.aj),Cr[2*xe+1]=Math.round((ae.y*E.scale-E.y)*s.aj)}kr.fill(0),mi.fill(0);for(let $=2045;$>=0;$--){const U=4*$,ee=Yt[U+0],se=Yt[U+1],ae=Yt[U+2],xe=Yt[U+3],ye=ee+ae>>1,me=se+xe>>1,he=ye+me-se,Te=me+ee-ye,Ae=se*wt+ee,rt=xe*wt+ae,Ge=me*wt+ye,ft=Math.hypot((Cr[2*Ae+0]+Cr[2*rt+0])/2-Cr[2*Ge+0],(Cr[2*Ae+1]+Cr[2*rt+1])/2-Cr[2*Ge+1])>=16;kr[Ge]=kr[Ge]||(ft?1:0),$<1022&&(kr[Ge]=kr[Ge]||kr[(se+Te>>1)*wt+(ee+he>>1)]||kr[(xe+Te>>1)*wt+(ae+he>>1)])}const P=new s.aZ,M=new s.a_;let k=0;function q($,U){const ee=U*wt+$;return mi[ee]===0&&(P.emplaceBack(Cr[2*ee+0],Cr[2*ee+1],$*s.aj/Ct,U*s.aj/Ct),mi[ee]=++k),mi[ee]-1}function V($,U,ee,se,ae,xe){const ye=$+ee>>1,me=U+se>>1;if(Math.abs($-ae)+Math.abs(U-xe)>1&&kr[me*wt+ye])V(ae,xe,$,U,ye,me),V(ee,se,ae,xe,ye,me);else{const he=q($,U),Te=q(ee,se),Ae=q(ae,xe);M.emplaceBack(he,Te,Ae)}}return V(0,0,Ct,Ct,Ct,0),V(Ct,Ct,0,0,0,Ct),{vertices:P,indices:M}}(this.tileID.canonical,n);f=_.vertices,m=_.indices}else{f=new s.aZ,m=new s.a_;for(const{x:v,y:w}of u)f.emplaceBack(v,w,0,0);const _=s.be(f.int16.subarray(0,4*f.length),void 0,4);for(let v=0;v<_.length;v+=3)m.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=t.createVertexBuffer(f,s.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(m),this._tileBoundsSegments=s.bd.simpleSegment(0,0,f.length,m.length)}_makeGlobeTileDebugBuffers(t,n){const u=n.projection;if(!u||u.name!=="globe"||n.freezeTileCoverage)return;const f=this.tileID.canonical,m=s.bg(f,n),_=s.bh(m),v=s.ah(n.zoom);let w;v>0&&(w=s.bi(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,f,n,_,w,v),this._makeGlobeTileDebugTextBuffer(t,f,n,_,w,v)}_globePoint(t,n,u,f,m,_,v){let w=s.bj(t,n,u);if(_){const E=1<<u.z,A=s.ay(f.center.lng),P=s.aH(f.center.lat),M=(u.x+.5)/E-A;let k=0;M>.5?k=-1:M<-.5&&(k=1);let q=(t/s.aj+u.x)/E+k,V=(n/s.aj+u.y)/E;q=(q-A)*f._pixelsPerMercatorPixel+A,V=(V-P)*f._pixelsPerMercatorPixel+P;const $=[q*f.worldSize,V*f.worldSize,0];s.ad($,$,_),w=s.bk(w,$,v)}return s.ad(w,w,m)}_makeGlobeTileDebugBorderBuffer(t,n,u,f,m,_){const v=new s.ba,w=new s.bb,E=new s.bl,A=(M,k,q,V,$)=>{const U=(q-M)/($-1),ee=(V-k)/($-1),se=v.length;for(let ae=0;ae<$;ae++){const xe=M+ae*U,ye=k+ae*ee;v.emplaceBack(xe,ye);const me=this._globePoint(xe,ye,n,u,f,m,_);E.emplaceBack(me[0],me[1],me[2]),w.emplaceBack(se+ae)}},P=s.aj;A(0,0,P,0,16),A(P,0,P,P,16),A(P,P,0,P,16),A(0,P,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(v,s.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(E,s.bm.members),this._tileDebugSegments=s.bd.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugTextBuffer(t,n,u,f,m,_){const v=s.aj/4,w=new s.ba,E=new s.a_,A=new s.bl,P=25;E.reserve(32),w.reserve(P),A.reserve(P);const M=(k,q)=>P*k+q;for(let k=0;k<P;k++){const q=k*v;for(let V=0;V<P;V++){const $=V*v;w.emplaceBack($,q);const U=this._globePoint($,q,n,u,f,m,_);A.emplaceBack(U[0],U[1],U[2])}}for(let k=0;k<4;k++)for(let q=0;q<4;q++){const V=M(k,q),$=M(k,q+1),U=M(k+1,q),ee=M(k+1,q+1);E.emplaceBack(V,$,U),E.emplaceBack(U,$,ee)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(E),this._tileDebugTextBuffer=t.createVertexBuffer(w,s.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(A,s.bm.members),this._tileDebugTextSegments=s.bd.simpleSegment(0,0,P,32)}destroy(t=!1){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.bp.setPbf(s.bq);class ss extends bo{constructor(t,n,u,f,m){super(t,n,u,f,m),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,n){const u=n.context,f=u.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t,{premultiply:!1}):this.texture=new s.T(u,t,f.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,n){const u=this._mrt=new s.bp(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.br(f,(m,_,v,w)=>{if(m)n(m);else try{const E=u.getHeaderLength(_);if(E>t)return void(this.request=this.fetchHeader(E,n));u.parseHeader(_),this._isHeaderLoaded=!0;let A=0;for(const P of Object.values(u.layers))A=Math.max(A,P.dataIndex[P.dataIndex.length-1].lastByte);_.byteLength>=A&&(this.entireBuffer=_),n(null,this.entireBuffer||_,v,w)}catch(E){n(E)}}),this.request}fetchBand(t,n,u){const f=this._mrt;if(!this._isHeaderLoaded||!f)return void u(new Error("Tile header is not ready"));const m=this.actor;if(!m)return void u(new Error("Can't fetch tile band without an actor"));let _;const v=(P,M)=>{_.complete(P,M),P?u(P):(this.updateTextureDescriptor(t,n),u(null,this.textureDescriptor&&this.textureDescriptor.img))},w=(P,M)=>{if(P)return u(P);const k=m.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:M,task:_},v,void 0,!0);this._workQueue.push(()=>{k&&k.cancel(),_.cancel()})},E=f.getLayer(t);if(!E)return void u(new Error(`Unknown sourceLayer "${t}"`));if(E.hasDataForBand(n))return this.updateTextureDescriptor(t,n),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const A=E.getDataRange([n]);if(_=f.createDecodingTask(A),!_||_.tasks.length)if(this.flushQueues(),this.entireBuffer)w(null,this.entireBuffer.slice(A.firstByte,A.lastByte+1));else{const P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${A.firstByte}-${A.lastByte}`}}),M=s.br(P,w);this._fetchQueue.push(()=>{M.cancel(),_.cancel()})}else u(null)}updateNeeded(t,n){return(!this.textureDescriptor||this.textureDescriptor.band!==n||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,n){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(n)||!u.hasDataForBand(n))return;const{bytes:f,tileSize:m,buffer:_,offset:v,scale:w}=u.getBandView(n),E=m+2*_,A=new s.r({width:E,height:E},f),P=this.texture;P&&P instanceof s.T&&P.update(A,{premultiply:!1}),this.textureDescriptor={layer:t,band:n,img:A,buffer:_,offset:v,tileSize:m,format:u.pixelFormat,mix:[w,256*w,65536*w,16777216*w]}}}class as{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,u){const f=t.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);const m={value:n,timeout:void 0};if(u!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},u)),this.data[f].push(m),this.order.push(f),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const u=t.wrapped().key,f=n===void 0?0:this.data[u].indexOf(n),m=this.data[u][f];return this.data[u].splice(f,1),m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const u in this.data)for(const f of this.data[u])t(f.value)||n.push(f);for(const u of n)this.remove(u.value.tileID,u)}}class Fs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,u){const f=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][f]=this.stateChanges[t][f]||{},s.l(this.stateChanges[t][f],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==f&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][f]===null){this.deletedStates[t][f]={};for(const m in this.state[t][f])u[m]||(this.deletedStates[t][f][m]=null)}else for(const m in u)this.deletedStates[t]&&this.deletedStates[t][f]&&this.deletedStates[t][f][m]===null&&delete this.deletedStates[t][f][m]}removeFeatureState(t,n,u){if(this.deletedStates[t]===null)return;const f=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&n!==void 0)this.deletedStates[t][f]!==null&&(this.deletedStates[t][f]=this.deletedStates[t][f]||{},this.deletedStates[t][f][u]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][f])for(u in this.deletedStates[t][f]={},this.stateChanges[t][f])this.deletedStates[t][f][u]=null;else this.deletedStates[t][f]=null;else this.deletedStates[t]=null}getState(t,n){const u=this.state[t]||{},f=this.stateChanges[t]||{},m=this.deletedStates[t];if(m===null)return{};if(n!==void 0){const v=String(n),w=s.l({},u[v],f[v]);if(m){const E=m[n];if(E===null)return{};for(const A in E)delete w[A]}return w}const _=s.l({},u,f);if(m)for(const v in m)delete _[v];return _}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const u={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const m={};for(const _ in this.stateChanges[f])this.state[f][_]||(this.state[f][_]={}),s.l(this.state[f][_],this.stateChanges[f][_]),m[_]=this.state[f][_];u[f]=m}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const m={};if(this.deletedStates[f]===null)for(const _ in this.state[f])m[_]={},this.state[f][_]={};else for(const _ in this.deletedStates[f]){if(this.deletedStates[f][_]===null)this.state[f][_]={};else if(this.state[f][_])for(const v of Object.keys(this.deletedStates[f][_]))delete this.state[f][_][v];m[_]=this.state[f][_]}u[f]=u[f]||{},s.l(u[f],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const f in t)t[f].refreshFeatureState(n)}}class Hn extends s.E{constructor(t,n,u){super(),this.id=t,this._onlySymbols=u,n.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new as(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Fs,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const u=this._tiles[n];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(_s).map(t=>t.key)}getRenderableIds(t,n){const u=[];for(const f in this._tiles)this._isIdRenderable(+f,t,n)&&u.push(this._tiles[f]);return t?u.sort((f,m)=>{const _=f.tileID,v=m.tileID,w=new s.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),E=new s.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-v.overscaledZ||E.y-w.y||E.x-w.x}).map(f=>f.tileID.key):u.map(f=>f.tileID).sort(_s).map(f=>f.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,t,n)))}_tileLoaded(t,n,u,f){if(f)if(t.state="errored",f.status!==404)this._source.fire(new s.z(f,{tile:t}));else{if(this._source.fire(new s.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=s.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new s.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const n=this.getRenderableIds();for(let f=0;f<n.length;f++){const m=n[f];if(t.neighboringTiles&&t.neighboringTiles[m]){const _=this.getTileByID(m);u(t,_),u(_,t)}}function u(f,m){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-f.tileID.canonical.x;const v=m.tileID.canonical.y-f.tileID.canonical.y,w=Math.pow(2,f.tileID.canonical.z),E=m.tileID.key;_===0&&v===0||Math.abs(v)>1||(Math.abs(_)>1&&(Math.abs(_+w)===1?_+=w:Math.abs(_-w)===1&&(_-=w)),m.dem&&f.dem&&(f.dem.backfillBorder(m.dem,_,v),f.neighboringTiles&&f.neighboringTiles[E]&&(f.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,u,f){for(const m in this._tiles){let _=this._tiles[m];if(f[m]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>u)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const E=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[E.key],_&&_.hasData()&&(v=E)}let w=v;for(;w.overscaledZ>n;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){f[v.key]=v;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=t.overscaledZ-1;u>=n;u--){const f=t.scaledTo(u),m=this._getLoadedTile(f);if(m)return m}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const u=Math.ceil(t.width/n)+1,f=Math.ceil(t.height/n)+1,m=Math.floor(u*f*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const u={};for(const f in this._tiles){const m=this._tiles[f];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),u[m.tileID.key]=m}this._tiles=u;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(t,n,u,f,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let v,w=this._source.maxzoom;const E=this.map&&this.map.painter?this.map.painter._terrain:null;if(E&&E.sourceCache===this&&E.attenuationRange()){const M=E.attenuationRange()[0],k=Math.floor(M)-Math.log2(E.getDemUpscale());w>k&&(w=k)}if(this.used||this.usedForTerrain){if(this._source.tileID)v=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new s.aM(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y));else if(this.tileCoverLift!==0){const M=t.clone();M.tileCoverLift=this.tileCoverLift,v=M.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:w,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(v.push(new s.aM(1,0,1,0,0)),v.push(new s.aM(1,0,1,1,0)),v.push(new s.aM(1,0,1,0,1)),v.push(new s.aM(1,0,1,1,1)))}else if(v=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:w,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const M=this._source.hasTile.bind(this._source);v=v.filter(k=>M(k))}}else v=[];if(v.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Wo(this._source.type)){const M=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),k=Math.min(M,this._source.maxzoom);if(_){const q=t.extendTileCover(v,k);for(const V of q)v.push(V)}else if(m){const q=t.extendTileCover(v,k,this.transform._camera.forward());for(const V of q)v.push(V)}else if(this.castsShadows&&f){const q=t.extendTileCover(v,k,f);for(const V of q)this._shadowCasterTiles[V.key]=!0,v.push(V)}}const A=this._updateRetainedTiles(v);if(Wo(this._source.type)&&v.length!==0){const M={},k={},q=Object.keys(A);for(const $ of q){const U=A[$],ee=this._tiles[$];if(!ee||ee.fadeEndTime&&ee.fadeEndTime<=s.q.now())continue;const se=this.findLoadedParent(U,Math.max(U.overscaledZ-Hn.maxOverzooming,this._source.minzoom));se&&(this._addTile(se.tileID),M[se.tileID.key]=se.tileID),k[$]=U}const V=v[v.length-1].overscaledZ;for(const $ in this._tiles){const U=this._tiles[$];if(A[$]||!U.hasData())continue;let ee=U.tileID;for(;ee.overscaledZ>V;){ee=ee.scaledTo(ee.overscaledZ-1);const se=this._tiles[ee.key];if(se&&se.hasData()&&k[ee.key]){A[$]=U.tileID;break}}}for(const $ in M)A[$]||(this._coveredTiles[$]=!0,A[$]=M[$])}for(const M in A)this._tiles[M].clearFadeHold();const P=s.bs(this._tiles,A);for(const M of P){const k=this._tiles[M];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const u={},f=t.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),m=t[0].overscaledZ,_=Math.max(m-Hn.maxOverzooming,this._source.minzoom),v=Math.max(m+Hn.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const A=this._addTile(E);n[E.key]=E,A.hasData()||f<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,f,v,n);for(const E of t){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const M=E.children(this._source.maxzoom)[0],k=this.getTile(M);if(k&&k.hasData()){n[M.key]=M;continue}}else{const M=E.children(this._source.maxzoom);if(n[M[0].key]&&n[M[1].key]&&n[M[2].key]&&n[M[3].key])continue}let P=A.wasRequested();for(let M=E.overscaledZ-1;M>=_;--M){const k=E.scaledTo(M);if(u[k.key]||(u[k.key]=!0,A=this.getTile(k),!A&&P&&(A=this._addTile(k)),A&&(n[k.key]=k,P=A.wasRequested(),A.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let u,f=this._tiles[t].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){u=this._loadedParentTiles[f.key];break}n.push(f.key);const m=f.scaledTo(f.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;f=m}for(const m of n)this._loadedParentTiles[m]=u}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const u=!!n;if(!u){const f=this.map?this.map.painter:null,m=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new ss(t,m,this.transform.tileZoom,f,this._isRaster):new bo(t,m,this.transform.tileZoom,f,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n.uses++,this._tiles[t.key]=n,u||this._source.fire(new s.A("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=n.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,u){const f=[],m=this.transform;if(!m)return f;const _=m.projection.name==="globe",v=s.ay(m.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(_){const P=E.tileID.canonical;if(P.z===0){const M=[Math.abs(s.aD(v,...ls(P,-1))-v),Math.abs(s.aD(v,...ls(P,1))-v)];A=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(s.aD(v,...ls(P,-1))-v),Math.abs(s.aD(v,...ls(P,0))-v),Math.abs(s.aD(v,...ls(P,1))-v)];A=[M.indexOf(Math.min(...M))-1]}}else A=[0];for(const P of A){const M=t.containsTile(E,m,n,P);M&&f.push(M)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const u=this.getRenderableIds(t,n).map(m=>this._tiles[m].tileID),f=this.transform.projection.name==="globe";for(const m of u)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=f?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return u}sortCoordinatesByDistance(t){const n=t.slice(),u=this.transform._camera.position,f=this.transform._camera.forward(),m={};for(const _ of n){const v=1/(1<<_.canonical.z);m[_.key]=((_.canonical.x+.5)*v+_.wrap-u[0])*f[0]+((_.canonical.y+.5)*v-u[1])*f[1]-u[2]*f[2]}return n.sort((_,v)=>m[_.key]-m[v.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(Wo(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=s.q.now())return!0}return!1}setFeatureState(t,n,u){this._state.updateState(t=t||"_geojsonTileLayer",n,u)}removeFeatureState(t,n,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,u)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,u){const f=this._tiles[t];f&&f.setDependencies(n,u)}reloadTilesForDependencies(t,n){for(const u in this._tiles)this._tiles[u].hasDependency(t,n)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const w=()=>{this._sourceLoaded&&(this._source.off("data",w),this._preloadTiles(t,n))};return void this._source.on("data",w)}const u=new Map,f=Array.isArray(t)?t:[t],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const w of f){const E=w.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const A of E)u.set(A.key,A);this.usedForTerrain&&w.updateElevation(!1)}const v=Array.from(u.values());s.bt(v,(w,E)=>{const A=new bo(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,P=>{this._source.type==="raster-dem"&&A.dem&&this._backfillDEM(A),E(P,A)})},n)}}function _s(l,t){const n=Math.abs(2*l.wrap)-+(l.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||u-n||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function Wo(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function ls(l,t){const n=1<<l.z;return[l.x/n+t,(l.x+1)/n+t]}Hn.maxOverzooming=10,Hn.maxUnderzooming=3;class Bs{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const u in this.style._mergedLayers){const f=this.style._mergedLayers[u];if(f.type==="fill-extrusion")this.layers.push({layer:f,visible:t,visibilityChanged:n});else if(f.type==="model"){const m=this.style.getLayerSource(f);m&&m.type==="batched-model"&&this.layers.push({layer:f,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const u=n.layer;let f=!1;u.type==="fill-extrusion"?f=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="model"&&(f=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!f&&n.visible,n.visible=f}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const f of this.layers){const m=f.layer,_=this.style.getLayerSourceCache(m);let v=1;m.type==="fill-extrusion"&&(v=f.visible?m.paint.get("fill-extrusion-vertical-scale"):0);let w=_?_.getTile(n):null;if(!w&&_&&n.canonical.z>_.getSource().minzoom){let E=n.scaledTo(Math.min(_.getSource().maxzoom,n.overscaledZ-1));for(;E.overscaledZ>=_.getSource().minzoom&&(w=_.getTile(E),!w&&E.overscaledZ!==0);)E=E.scaledTo(E.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:w?w.getBucket(m):null,tileID:w?w.tileID:n,verticalScale:v})}t.hasAnyZOffset=!1;let u=!1;for(let f=0;f<t.symbolInstances.length;f++){const m=t.symbolInstances.get(f),_=m.zOffset,v=this._getHeightAtTileOffset(n,m.tileAnchorX,m.tileAnchorY);m.zOffset=v!==Number.NEGATIVE_INFINITY?v:_,u||_===m.zOffset||(u=!0),t.hasAnyZOffset||m.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,u,f){let m=n,_=u;if(t.canonical.z!==f.canonical.z){const v=f.canonical,w=1/(1<<t.canonical.z-v.z);m=(n+t.canonical.x*s.aj)*w-v.x*s.aj|0,_=(u+t.canonical.y*s.aj)*w-v.y*s.aj|0}return{tileX:m,tileY:_}}_getHeightAtTileOffset(t,n,u){let f,m;for(let _=0;_<this.layers.length;++_){if(this.layers[_].layer.type!=="fill-extrusion")continue;const{bucket:v,tileID:w,verticalScale:E}=this.currentBuildingBuckets[_];if(!v)continue;const{tileX:A,tileY:P}=this._mapCoordToOverlappingTile(t,n,u,w),M=v.getHeightAtTileCoord(A,P);M&&M.height!==void 0&&(M.hidden?f=M.height:m=Math.max(M.height*E,m||0))}if(m!==void 0)return m;for(let _=0;_<this.layers.length;++_){const v=this.layers[_];if(v.layer.type!=="model"||!v.visible)continue;const{bucket:w,tileID:E}=this.currentBuildingBuckets[_];if(!w)continue;const{tileX:A,tileY:P}=this._mapCoordToOverlappingTile(t,n,u,E),M=w.getHeightAtTileCoord(A,P);if(M&&!M.hidden)return M.height===void 0&&f!==void 0?Math.min(M.maxHeight,f)*M.verticalScale:M.height?M.height*M.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function oa(l,t){const n={};for(const u in l)u!=="ref"&&(n[u]=l[u]);return s.bu.forEach(u=>{u in t&&(n[u]=t[u])}),n}function sa(l){l=l.slice();const t=Object.create(null);for(let n=0;n<l.length;n++)t[l[n].id]=l[n];for(let n=0;n<l.length;n++)"ref"in l[n]&&(l[n]=oa(l[n],t[l[n].ref]));return l}const ki={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Bl(l,t,n){n.push({command:ki.addSource,args:[l,t[l]]})}function Ta(l,t,n){t.push({command:ki.removeSource,args:[l]}),n[l]=!0}function Vd(l,t,n,u){Ta(l,n,u),Bl(l,t,n)}function aa(l,t,n){let u;for(u in l[n])if(l[n].hasOwnProperty(u)&&u!=="data"&&!s.bv(l[n][u],t[n][u]))return!1;for(u in t[n])if(t[n].hasOwnProperty(u)&&u!=="data"&&!s.bv(l[n][u],t[n][u]))return!1;return!0}function Xs(l,t,n,u,f,m){let _;for(_ in t=t||{},l=l||{})l.hasOwnProperty(_)&&(s.bv(l[_],t[_])||n.push({command:m,args:[u,_,t[_],f]}));for(_ in t)t.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&(s.bv(l[_],t[_])||n.push({command:m,args:[u,_,t[_],f]}))}function Ys(l){return l.id}function Mn(l,t){return l[t.id]=t,l}class Ea{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aD(t,0,1);let n=1,u=this._distances[n];const f=t*this.paddedLength+this.padding;for(;u<f&&n<this._distances.length;)u=this._distances[++n];const m=n-1,_=this._distances[m],v=u-_,w=v>0?(f-_)/v:0;return this.points[m].mult(1-w).add(this.points[n].mult(w))}}class Ia{constructor(t,n,u){const f=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(n/u);for(let _=0;_<this.xCellCount*this.yCellCount;_++)f.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,u,f,m){this._forEachCell(n,u,f,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m)}insertCircle(t,n,u,f){this._forEachCell(n-f,u-f,n+f,u+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(u),this.circles.push(f)}_insertBoxCell(t,n,u,f,m,_){this.boxCells[m].push(_)}_insertCircleCell(t,n,u,f,m,_){this.circleCells[m].push(_)}_query(t,n,u,f,m,_){if(u<0||t>this.width||f<0||n>this.height)return!m&&[];const v=[];if(t<=0&&n<=0&&this.width<=u&&this.height<=f){if(m)return!0;for(let w=0;w<this.boxKeys.length;w++)v.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const E=this.circles[3*w],A=this.circles[3*w+1],P=this.circles[3*w+2];v.push({key:this.circleKeys[w],x1:E-P,y1:A-P,x2:E+P,y2:A+P})}return _?v.filter(_):v}return this._forEachCell(t,n,u,f,this._queryCell,v,{hitTest:m,seenUids:{box:{},circle:{}}},_),m?v.length>0:v}_queryCircle(t,n,u,f,m){const _=t-u,v=t+u,w=n-u,E=n+u;if(v<0||_>this.width||E<0||w>this.height)return!f&&[];const A=[];return this._forEachCell(_,w,v,E,this._queryCellCircle,A,{hitTest:f,circle:{x:t,y:n,radius:u},seenUids:{box:{},circle:{}}},m),f?A.length>0:A}query(t,n,u,f,m){return this._query(t,n,u,f,!1,m)}hitTest(t,n,u,f,m){return this._query(t,n,u,f,!0,m)}hitTestCircle(t,n,u,f){return this._queryCircle(t,n,u,!0,f)}_queryCell(t,n,u,f,m,_,v,w){const E=v.seenUids,A=this.boxCells[m];if(A!==null){const M=this.bboxes;for(const k of A)if(!E.box[k]){E.box[k]=!0;const q=4*k;if(t<=M[q+2]&&n<=M[q+3]&&u>=M[q+0]&&f>=M[q+1]&&(!w||w(this.boxKeys[k]))){if(v.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[k],x1:M[q],y1:M[q+1],x2:M[q+2],y2:M[q+3]})}}}const P=this.circleCells[m];if(P!==null){const M=this.circles;for(const k of P)if(!E.circle[k]){E.circle[k]=!0;const q=3*k;if(this._circleAndRectCollide(M[q],M[q+1],M[q+2],t,n,u,f)&&(!w||w(this.circleKeys[k]))){if(v.hitTest)return _.push(!0),!0;{const V=M[q],$=M[q+1],U=M[q+2];_.push({key:this.circleKeys[k],x1:V-U,y1:$-U,x2:V+U,y2:$+U})}}}}}_queryCellCircle(t,n,u,f,m,_,v,w){const E=v.circle,A=v.seenUids,P=this.boxCells[m];if(P!==null){const k=this.bboxes;for(const q of P)if(!A.box[q]){A.box[q]=!0;const V=4*q;if(this._circleAndRectCollide(E.x,E.y,E.radius,k[V+0],k[V+1],k[V+2],k[V+3])&&(!w||w(this.boxKeys[q])))return _.push(!0),!0}}const M=this.circleCells[m];if(M!==null){const k=this.circles;for(const q of M)if(!A.circle[q]){A.circle[q]=!0;const V=3*q;if(this._circlesCollide(k[V],k[V+1],k[V+2],E.x,E.y,E.radius)&&(!w||w(this.circleKeys[q])))return _.push(!0),!0}}}_forEachCell(t,n,u,f,m,_,v,w){const E=this._convertToXCellCoord(t),A=this._convertToYCellCoord(n),P=this._convertToXCellCoord(u),M=this._convertToYCellCoord(f);for(let k=E;k<=P;k++)for(let q=A;q<=M;q++)if(m.call(this,t,n,u,f,this.xCellCount*q+k,_,v,w))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,u,f,m,_){const v=f-t,w=m-n,E=u+_;return E*E>v*v+w*w}_circleAndRectCollide(t,n,u,f,m,_,v){const w=(_-f)/2,E=Math.abs(t-(f+w));if(E>w+u)return!1;const A=(v-m)/2,P=Math.abs(n-(m+A));if(P>A+u)return!1;if(E<=w||P<=A)return!0;const M=E-w,k=P-A;return M*M+k*k<=u*u}}const us={unknown:0,flipRequired:1,flipNotRequired:2},ys=Math.tan(85*Math.PI/180);function Wa(l,t,n,u,f,m,_){const v=s.bz();if(n)if(m.name==="globe"){const w=s.bA(f,t);s.az(v,v,w)}else{const w=s.bB([],_);v[0]=w[0],v[1]=w[1],v[4]=w[2],v[5]=w[3],u||s.by(v,v,f.angle)}else s.az(v,f.labelPlaneMatrix,l);return v}function Aa(l,t,n,u,f,m,_){const v=Wa(l,t,n,u,f,m,_);return m.name==="globe"&&n||(v[2]=v[6]=v[10]=v[14]=0),v}function su(l,t,n,u,f,m,_){if(n){if(m.name==="globe"){const v=Wa(l,t,n,u,f,m,_);return s.bi(v,v),s.az(v,l,v),v}{const v=s.bw(l),w=s.bx([]);return w[0]=_[0],w[1]=_[1],w[4]=_[2],w[5]=_[3],s.az(v,v,w),u||s.by(v,v,-f.angle),v}}return f.glCoordMatrix}function Co(l,t,n,u){const f=[l,t,n,1];n?s.aA(f,f,u):Vl(f,f,u);const m=f[3];return f[0]/=m,f[1]/=m,f[2]/=m,f}function Ks(l,t){return Math.min(.5+l/t*.5,1.5)}function Ou(l,t){const n=l[0]/l[3],u=l[1]/l[3];return n>=-t[0]&&n<=t[0]&&u>=-t[1]&&u<=t[1]}function la(l,t,n,u,f,m,_,v,w,E){const A=n.transform,P=u?l.textSizeData:l.iconSizeData,M=s.bH(P,n.transform.zoom),k=A.projection.name==="globe",q=[256/n.width*2+1,256/n.height*2+1],V=u?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;V.clear();let $=null;k&&($=u?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const U=l.lineVertexArray,ee=u?l.text.placedSymbolArray:l.icon.placedSymbolArray,se=n.transform.width/n.transform.height;let ae,xe=!1;for(let ye=0;ye<ee.length;ye++){const me=ee.get(ye),{numGlyphs:he,writingMode:Te}=me;if(Te!==s.bI.vertical||xe||ae===s.bI.horizontal||(xe=!0),ae=Te,(me.hidden||Te===s.bI.vertical)&&!xe){ai(he,V);continue}xe=!1;const Ae=new s.P(me.tileAnchorX,me.tileAnchorY);let{x:rt,y:Ge,z:ft}=A.projection.projectTilePoint(Ae.x,Ae.y,E.canonical);if(w){const[ur,gr,Kt]=w(Ae);rt+=ur,Ge+=gr,ft+=Kt}const mt=[rt,Ge,ft,1];if(s.aA(mt,mt,t),!Ou(mt,q)){ai(he,V);continue}const Bt=mt[3],je=Ks(n.transform.getCameraToCenterDistance(A.projection),Bt),tt=s.bJ(P,M,me),Ve=_?tt/je:tt*je,vt=Co(rt,Ge,ft,f);if(vt[3]<=0){ai(he,V);continue}let it={};const Et=s.al(l.layers[0].layout.get("text-max-angle")),yt=Math.cos(Et),Mt=_?null:w,Dt=vs(me,Ve,!1,v,t,f,m,l.glyphOffsetArray,U,V,$,vt,Ae,it,se,Mt,A.projection,E,_,yt);xe=Dt.useVertical,Mt&&Dt.needsFlipping&&(it={}),(Dt.notEnoughRoom||xe||Dt.needsFlipping&&vs(me,Ve,!0,v,t,f,m,l.glyphOffsetArray,U,V,$,vt,Ae,it,se,Mt,A.projection,E,_,yt).notEnoughRoom)&&ai(he,V)}u?(l.text.dynamicLayoutVertexBuffer.updateData(V),$&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData($)):(l.icon.dynamicLayoutVertexBuffer.updateData(V),$&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData($))}function Nl(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$){const{lineStartIndex:U,glyphStartIndex:ee,segment:se}=v,ae=ee+v.numGlyphs,xe=U+v.lineLength,ye=t.getoffsetX(ee),me=t.getoffsetX(ae-1),he=Xa(l*ye,n,u,f,m,_,se,U,xe,w,E,A,P,M,!0,k,q,V,$);if(!he)return null;const Te=Xa(l*me,n,u,f,m,_,se,U,xe,w,E,A,P,M,!0,k,q,V,$);return Te?{first:he,last:Te}:null}function Ca(l,t,n,u){return l===s.bI.horizontal&&Math.abs(u)>Math.abs(n)?{useVertical:!0}:l===s.bI.vertical?u>0?{needsFlipping:!0}:null:t!==us.unknown&&function(f,m){return f===0||Math.abs(m/f)>ys}(n,u)?t===us.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function vs(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U,ee,se){const ae=t/24,xe=l.lineOffsetX*ae,ye=l.lineOffsetY*ae,{lineStartIndex:me,glyphStartIndex:he,numGlyphs:Te,segment:Ae,writingMode:rt,flipState:Ge}=l,ft=me+l.lineLength,mt=Bt=>{if(A){const[vt,it,Et]=Bt.up,yt=E.length;s.bK(A,yt+0,vt,it,Et),s.bK(A,yt+1,vt,it,Et),s.bK(A,yt+2,vt,it,Et),s.bK(A,yt+3,vt,it,Et)}const[je,tt,Ve]=Bt.point;s.bL(E,je,tt,Ve,Bt.angle)};if(Te>1){const Bt=Nl(ae,v,xe,ye,n,P,M,l,w,m,k,V,!1,$,U,ee,se);if(!Bt)return{notEnoughRoom:!0};if(u&&!n){let[je,tt,Ve]=Bt.first.point,[vt,it,Et]=Bt.last.point;[je,tt]=Co(je,tt,Ve,_),[vt,it]=Co(vt,it,Et,_);const yt=Ca(rt,Ge,(vt-je)*q,it-tt);if(l.flipState=yt&&yt.needsFlipping?us.flipRequired:us.flipNotRequired,yt)return yt}mt(Bt.first);for(let je=he+1;je<he+Te-1;je++){const tt=Xa(ae*v.getoffsetX(je),xe,ye,n,P,M,Ae,me,ft,w,m,k,V,!1,!1,$,U,ee,se);if(!tt)return E.length-=4*(je-he),{notEnoughRoom:!0};mt(tt)}mt(Bt.last)}else{if(u&&!n){const je=Co(M.x,M.y,0,f),tt=me+Ae+1,Ve=new s.P(w.getx(tt),w.gety(tt)),vt=Co(Ve.x,Ve.y,0,f),it=vt[3]>0?vt:hl(M,Ve,je,1,f,void 0,$,U.canonical),Et=Ca(rt,Ge,(it[0]-je[0])*q,it[1]-je[1]);if(l.flipState=Et&&Et.needsFlipping?us.flipRequired:us.flipNotRequired,Et)return Et}const Bt=Xa(ae*v.getoffsetX(he),xe,ye,n,P,M,Ae,me,ft,w,m,k,V,!1,!1,$,U,ee,se);if(!Bt)return{notEnoughRoom:!0};mt(Bt)}return{}}function Za(l,t,n,u,f){const{x:m,y:_,z:v}=u.projectTilePoint(l.x,l.y,t);if(!f)return Co(m,_,v,n);const[w,E,A]=f(l);return Co(m+w,_+E,v+A,n)}function hl(l,t,n,u,f,m,_,v){const w=Za(l.sub(t)._unit()._add(l),v,f,_,m);return s.at(w,n,w),s.au(w,w),s.bF(w,n,w,u)}function Xa(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U,ee){const se=u?l-t:l+t;let ae=se>0?1:-1,xe=0;u&&(ae*=-1,xe=Math.PI),ae<0&&(xe+=Math.PI);let ye=v+_+(ae>0?0:1)|0,me=f,he=f,Te=0,Ae=0;const rt=Math.abs(se),Ge=[],ft=[];let mt=m,Bt=mt,je=s.bC([]);const tt=()=>hl(Bt,mt,he,rt-Te+1,A,M,V,$.canonical);for(;Te+Ae<=rt;){if(ye+=ae,ye<v||ye>=w)return null;if(he=me,Bt=mt,Ge.push(he),k&&ft.push(Bt),mt=new s.P(E.getx(ye),E.gety(ye)),me=P[ye],!me){const Kt=Za(mt,$.canonical,A,V,M);me=Kt[3]>0?P[ye]=Kt:tt()}Te+=Ae;const ur=s.at([],me,he),gr=s.bD(he,me);if(n&&gr>0&&Ae>0&&s.bE(je,ur)/(Ae*gr)<ee)return null;Ae=gr,je=ur}q&&M&&(P[ye]&&(me=tt(),Ae=s.bD(he,me),je=s.at([],me,he)),P[ye]=me);const Ve=(rt-Te)/Ae,vt=mt.sub(Bt)._mult(Ve)._add(Bt),it=s.bF([],he,je,Ve);let Et=[0,0,1],yt=je[0],Mt=je[1];if(U&&(Et=V.upVector($.canonical,vt.x,vt.y),Et[0]!==0||Et[1]!==0||Et[2]!==1)){const ur=[Et[2],0,-Et[0]],gr=s.bG([],Et,ur);s.au(ur,ur),s.au(gr,gr),yt=s.bE(je,ur),Mt=s.bE(je,gr)}if(n){const ur=s.bG([],Et,je);s.au(ur,ur),s.bF(it,it,ur,n*ae)}const Dt=xe+Math.atan2(Mt,yt);return Ge.push(it),k&&ft.push(vt),{point:it,angle:Dt,path:Ge,tilePath:ft,up:Et}}function ai(l,t){const n=t.length,u=n+4*l;t.resize(u),t.float32.fill(-1/0,4*n,4*u)}function Vl(l,t,n){const u=t[0],f=t[1];return l[0]=n[0]*u+n[4]*f+n[12],l[1]=n[1]*u+n[5]*f+n[13],l[3]=n[3]*u+n[7]*f+n[15],l}const Mr=100;class au{constructor(t,n,u=new Ia(t.width+200,t.height+200,25),f=new Ia(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Mr,this.screenBottomBoundary=t.height+Mr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,u,f,m,_,v,w){let E=u.projectedAnchorX,A=u.projectedAnchorY,P=u.projectedAnchorZ;const M=u.elevation,k=u.tileID,q=t.getProjection();if(M&&k){const[ye,me,he]=q.upVector(k.canonical,u.tileAnchorX,u.tileAnchorY),Te=q.upVectorScale(k.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;E+=ye*M*Te,A+=me*M*Te,P+=he*M*Te}const V=this.projectAndGetPerspectiveRatio(v,E,A,P,u.tileID,q.name==="globe"||!!M||this.transform.pitch>0,q),$=_*V.perspectiveRatio,U=(u.x1*n+f.x-u.padding)*$+V.point.x,ee=(u.y1*n+f.y-u.padding)*$+V.point.y,se=(u.x2*n+f.x+u.padding)*$+V.point.x,ae=(u.y2*n+f.y+u.padding)*$+V.point.y,xe=V.perspectiveRatio<=.55||V.occluded;return!this.isInsideGrid(U,ee,se,ae)||!m&&this.grid.hitTest(U,ee,se,ae,w)||xe?{box:[],offscreen:!1,occluded:V.occluded}:{box:[U,ee,se,ae],offscreen:this.isOffscreen(U,ee,se,ae),occluded:!1}}placeCollisionCircles(t,n,u,f,m,_,v,w,E,A,P,M,k,q,V){const $=[],U=this.transform.elevation,ee=t.getProjection(),se=U?U.getAtTileOffsetFunc(V,this.transform.center.lat,this.transform.worldSize,ee):null,ae=new s.P(u.tileAnchorX,u.tileAnchorY);let{x:xe,y:ye,z:me}=ee.projectTilePoint(ae.x,ae.y,V.canonical);if(se){const[Et,yt,Mt]=se(ae);xe+=Et,ye+=yt,me+=Mt}const he=ee.name==="globe",Te=this.projectAndGetPerspectiveRatio(v,xe,ye,me,V,he||!!U||this.transform.pitch>0,ee),{perspectiveRatio:Ae}=Te,rt=(P?_/Ae:_*Ae)/s.bO,Ge=Co(xe,ye,me,w),ft=u.lineOffsetX*rt,mt=u.lineOffsetY*rt,Bt=s.al(t.layers[0].layout.get("text-max-angle")),je=Math.cos(Bt),tt=Te.signedDistanceFromCamera>0?Nl(rt,m,ft,mt,!1,Ge,ae,u,f,w,{},U&&!P?se:null,P&&!!U,ee,V,P,je):null;let Ve=!1,vt=!1,it=!0;if(tt&&!Te.occluded){const Et=.5*k*Ae+q,yt=new s.P(-100,-100),Mt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Dt=new Ea,{first:ur,last:gr}=tt,Kt=ur.path.length;let pr=[];for(let Ur=Kt-1;Ur>=1;Ur--)pr.push(ur.path[Ur]);for(let Ur=1;Ur<gr.path.length;Ur++)pr.push(gr.path[Ur]);const nr=2.5*Et;E&&(pr=pr.map(([Ur,li,Xi],Yi)=>(se&&!he&&(Xi=se(Yi<Kt-1?ur.tilePath[Kt-1-Yi]:gr.tilePath[Yi-Kt+2])[2]),Co(Ur,li,Xi,E))),pr.some(Ur=>Ur[3]<=0)&&(pr=[]));let Ir=[];if(pr.length>0){let Ur=1/0,li=-1/0,Xi=1/0,Yi=-1/0;for(const ei of pr)Ur=Math.min(Ur,ei[0]),Xi=Math.min(Xi,ei[1]),li=Math.max(li,ei[0]),Yi=Math.max(Yi,ei[1]);li>=yt.x&&Ur<=Mt.x&&Yi>=yt.y&&Xi<=Mt.y&&(Ir=[pr.map(ei=>new s.P(ei[0],ei[1]))],(Ur<yt.x||li>Mt.x||Xi<yt.y||Yi>Mt.y)&&(Ir=s.bM(Ir,yt.x,yt.y,Mt.x,Mt.y)))}for(const Ur of Ir){Dt.reset(Ur,.25*Et);let li=0;li=Dt.length<=.5*Et?1:Math.ceil(Dt.paddedLength/nr)+1;for(let Xi=0;Xi<li;Xi++){const Yi=Xi/Math.max(li-1,1),ei=Dt.lerp(Yi),Ln=ei.x+Mr,_n=ei.y+Mr;$.push(Ln,_n,Et,0);const Hr=Ln-Et,wi=_n-Et,Si=Ln+Et,Ki=_n+Et;if(it=it&&this.isOffscreen(Hr,wi,Si,Ki),vt=vt||this.isInsideGrid(Hr,wi,Si,Ki),!n&&this.grid.hitTestCircle(Ln,_n,Et,M)&&(Ve=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ve,occluded:!1}}}}return{circles:!A&&Ve||!vt?[]:$,offscreen:it,collisionDetected:Ve,occluded:Te.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let u=1/0,f=1/0,m=-1/0,_=-1/0;for(const A of t){const P=new s.P(A.x+Mr,A.y+Mr);u=Math.min(u,P.x),f=Math.min(f,P.y),m=Math.max(m,P.x),_=Math.max(_,P.y),n.push(P)}const v=this.grid.query(u,f,m,_).concat(this.ignoredGrid.query(u,f,m,_)),w={},E={};for(const A of v){const P=A.key;if(w[P.bucketInstanceId]===void 0&&(w[P.bucketInstanceId]={}),w[P.bucketInstanceId][P.featureIndex])continue;const M=[new s.P(A.x1,A.y1),new s.P(A.x2,A.y1),new s.P(A.x2,A.y2),new s.P(A.x1,A.y2)];s.bN(n,M)&&(w[P.bucketInstanceId][P.featureIndex]=!0,E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]=[]),E[P.bucketInstanceId].push(P.featureIndex))}return E}insertCollisionBox(t,n,u,f,m){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:f,collisionGroupID:m},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,u,f,m){const _=n?this.ignoredGrid:this.grid,v={bucketInstanceId:u,featureIndex:f,collisionGroupID:m};for(let w=0;w<t.length;w+=4)_.insertCircle(v,t[w],t[w+1],t[w+2])}projectAndGetPerspectiveRatio(t,n,u,f,m,_,v){const w=[n,u,f,1];let E=!1;f||this.transform.pitch>0?(s.aA(w,w,t),this.fogState&&m&&v.name!=="globe"&&(E=function(M,k,q,V,$,U){const ee=U.calculateFogTileMatrix($),se=[k,q,V];return s.ad(se,se,ee),lr(M,s.ae(se),U.pitch,U._fov)}(this.fogState,n,u,f,m.toUnwrapped(),this.transform)>.9)):Vl(w,w,t);const A=w[3];return{point:new s.P((w[0]/A+1)/2*this.transform.width+Mr,(-w[1]/A+1)/2*this.transform.height+Mr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/A*.5,1.5),signedDistanceFromCamera:A,occluded:_&&w[2]>A||E}}isOffscreen(t,n,u,f){return u<Mr||t>=this.screenRightBoundary||f<Mr||n>this.screenBottomBoundary}isInsideGrid(t,n,u,f){return u>=0&&t<this.gridRightBoundary&&f>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=s.bx([]);return s.bo(t,t,[-100,-100,0]),t}}function lu(l,t,n){const u=t.createTileMatrix(l,l.worldSize,n.toUnwrapped());return s.az(new Float32Array(16),l.projMatrix,u)}function Ya(l,t,n){if(t.projection.name===n.projection.name)return l.projMatrix;const u=n.clone();return u.setProjection(t.projection),lu(u,t.getProjection(),l)}function ua(l,t,n){return t.name===n.projection.name?l.projMatrix:lu(n,t,l)}class Mo{constructor(t,n,u,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):f&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ca{constructor(t,n,u,f,m,_=!1){this.text=new Mo(t?t.text:null,n,u,m),this.icon=new Mo(t?t.icon:null,n,f,m),this.clipped=_}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ma{constructor(t,n,u,f=!1){this.text=t,this.icon=n,this.skipFade=u,this.clipped=f}}class Sr{constructor(){this.invProjMatrix=s.bz(),this.viewportMatrix=s.bz(),this.circles=[]}}class Hi{constructor(t,n,u,f,m){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=u,this.bucketIndex=f,this.tileID=m}}class xi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:u=>u.collisionGroupID===n}}return this.collisionGroups[t]}}function zo(l,t,n,u,f){const{horizontalAlign:m,verticalAlign:_}=s.bV(l),v=-(m-.5)*t,w=-(_-.5)*n,E=s.bU(l,u);return new s.P(v+E[0]*f,w+E[1]*f)}function Pa(l,t,n,u,f){const m=new s.P(l,t);return n&&m._rotate(u?f:-f),m}class Ui{constructor(t,n,u,f,m,_){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new au(this.transform,m),this.buildingIndex=_,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new xi(u),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,n,u,f,m=1){const _=u.getBucket(n),v=u.latestFeatureIndex;if(!_||!v||n.fqid!==_.layerIds[0])return;const w=_.layers[0].layout,E=_.layers[0].paint,A=u.collisionBoxArray,P=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),M=u.tileSize/s.aj,k=u.tileID.toUnwrapped();this.transform.setProjection(_.projection);const q=(V=u.tileID,$=_.getProjection(),U=this.transform,$.name===this.projection?U.calculateProjMatrix(V.toUnwrapped()):lu(U,$,V));var V,$,U;const ee=w.get("text-pitch-alignment")==="map",se=w.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const ae=n.dynamicFilter(),xe=n.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(u),me=Aa(q,u.tileID.canonical,ee,se,this.transform,_.getProjection(),ye);let he=null;if(ee){const tt=su(q,u.tileID.canonical,ee,se,this.transform,_.getProjection(),ye);he=s.az([],this.transform.labelPlaneMatrix,tt)}let Te=null;ae&&u.latestFeatureIndex&&(Te={unwrappedTileID:k,dynamicFilter:ae,dynamicFilterNeedsFeature:xe}),this.retainedQueryData[_.bucketInstanceId]=new Hi(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,u.tileID);const[Ae,rt]=_.layers[0].layout.get("text-size-scale-range"),Ge=s.aD(m,Ae,rt),[ft,mt]=w.get("icon-size-scale-range"),Bt=s.aD(m,ft,mt),je={bucket:_,layout:w,paint:E,posMatrix:q,textLabelPlaneMatrix:me,labelToScreenMatrix:he,clippingData:Te,scale:P,textPixelRatio:M,holdingForFade:u.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:s.bH(_.textSizeData,this.transform.zoom,Ge),partiallyEvaluatedIconSize:s.bH(_.iconSizeData,this.transform.zoom,Bt),collisionGroup:this.collisionGroups.get(_.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(f)for(const tt of _.sortKeyRanges){const{sortKey:Ve,symbolInstanceStart:vt,symbolInstanceEnd:it}=tt;t.push({sortKey:Ve,symbolInstanceStart:vt,symbolInstanceEnd:it,parameters:je})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:je})}attemptAnchorPlacement(t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U,ee){const{textOffset0:se,textOffset1:ae,crossTileID:xe}=M,ye=[se,ae],me=zo(t,u,f,ye,m),he=this.collisionIndex.placeCollisionBox(q,m,n,Pa(me.x,me.y,_,v,this.transform.angle),P,w,E,A.predicate);if($){const Te=q.getSymbolInstanceIconSize(ee,this.transform.zoom,M.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,Te,$,Pa(me.x,me.y,_,v,this.transform.angle),P,w,E,A.predicate).box.length===0)return}if(he.box.length>0){let Te;return this.prevPlacement&&this.prevPlacement.variableOffsets[xe]&&this.prevPlacement.placements[xe]&&this.prevPlacement.placements[xe].text&&(Te=this.prevPlacement.variableOffsets[xe].anchor),this.variableOffsets[xe]={textOffset:ye,width:u,height:f,anchor:t,textScale:m,prevAnchor:Te},this.markUsedJustification(q,t,M,V),q.allowVerticalPlacement&&(this.markUsedOrientation(q,V,M),this.placedOrientations[xe]=V),{shift:me,placedGlyphBoxes:he}}}placeLayerBucketPart(t,n,u,f,m=1){const{bucket:_,layout:v,paint:w,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:P,clippingData:M,textPixelRatio:k,holdingForFade:q,collisionBoxArray:V,partiallyEvaluatedTextSize:$,partiallyEvaluatedIconSize:U,collisionGroup:ee,latestFeatureIndex:se}=t.parameters,ae=v.get("text-optional"),xe=v.get("icon-optional"),ye=v.get("text-allow-overlap"),me=v.get("icon-allow-overlap"),he=v.get("text-rotation-alignment")==="map",Te=v.get("text-pitch-alignment")==="map",Ae=w.get("symbol-z-offset"),rt=v.get("symbol-elevation-reference")==="sea",[Ge,ft]=v.get("text-size-scale-range"),[mt,Bt]=v.get("icon-size-scale-range"),je=s.aD(m,Ge,ft),tt=s.aD(m,mt,Bt);this.transform.setProjection(_.projection);let Ve=ye&&(me||!_.hasIconData()||xe),vt=me&&(ye||!_.hasTextData()||ae);const it=!Ae.isConstant();!_.collisionArrays&&V&&_.deserializeCollisionBoxes(V),u&&f&&_.updateCollisionDebugBuffers(this.transform.zoom,V,je,tt);const Et=(yt,Mt,Dt)=>{const{crossTileID:ur,numVerticalGlyphVertices:gr}=yt;let Kt=null;if(M&&M.dynamicFilterNeedsFeature||it){const Li=this.retainedQueryData[_.bucketInstanceId];Kt=se.loadFeature({featureIndex:yt.featureIndex,bucketIndex:Li.bucketIndex,sourceLayerIndex:Li.sourceLayerIndex,layoutVertexArrayOffset:0})}if(M&&!(0,M.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Kt,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new s.P(yt.tileAnchorX,yt.tileAnchorY),this.transform.calculateDistanceTileData(M.unwrappedTileID)))return this.placements[ur]=new Ma(!1,!1,!1,!0),void n.add(ur);const pr=Ae.evaluate(Kt,{});if(n.has(ur))return;if(q)return void(this.placements[ur]=new Ma(!1,!1,!1));let nr=!1,Ir=!1,Ur=!0,li=!1,Xi=!1,Yi=null,ei={box:null,offscreen:null,occluded:null},Ln={box:null},_n=null,Hr=null,wi=null,Si=0,Ki=0,uo=0;Dt.textFeatureIndex?Si=Dt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(Si=yt.featureIndex),Dt.verticalTextFeatureIndex&&(Ki=Dt.verticalTextFeatureIndex);const zn=Li=>{Li.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const en=this.transform.elevation;Li.elevation=rt?pr:pr+(en?en.getAtTileOffset(Li.tileID,Li.tileAnchorX,Li.tileAnchorY):0),Li.elevation+=yt.zOffset},Wn=Dt.textBox;if(Wn){zn(Wn);const Li=Gi=>{let on=s.bI.horizontal;if(_.allowVerticalPlacement&&!Gi&&this.prevPlacement){const To=this.prevPlacement.placedOrientations[ur];To&&(this.placedOrientations[ur]=To,on=To,this.markUsedOrientation(_,on,yt))}return on},en=(Gi,on)=>{if(_.allowVerticalPlacement&&gr>0&&Dt.verticalTextBox){for(const To of _.writingModes)if(To===s.bI.vertical?(ei=on(),Ln=ei):ei=Gi(),ei&&ei.box&&ei.box.length)break}else ei=Gi()};if(v.get("text-variable-anchor")){let Gi=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ur]){const yi=this.prevPlacement.variableOffsets[ur];Gi.indexOf(yi.anchor)>0&&(Gi=Gi.filter(Uo=>Uo!==yi.anchor),Gi.unshift(yi.anchor))}const on=(yi,Uo,Jn)=>{const Jo=_.getSymbolInstanceTextSize($,yt,this.transform.zoom,Mt),al=(yi.x2-yi.x1)*Jo+2*yi.padding,Rl=(yi.y2-yi.y1)*Jo+2*yi.padding,Hs=yt.hasIconTextFit&&!me?Uo:null;Hs&&zn(Hs);let Ua={box:[],offscreen:!1,occluded:!1};const Ro=ye?2*Gi.length:Gi.length;for(let qa=0;qa<Ro;++qa){const ll=this.attemptAnchorPlacement(Gi[qa%Gi.length],yi,al,Rl,Jo,he,Te,k,E,ee,qa>=Gi.length,yt,Mt,_,Jn,Hs,$,U);if(ll&&(Ua=ll.placedGlyphBoxes,Ua&&Ua.box&&Ua.box.length)){nr=!0,Yi=ll.shift;break}}return Ua};en(()=>on(Wn,Dt.iconBox,s.bI.horizontal),()=>{const yi=Dt.verticalTextBox;return yi&&zn(yi),_.allowVerticalPlacement&&!(ei&&ei.box&&ei.box.length)&&gr>0&&yi?on(yi,Dt.verticalIconBox,s.bI.vertical):{box:null,offscreen:null,occluded:null}}),ei&&(nr=ei.box,Ur=ei.offscreen,li=ei.occluded);const To=Li(!(!ei||!ei.box));if(!nr&&this.prevPlacement){const yi=this.prevPlacement.variableOffsets[ur];yi&&(this.variableOffsets[ur]=yi,this.markUsedJustification(_,yi.anchor,yt,To))}}else{const Gi=(on,To)=>{const yi=_.getSymbolInstanceTextSize($,yt,this.transform.zoom,Mt,m),Uo=this.collisionIndex.placeCollisionBox(_,yi,on,new s.P(0,0),ye,k,E,ee.predicate);return Uo&&Uo.box&&Uo.box.length&&(this.markUsedOrientation(_,To,yt),this.placedOrientations[ur]=To),Uo};en(()=>Gi(Wn,s.bI.horizontal),()=>{const on=Dt.verticalTextBox;return _.allowVerticalPlacement&&gr>0&&on?(zn(on),Gi(on,s.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Li(!!(ei&&ei.box&&ei.box.length))}}if(_n=ei,nr=_n&&_n.box&&_n.box.length>0,Ur=_n&&_n.offscreen,li=_n&&_n.occluded,yt.useRuntimeCollisionCircles){const Li=_.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex>=0?yt.centerJustifiedTextSymbolIndex:yt.verticalPlacedTextSymbolIndex),en=s.bJ(_.textSizeData,$,Li),Gi=v.get("text-padding");Hr=this.collisionIndex.placeCollisionCircles(_,ye,Li,_.lineVertexArray,_.glyphOffsetArray,en,E,A,P,u,Te,ee.predicate,yt.collisionCircleDiameter*en/s.bO,Gi,this.retainedQueryData[_.bucketInstanceId].tileID),nr=ye||Hr.circles.length>0&&!Hr.collisionDetected,Ur=Ur&&Hr.offscreen,li=Hr.occluded}if(Dt.iconFeatureIndex&&(uo=Dt.iconFeatureIndex),Dt.iconBox){const Li=en=>{zn(en);const Gi=yt.hasIconTextFit&&Yi?Pa(Yi.x,Yi.y,he,Te,this.transform.angle):new s.P(0,0),on=_.getSymbolInstanceIconSize(U,this.transform.zoom,yt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,on,en,Gi,me,k,E,ee.predicate)};Ln&&Ln.box&&Ln.box.length&&Dt.verticalIconBox?(wi=Li(Dt.verticalIconBox),Ir=wi.box.length>0):(wi=Li(Dt.iconBox),Ir=wi.box.length>0),Ur=Ur&&wi.offscreen,Xi=wi.occluded}const Tn=ae||yt.numHorizontalGlyphVertices===0&&gr===0,ti=xe||yt.numIconVertices===0;if(Tn||ti?ti?Tn||(Ir=Ir&&nr):nr=Ir&&nr:Ir=nr=Ir&&nr,nr&&_n&&_n.box&&this.collisionIndex.insertCollisionBox(_n.box,v.get("text-ignore-placement"),_.bucketInstanceId,Ln&&Ln.box&&Ki?Ki:Si,ee.ID),Ir&&wi&&this.collisionIndex.insertCollisionBox(wi.box,v.get("icon-ignore-placement"),_.bucketInstanceId,uo,ee.ID),Hr&&(nr&&this.collisionIndex.insertCollisionCircles(Hr.circles,v.get("text-ignore-placement"),_.bucketInstanceId,Si,ee.ID),u)){const Li=_.bucketInstanceId;let en=this.collisionCircleArrays[Li];en===void 0&&(en=this.collisionCircleArrays[Li]=new Sr);for(let Gi=0;Gi<Hr.circles.length;Gi+=4)en.circles.push(Hr.circles[Gi+0]),en.circles.push(Hr.circles[Gi+1]),en.circles.push(Hr.circles[Gi+2]),en.circles.push(Hr.collisionDetected?1:0)}const cn=_.projection.name!=="globe";Ve=Ve&&(cn||!li),vt=vt&&(cn||!Xi),this.placements[ur]=new Ma(nr||Ve,Ir||vt,Ur||_.justReloaded),n.add(ur)};if(_.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(_,this.retainedQueryData[_.bucketInstanceId].tileID),_.elevationType==="road"&&_.updateRoadElevation(),_.updateZOffset(),_.sortFeaturesByY){const yt=_.getSortedSymbolIndexes(this.transform.angle);for(let Mt=yt.length-1;Mt>=0;--Mt){const Dt=yt[Mt];Et(_.symbolInstances.get(Dt),Dt,_.collisionArrays[Dt])}_.hasAnyZOffset&&s.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const yt=_.getSortedIndexesByZOffset();for(let Mt=0;Mt<yt.length;++Mt){const Dt=yt[Mt];Et(_.symbolInstances.get(Dt),Dt,_.collisionArrays[Dt])}}else for(let yt=t.symbolInstanceStart;yt<t.symbolInstanceEnd;yt++)Et(_.symbolInstances.get(yt),yt,_.collisionArrays[yt]);if(u&&_.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[_.bucketInstanceId];s.bi(yt.invProjMatrix,E),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,n,u,f){const{leftJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:_,rightJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:w,crossTileID:E}=u,A=s.bT(n),P=f===s.bI.vertical?w:A==="left"?m:A==="center"?_:A==="right"?v:-1;m>=0&&(t.text.placedSymbolArray.get(m).crossTileID=P>=0&&m!==P?0:E),_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=P>=0&&_!==P?0:E),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=P>=0&&v!==P?0:E),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=P>=0&&w!==P?0:E)}markUsedOrientation(t,n,u){const f=n===s.bI.horizontal||n===s.bI.horizontalOnly?n:0,m=n===s.bI.vertical?n:0,{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:E}=u,A=t.text.placedSymbolArray;_>=0&&(A.get(_).placedOrientation=f),v>=0&&(A.get(v).placedOrientation=f),w>=0&&(A.get(w).placedOrientation=f),E>=0&&(A.get(E).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let u=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const f=n?n.symbolFadeChange(t):1,m=n?n.opacities:{},_=n?n.variableOffsets:{},v=n?n.placedOrientations:{};for(const w in this.placements){const E=this.placements[w],A=m[w];A?(this.opacities[w]=new ca(A,f,E.text,E.icon,null,E.clipped),u=u||E.text!==A.text.placed||E.icon!==A.icon.placed):(this.opacities[w]=new ca(null,f,E.text,E.icon,E.skipFade,E.clipped),u=u||E.text||E.icon)}for(const w in m){const E=m[w];if(!this.opacities[w]){const A=new ca(E,f,!1,!1);A.isHidden()||(this.opacities[w]=A,u=u||E.text.placed||E.icon.placed)}}for(const w in _)this.variableOffsets[w]||!this.opacities[w]||this.opacities[w].isHidden()||(this.variableOffsets[w]=_[w]);for(const w in v)this.placedOrientations[w]||!this.opacities[w]||this.opacities[w].isHidden()||(this.placedOrientations[w]=v[w]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,u,f){const m=new Set;for(const _ of n){const v=_.getBucket(t);v&&_.latestFeatureIndex&&t.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,m,_,_.collisionBoxArray,u,f,_.tileID,t.scope),v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,_.tileID),v.elevationType==="road"&&v.updateRoadElevation(),v.updateZOffset())}}updateBucketOpacities(t,n,u,f,m,_,v,w){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const E=t.layers[0].layout,A=t.layers[0].paint,P=!!t.layers[0].dynamicFilter(),M=new ca(null,0,!1,!1,!0),k=E.get("text-allow-overlap"),q=E.get("icon-allow-overlap"),V=E.get("text-variable-anchor"),$=E.get("text-rotation-alignment")==="map",U=E.get("text-pitch-alignment")==="map",ee=A.get("symbol-z-offset"),se=E.get("symbol-elevation-reference")==="sea",ae=!ee.isConstant(),xe=new ca(null,0,k&&(q||!t.hasIconData()||E.get("icon-optional")),q&&(k||!t.hasTextData()||E.get("text-optional")),!0);!t.collisionArrays&&f&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(f);const ye=(he,Te,Ae)=>{for(let rt=0;rt<Te/4;rt++)he.opacityVertexArray.emplaceBack(Ae)};let me=0;_&&t.updateReplacement(v,_);for(let he=0;he<t.symbolInstances.length;he++){const Te=t.symbolInstances.get(he),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:rt,crossTileID:Ge,numIconVertices:ft,tileAnchorX:mt,tileAnchorY:Bt}=Te;let je=null;const tt=this.retainedQueryData[t.bucketInstanceId];ae&&Te&&tt&&(je=u.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:tt.bucketIndex,sourceLayerIndex:tt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ve=ee.evaluate(je,{}),vt=n.has(Ge);let it=this.opacities[Ge];vt?it=M:it||(it=xe,this.opacities[Ge]=it),n.add(Ge);const Et=Ae>0||rt>0,yt=ft>0,Mt=this.placedOrientations[Ge],Dt=Mt===s.bI.vertical,ur=Mt===s.bI.horizontal||Mt===s.bI.horizontalOnly;!Et&&!yt||it.isHidden()||me++;let gr=!1;if((Et||yt)&&_)for(const Kt of t.activeReplacements){if(s.bP(Kt,m,s.bQ.Symbol,w)||Kt.min.x>mt||mt>Kt.max.x||Kt.min.y>Bt||Bt>Kt.max.y)continue;const pr=s.bR(mt,Bt,v.canonical,Kt.footprintTileId.canonical);if(gr=s.bS(pr,Kt.footprint),gr)break}if(Et){const Kt=gr?Ra:Ka(it.text);ye(t.text,Ae,Dt?Ra:Kt),ye(t.text,rt,ur?Ra:Kt);const pr=it.text.isHidden(),{leftJustifiedTextSymbolIndex:nr,centerJustifiedTextSymbolIndex:Ir,rightJustifiedTextSymbolIndex:Ur,verticalPlacedTextSymbolIndex:li}=Te,Xi=t.text.placedSymbolArray,Yi=pr||Dt?1:0;nr>=0&&(Xi.get(nr).hidden=Yi),Ir>=0&&(Xi.get(Ir).hidden=Yi),Ur>=0&&(Xi.get(Ur).hidden=Yi),li>=0&&(Xi.get(li).hidden=pr||ur?1:0);const ei=this.variableOffsets[Ge];ei&&this.markUsedJustification(t,ei.anchor,Te,Mt);const Ln=this.placedOrientations[Ge];Ln&&(this.markUsedJustification(t,"left",Te,Ln),this.markUsedOrientation(t,Ln,Te))}if(yt){const Kt=gr?Ra:Ka(it.icon),{placedIconSymbolIndex:pr,verticalPlacedIconSymbolIndex:nr}=Te,Ir=t.icon.placedSymbolArray,Ur=it.icon.isHidden()?1:0;pr>=0&&(ye(t.icon,ft,Dt?Ra:Kt),Ir.get(pr).hidden=Ur),nr>=0&&(ye(t.icon,Te.numVerticalIconVertices,ur?Ra:Kt),Ir.get(nr).hidden=Ur)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Kt=t.collisionArrays[he];if(Kt){let pr=new s.P(0,0),nr=!0;if(Kt.textBox||Kt.verticalTextBox){if(V){const Ur=this.variableOffsets[Ge];Ur?(pr=zo(Ur.anchor,Ur.width,Ur.height,Ur.textOffset,Ur.textScale),$&&pr._rotate(U?this.transform.angle:-this.transform.angle)):nr=!1}P&&(nr=!it.clipped),Kt.textBox&&dl(t.textCollisionBox.collisionVertexArray,it.text.placed,!nr||Dt,Ve,se,pr.x,pr.y),Kt.verticalTextBox&&dl(t.textCollisionBox.collisionVertexArray,it.text.placed,!nr||ur,Ve,se,pr.x,pr.y)}const Ir=nr&&!!(!ur&&Kt.verticalIconBox);Kt.iconBox&&dl(t.iconCollisionBox.collisionVertexArray,it.icon.placed,Ir,Ve,se,Te.hasIconTextFit?pr.x:0,Te.hasIconTextFit?pr.y:0),Kt.verticalIconBox&&dl(t.iconCollisionBox.collisionVertexArray,it.icon.placed,!Ir,Ve,se,Te.hasIconTextFit?pr.x:0,Te.hasIconTextFit?pr.y:0)}}}if(t.fullyClipped=me===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const u=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function dl(l,t,n,u,f,m,_){l.emplaceBack(t?1:0,n?1:0,m||0,_||0,u,f?1:0),l.emplaceBack(t?1:0,n?1:0,m||0,_||0,u,f?1:0),l.emplaceBack(t?1:0,n?1:0,m||0,_||0,u,f?1:0),l.emplaceBack(t?1:0,n?1:0,m||0,_||0,u,f?1:0)}const fl=Math.pow(2,25),uu=Math.pow(2,24),Oo=Math.pow(2,17),$n=Math.pow(2,16),_c=Math.pow(2,9),cu=Math.pow(2,8),yc=Math.pow(2,1);function Ka(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,n=Math.floor(127*l.opacity);return n*fl+t*uu+n*Oo+t*$n+n*_c+t*cu+n*yc+t}const Ra=0;class Fu{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,u,f,m,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(v,f,t[this._currentTileIndex],this._sortAcrossTiles,_),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,E)=>w.sortKey-E.sortKey));this._currentPartIndex<v.length;){const w=v[this._currentPartIndex];if(n.placeLayerBucketPart(w,this._seenCrossTileIDs,u,w.symbolInstanceStart===0,_),this._currentPartIndex++,m())return!0}return!1}}class N{constructor(t,n,u,f,m,_,v,w,E){this.placement=new Ui(t,m,_,v,w,E),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,n,u,f,m){const _=s.q.now(),v=()=>{const w=s.q.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=n[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=E)&&(!w.maxzoom||w.maxzoom>E)){const A=w,P=A.layout.get("symbol-z-elevate"),M=A.layout.get("symbol-sort-key").constantOr(1)!==void 0,k=A.layout.get("symbol-z-order"),q=k==="viewport-y"||k==="auto"&&!(k!=="viewport-y"&&M),V=A.layout.get("text-allow-overlap")||A.layout.get("icon-allow-overlap")||A.layout.get("text-ignore-placement")||A.layout.get("icon-ignore-placement"),$=q&&V,U=this._inProgressLayer=this._inProgressLayer||new Fu(A),ee=s.C(w.source,w.scope);if(U.continuePlacement(P||$?f[ee]:u[ee],this.placement,this._showCollisionBoxes,w,v,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Q=512/s.aj/2;class ve{constructor(t,n,u){this.tileID=t,this.bucketInstanceId=u,this.index=new s.bW(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const f=t.canonical.x*s.aj,m=t.canonical.y*s.aj;for(let _=0;_<n.length;_++){const{key:v,crossTileID:w,tileAnchorX:E,tileAnchorY:A}=n.get(_),P=Math.floor((f+E)*Q),M=Math.floor((m+A)*Q);this.index.add(P,M),this.keys.push(v),this.crossTileIDs.push(w)}this.index.finish()}findMatches(t,n,u){const f=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),m=Q/Math.pow(2,n.canonical.z-this.tileID.canonical.z),_=n.canonical.x*s.aj,v=n.canonical.y*s.aj;for(let w=0;w<t.length;w++){const E=t.get(w);if(E.crossTileID)continue;const{key:A,tileAnchorX:P,tileAnchorY:M}=E,k=Math.floor((_+P)*m),q=Math.floor((v+M)*m),V=this.index.range(k-f,q-f,k+f,q+f).sort(($,U)=>$-U);for(const $ of V){const U=this.crossTileIDs[$];if(this.keys[$]===A&&!u.has(U)){u.add(U),E.crossTileID=U;break}}}}}class Oe{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class zt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const u in this.indexes){const f=this.indexes[u],m={};for(const _ in f){const v=f[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+n),m[v.tileID.key]=v}this.indexes[u]=m}this.lng=t}addBucket(t,n,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<n.symbolInstances.length;m++)n.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const f=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const _=this.indexes[m];if(Number(m)>t.overscaledZ)for(const v in _){const w=_[v];w.tileID.isChildOf(t)&&w.findMatches(n.symbolInstances,t,f)}else{const v=_[t.scaledTo(Number(m)).key];v&&v.findMatches(n.symbolInstances,t,f)}}for(let m=0;m<n.symbolInstances.length;m++){const _=n.symbolInstances.get(m);_.crossTileID||(_.crossTileID=u.generate(),f.add(_.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ve(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const u of n.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let n=!1;for(const u in this.indexes){const f=this.indexes[u];for(const m in f)t[f[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,f[m]),delete f[m],n=!0)}return n}}class xt{constructor(){this.layerIndexes={},this.crossTileIDs=new Oe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,u,f){let m=this.layerIndexes[t.fqid];m===void 0&&(m=this.layerIndexes[t.fqid]=new zt);let _=!1;const v={};f.name!=="globe"&&m.handleWrapJump(u);for(const w of n){const E=w.getBucket(t);E&&t.fqid===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(w.tileID,E,this.crossTileIDs)&&(_=!0),v[E.bucketInstanceId]=!0)}return m.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const n={};t.forEach(u=>{n[u]=!0});for(const u in this.layerIndexes)n[u]||delete this.layerIndexes[u]}}const Xt=771;class Ft{constructor(t,n,u,f){this.blendFunction=t,this.blendColor=n,this.mask=u,this.blendEquation=f}}Ft.Replace=[1,0,1,0],Ft.disabled=new Ft(Ft.Replace,s.am.transparent,[!1,!1,!1,!1]),Ft.unblended=new Ft(Ft.Replace,s.am.transparent,[!0,!0,!0,!0]),Ft.alphaBlended=new Ft([1,Xt,1,Xt],s.am.transparent,[!0,!0,!0,!0]),Ft.alphaBlendedNonPremultiplied=new Ft([770,Xt,770,Xt],s.am.transparent,[!0,!0,!0,!0]),Ft.multiply=new Ft([774,0,774,0],s.am.transparent,[!0,!0,!0,!0]);class Rt{constructor(t,n,u){this.func=t,this.mask=n,this.range=u}}Rt.ReadOnly=!1,Rt.ReadWrite=!0,Rt.disabled=new Rt(519,Rt.ReadOnly,[0,1]);const qi=7680;class rr{constructor(t,n,u,f,m,_){this.test=t,this.ref=n,this.mask=u,this.fail=f,this.depthFail=m,this.pass=_}}rr.disabled=new rr({func:519,mask:0},0,0,qi,qi,qi);const Pn=1029,Po=2305;class Dr{constructor(t,n,u){this.enable=t,this.mode=n,this.frontFace=u}}function Ns(l,t){const n=s.c1(l,3);s.c3(l,t),s.c7(l,3,n)}function xs(l,t){const n=s.bY([]);return s.bZ(n,n,-t),s.b_(n,n,-l),n}function vc(l,t){const n=[l[0],l[1],0],u=[t[0],t[1],0];if(s.ae(n)>=1e-15){const _=s.au([],n);s.b$(u,_,s.bE(u,_)),t[0]=u[0],t[1]=u[1]}const f=s.bG([],t,l);if(s.c0(f)<1e-15)return null;const m=Math.atan2(-f[1],f[0]);return xs(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),m)}Dr.disabled=new Dr(!1,Pn,Po),Dr.backCCW=new Dr(!0,Pn,Po),Dr.backCW=new Dr(!0,Pn,2304),Dr.frontCW=new Dr(!0,1028,2304),Dr.frontCCW=new Dr(!0,1028,Po);class ha{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof s.ac?t:new s.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=s.bX(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n){if(this.orientation=null,!this.position)return;const u=this.position,f=this._elevation?this._elevation.getAtPointOrZero(s.ac.fromLngLat(t)):0,m=s.ac.fromLngLat(t,f),_=[m.x-u.x,m.y-u.y,m.z-u.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=vc(_,n)}setPitchBearing(t,n){this.orientation=xs(s.al(t),s.al(-n))}}class bs{constructor(t,n){this._transform=s.bx([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new s.ac(t[0],t[1],t[2])}get position(){const t=s.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&s.c7(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.bY([]),t&&Ns(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=xs(t,n),Ns(this._transform,this._orientation)}forward(){const t=s.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const u=new Float64Array(16);return s.bi(u,this.getWorldToCamera(t,n)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,u){const f=this.position;s.b$(f,f,-t);const m=new Float64Array(16);return s.bn(m,[u,u,u]),s.bo(m,m,f),m[10]*=n,m}getWorldToCamera(t,n){const u=new Float64Array(16),f=new Float64Array(4),m=this.position;return s.c2(f,this._orientation),s.b$(m,m,-t),s.c3(u,f),s.bo(u,u,m),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=n,u[9]*=n,u[10]*=n,u[11]*=n,u}getCameraToClipPerspective(t,n,u,f){const m=new Float64Array(16);return s.c4(m,t,n,u,f),m}getCameraToClipOrthographic(t,n,u,f,m,_){const v=new Float64Array(16);return s.c5(v,t,n,u,f,m,_),v}getDistanceToElevation(t,n=!1){const u=t===0?0:s.c6(t,n?s.aY(this.position[1]):this.position[1]),f=this.forward();return(u-this.position[2])/f[2]}clone(){return new bs([...this.position],[...this.orientation])}}const Ms={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class xc{constructor(t=0,n=0,u=0,f=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(u)||u<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=u,this.right=f}interpolate(t,n,u){return n.top!=null&&t.top!=null&&(this.top=s.ai(t.top,n.top,u)),n.bottom!=null&&t.bottom!=null&&(this.bottom=s.ai(t.bottom,n.bottom,u)),n.left!=null&&t.left!=null&&(this.left=s.ai(t.left,n.left,u)),n.right!=null&&t.right!=null&&(this.right=s.ai(t.right,n.right,u)),this}getCenter(t,n){const u=s.aD((this.left+t-this.right)/2,0,t),f=s.aD((this.top+n-this.bottom)/2,0,n);return new s.P(u,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new xc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const jl=15;class hu{constructor(t,n,u,f,m,_,v){this.tileSize=512,this._renderWorldCopies=m===void 0||m,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=u??0,this._maxPitch=f??60,this.setProjection(_),this.setMaxBounds(v),this.width=0,this.height=0,this._center=new s.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new xc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new bs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new hu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<jl}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return s.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=s.ce(this.projectionOptions);const u=this.getProjection(),f=!s.bv(n,u);return f&&this._calcMatrices(),this.mercatorFromTransition=!1,f}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.ce({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=s.cf(),s.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=s.aD(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let f=0,m=0;for(let _=0;_<n.length;_++){const v=new s.P(n[_][0]*this.width,u+n[_][1]*(this.height-u)),w=t.pointCoordinate(v);if(!w)continue;const E=1/Math.hypot(w[0]-this._camera.position[0],w[1]-this._camera.position[1]);f+=w[3]*E,m+=E}return m===0?NaN:f/m}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*n,f=this._mercatorZfromZoom(t),m=this._mercatorZfromZoom(this._maxZoom),_=Math.max(f-u,m);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const f=s.ae(s.at([],this._camera.position,u));return s.aD(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!s.ch(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];s.ci(u,this._camera.position)||(this._setCameraPosition(u),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new ha;return n.position=new s.ac(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!s.cj(t))return!1;s.ck(t,t);const n=s.cl([],[0,0,-1],t),u=s.cl([],[0,-1,0],t);if(u[2]<0)return!1;const f=vc(n,u);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;t[2]=s.aD(t[2],f/u,f/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,u){this._unmodified=!1,this._edgeInsets.interpolate(t,n,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new s.cm(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new s.P(0,0)),f=this.pointCoordinate(new s.P(this.width,0)),m=this.pointCoordinate(new s.P(this.width,this.height)),_=this.pointCoordinate(new s.P(0,this.height)),v=Math.floor(Math.min(u.x,f.x,m.x,_.x)),w=Math.floor(Math.max(u.x,f.x,m.x,_.x)),E=1;for(let A=v-E;A<=w+E;A++)A!==0&&n.push(new s.cm(A,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,u){let f=[];const m=u!=null,_=!m;if(_&&this.zoom<n||m&&u[0]===0&&u[1]===0)return f;const v=new Set,w=(A,P,M,k,q)=>{const V=s.cK(P,A,M,k,q);v.has(V)||(f.push(new s.aM(A,P,M,k,q)),v.add(V))};for(let A=0;A<t.length;A++){const P=t[A];if(_&&P.canonical.z!==n)continue;const M=P.canonical,k=P.overscaledZ,q=P.wrap,V=1<<M.z,$=M.x+1<V,U=M.x>0,ee=M.y+1<V,se=M.y>0,ae=P.wrap-(U?0:1),xe=P.wrap+($?0:1),ye=U?M.x-1:V-1,me=$?M.x+1:0;if(m)u[0]<0?(w(k,xe,M.z,me,M.y),u[1]<0&&ee&&(w(k,q,M.z,M.x,M.y+1),w(k,xe,M.z,me,M.y+1)),u[1]>0&&se&&(w(k,q,M.z,M.x,M.y-1),w(k,xe,M.z,me,M.y-1))):u[0]>0?(w(k,ae,M.z,ye,M.y),u[1]<0&&ee&&(w(k,q,M.z,M.x,M.y+1),w(k,ae,M.z,ye,M.y+1)),u[1]>0&&se&&(w(k,q,M.z,M.x,M.y-1),w(k,ae,M.z,ye,M.y-1))):u[1]<0&&ee?w(k,q,M.z,M.x,M.y+1):se&&w(k,q,M.z,M.x,M.y-1);else{const he=P.visibleQuadrants;1&he&&(w(k,ae,M.z,ye,M.y),se&&(w(k,q,M.z,M.x,M.y-1),w(k,ae,M.z,ye,M.y-1))),2&he&&(w(k,xe,M.z,me,M.y),se&&(w(k,q,M.z,M.x,M.y-1),w(k,xe,M.z,me,M.y-1))),4&he&&(w(k,ae,M.z,ye,M.y),ee&&(w(k,q,M.z,M.x,M.y+1),w(k,ae,M.z,ye,M.y+1))),8&he&&(w(k,xe,M.z,me,M.y),ee&&(w(k,q,M.z,M.x,M.y+1),w(k,xe,M.z,me,M.y+1)))}}const E=[];for(const A of f)f.some(P=>A.isChildOf(P))||E.push(A);if(f=E.filter(A=>!t.some(P=>!!(A.overscaledZ<n&&P.isChildOf(A))||A.equals(P)||A.isChildOf(P))),_){const A=1<<n,P=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),M=[A*P.x,A*P.y],k=4,q=k*k;f=f.filter(V=>{const $=V.canonical.x+.5-M[0],U=V.canonical.y+.5-M[1];return $*$+U*U<q})}return f}coveringTiles(t){let n=this.coveringZoomLevel(t);const u=n,f=this.elevation&&this.elevation.exaggeration(),m=f&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const v=this.locationCoordinate(this.center),w=this.center.lat,E=1<<n,A=[E*v.x,E*v.y,0],P=this.projection.name==="globe",M=!P,k=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,M),q=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=E*s.c6(1,this.center.lat),$=this._camera.position[2]/s.c6(1,this.center.lat),U=[E*q.x,E*q.y,$*(M?1:V)],ee=P||f,se=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ae=this.isLODDisabled(!0)?n:0;let xe;if(this._elevation&&t.isTerrainDEM)xe=1e4*this._elevation.exaggeration();else if(this._elevation){const Ve=this._elevation.getMinMaxForVisibleTiles();xe=Ve?Ve.max:this._centerAltitude}else xe=this._centerAltitude;const ye=t.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,me=this.projection.isReprojectedInTileSpace?s.co(this):1,he=Ve=>{const it=new s.ac(Ve.x+25e-6,Ve.y,Ve.z),Et=new s.ac(Ve.x,Ve.y+25e-6,Ve.z),yt=Ve.toLngLat(),Mt=it.toLngLat(),Dt=Et.toLngLat(),ur=this.locationCoordinate(yt),gr=this.locationCoordinate(Mt),Kt=this.locationCoordinate(Dt),pr=Math.hypot(gr.x-ur.x,gr.y-ur.y),nr=Math.hypot(Kt.x-ur.x,Kt.y-ur.y);return Math.sqrt(pr*nr)*me/25e-6},Te=Ve=>{const vt=xe,it=ye;return{aabb:s.cr(this,E,0,0,0,Ve,it,vt,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:vt,wrap:Ve,fullyVisible:!1}},Ae=[];let rt=[];const Ge=n,ft=t.reparseOverscaled?u:n,mt=($-this._centerAltitude)*V,Bt=Ve=>{if(!this._elevation||!Ve.tileID||!_)return;const vt=this._elevation.getMinMaxForTile(Ve.tileID),it=Ve.aabb;vt?(it.min[2]=vt.min,it.max[2]=vt.max,it.center[2]=(it.min[2]+it.max[2])/2):(Ve.shouldSplit=tt(Ve),Ve.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},je=(Ve,vt)=>{if(.707*vt<Ve)return 1;const it=vt/Ve;return it/(1.4144271570014144+(Math.pow(1.1,it-1.4144271570014144+1)-1)/(1.1-1)-1)},tt=Ve=>{if(Ve.zoom<ae)return!0;if(Ve.zoom===Ge)return!1;if(Ve.shouldSplit!=null)return Ve.shouldSplit;const vt=Ve.aabb.distanceX(U),it=Ve.aabb.distanceY(U);let Et=mt,yt=1;if(P){Et=Ve.aabb.distanceZ(U);const nr=Math.pow(2,Ve.zoom),Ir=s.aY((Ve.y+1)/nr),Ur=s.aY(Ve.y/nr),li=Math.min(Math.max(w,Ir),Ur),Xi=s.cP(li)/s.cP(w);if(yt=li===w?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Xi/this._mercatorScaleRatio),this.zoom<=s.cL&&Ve.zoom===Ge-1&&Xi>=.9)return!0}else if(m&&(Et=Ve.aabb.distanceZ(U)*V),this.projection.isReprojectedInTileSpace&&u<=5){const nr=Math.pow(2,Ve.zoom),Ir=he(new s.ac((Ve.x+.5)/nr,(Ve.y+.5)/nr));yt=Ir>.85?1:Ir}if(!_){const nr=Math.sqrt(vt*vt+it*it+Et*Et);let Ir=(1<<Ge-Ve.zoom)*se*yt;return Ir*=je(Math.max(Et,mt),nr),nr<Ir}let Mt=Number.MAX_VALUE,Dt=0;const ur=Ve.aabb.getCorners(),gr=[];for(const nr of ur){s.at(gr,nr,U),P||(m?gr[2]*=V:gr[2]=mt);const Ir=s.bE(gr,this._camera.forward());Ir<Mt&&(Mt=Ir,Dt=Math.abs(gr[2]))}let Kt=(1<<Ge-Ve.zoom)*se*yt;if(Kt*=je(Math.max(Dt,mt),Mt),Mt<Kt)return!0;const pr=Ve.aabb.closestPoint(A);return pr[0]===A[0]&&pr[1]===A[1]};if(this.renderWorldCopies)for(let Ve=1;Ve<=3;Ve++)Ae.push(Te(-Ve)),Ae.push(Te(Ve));for(Ae.push(Te(0));Ae.length>0;){const Ve=Ae.pop(),vt=Ve.x,it=Ve.y;let Et=Ve.fullyVisible;const yt=()=>this.projection.name==="globe"&&(Ve.y===0||Ve.y===(1<<Ve.zoom)-1);if(!Et){let Mt=ee?Ve.aabb.intersects(k):Ve.aabb.intersectsFlat(k);if(Mt===0&&yt()){const Dt=new s.cp(Ve.zoom,vt,it);Mt=s.cq(this,E,Dt,!0).intersects(k)}if(Mt===0)continue;Et=Mt===2}if(Ve.zoom!==Ge&&tt(Ve))for(let Mt=0;Mt<4;Mt++){const Dt=(vt<<1)+Mt%2,ur=(it<<1)+(Mt>>1),gr={aabb:_?Ve.aabb.quadrant(Mt):s.cr(this,E,Ve.zoom+1,Dt,ur,Ve.wrap,Ve.minZ,Ve.maxZ,this.projection),zoom:Ve.zoom+1,x:Dt,y:ur,wrap:Ve.wrap,fullyVisible:Et,tileID:void 0,shouldSplit:void 0,minZ:Ve.minZ,maxZ:Ve.maxZ};m&&!P&&(gr.tileID=new s.aM(Ve.zoom+1===Ge?ft:Ve.zoom+1,Ve.wrap,Ve.zoom+1,Dt,ur),Bt(gr)),Ae.push(gr)}else{const Mt=Ve.zoom===Ge?ft:Ve.zoom;if(t.minzoom&&t.minzoom>Mt)continue;let Dt=0;if(!Et){let pr=ee?Ve.aabb.intersectsPrecise(k):Ve.aabb.intersectsPreciseFlat(k);if(pr===0&&yt()){const nr=new s.cp(Ve.zoom,vt,it);pr=s.cq(this,E,nr,!0).intersectsPrecise(k)}if(pr===0)continue;if(t.calculateQuadrantVisibility)if(k.containsPoint(Ve.aabb.center))Dt=15;else for(let nr=0;nr<4;nr++)Ve.aabb.quadrant(nr).intersects(k)!==0&&(Dt|=1<<nr)}const ur=A[0]-(.5+vt+(Ve.wrap<<Ve.zoom))*(1<<n-Ve.zoom),gr=A[1]-.5-it,Kt=Ve.tileID?Ve.tileID:new s.aM(Mt,Ve.wrap,Ve.zoom,vt,it);t.calculateQuadrantVisibility&&(Kt.visibleQuadrants=Dt),rt.push({tileID:Kt,distanceSq:ur*ur+gr*gr})}}if(this.fogCullDistSq){const Ve=this.fogCullDistSq,vt=this.horizonLineFromTop();rt=rt.filter(it=>{const Et=[0,0,0,1],yt=[s.aj,s.aj,0,1],Mt=this.calculateFogTileMatrix(it.tileID.toUnwrapped());s.aA(Et,Et,Mt),s.aA(yt,yt,Mt);const Dt=s.cs([],Et,yt),ur=s.ct([],Et,yt),gr=s.cM(Dt,ur);if(gr===0)return!0;let Kt=!1;const pr=this._elevation;if(pr&&gr>Ve&&vt!==0){const nr=this.calculateProjMatrix(it.tileID.toUnwrapped());let Ir;t.isTerrainDEM||(Ir=pr.getMinMaxForTile(it.tileID)),Ir||(Ir={min:ye,max:xe});const Ur=s.cu(this.rotation),li=[Ur[0]*s.aj,Ur[1]*s.aj,Ir.max];s.ad(li,li,nr),Kt=(1-li[1])*this.height*.5<vt}return gr<Ve||Kt})}return rt.sort((Ve,vt)=>Ve.distanceSq-vt.distanceSq).map(Ve=>Ve.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const n=s.aD(t.lat,-s.cv,s.cv),u=this.projection.project(t.lng,n);return new s.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let u,f;const m=this.centerPoint;if(this.projection.name==="globe"){const v=this.worldSize;u=(n.x-m.x)/v,f=(n.y-m.y)/v}else{const v=this.pointCoordinate(n),w=this.pointCoordinate(m);u=v.x-w.x,f=v.y-w.y}const _=this.locationCoordinate(t);this.setLocation(new s.ac(_.x-u,_.y-f))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,n){return this.projection.locationPoint(this,t,n)}locationPoint3D(t,n){return this.projection.locationPoint(this,t,n,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,n){return this.coordinateLocation(this.pointCoordinate3D(t,n))}locationCoordinate(t,n){const u=n?s.c6(n,t.lat):void 0,f=this.projection.project(t.lng,t.lat);return new s.ac(f.x,f.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const u=n??this._centerAltitude,f=[t.x,t.y,0,1],m=[t.x,t.y,1,1];s.aA(f,f,this.pixelMatrixInverse),s.aA(m,m,this.pixelMatrixInverse);const _=m[3];s.cw(f,f,1/f[3]),s.cw(m,m,1/_);const v=f[2],w=m[2];return{p0:f,p1:m,t:v===w?0:(u-v)/(w-v)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return s.aA(n,n,this.pixelMatrixInverse),s.aA(u,u,this.pixelMatrixInverse),s.cw(n,n,1/n[3]),s.cw(u,u,1/u[3]),n[2]=s.c6(n[2],this._center.lat)*this.worldSize,u[2]=s.c6(u[2],this._center.lat)*this.worldSize,s.cw(n,n,1/this.worldSize),s.cw(u,u,1/this.worldSize),new s.av([n[0],n[1],n[2]],s.au([],s.at([],u,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:u,t:f}=t,m=s.c6(n[2],this._center.lat),_=s.c6(u[2],this._center.lat);return new s.ac(s.ai(n[0],u[0],f)/this.worldSize,s.ai(n[1],u[1],f)/this.worldSize,s.ai(m,_,f))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new s.ac(u[0],u[1],u[2]);let f=0,m=this.horizonLineFromTop();if(t.y>m)return this.pointCoordinate(t,n);const _=.02*m,v=t.clone();for(let w=0;w<10&&m-f>_;w++){v.y=s.ai(f,m,.66);const E=this.projection.pointCoordinate3D(this,v.x,v.y);E?(m=v.y,u=E):f=v.y}return u?new s.ac(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cx)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const u=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,f=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return s.aA(f,f,this.pixelMatrix),f[3]>0?new s.P(f[0]/f[3],f[1]/f[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,m=this.pointLocation3D(new s.P(n,t)),_=this.pointLocation3D(new s.P(f,t)),v=this.pointLocation3D(new s.P(f,u)),w=this.pointLocation3D(new s.P(n,u));let E=Math.min(m.lng,_.lng,v.lng,w.lng),A=Math.max(m.lng,_.lng,v.lng,w.lng),P=Math.min(m.lat,_.lat,v.lat,w.lat),M=Math.max(m.lat,_.lat,v.lat,w.lat);const k=Math.pow(2,-this.zoom)/16*270,q=this.projection.name==="globe"?1:4,V=($,U,ee,se,ae)=>{const xe=($+ee)/2,ye=(U+se)/2,me=new s.P(xe,ye),{lng:he,lat:Te}=this.pointLocation3D(me),Ae=Math.max(0,E-he,P-Te,he-A,Te-M);E=Math.min(E,he),A=Math.max(A,he),P=Math.min(P,Te),M=Math.max(M,Te),(ae<q||Ae>k)&&(V($,U,xe,ye,ae+1),V(xe,ye,ee,se,ae+1))};if(V(n,t,f,t,1),V(f,t,f,u,1),V(f,u,n,u,1),V(n,u,n,t,1),this.projection.name==="globe"){const[$,U]=s.cy(this);$?(M=90,A=180,E=-180):U&&(P=-90,A=180,E=-180)}return new s.aG(new s.cd(E,P),new s.cd(A,M))}_getBoundsRectangular(t,n){const{top:u,left:f}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=new s.P(f,u),w=new s.P(_,u),E=new s.P(_,m),A=new s.P(f,m);let P=this.pointCoordinate(v,t),M=this.pointCoordinate(w,t);const k=this.pointCoordinate(E,n),q=this.pointCoordinate(A,n),V=($,U)=>(U.y-$.y)/(U.x-$.x);return P.y>1&&M.y>=0?P=new s.ac((1-q.y)/V(q,P)+q.x,1):P.y<0&&M.y<=1&&(P=new s.ac(-q.y/V(q,P)+q.x,0)),M.y>1&&P.y>=0?M=new s.ac((1-k.y)/V(k,M)+k.x,1):M.y<0&&P.y<=1&&(M=new s.ac(-k.y/V(k,M)+k.x,0)),new s.aG().extend(this.coordinateLocation(P)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(k))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((u,f)=>{if(f.dem){const m=f.dem.tree;u.min=Math.min(u.min,m.minimums[0]),u.max=Math.max(u.max,m.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cv,this.maxLat=s.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.ay(this.minLng)*this.tileSize,this.worldMaxX=s.ay(this.maxLng)*this.tileSize,this.worldMinY=s.aH(this.maxLat)*this.tileSize,this.worldMaxY=s.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,u=this._distanceTileDataCache;if(u[n])return u[n];const f=t.canonical,m=1/this.height,_=this.cameraWorldSize,v=_/this.zoomScale(f.z),w=(f.x+Math.pow(2,f.z)*t.wrap)*v,E=f.y*v,A=this.point;A.x*=_/this.worldSize,A.y*=_/this.worldSize;const P=this.angle,M=Math.sin(-P),k=-Math.cos(-P);return u[n]={bearing:[M,k],center:[(A.x-w)*m,(A.y-E)*m],scale:v/s.aj*m},u[n]}calculateFogTileMatrix(t){const n=t.key,u=this._fogTileMatrixCache;if(u[n])return u[n];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.az(f,this.worldToFogMatrix,f),u[n]=new Float32Array(f),u[n]}calculateProjMatrix(t,n=!1,u=!1){const f=t.key;let m;if(m=u?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,m[f])return m[f];const _=this.calculatePosMatrix(t,this.worldSize);let v;return v=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,s.az(_,v,_),m[f]=new Float32Array(_),m[f]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[n])return u[n];const f=s.cz(t,this);return u[n]=f,u[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=s.bn([],[t,t,t]);return s.az(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=s.c6(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(n),f=this._camera.forward(),m=s.c6(1,this._center.lat);u[2]/=m,f[2]/=m,s.au(f,f);const _=t.raycast(u,f,t.exaggeration());if(_){const v=s.bF([],u,f,_),w=new s.ac(v[0],v[1],s.c6(v[2],s.aY(v[1]))),E=(w.z+s.ae([w.x-u[0],w.y-u[1],w.z-u[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(E),this._centerAltitude=w.toAltitude(),this._center=this.coordinateLocation(w),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,u=s.c6(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(u),m=n.getAtPointOrZero(new s.ac(...f)),_=this.pixelsPerMeter/this.worldSize*m,v=this._minimumHeightOverTerrain(),w=f[2]-_;if(w<=v)if(w<0||t){const E=this.locationCoordinate(this._center,this._centerAltitude),A=[f[0],f[1],E.z-f[2]],P=s.ae(A);A[2]-=(v-w)/this._pixelsPerMercatorPixel;const M=s.ae(A);if(M===0)return;s.b$(A,A,P/M*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],E.z*this._pixelsPerMercatorPixel-A[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const M=this.center;return M.lat=s.aD(M.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(M.lng=s.aD(M.lng,this.minLng,this.maxLng)),this.center=M,void(this._constraining=!1)}const n=this._unmodified,{x:u,y:f}=this.point;let m=0,_=u,v=f;const w=this.width/2,E=this.height/2,A=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(f-E<A&&(v=A+E),f+E>P&&(v=P-E),P-A<this.height&&(m=Math.max(m,this.height/(P-A)),v=(P+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const M=this.worldMinX*this.scale,k=this.worldMaxX*this.scale,q=this.worldSize/2-(M+k)/2;_=(u+q+this.worldSize)%this.worldSize-q,_-w<M&&(_=M+w),_+w>k&&(_=k-w),k-M<this.width&&(m=Math.max(m,this.width/(k-M)),_=(k+M)/2)}_===u&&v===f||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(_,v))),m&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(m)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.c6(1,this.center.lat)/s.c6(1,s.cN));const f=s.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this.projection.zAxisUnit==="meters"?u:1,_=this._camera.getWorldToCamera(this.worldSize,m);let v;const w=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(w[8]=2*-t.x/this.width,w[9]=2*t.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ae=Te*this.aspect,rt=-Ae,Ge=-Te;Ae-=t.x,rt-=t.x,Te+=t.y,Ge+=t.y,v=this._camera.getCameraToClipOrthographic(rt,Ae,Ge,Te,this._nearZ,this._farZ),((ft,mt,Bt,je)=>{for(let tt=0;tt<16;tt++)ft[tt]=s.ai(mt[tt],Bt[tt],je)})(v,v,w,s.cO(this.pitch>=jl?1:this.pitch/jl))}else v=w;const E=s.cB([],w,_);let A=s.cB([],v,_);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),Ae=s.bx([]);s.bo(Ae,Ae,[Te.x*this.worldSize,Te.y*this.worldSize,0]),s.az(Ae,Ae,s.cC(this)),s.bo(Ae,Ae,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),s.az(A,A,Ae),s.az(E,E,Ae),this.inverseAdjustmentMatrix=s.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cE([],A,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=A,this.invProjMatrix=s.bi(new Float64Array(16),this.projMatrix),n){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-t.x/this.width,Te[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cB([],Te,_)}else this.expandedFarZProjMatrix=this.projMatrix;const P=s.bi([],v);this.frustumCorners=s.cF.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const M=new Float32Array(16);s.bx(M),s.cE(M,M,[1,-1,1]),s.cG(M,M,this._pitch),s.by(M,M,this.angle);const k=s.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.bw(k);const q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-t.x/this.width,k[9]=2*(t.y+q)/this.height,this.skyboxMatrix=s.az(M,k,M);const V=this.point,$=V.x,U=V.y,ee=this.width%2/2,se=this.height%2/2,ae=Math.cos(this.angle),xe=Math.sin(this.angle),ye=$-Math.round($)+ae*ee+xe*se,me=U-Math.round(U)+ae*se+xe*ee,he=new Float64Array(A);if(s.bo(he,he,[ye>.5?ye-1:ye,me>.5?me-1:me,0]),this.alignedProjMatrix=he,A=s.bz(),s.cE(A,A,[this.width/2,-this.height/2,1]),s.bo(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=s.bz(),s.cE(A,A,[1,-1,1]),s.bo(A,A,[-1,-1,0]),s.cE(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=s.az(new Float64Array(16),this.labelPlaneMatrix,E),this._calcFogMatrices(),this._distanceTileDataCache={},A=s.bi(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=A,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cH(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.ad(Te,Te,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=A;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,u=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,m=[t,t,n];s.b$(m,m,f),s.b$(u,u,-1),s.cI(u,u,m);const _=s.bz();s.bo(_,_,u),s.cE(_,_,m),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,f)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),f=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-u[0]*m,f.y/this.worldSize-u[1]*m,t/this.worldSize*this._centerAltitude-u[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],f=t[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(m=Math.min((n-u)/f,1)),this._camera.position=s.bF([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:u,bearing:f}=this._camera.getPitchBearing(),m=s.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.al(this._maxPitch)),v=Math.max((t[2]-m)/Math.cos(u),_),w=this._zoomFromMercatorZ(v);s.bF(t,t,n,v),this._pitch=s.aD(u,s.al(this.minPitch),s.al(this.maxPitch)),this.angle=s.bX(f,-Math.PI,Math.PI),this._setZoom(s.aD(w,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,u=s.cx,f=0,m=1/0;for(;u-n>1e-6&&u>n;){const _=n+.5*(u-n),v=this.tileSize*Math.pow(2,_),w=this.getCameraToCenterDistance(this.projection,_,v),E=this.scaleZoom(w/(t*this.tileSize)),A=Math.abs(_-E);A<m&&(m=A,f=_),_<E?n=_:u=_}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const u=Math.min(t.x,n.x),f=Math.max(t.x,n.x),m=Math.min(t.y,n.y),_=Math.max(t.y,n.y);if(m<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const v=[new s.P(u,m),new s.P(f,_),new s.P(u,_),new s.P(f,m)],w=this.renderWorldCopies?-3:0,E=this.renderWorldCopies?4:1;for(const A of v){const P=this.pointRayIntersection(A);if(P.t<0)return!0;const M=this.rayIntersectionCoordinate(P);if(M.x<w||M.y<0||M.x>E||M.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,n){const u=s.ae(s.at([],this._camera.position,t)),f=this._zoomFromMercatorZ(u)+n;return u-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,u,f],m){const _=[n,u,f,1];s.aA(_,_,m);const v=_[3]=Math.max(_[3],1e-6);return _[0]/=v,_[1]/=v,_[2]/=v,_}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,u=this.worldSize){const f=s.cA(t,n,this.width,this.height,1024),m=t.pixelSpaceConversion(this.center.lat,u,f);let _=.5/Math.tan(.5*this._fov)*this.height*m;return this.isOrthographic&&(_=s.ai(1,_,s.cO(this.pitch>=jl?1:this.pitch/jl))),_}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.az(t,t,this.globeMatrix),t}getFrustum(t){return s.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Ja=(l,t)=>{if(t>0&&l.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=l.transform,u=Math.max(Math.abs(n._zoom-(l.minCutoffZoom-1)),1),f=n.isLODDisabled(!1)?s.af(60,45,n.pitch):s.af(30,15,n.pitch),m=n._farZ-n._nearZ,_=t*n.height,v=((1-(w=f))*n.cameraToCenterDistance+w*(n._farZ+_))*u;var w;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(v-n._nearZ)/m,(v-_-n._nearZ)/m]}}},Fo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class oh{constructor(t,n){this.aabb=t,this.lastCascade=n}}class du{add(t,n){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],n.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],n.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],n.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],n.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],n.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],n.max[2])):this.receivers[t.key]=new oh(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,u){const f=s.cV.fromPoints(t.points);let m=0;for(const _ in this.receivers){const v=this.receivers[_];if(!v||!f.intersectsAabb(v.aabb))continue;v.aabb.min=f.closestPoint(v.aabb.min),v.aabb.max=f.closestPoint(v.aabb.max);const w=v.aabb.getCorners();for(let E=0;E<u.length;E++){let A=!0;for(const P of w){const M=[P[0]*n,P[1]*n,P[2]];if(s.ad(M,M,u[E].matrix),M[0]<-1||M[0]>1||M[1]<-1||M[1]>1){A=!1;break}}if(v.lastCascade=E,m=Math.max(m,E),A)break}}return m+1}}class dp{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new du,this._depthMode=new Rt(t.context.gl.LEQUAL,Rt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Fo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Fo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Fo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const f=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||f<=0||(this._shadowLayerCount=u.style.order.reduce((q,V)=>{const $=u.style._mergedLayers[V];return q+($.hasShadowPass()&&!$.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const m=u.context,_=Fo.shadowMapResolution,v=Fo.shadowMapResolution;if(this._cascades.length===0||Fo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let q=0;q<Fo.cascadeCount;++q){const V=u._shadowMapDebug,$=m.gl,U=m.createFramebuffer(_,v,V,"texture"),ee=new s.T(m,{width:_,height:v,data:null},$.DEPTH_COMPONENT16);if(U.depthAttachment.set(ee.texture),V){const se=new s.T(m,{width:_,height:v,data:null},$.RGBA8);U.colorAttachment.set(se.texture)}this._cascades.push({framebuffer:U,texture:ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cn,scale:0})}}this.shadowDirection=sh(n);let w=0;if(t.elevation){const q=t.elevation,V=[1e4,-1e4];q.visibleDemTiles.filter($=>$.dem).forEach($=>{const U=$.dem.tree;V[0]=Math.min(V[0],U.minimums[0]),V[1]=Math.max(V[1],U.maximums[0])}),V[0]!==1e4&&(w=(V[1]-V[0])*q.exaggeration())}const E=1.5*t.cameraToCenterDistance,A=3*E,P=new Float64Array(16);for(let q=0;q<this._cascades.length;++q){const V=this._cascades[q];let $=t.height/50,U=1;Fo.cascadeCount===1?U=A:q===0?U=E:($=E,U=A);const[ee,se]=Xh(t,this.shadowDirection,$,U,Fo.shadowMapResolution,w);V.scale=t.scale,V.matrix=ee,V.boundingSphereRadius=se,s.bi(P,V.matrix),V.frustum=s.cn.fromInvProjectionMatrix(P,1,0,!0),V.far=U}const M=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[M].far,this._cascades[M].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Fo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Fo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ms.ShadowMap0,this._uniformValues.u_shadowmap_1=Ms.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const k=u.transform.elevation;for(const q of this._groundShadowTiles){let V={min:0,max:0};if(k){const $=k.getMinMaxForTile(q);$&&(V=$)}this.addShadowReceiver(q.toUnwrapped(),V.min,V.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const u=this.painter,f=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),f.viewport.set([0,0,Fo.shadowMapResolution,Fo.shadowMapResolution]);for(let m=0;m<this._numCascadesToRender;++m){u.currentShadowCascade=m,f.bindFramebuffer.set(this._cascades[m].framebuffer.framebuffer),f.clear({color:s.am.white,depth:1});for(const _ of t.order){const v=t._mergedLayers[_];if(!v.hasShadowPass()||v.isHidden(u.transform.zoom))continue;const w=t.getLayerSourceCache(v),E=w?n[w.id]:void 0;(v.type==="model"||E&&E.length)&&u.renderLayer(u,w,v,E)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,u=t.context,f=n.directionalLight,m=n.ambientLight;if(!f||!m)return;const _=[],v=Ja(t,t.longestCutoffRange);v.shouldRenderCutoff&&_.push("RENDER_CUTOFF"),_.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&_.push("NORMAL_OFFSET");const w=Da(n,f,m),E=new Rt(u.gl.LEQUAL,Rt.ReadOnly,t.depthRangeFor3D);for(const A of this._groundShadowTiles){const P=A.toUnwrapped(),M=t.isTileAffectedByFog(A),k=t.getOrCreateProgram("groundShadow",{defines:_,overrideFog:M});this.setupShadows(P,k),t.uploadCommonUniforms(u,k,P,null,v);const q={u_matrix:t.transform.calculateProjMatrix(P),u_ground_shadow_factor:w};k.draw(t,u.gl.TRIANGLES,E,rr.disabled,Ft.multiply,Dr.disabled,q,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ft.unblended:Ft.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,u=n.calculatePosMatrix(t,n.worldSize);return s.az(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return s.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,n,u,f=0){if(!this.enabled)return;const m=this.painter.transform,_=this.painter.context,v=_.gl,w=this._uniformValues,E=new Float64Array(16),A=m.calculatePosMatrix(t,m.worldSize);for(let P=0;P<this._cascades.length;P++)s.az(E,this._cascades[P].matrix,A),w[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),_.activeTexture.set(v.TEXTURE0+Ms.ShadowMap0+P),this._cascades[P].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);if(this.useNormalOffset=!!u,this.useNormalOffset){const P=s.cT(t.canonical),M=2/m.tileSize*s.aj/Fo.shadowMapResolution,k=M*this._cascades[0].boundingSphereRadius,q=M*this._cascades[this._cascades.length-1].boundingSphereRadius,V=(u==="vector-tile"?1:3)/Math.pow(2,f-t.canonical.z-(1-m.zoom+Math.floor(m.zoom)));w.u_shadow_normal_offset=[P,k*V,q*V],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(_,w)}setupShadowsFromMatrix(t,n,u=!1){if(!this.enabled)return;const f=this.painter.context,m=f.gl,_=this._uniformValues,v=new Float64Array(16);for(let w=0;w<Fo.cascadeCount;w++)s.az(v,this._cascades[w].matrix,t),_[w===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(v),f.activeTexture.set(m.TEXTURE0+Ms.ShadowMap0+w),this._cascades[w].texture.bind(m.NEAREST,m.CLAMP_TO_EDGE);if(this.useNormalOffset=u,u){const w=Fo.normalOffset;_.u_shadow_normal_offset=[1,w,w],_.u_shadow_bias=[6e-5,.0012,.012]}else _.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(f,_)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,u,f){if(f[2]>=0)return{};const m=function(w,E,A){const P=A/(1<<w.canonical.z);return new s.cV([w.canonical.x*P+w.wrap*A,w.canonical.y*P+w.wrap*A,0],[(w.canonical.x+1)*P+w.wrap*A,(w.canonical.y+1)*P+w.wrap*A,E])}(t,n,u).getCorners(),_=n/-f[2];f[0]<0?(s.cU(m[0],m[0],[f[0]*_,0,0]),s.cU(m[3],m[3],[f[0]*_,0,0])):f[0]>0&&(s.cU(m[1],m[1],[f[0]*_,0,0]),s.cU(m[2],m[2],[f[0]*_,0,0])),f[1]<0?(s.cU(m[0],m[0],[0,f[1]*_,0]),s.cU(m[1],m[1],[0,f[1]*_,0])):f[1]>0&&(s.cU(m[2],m[2],[0,f[1]*_,0]),s.cU(m[3],m[3],[0,f[1]*_,0]));const v={};return v.vertices=m,v.planes=[pl(m[1],m[0],m[4]),pl(m[2],m[1],m[5]),pl(m[3],m[2],m[6]),pl(m[0],m[3],m[7])],v}addShadowReceiver(t,n,u){this._receivers.add(t,s.cV.fromTileIdAndHeight(t,n,u))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function pl(l,t,n){const u=s.at([],n,t),f=s.at([],l,t),m=s.bG([],u,f),_=s.ae(m);return _===0?[0,0,1,0]:(s.b$(m,m,1/_),[m[0],m[1],m[2],-s.bE(m,t)])}function sh(l){const t=l.properties.get("direction"),n=s.cR(t.x,t.y,t.z);n[2]=s.aD(n[2],0,75);const u=s.cW([n[0],n[1],n[2]]);return s.cS(u.x,u.y,u.z)}function Da(l,t,n){const u=t.properties.get("color-use-theme")==="none",f=t.properties.get("color"),m=t.properties.get("intensity"),_=t.properties.get("direction"),v=[_.x,_.y,_.z],w=n.properties.get("color-use-theme")==="none",E=n.properties.get("color"),A=n.properties.get("intensity"),P=Math.max(s.bE([0,0,1],v),0),M=[0,0,0];s.b$(M,E.toRenderColor(w?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),A);const k=[0,0,0];return s.b$(k,f.toRenderColor(u?null:l.getLut(n.scope)).toArray01Linear().slice(0,3),P*m),s.cX([M[0]>0?M[0]/(M[0]+k[0]):0,M[1]>0?M[1]/(M[1]+k[1]):0,M[2]>0?M[2]/(M[2]+k[2]):0])}function Xh(l,t,n,u,f,m){const _=l.zoom,v=l.scale,w=l.worldSize,E=1/w,A=l.aspect,P=Math.sqrt(1+A*A)*Math.tan(.5*l.fovX),M=P*P,k=u-n,q=u+n;let V,$;M>k/q?(V=u,$=u*P):(V=.5*q*(1+M),$=.5*Math.sqrt(k*k+2*(u*u+n*n)*M+q*q*M*M));const U=l.projection.pixelsPerMeter(l.center.lat,w),ee=l._camera.getCameraToWorldMercator(),se=[0,0,-V*E];s.ad(se,se,ee);let ae=$*E;const xe=l._edgeInsets;if(!(xe.left===0&&xe.top===0&&xe.right===0&&xe.bottom===0||xe.left===xe.right&&xe.top===xe.bottom)){const Et=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?U:1),yt=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,n,u);yt[8]=2*-l.centerOffset.x/l.width,yt[9]=2*l.centerOffset.y/l.height;const Mt=new Float64Array(16);s.cB(Mt,yt,Et);const Dt=new Float64Array(16);s.bi(Dt,Mt);const ur=s.cn.fromInvProjectionMatrix(Dt,w,_,!0);for(const gr of ur.points){const Kt=((ye=gr)[0]/=v,ye[1]/=v,ye[2]=s.c6(ye[2],l._center.lat),ye);ae=Math.max(ae,s.c0(s.cY([],se,Kt)))}}var ye;ae*=f/(f-1);const me=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),Te=new bs;Te.position=se,Te.setPitchBearing(me,he);const Ae=Te.getWorldToCamera(w,U),rt=ae*w,Ge=Math.min(l._mercatorZfromZoom(17)*w*-2,-2*rt),ft=Te.getCameraToClipOrthographic(-rt,rt,-rt,rt,Ge,(rt+m*U)/t[2]),mt=new Float64Array(16);s.az(mt,ft,Ae);const Bt=s.cS(Math.floor(1e6*se[0])/1e6*w,Math.floor(1e6*se[1])/1e6*w,0),je=.5*f,tt=[0,0,0];s.ad(tt,Bt,mt),s.b$(tt,tt,je);const Ve=[Math.floor(tt[0]),Math.floor(tt[1]),Math.floor(tt[2])],vt=[0,0,0];s.at(vt,tt,Ve),s.b$(vt,vt,-1/je);const it=new Float64Array(16);return s.bx(it),s.bo(it,it,vt),s.az(mt,it,mt),[mt,rt]}class Ul extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,n){return s.aS(this.requestManager.transformRequest(n,s.R.Model).url).then(u=>{if(!u)return;const f=s.aT(u),m=new s.aU(t,void 0,void 0,f);return m.computeBoundsAndApplyParent(),m}).catch(u=>{if(u&&u.status===404)return null;this.fire(new s.z(new Error(`Could not load model ${t} from ${n}: ${u.message}`)))})}load(t,n,u={forceReload:!1}){this.models[n]||(this.models[n]={});const f=Object.keys(t),m=[],_=[];for(const v of f){const w=t[v];this.hasURLBeenRequested(w)&&!u.forceReload||(this.modelByURL[w]={modelId:v,scope:n},m.push(this.loadModel(v,w)),_.push(v)),this.models[n][v]||(this.models[n][v]={model:null,numReferences:1})}this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+_.length,Promise.allSettled(m).then(v=>{for(let w=0;w<v.length;w++){const{status:E}=v[w];if(E==="rejected")continue;const{value:A}=v[w];this.models[n][_[w]]||(this.models[n][_[w]]={model:null,numReferences:1}),this.models[n][_[w]].model=A}this.numModelsLoading[n]-=_.length,this.fire(new s.A("data",{dataType:"style"}))}).catch(v=>{this.fire(new s.z(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,n):this.getModelByURL(this.modelUris[n][t]))}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}getModelByURL(t){if(!t)return null;const n=this.modelByURL[t];return n?this.models[n.scope][n.modelId].model:null}hasModelBeenAdded(t,n){return this.models[n]&&this.models[n][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,n,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const f=this.requestManager.normalizeModelURL(n);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===f)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(f)){const{scope:m,modelId:_}=this.modelByURL[f];this.models[m][_].numReferences++}else this.modelUris[u][t]=f,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u=this.modelUris[n];for(const f in t)u[f]=this.requestManager.normalizeModelURL(t[f])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const u={};for(const f of t)this.hasModel(f,n,{exactIdMatch:!0})||this.hasURLBeenRequested(f)?this.models[n][f].numReferences++:this.modelUris[n][f]&&!this.hasURLBeenRequested(f)?u[f]=this.modelUris[n][f]:!this.hasURLBeenRequested(f)&&s.cZ(f,!1)&&(this.modelUris[n][f]=this.requestManager.normalizeModelURL(f),u[f]=this.modelUris[n][f]);this.load(u,n)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,n,u=!1){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0)){const f=this.modelUris[n][t];u||delete this.modelUris[n][t],delete this.modelByURL[f];const m=this.models[n][t].model;if(!m)return;delete this.models[n][t],m.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const n of Object.keys(this.models[t])){const u=this.models[t][n].model;delete this.models[t][n],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const u in this.models[n])this.models[n][u].model&&this.models[n][u].model.upload(t.context)}}const Of=new s.a7({data:new s.a8(s.a5.colorTheme.data)}),fp={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Ff(l){return l=l||{},Object.assign(l,fp)}class Bf extends s.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},s.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new s.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(_,v){const[w,E]=_,{center:A,radius:P}=v,[M,k]=A,q=Math.abs(w-M);return Math.sqrt((q>180?360-q:q)**2+(E-k)**2)<=P}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new s.A("floorplangone")));const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=new s.P(this._map.transform.width/2,this._map.transform.height/2),f=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(t?f:u,n);m.length>0&&(this._selectedFloorplan&&m[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=m[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(m){const[[_,v],[w,E]]=m,A=(w-_+360)%360,P=A>180?360-A:A;return{center:[(_+P/2+360)%360,(v+E)/2],radius:Math.sqrt(P**2+(E-v)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const n=this._floorplanStates[this._indoorData.id].selectedBuilding,u=this._floorplanStates[this._indoorData.id].selectedLevel;let f;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const m of this._indoorData.levels)m.id===this._selectedLevel.id&&(f=m.id);if(this.fire(new s.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:f})),n){const m=this._indoorData.buildings.find(_=>_.id===n);this._buildingSelected(m,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(u){const m=this._indoorData.levels.find(_=>_.id===u);this._updateLevels(m,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,n){n&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(f=>t.levels.includes(f.id));this.fire(new s.A("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const n=this._indoorData.levels.find(u=>u.id===t);this._updateLevels(n,!0)}this.fire(new s.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,n){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(n&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function u(E){const A=E.indexOf("/floor/");if(A===-1)return E;const P=A+7,M=E.indexOf("/",P);return M===-1?E.slice(P):E.slice(P,M)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const f=[],m={},_={},v={},w={};for(const E of this._indoorData.levels)if(f.push(E.id),m[E.id]=E.height,_[E.id]=E.base,t){if(this.mergeFloors){const A=u(t.id),P=u(E.id);v[E.id]=P===A?"true":"false"}else v[E.id]=E.id===t.id?"true":"false";w[E.id]=E.base<t.base?"true":"false"}else w[E.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",f]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",w]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),n&&t.extent)){const E=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),A=this._map.getZoom(),P=E.zoom?Math.abs(A-E.zoom):0;this._map.fitBounds(t.extent,P>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:A})}}selectFloorplan(t){const n={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new s.P(0,0),new s.P(this._map.transform.width,this._map.transform.height)],f=this._map.queryRenderedFeatures(u,n);if(f.length>0){for(const m of f)if(JSON.parse(m.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=m,this._floorplanSelected(!0);break}}}selectBuilding(t){const n=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(n,!0)}selectLevel(t){this._levelSelected(t)}}function pp(l){if(!l.metadata||!l.metadata.content_area)return;const t=s.q.devicePixelRatio,{left:n,top:u,width:f,height:m}=l.metadata.content_area,_=n*t,v=u*t;return[_,v,_+f*t,v+m*t]}function Yh(l){if(l)return l.map(([t,n])=>[t*s.q.devicePixelRatio,n*s.q.devicePixelRatio])}class ka{constructor(t,n,u){this.id=t,this.scope=n,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const n=this.sourceCache.getVisibleCoordinates();if(n.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof na))return t;const f=n.map(_=>this.sourceCache.getTile(_)),m=u.getImages(f,Array.from(this.pendingRequests));for(const[_,v]of m)t.set(s.I.from({name:_,iconsetId:this.id}),v),this.pendingRequests.delete(_);for(const _ of this.pendingRequests)this.missingRequests.add(_);return this.pendingRequests.clear(),t}}const La=(l,t)=>ke(l,t&&t.filter(n=>n.identifier!=="source.canvas")),jd=s.aF(ki,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ud=s.aF(ki,["setCenter","setZoom","setBearing","setPitch"]),ml=new Set(["background","sky","slot","custom"]),bc={version:8,layers:[],sources:{}},ah={duration:300,delay:0};class za extends s.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=s.l({},ah),this._buildingIndex=new Bs(this),this.crossTileSymbolIndex=new xt,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new zi,this.dispatcher=n.dispatcher?n.dispatcher:new s.D(s.d0(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new zs(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new s.d1(t._requestManager,n.localFontFamily?s.d2.all:n.localIdeographFontFamily?s.d2.ideographs:s.d2.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new Ul(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",s.d3());const u=this;this._rtlTextPluginCallback=za.registerForPluginStateChange(f=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(m,_)=>{if(s.d4(m),_&&_.every(v=>v))for(const v in u._sourceCaches){const w=u._sourceCaches[v],E=w.getSource().type;E!=="vector"&&E!=="geojson"||w.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const m=this.getOwnSource(f.sourceId);if(m&&m.vectorLayerIds)for(const _ in this._layers){const v=this._layers[_];v.source===m.id&&this._validateLayer(v)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.f(t))return t;const n=s.d5(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${s.d6(JSON.stringify(t))}`}_diffStyle(t,n,u){this.globalId=this._getGlobalId(t);const f=(m,_)=>{try{_(null,this.setState(m,u))}catch(v){_(v,!1)}};if(typeof t=="string"){const m=this.map._requestManager.normalizeStyleURL(t),_=this.map._requestManager.transformRequest(m,s.R.Style);s.n(_,(v,w)=>{v?this.fire(new s.z(v)):w&&f(w,n)})}else typeof t=="object"&&f(t,n)}loadURL(t,n={}){this.fire(new s.A("dataloading",{dataType:"style"}));const u=typeof n.validate=="boolean"?n.validate:!s.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const f=this.importsCache.get(t);if(f)return this._load(f,u);const m=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.n(m,(_,v)=>{if(this._request=null,_)this.fire(new s.z(_));else if(v)return this.importsCache.set(t,v),this._load(v,u)})}loadJSON(t,n={}){this.fire(new s.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.q.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new s.A("dataloading",{dataType:"style"})),this._load(bc,!1)}_loadImports(t,n,u){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const f=[];for(const m of t){const _=this._createFragmentStyle(m),v=new Promise(A=>{_.once("style.import.load",A),_.once("error",A)}).then(()=>this.mergeAll());if(f.push(v),this.resolvedImports.has(m.url)){_.loadEmpty();continue}const w=m.data||this.importsCache.get(m.url);w?(_.loadJSON(w,{validate:n}),this._isInternalStyle(w)&&(_.globalId=null)):m.url?_.loadURL(m.url,{validate:n}):_.loadEmpty();const E={style:_,id:m.id,config:m.config};if(u){const A=this.fragments.findIndex(({id:P})=>P===u);this.fragments=this.fragments.slice(0,A).concat(E).concat(this.fragments.slice(A))}else this.fragments.push(E)}return Promise.allSettled(f)}getImportGlobalIds(t=this,n=new Set){for(const u of t.fragments)u.style.globalId&&n.add(u.style.globalId),this.getImportGlobalIds(u.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?s.C(t.id,this.scope):t.id;let u;const f=this._initialConfig&&this._initialConfig[n];(t.config||f)&&(u=s.l({},t.config,f));const m=new za(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return m.setEventedParent(this.map,{style:m}),m}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){const u=t.indoor?Ff(t.schema):t.schema;if(this._isInternalStyle(t)){const _=s.l({},bc,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(_,n)}if(this.updateConfig(this._config,u),n&&La(this,so(t)))return;this._loaded=!0,this.stylesheet=s.d7(t);const f=()=>{for(const E in t.sources)this.addSource(E,t.sources[E],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const E in t.iconsets)this.addIconset(E,t.iconsets[E]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const _=sa(this.stylesheet.layers);if(this._order=_.map(E=>E.id),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const E=this.stylesheet.lights[0];this.light=new Qe(E.properties,E.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Qe(this.stylesheet.light)),this._layers={};for(const E of _){const A=s.dc(E,this.scope,this._styleColorTheme.lut,this.options);A.configDependencies.size!==0&&this._configDependentLayers.add(A.fqid),A.setEventedParent(this,{layer:{id:A.id}}),this._layers[A.id]=A;const P=this.getOwnLayerSourceCache(A),M=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&A.canCastShadows()&&M&&(P.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const v=this.stylesheet.terrain;v&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.A("data",{dataType:"style"}));const w=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new s.A(w?"style.load":"style.import.load"))}).catch(E=>{this.fire(new s.z(new Error("Failed to load imports",E))),this.fire(new s.A(w?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new s.A(w?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const m=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(m){const _=this._evaluateColorThemeData(m);this._loadColorTheme(_).then(()=>{f()}).catch(v=>{s.w(`Couldn't load color theme from the stylesheet: ${v}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,n,u,f,m,_,v,w,E,A;const P={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(M=>{if(M.stylesheet){if(M.light!=null&&(t=M.light),M.stylesheet.lights)for(const k of M.stylesheet.lights)k.type==="ambient"&&M.ambientLight!=null&&(n=M.ambientLight),k.type==="directional"&&M.directionalLight!=null&&(u=M.directionalLight);f=this._prioritizeTerrain(f,M.terrain,M.stylesheet.terrain),M.stylesheet.fog&&M.fog!=null&&(m=M.fog),M.stylesheet.snow&&M.snow!=null&&(_=M.snow),M.stylesheet.rain&&M.rain!=null&&(v=M.rain),M.stylesheet.camera!=null&&(A=M.stylesheet.camera),M.stylesheet.projection!=null&&(w=M.stylesheet.projection),M.stylesheet.transition!=null&&(E=M.stylesheet.transition),P[M.scope]=M._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=u,this.fog=m,this.snow=_,this.rain=v,this._styleColorThemeForScope=P,f===null?delete this.terrain:this.terrain=f,this.camera=A||{"camera-projection":"perspective"},this.projection=w||{name:"mercator"},this.transition=s.l({},ah,E),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const n=u=>{for(const f of u.fragments)n(f.style);t(u)};n(this)}_prioritizeTerrain(t,n,u){const f=t&&t.drapeRenderMode===0;return u===null?n&&n.drapeRenderMode===0?n:f?t:null:n!=null&&(!t||f||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},u={};this.forEachFragmentStyle(f=>{for(const m in f._sourceCaches){const _=s.C(m,f.scope);t[_]=f._sourceCaches[m]}for(const m in f._otherSourceCaches){const _=s.C(m,f.scope);n[_]=f._otherSourceCaches[m]}for(const m in f._symbolSourceCaches){const _=s.C(m,f.scope);u[_]=f._symbolSourceCaches[m]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},n=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(m=>{for(const _ of m._order){const v=m._layers[_];if(v.type==="slot"){const w=s.d8(_);if(t[w])continue;t[w]=[]}v.slot&&t[v.slot]?t[v.slot].push(v):n.push(v)}}),this._mergedOrder=[];const f=(m=[])=>{for(const _ of m)if(_.type==="slot"){const v=s.d8(_.id);t[v]&&f(t[v]),this._mergedSlots.push(v)}else{const v=s.C(_.id,_.scope);this._mergedOrder.push(v),u[v]=_,_.is3D(!!this.terrain)&&(this._has3DLayers=!0),_.type==="circle"&&(this._hasCircleLayers=!0),_.type==="symbol"&&(this._hasSymbolLayers=!0),_.type==="clip"&&(this._clipLayerPresent=!0)}};f(n),this._mergedOrder.sort((m,_)=>{const v=u[m],w=u[_];return v.hasInitialOcclusionOpacityProperties?w.is3D(!!this.terrain)?1:0:v.is3D(!!this.terrain)&&w.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=s.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,u,f){const m=s.l({},u);for(const v of Object.keys(s.a5.colorTheme))m[v]===void 0&&(m[v]=s.a5.colorTheme[v].default);const _=new s.a6(Of,n,new Map(f));return _.setTransitionOrValue(m,f),_.untransitioned().possiblyEvaluate(new s.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,f)=>{const m="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let _=t;_.startsWith(m)||(_=m+_);const v=s.I.from("mapbox-reserved-lut"),w=new Image;w.src=_,w.onerror=()=>{this._styleColorTheme.lutLoading=!1,f(new Error("Failed to load image data"))},w.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void u();this._styleColorTheme.lutLoading=!1;const{width:E,height:A,data:P}=s.q.getImageData(w);if(A>32)return void f(new Error("The height of the image must be less than or equal to 32 pixels."));if(E!==A*A)return void f(new Error("The width of the image must be equal to the height squared."));this.getImage(v)&&this.removeImage(v),this.addImage(v,{data:new s.r({width:E,height:A},P),pixelRatio:1,sdf:!1,usvg:!1,version:0});const M=this.imageManager.getImage(v,this.scope);M?(this._styleColorTheme.lut={image:M.data,data:t},u()):f(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,u,f){let m,_,v;const w=s.q.devicePixelRatio>1?"@2x":"";let E=s.n(u.transformRequest(u.normalizeSpriteURL(n,w,".json"),s.R.SpriteJSON),(M,k)=>{E=null,v||(v=M,m=k,P())}),A=s.o(u.transformRequest(u.normalizeSpriteURL(n,w,".png"),s.R.SpriteImage),(M,k)=>{A=null,v||(v=M,_=k,P())});function P(){if(v)f(v);else if(m&&_){const M=s.q.getImageData(_),k={};for(const q in m){const{width:V,height:$,x:U,y:ee,sdf:se,pixelRatio:ae,stretchX:xe,stretchY:ye,content:me}=m[q],he=new s.r({width:V,height:$});s.r.copy(M,he,{x:U,y:ee},{x:0,y:0},{width:V,height:$},null),k[q]={data:he,pixelRatio:ae,sdf:se,stretchX:xe,stretchY:ye,content:me,usvg:!1}}f(null,k)}}return{cancel(){E&&(E.cancel(),E=null),A&&(A.cancel(),A=null)}}}(t,this.map._requestManager,(n,u)=>{if(this._spriteRequest=null,n)this.fire(new s.z(n));else if(u){const f=new Map;for(const m in u)f.set(s.I.from(m),u[m]);this.addImages(f)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))})}addIconset(t,n){if(n.type==="sprite")return void this._loadSprite(n.url);const u=this.getOwnSourceCache(n.source);if(!u)return void this.fire(new s.z(new Error(`Source "${n.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const f=u.getSource();if(f.type!=="raster-array")return void this.fire(new s.z(new Error(`Source "${n.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));f.partial=!1;const m=new ka(t,this.scope,u);this.imageManager.addImageProvider(m,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var u,f;this._spriteRequest=(f=(m,_)=>{if(this._spriteRequest=null,m)n?this._loadSprite(t):this.fire(new s.z(m));else if(_){const v=new Map;for(const w in _)v.set(s.I.from(w),_[w]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.A("data",{dataType:"style"}))},s.br((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),s.R.Iconset),(m,_)=>{if(m)return void f(m);const v={},w=s.c_(new s.bq(_));for(const E of w.icons){const A={version:1,pixelRatio:s.q.devicePixelRatio,content:pp(E),stretchX:E.metadata?Yh(E.metadata.stretch_x_areas):void 0,stretchY:E.metadata?Yh(E.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:E};v[E.name]=A}f(null,v)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const u=t.sourceLayer;u&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(u)===-1)&&this.fire(new s.z(new Error(`Source layer "${u}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const u=this.fragments[n];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const u=this._sourceCaches[n].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const n=[];for(const u of t){const f=this._layers[u];f&&f.type!=="custom"&&n.push(f.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new s.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new s.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const u=this.map.painter;if(u)for(let f=t.minzoom||0;f<(t.maxzoom||25.5);f++){const m=t.getProgramIds();if(m)for(const _ of m){const v=t.getDefaultProgramParams(_,n.zoom,this._styleColorTheme.lut);v&&(u.style=this,this.fog&&(u._fogVisible=!0,v.overrideFog=!0,u.getOrCreateProgram(_,v)),u._fogVisible=!1,v.overrideFog=!1,u.getOrCreateProgram(_,v),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(v.overrideRtt=!0,u.getOrCreateProgram(_,v)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));const u=this._changes.isDirty();let f=!1;if(this._changes.isDirty()){const v=this._changes.getLayerUpdatesByScope();for(const w in v){const{updatedIds:E,removedIds:A}=v[w];(E||A)&&(this._updateWorkerLayers(w,E,A),f=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const m={};for(const v in this._mergedSourceCaches){const w=this._mergedSourceCaches[v];m[v]=w.used,w.used=!1,w.tileCoverLift=0}for(const v of this._mergedOrder){const w=this._mergedLayers[v];if(w.recalculate(t,this._availableImages),!w.isHidden(t.zoom)){const E=this.getLayerSourceCache(w);E&&(E.used=!0,E.tileCoverLift=Math.max(E.tileCoverLift,w.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(w,t)}):this.precompilePrograms(w,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&f&&this.mergeLayers();const _=this.imageManager.getPendingImageProviders();for(const v of _)v.sourceCache.used=!0;for(const v in m){const w=this._mergedSourceCaches[v];m[v]!==w.used&&w.getSource().fire(new s.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new s.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const n of t){const u=n.resolvePendingRequests(),f=this.getFragmentStyle(n.scope);f&&f.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const n in this._mergedSourceCaches){const u=this._mergedSourceCaches[n].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const n in t)this._changes.resetUpdatedImages(n)}_updateWorkerLayers(t,n,u){const f=this.getFragmentStyle(t);f&&this.dispatcher.broadcast("updateLayers",{layers:n?f._serializeLayers(n):[],scope:t,removedIds:u||[],options:f.options})}setState(t,n){if(this._checkLoaded(),La(this,so(t)))return!1;(t=s.d7(t)).layers=sa(t.layers);const u=function(_,v){if(!_)return[{command:ki.setStyle,args:[v]}];let w=[];try{if(!s.bv(_.version,v.version))return[{command:ki.setStyle,args:[v]}];if(s.bv(_.center,v.center)||w.push({command:ki.setCenter,args:[v.center]}),s.bv(_.zoom,v.zoom)||w.push({command:ki.setZoom,args:[v.zoom]}),s.bv(_.bearing,v.bearing)||w.push({command:ki.setBearing,args:[v.bearing]}),s.bv(_.pitch,v.pitch)||w.push({command:ki.setPitch,args:[v.pitch]}),s.bv(_.sprite,v.sprite)||w.push({command:ki.setSprite,args:[v.sprite]}),s.bv(_.glyphs,v.glyphs)||w.push({command:ki.setGlyphs,args:[v.glyphs]}),s.bv(_.imports,v.imports)||function(k=[],q=[],V){q=q||[];const $=(k=k||[]).map(Ys),U=q.map(Ys),ee=k.reduce(Mn,{}),se=q.reduce(Mn,{}),ae=$.slice();let xe,ye,me,he;for(xe=0,ye=0;xe<$.length;xe++)me=$[xe],se.hasOwnProperty(me)?ye++:(V.push({command:ki.removeImport,args:[me]}),ae.splice(ae.indexOf(me,ye),1));for(xe=0,ye=0;xe<U.length;xe++)me=U[U.length-1-xe],ae[ae.length-1-xe]!==me&&(ee.hasOwnProperty(me)?(V.push({command:ki.removeImport,args:[me]}),ae.splice(ae.lastIndexOf(me,ae.length-ye),1)):ye++,he=ae[ae.length-xe],V.push({command:ki.addImport,args:[se[me],he]}),ae.splice(ae.length-xe,0,me));for(const Te of q){const Ae=ee[Te.id];Ae&&!s.bv(Ae,Te)&&V.push({command:ki.updateImport,args:[Te.id,Te]})}}(_.imports,v.imports,w),s.bv(_.transition,v.transition)||w.push({command:ki.setTransition,args:[v.transition]}),s.bv(_.light,v.light)||w.push({command:ki.setLight,args:[v.light]}),s.bv(_.fog,v.fog)||w.push({command:ki.setFog,args:[v.fog]}),s.bv(_.snow,v.snow)||w.push({command:ki.setSnow,args:[v.snow]}),s.bv(_.rain,v.rain)||w.push({command:ki.setRain,args:[v.rain]}),s.bv(_.projection,v.projection)||w.push({command:ki.setProjection,args:[v.projection]}),s.bv(_.lights,v.lights)||w.push({command:ki.setLights,args:[v.lights]}),s.bv(_.camera,v.camera)||w.push({command:ki.setCamera,args:[v.camera]}),s.bv(_.iconsets,v.iconsets)||function(k,q,V){let $;for($ in q=q||{},k=k||{})k.hasOwnProperty($)&&(q.hasOwnProperty($)||V.push({command:ki.removeIconset,args:[$]}));for($ in q){if(!q.hasOwnProperty($))continue;const U=q[$];k.hasOwnProperty($)?s.bv(k[$],U)||(V.push({command:ki.removeIconset,args:[$]}),V.push({command:ki.addIconset,args:[$,U]})):V.push({command:ki.addIconset,args:[$,U]})}}(_.iconsets,v.iconsets,w),!s.bv(_["color-theme"],v["color-theme"]))return[{command:ki.setStyle,args:[v]}];const E={},A=[];(function(k,q,V,$){let U;for(U in q=q||{},k=k||{})k.hasOwnProperty(U)&&(q.hasOwnProperty(U)||Ta(U,V,$));for(U in q){if(!q.hasOwnProperty(U))continue;const ee=q[U];k.hasOwnProperty(U)?s.bv(k[U],ee)||(k[U].type==="geojson"&&ee.type==="geojson"&&aa(k,q,U)?V.push({command:ki.setGeoJSONSourceData,args:[U,ee.data]}):Vd(U,q,V,$)):Bl(U,q,V)}})(_.sources,v.sources,A,E);const P=[];_.layers&&_.layers.forEach(k=>{k.source&&E[k.source]?w.push({command:ki.removeLayer,args:[k.id]}):P.push(k)});let M=_.terrain;M&&E[M.source]&&(w.push({command:ki.setTerrain,args:[void 0]}),M=void 0),w=w.concat(A),s.bv(M,v.terrain)||w.push({command:ki.setTerrain,args:[v.terrain]}),function(k,q,V){q=q||[];const $=(k=k||[]).map(Ys),U=q.map(Ys),ee=k.reduce(Mn,{}),se=q.reduce(Mn,{}),ae=$.slice(),xe=Object.create(null);let ye,me,he,Te,Ae,rt,Ge;for(ye=0,me=0;ye<$.length;ye++)he=$[ye],se.hasOwnProperty(he)?me++:(V.push({command:ki.removeLayer,args:[he]}),ae.splice(ae.indexOf(he,me),1));for(ye=0,me=0;ye<U.length;ye++)he=U[U.length-1-ye],ae[ae.length-1-ye]!==he&&(ee.hasOwnProperty(he)?(V.push({command:ki.removeLayer,args:[he]}),ae.splice(ae.lastIndexOf(he,ae.length-me),1)):me++,rt=ae[ae.length-ye],V.push({command:ki.addLayer,args:[se[he],rt]}),ae.splice(ae.length-ye,0,he),xe[he]=!0);for(ye=0;ye<U.length;ye++)if(he=U[ye],Te=ee[he],Ae=se[he],!xe[he]&&!s.bv(Te,Ae))if(s.bv(Te.source,Ae.source)&&s.bv(Te["source-layer"],Ae["source-layer"])&&s.bv(Te.type,Ae.type)){for(Ge in Xs(Te.layout,Ae.layout,V,he,null,ki.setLayoutProperty),Xs(Te.paint,Ae.paint,V,he,null,ki.setPaintProperty),s.bv(Te.slot,Ae.slot)||V.push({command:ki.setSlot,args:[he,Ae.slot]}),s.bv(Te.filter,Ae.filter)||V.push({command:ki.setFilter,args:[he,Ae.filter]}),s.bv(Te.minzoom,Ae.minzoom)&&s.bv(Te.maxzoom,Ae.maxzoom)||V.push({command:ki.setLayerZoomRange,args:[he,Ae.minzoom,Ae.maxzoom]}),Te)Te.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Xs(Te[Ge],Ae[Ge],V,he,Ge.slice(6),ki.setPaintProperty):s.bv(Te[Ge],Ae[Ge])||V.push({command:ki.setLayerProperty,args:[he,Ge,Ae[Ge]]}));for(Ge in Ae)Ae.hasOwnProperty(Ge)&&!Te.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Xs(Te[Ge],Ae[Ge],V,he,Ge.slice(6),ki.setPaintProperty):s.bv(Te[Ge],Ae[Ge])||V.push({command:ki.setLayerProperty,args:[he,Ge,Ae[Ge]]}))}else V.push({command:ki.removeLayer,args:[he]}),rt=ae[ae.lastIndexOf(he)+1],V.push({command:ki.addLayer,args:[Ae,rt]})}(P,v.layers,w)}catch(E){console.warn("Unable to compute style diff:",E),w=[{command:ki.setStyle,args:[v]}]}return w}(this.serialize(),t).filter(_=>!(_.command in Ud));if(u.length===0)return!1;const f=u.filter(_=>!(_.command in jd));if(f.length>0)throw new Error(`Unimplemented: ${f.map(_=>_.command).join(", ")}.`);const m=[];return u.forEach(_=>{m.push(this[_.command](..._.args))}),n&&Promise.all(m).then(n).catch(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[n,u]of t.entries()){if(this.getImage(n))return this.fire(new s.z(new Error(`An image with the name "${n.name}" already exists.`)));this.imageManager.addImage(n,this.scope,u),this._changes.updateImage(n,this.scope)}return this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this}addImage(t,n){return this.getImage(t)?this.fire(new s.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,n),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this)}updateImage(t,n,u=!1){this.imageManager.updateImage(t,this.scope,n),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.A("data",{dataType:"style"})),this}addModel(t,n,u={}){return this._checkLoaded(),this._validate(Me,`models.${t}`,n,null,u)||(this.modelManager.addModel(t,n,this.scope),this.fire(new s.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new s.A("data",{dataType:"style"})),this):this.fire(new s.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,n,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(xr,`sources.${t}`,n,null,u))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const f=As(t,n,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id}));const m=_=>{const v=(_?"symbol:":"other:")+f.id,w=s.C(v,this.scope),E=this._sourceCaches[v]=new Hn(w,f,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=E,E.onAdd(this.map)};m(!1),n.type!=="vector"&&n.type!=="geojson"||m(!0),f.onAdd&&f.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const f=Object.entries(this.stylesheet.iconsets).find(([m,_])=>_.type==="source"&&_.source===t);if(f)return this.fire(new s.z(new Error(`Source "${t}" cannot be removed while iconset "${f[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const f of u){const m=s.d8(f.id);delete this._sourceCaches[m],this._changes.discardSourceCacheUpdate(f.id),f.fire(new s.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const u=this.getOwnSourceCache(n);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const u=t[n]._tiles;for(const f in u){const m=u[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const f of t){if(this._validate(un,"lights",f))return;switch(f.type){case"ambient":if(this.ambientLight){const m=this.ambientLight;m.set(f),m.updateTransitions(n)}else this.ambientLight=new wn(f,Wi||(Wi=new s.a7({color:new s.a8(s.a5.properties_light_ambient.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const m=this.directionalLight;m.set(f),m.updateTransitions(n)}else this.directionalLight=new wn(f,Mi||(Mi=new s.a7({direction:new s.an(s.a5.properties_light_directional.direction),color:new s.a8(s.a5.properties_light_directional.color),"color-use-theme":new s.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.a8(s.a5.properties_light_directional.intensity),"cast-shadows":new s.a8(s.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new s.a8(s.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.a8(s.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=new s.aa(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(u),this.directionalLight&&this.directionalLight.recalculate(u),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const u=M=>.2126*(M[0]<=.03928?M[0]/12.92:Math.pow((M[0]+.055)/1.055,2.4))+.7152*(M[1]<=.03928?M[1]/12.92:Math.pow((M[1]+.055)/1.055,2.4))+.0722*(M[2]<=.03928?M[2]/12.92:Math.pow((M[2]+.055)/1.055,2.4)),f=t.properties.get("color").toRenderColor(null).toArray01(),m=t.properties.get("intensity"),_=t.properties.get("direction"),v=1-s.cR(_.x,_.y,_.z)[2]/90,w=u(f)*m*v,E=n.properties.get("color").toRenderColor(null).toArray01(),A=n.properties.get("intensity"),P=u(E)*A;return Number(((w+P)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.d9(t)){const n=s.da(t),u=this.fragments.find(({id:m})=>m===n);if(!u)return;const f=s.d8(t);return u.style.getFragmentStyle(f)}{const n=this.fragments.find(({id:u})=>u===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},u=(f,m="")=>`${f}::${m}`;this._featuresetSelectors={};for(const f in t){const m=this._featuresetSelectors[f]=[];for(const _ of t[f].selectors){if(_.featureNamespace){const w=this.getOwnLayer(_.layer);if(!w){s.w(`Layer is undefined for selector: ${_.layer}`);continue}const E=u(w.source,w.sourceLayer);if(E in n&&n[E]!==_.featureNamespace){s.w(`"featureNamespace ${_.featureNamespace} of featureset ${f}'s selector is not associated to the same source, skip this selector`);continue}n[E]=_.featureNamespace}let v;if(_.properties)for(const w in _.properties){const E=s.X(_.properties[w]);E.result==="success"&&(v=v||{},v[w]=E.value)}m.push({layerId:_.layer,namespace:_.featureNamespace,properties:v,uniqueFeatureID:_._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const u=[];for(const f in n.stylesheet.featuresets)u.push({featuresetId:f,importId:n.scope?n.scope:void 0});return u}getFeaturesetLayers(t,n){const u=this.getFragmentStyle(n),f=u.stylesheet.featuresets;if(!f||!f[t])return this.fire(new s.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const m=[];for(const _ of f[t].selectors){const v=u.getOwnLayer(_.layer);v&&m.push(v)}return m}getConfigProperty(t,n){const u=this.getFragmentStyle(t);if(!u)return null;const f=s.C(n,u.scope),m=u.options.get(f),_=m?m.value||m.default:null;return _?_.serialize():null}setConfigProperty(t,n,u){const f=this.getFragmentStyle(t);if(!f)return;const m=f.stylesheet.indoor?Ff(f.stylesheet.schema):f.stylesheet.schema;if(!m||!m[n])return;const _=s.X(u);if(_.result!=="success")return void La(this,_.value);const v=_.value.expression,w=s.C(n,f.scope),E=f.options.get(w);if(!E)return;let A;const{minValue:P,maxValue:M,stepValue:k,type:q,values:V}=m[n],$=s.X(m[n].default);$.result==="success"&&(A=$.value.expression),A?(this.options.set(w,Object.assign({},E,{value:v,default:A,minValue:P,maxValue:M,stepValue:k,type:q,values:V})),this.updateConfigDependencies(n)):this.fire(new s.z(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const u=n.stylesheet.schema;if(!u)return null;const f={};for(const m in u){const _=s.C(m,n.scope),v=n.options.get(_),w=v?v.value||v.default:null;f[m]=w?w.serialize():null}return f}setConfig(t,n){const u=this.getFragmentStyle(t);u&&(u.updateConfig(n,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=n,u.updateConfig(u._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const u in n){let f,m;const _=s.X(n[u].default);if(_.result==="success"&&(f=_.value.expression),t&&t[u]!==void 0){const M=s.X(t[u]);M.result==="success"&&(m=M.value.expression)}const{minValue:v,maxValue:w,stepValue:E,type:A,values:P}=n[u];if(f){const M=s.C(u,this.scope);this.options.set(M,{default:f,value:m,minValue:v,maxValue:w,stepValue:E,type:A,values:P})}else this.fire(new s.z(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new s.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const n of this._configDependentLayers){const u=this.getLayer(n);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const u=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(u){const f=n._evaluateColorThemeData(u);(!n._styleColorTheme.lut&&f!==""||n._styleColorTheme.lut&&f!==n._styleColorTheme.lut.data)&&n.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,n,u={}){this._checkLoaded();const f=t.id;if(this._layers[f])return void this.fire(new s.z(new Error(`Layer with id "${f}" already exists on this map`)));let m;if(t.type==="custom"){if(La(this,s.db(t)))return;m=s.dc(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=s.d7(t),t=s.l(t,{source:f})),this._validate(G,`layers.${f}`,t,{arrayIndex:-1},u))return;m=s.dc(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(m),m.setEventedParent(this,{layer:{id:f}})}m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid);let _=this._order.length;if(n){const A=this._order.indexOf(n);if(A===-1)return void this.fire(new s.z(new Error(`Layer with id "${n}" does not exist on this map.`)));m.slot===this._layers[n].slot?_=A:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,f),this._layerOrderChanged=!0,this._layers[f]=m;const v=this.getOwnLayerSourceCache(m),w=!!this.directionalLight&&this.directionalLight.shadowsEnabled();v&&m.canCastShadows()&&w&&(v.castsShadows=!0);const E=this._changes.getRemovedLayer(m);if(E&&m.source&&v&&m.type!=="custom"){this._changes.discardLayerRemoval(m);const A=s.C(m.source,m.scope);E.type!==m.type?this._changes.updateSourceCache(A,"clear"):(this._changes.updateSourceCache(A,"reload"),v.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),m.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===n)return;const f=this._order.indexOf(t);this._order.splice(f,1);let m=this._order.length;if(n){const _=this._order.indexOf(n);if(_===-1)return void this.fire(new s.z(new Error(`Layer with id "${n}" does not exist on this map.`)));u.slot===this._layers[n].slot?m=_:s.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(m,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const f=this.getOwnLayerSourceCache(n);if(f&&f.castsShadows){let m=!1;for(const _ in this._layers)if(this._layers[_].source===n.source&&this._layers[_].canCastShadows()){m=!0;break}f.castsShadows=m}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,u){this._checkLoaded();const f=this._checkLayer(t);f&&(f.minzoom===n&&f.maxzoom===u||(n!=null&&(f.minzoom=n),u!=null&&(f.maxzoom=u),this._updateLayer(f)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==n&&(u.slot=n,this._updateLayer(u))}setFilter(t,n,u={}){this._checkLoaded();const f=this._checkLayer(t);if(f&&!s.bv(f.filter,n))return n==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(K,`layers.${f.id}.filter`,n,{layerType:f.type},u)||(f.filter=s.d7(n),this._updateLayer(f)))}getFilter(t){const n=this._checkLayer(t);if(n)return s.d7(n.filter)}setLayoutProperty(t,n,u,f={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!s.bv(m.getLayoutProperty(n),u)){if(u!=null&&(!f||f.validate!==!1)&&La(m,Ce.call(so,{key:`layers.${t}.layout.${n}`,layerType:m.type,objectKey:n,value:u,styleSpec:s.a5,style:{glyphs:!0,sprite:!0}})))return;m.setLayoutProperty(n,u),m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),this._updateLayer(m)}}getLayoutProperty(t,n){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(n)}setPaintProperty(t,n,u,f={}){this._checkLoaded();const m=this._checkLayer(t);if(!m||s.bv(m.getPaintProperty(n),u)||u!=null&&(!f||f.validate!==!1)&&La(m,ge.call(so,{key:`layers.${t}.paint.${n}`,layerType:m.type,objectKey:n,value:u,styleSpec:s.a5})))return;const _=m.setPaintProperty(n,u);m.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),_&&this._updateLayer(m),this._changes.updatePaintProperties(m)}getPaintProperty(t,n){const u=this._checkLayer(t);if(u)return u.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:w,importId:E}=t.target,A=this.getFragmentStyle(E),P=A.getFeaturesetLayers(w);for(const{source:M,sourceLayer:k}of P)A.setFeatureState({id:t.id,source:M,sourceLayer:k},n)}else if("layerId"in t.target){const{layerId:w}=t.target,E=this.getLayer(w);this.setFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer},n)}return}const u=t.source,f=t.sourceLayer,m=this._checkSource(u);if(!m)return;const _=m.type;if(_==="geojson"&&f)return void this.fire(new s.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!f)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided.")));const v=this.getOwnSourceCaches(u);for(const w of v)w.setFeatureState(f,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:w,importId:E}=t.target,A=this.getFragmentStyle(E),P=A.getFeaturesetLayers(w);for(const{source:M,sourceLayer:k}of P)A.removeFeatureState({id:t.id,source:M,sourceLayer:k},n)}else if("layerId"in t.target){const{layerId:w}=t.target,E=this.getLayer(w);this.removeFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer},n)}return}const u=t.source,f=this._checkSource(u);if(!f)return;const m=f.type,_=m==="vector"?t.sourceLayer:void 0;if(m==="vector"&&!_)return void this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.z(new Error("A feature id is required to remove its specific state property.")));const v=this.getOwnSourceCaches(u);for(const w of v)w.removeFeatureState(_,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let m;if("featuresetId"in t.target){const{featuresetId:_,importId:v}=t.target,w=this.getFragmentStyle(v),E=w.getFeaturesetLayers(_);for(const{source:A,sourceLayer:P}of E){const M=w.getFeatureState({id:t.id,source:A,sourceLayer:P});if(M&&!m)m=M;else if(!s.bv(m,M))return void this.fire(new s.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:_}=t.target,v=this.getLayer(_);m=this.getFeatureState({id:t.id,source:v.source,sourceLayer:v.sourceLayer})}return m}const n=t.source,u=t.sourceLayer,f=this._checkSource(n);if(f){if(f.type!=="vector"||u)return t.id===void 0&&this.fire(new s.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(u,t.id);this.fire(new s.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=s.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return s.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.dd({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),u=s.C(t.source,t.scope),f=this._changes.getUpdatedSourceCaches();t.source&&!f[u]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=v=>this._mergedLayers[v].is3D(!!this.terrain),u=this.order,f={},m=[];for(let v=u.length-1;v>=0;v--){const w=u[v];if(n(w)){f[w]=v;for(const E of t){const A=E[w];if(A)for(const P of A)m.push(P)}}}m.sort((v,w)=>w.intersectionZ-v.intersectionZ);const _=[];for(let v=u.length-1;v>=0;v--){const w=u[v];if(n(w))for(let E=m.length-1;E>=0;E--){const A=m[E].feature;if(A.layer&&f[A.layer.id]<v)break;_.push(A),m.pop()}else for(const E of t){const A=E[w];if(A)for(const P of A)_.push(P.feature)}}return _}queryRenderedFeatures(t,n,u){let f;n&&!Array.isArray(n)&&n.filter&&(this._validate(K,"queryRenderedFeatures.filter",n.filter,null,n),f=s.b3(n.filter));const m={},_=A=>{if(ml.has(A.type))return;const P=this.getOwnLayerSourceCache(A),M=m[P.id]=m[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};A.is3D(!!this.terrain)&&(M.has3DLayers=!0),M.layers[A.fqid]=M.layers[A.fqid]||{styleLayer:A,targets:[]},M.layers[A.fqid].targets.push({filter:f})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new s.z(new Error("parameters.layers must be an Array."))),[];for(const A of n.layers){const P=this._layers[A];if(!P)return this.fire(new s.z(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];_(P)}}else for(const A in this._layers)_(this._layers[A]);const v=this._queryRenderedFeatures(t,m,u),w=this._flattenAndSortRenderedFeatures(v),E=[];for(const A of w)s.de(A.layer.id)===this.scope&&E.push(A);return E}queryRenderedFeatureset(t,n,u){let f;n&&!Array.isArray(n)&&n.filter&&(this._validate(K,"queryRenderedFeatures.filter",n.filter,null,n),f=s.b3(n.filter));const m="mock",_=[];if(n&&n.target)_.push(Object.assign({},n,{targetId:m,filter:f}));else{const A=this.getFeaturesetDescriptors();for(const P of A)_.push({targetId:m,filter:f,target:P});for(const{style:P}of this.fragments){const M=P.getFeaturesetDescriptors();for(const k of M)_.push({targetId:m,filter:f,target:k})}}const v=this.queryRenderedTargets(t,_,u),w=[],E=new Set;for(const A of v)for(const P of A.variants[m])Zs(P,A,E)||w.push(new s.df(A,P));return w}queryRenderedTargets(t,n,u){const f={},m=(v,w,E,A)=>{const P=f[w.id]=f[w.id]||{sourceCache:w,layers:{},has3DLayers:!1};if(P.layers[v.fqid]=P.layers[v.fqid]||{styleLayer:v,targets:[]},v.is3D(!!this.terrain)&&(P.has3DLayers=!0),!A)return E.uniqueFeatureID=!1,void P.layers[v.fqid].targets.push(E);P.layers[v.fqid].targets.push(Object.assign({},E,{namespace:A.namespace,properties:A.properties,uniqueFeatureID:A.uniqueFeatureID}))};for(const v of n)if("featuresetId"in v.target){const{featuresetId:w,importId:E}=v.target,A=this.getFragmentStyle(E);if(!A||!A._featuresetSelectors)continue;const P=A._featuresetSelectors[w];if(!P){this.fire(new s.z(new Error(`The featureset '${w}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const M of P){const k=A.getOwnLayer(M.layerId);k&&!ml.has(k.type)&&m(k,A.getOwnLayerSourceCache(k),v,M)}}else if("layerId"in v.target){const{layerId:w}=v.target,E=this.getLayer(w);if(!E||ml.has(E.type))continue;m(E,this.getLayerSourceCache(E),v)}const _=this._queryRenderedFeatures(t,f,u);return this._flattenAndSortRenderedFeatures(_)}_queryRenderedFeatures(t,n,u){const f=[],m=!!this.map._showQueryGeometry,_=On.createFromScreenPoints(t,u);for(const v in n){const w=Cs(_,n[v],this._availableImages,u,m);Object.keys(w).length&&f.push(w)}if(this.placement)for(const v in n){if(!n[v].sourceCache._onlySymbols)continue;const w=j(_.screenGeometry,n[v],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(w).length&&f.push(w)}return f}querySourceFeatures(t,n){const u=n&&n.filter;u&&this._validate(K,"querySourceFeatures.filter",u,null,n);let f=[];const m=this.getOwnSourceCaches(t);for(const _ of m)f=f.concat(te(_,n));return f}addSourceType(t,n,u){return za.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(za.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,u={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const v in t)if(!s.bv(t[v],f[v])){m=!0;break}if(!m)return;const _=this._getTransitionParameters();this.light.setLight(t,n,u),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const f=t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const v="terrain-dem-src";this.addSource(v,u.source),u=s.d7(u),u=s.l(u,{source:v})}const m=s.l({},u),_={};if(this.terrain&&f){m.source=this.terrain.get().source;const v=this.terrain?this.getFragmentStyle(this.terrain.scope):null;v&&(_.style=v.serialize())}if(this._validate(Ot,"terrain",m,_))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&n!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,n),this.fire(new s.A("data",{dataType:"style"}))}else{const m=this.terrain,_=m.get();for(const v of Object.keys(s.a5.terrain))!u.hasOwnProperty(v)&&s.a5.terrain[v].default&&(u[v]=s.a5.terrain[v].default);for(const v in t)if(!s.bv(t[v],_[v])){m.set(t,this.options),this.stylesheet.terrain=t;const w=this._getTransitionParameters({duration:0});m.updateTransitions(w),this.fire(new s.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new Xr(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createSnow(t){const n=this.snow=new ii(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_createRain(t){const n=this.rain=new Pi(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!s.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!s.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!s.bv(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const u=this._getTransitionParameters({duration:0});n.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const f in this._layers)this._layers[f].lut=this._styleColorTheme.lut;for(const f in this._sourceCaches)this._sourceCaches[f].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(n);this._loadColorTheme(u).then(()=>{this.fire(new s.A("colorthemeset")),t()}).catch(f=>{s.w(`Couldn't set color theme: ${f}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=n,u._reloadColorTheme())}_getTransitionParameters(t){return{now:s.q.now(),transition:s.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):n.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const u=this.terrain=new _t(t,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const f=this._getTransitionParameters({duration:0});u.updateTransitions(f)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,u,f,m={}){if(m&&m.validate===!1)return!1;const _=s.l({},this.serialize());return La(this,t.call(so,s.l({key:n,style:_,value:u,styleSpec:s.a5},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dg.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const u of n)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const n=this.getSourceCaches(t);for(const u of n)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=sh(this.directionalLight));const u=new Set;for(const f in this._mergedLayers){const m=this._mergedLayers[f];m.hasElevation()&&!u.has(m.source)&&u.add(m.source)}for(const f in this._mergedSourceCaches){const m=this._mergedSourceCaches[f],_=u.has(m._source.id);m.update(t,void 0,void 0,n,_)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,u,f,m,_,v=!1){let w=!1,E=!1;const A={},P={};for(const M of this._mergedOrder){const k=this._mergedLayers[M];if(k.type!=="symbol")continue;const q=s.C(k.source,k.scope);let V=A[q];if(!V){const U=this.getLayerSourceCache(k);if(!U)continue;const ee=U.getRenderableIds(!0).map(se=>U.getTileByID(se));P[q]=ee.slice(),V=A[q]=ee.sort((se,ae)=>ae.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(ae.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(k,V,n.center.lng,n.projection);w=w||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||f===0,this._layerOrderChanged&&this.fire(new s.A("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.q.now(),n.zoom))&&(this.pauseablePlacement=new N(n,this._mergedOrder,v,u,f,m,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,A,P,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.q.now()),E=!0),w&&this.pauseablePlacement.placement.setStale()),E||w){this._buildingIndex.onNewFrame(n.zoom);for(let M=0;M<this._mergedOrder.length;M++){const k=this._mergedLayers[this._mergedOrder[M]];if(k.type!=="symbol")continue;const q=this.isLayerClipped(k);this.placement.updateLayerOpacities(k,A[s.C(k.source,k.scope)],M,q?_:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:m})=>m===t.id)!==-1)return void this.fire(new s.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return u.push(t),this._loadImports([t],!0);const f=u.findIndex(({id:m})=>m===n);return f===-1&&this.fire(new s.z(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,f).concat(t).concat(u.slice(f)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],f=this.getImportIndex(t);return f===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==u[f].url&&this.setImportUrl(t,n.url),s.bv(n.config,u[f].config)||this.setImportConfig(t,n.config,n.data.schema),s.bv(n.data,u[f].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let u=this.stylesheet.imports||[];const f=this.getImportIndex(t);if(f===-1)return this;const m=this.getImportIndex(n);if(m===-1)return this;const _=u[f],v=this.fragments[f];return u=u.filter(({id:w})=>w!==t),this.fragments=this.fragments.filter(({id:w})=>w!==t),this.stylesheet.imports=u.slice(0,m).concat(_).concat(u.slice(m)),this.fragments=this.fragments.slice(0,m).concat(v).concat(this.fragments.slice(m)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const u=this.stylesheet.imports||[],f=this.getImportIndex(t);if(f===-1)return this;u[f].url=n;const m=this.fragments[f];return m.style=this._createFragmentStyle(u[f]),m.style.on("style.import.load",()=>this.mergeAll()),m.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const u=this.getImportIndex(t),f=this.stylesheet.imports||[];return u===-1?this:n?(this.fragments[u].style.setState(n),this._reloadImports(),this):(delete f[u].data,this.setImportUrl(t,f[u].url))}setImportConfig(t,n,u){this._checkLoaded();const f=this.getImportIndex(t),m=this.stylesheet.imports||[];if(f===-1)return this;n?m[f].config=n:delete m[f].config;const _=this.fragments[f];u&&_.style.stylesheet&&(_.style.stylesheet.schema=u);const v=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=n,_.style.updateConfig(n,v),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(n.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return n===-1&&this.fire(new s.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[n];u&&t.push(u.getSource())}return t}getSource(t,n){const u=this.getSourceCache(t,n);return u&&u.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const u=s.C(t,n);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const n=s.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const u=t[n];u==="reload"?this.reloadSource(n):u==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const u of n){const f=this.getLayer(u);f&&f.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,n,u){this.imageManager.getImages(n.images,n.scope,u),this._updateTilesForChangedImages();const f=_=>{if(_){const v=n.images.map(w=>s.I.toString(w));_.setDependencies(n.tileID.key,n.type,v)}},m=s.C(n.source,n.scope);f(this._mergedOtherSourceCaches[m]),f(this._mergedSymbolSourceCaches[m])}rasterizeImages(t,n,u){this.imageManager.rasterizeImages(n,u)}getGlyphs(t,n,u){this.glyphManager.getGlyphs(n.stacks,n.scope,u)}getResource(t,n,u){return s.dh(n,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new s.z(new Error(`There is no source with ID '${t}'`))),!1):n.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(u||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}za.getSourceType=function(l){return $a[l]},za.setSourceType=function(l,t){$a[l]=t},za.registerForPluginStateChange=s.c$;var wc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qa=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,lh=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,fu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Vs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,uh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Wt=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,pu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Sc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ch=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Tc=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const mu=[];fa(wc,mu),fa(lh,mu),fa(Qa,mu);const da={"_prelude_fog.vertex.glsl":uh,"_prelude_terrain.vertex.glsl":Vs,"_prelude_shadow.vertex.glsl":ch,"_prelude_fog.fragment.glsl":Wt,"_prelude_shadow.fragment.glsl":Tc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":pu,"_prelude_raster_particle.glsl":Sc},Bu={};Ci("",Vs),Ci(Wt,uh),Ci(Tc,ch),Ci(pu,""),Ci(Sc,"");const ql=Ci(Qa,lh),Ec=wc;var gu={background:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);color*=u_opacity;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=vec4(linearTosRGB(color.rgb),color.a);
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ci("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ci(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ci("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ci("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ci(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ci(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
void main() {vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,normal);
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(v_normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ci(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ci(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ci(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ci("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ci("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ci(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ci(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(abs(v_z_offset) > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ci("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ci(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,fu),skyboxGradient:Ci(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,fu),skyboxCapture:Ci(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ci(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ci(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ci(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ci(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ci("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ci("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ci("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ci("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function fa(l,t){const n=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of n)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=u.split(" ");for(const m of f)t.includes(m)||t.push(m)}}function Ci(l,t){const n=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let f=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);f&&(f=f.map(E=>{const A=E.split(" ");return A[A.length-1]}),f=[...new Set(f)]);const m={},_=[],v=[];if(l=l.replace(n,(E,A)=>(v.push(A),"")),(t=t.replace(n,(E,A)=>(_.push(A),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let w=[...mu];fa(l,w),fa(t,w);for(const E of[..._,...v])da[E]||console.error(`Undefined include: ${E}`),Bu[E]||(Bu[E]=[],fa(da[E],Bu[E])),w=[...w,...Bu[E]];return{fragmentSource:l=l.replace(u,(E,A,P,M,k)=>(m[k]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${k}
in ${P} ${M} ${k};
#else
uniform ${P} ${M} u_${k};
#endif
`:A==="initialize"?`
#ifdef HAS_UNIFORM_u_${k}
    ${P} ${M} ${k} = u_${k};
#endif
`:A==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    in ${P} ${M} ${k};
#endif
`:A==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(E,A,P,M,k)=>{const q=M==="float"?"vec2":M,V=k.match(/color/)?"color":q;return A==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${k}
in ${P} ${M} a_${k};
#endif
`:m[k]?A==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${P} ${q} a_${k};
out ${P} ${M} ${k};
#else
uniform ${P} ${M} u_${k};
#endif
`:A==="initialize"?V==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = a_${k};
#else
    ${P} ${M} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${k} = unpack_mix_${V}(a_${k}, u_${k}_t);
#else
    ${P} ${M} ${k} = u_${k};
#endif
`:A==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    in ${P} ${M} a_${k};
    out ${P} ${M} ${k};
#endif
`:A==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    ${k} = a_${k};
#endif
`:void 0:A==="define"?`
#ifndef HAS_UNIFORM_u_${k}
uniform lowp float u_${k}_t;
in ${P} ${q} a_${k};
#else
uniform ${P} ${M} u_${k};
#endif
`:A==="define-instanced"?V==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${k}0;
in vec4 a_${k}1;
in vec4 a_${k}2;
in vec4 a_${k}3;
#else
uniform ${P} ${M} u_${k};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${P} ${q} a_${k};
#else
uniform ${P} ${M} u_${k};
#endif
`:A==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${k}
    ${P} ${M} ${k} = a_${k};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${k}
    ${P} ${M} ${k} = a_${k};
#else
    ${P} ${M} ${k} = u_${k};
#endif
`:`
#ifndef HAS_UNIFORM_u_${k}
    ${P} ${M} ${k} = unpack_mix_${V}(a_${k}, u_${k}_t);
#else
    ${P} ${M} ${k} = u_${k};
#endif
`}),staticAttributes:f,usedDefines:w,vertexIncludes:_,fragmentIncludes:v}}class hh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,u,f,m,_,v,w){this.context=t;let E=this.boundPaintVertexBuffers.length!==f.length;for(let P=0;!E&&P<f.length;P++)this.boundPaintVertexBuffers[P]!==f[P]&&(E=!0);let A=this.boundDynamicVertexBuffers.length!==v.length;for(let P=0;!A&&P<v.length;P++)this.boundDynamicVertexBuffers[P]!==v[P]&&(A=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==u||E||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==_)this.freshBind(n,u,f,m,_,v,w);else{t.bindVertexArrayOES.set(this.vao);for(const P of v)P&&(P.bind(),w&&P.instanceCount&&P.setVertexAttribDivisor(t.gl,n,w));m&&m.dynamicDraw&&m.bind()}}freshBind(t,n,u,f,m,_,v){const w=t.numAttributes,E=this.context,A=E.gl;this.vao&&this.destroy(),this.vao=E.gl.createVertexArray(),E.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=f,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=_,n.enableAttributes(A,t),n.bind(),n.setVertexAttribPointers(A,t,m);for(const P of u)P.enableAttributes(A,t),P.bind(),P.setVertexAttribPointers(A,t,m);for(const P of _)P&&(P.enableAttributes(A,t),P.bind(),P.setVertexAttribPointers(A,t,m),v&&P.instanceCount&&P.setVertexAttribDivisor(A,t,v));f&&f.bind(),E.currentNumAttributes=w}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function mp(l,t){const n=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new s.ac(0,u/n).toLngLat().lat,new s.ac(0,(u+1)/n).toLngLat().lat]}function Nf(l,t,n,u,f,m,_){const v=l.context,w=v.gl,E=n.hillshadeFBO;if(!E)return;l.prepareDrawTile();const A=l.isTileAffectedByFog(t),P=l.getOrCreateProgram("hillshade",{overrideFog:A});v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,E.colorAttachment.get());const M=(($,U,ee,se)=>{const ae=ee.paint.get("hillshade-shadow-color"),xe=ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ye=ee.paint.get("hillshade-highlight-color"),me=ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",he=ee.paint.get("hillshade-accent-color"),Te=ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ae=ee.paint.get("hillshade-emissive-strength");let rt=s.al(ee.paint.get("hillshade-illumination-direction"));if(ee.paint.get("hillshade-illumination-anchor")==="viewport")rt-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){const ft=$.style.directionalLight.properties.get("direction"),mt=s.cR(ft.x,ft.y,ft.z);rt=s.al(mt[1])}const Ge=!$.options.moving;return{u_matrix:se||$.transform.calculateProjMatrix(U.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:mp(0,U.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),rt],u_shadow:ae.toRenderColor(xe?null:ee.lut),u_highlight:ye.toRenderColor(me?null:ee.lut),u_emissive_strength:Ae,u_accent:he.toRenderColor(Te?null:ee.lut)}})(l,n,u,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(v,P,t.toUnwrapped());const{tileBoundsBuffer:k,tileBoundsIndexBuffer:q,tileBoundsSegments:V}=l.getTileBoundsBuffers(n);P.draw(l,w.TRIANGLES,f,m,_,Dr.disabled,M,u.id,k,q,V)}function Nu(l,t,n){if(!t.needsDEMTextureUpload)return;const u=l.context,f=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(n.stride);const m=n.getPixels();t.demTexture?t.demTexture.update(m,{premultiply:!1}):t.demTexture=new s.T(u,m,f.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function qd(l,t,n){const u=l.context,f=u.gl;if(!t.dem)return;const m=t.dem;if(u.activeTexture.set(f.TEXTURE1),Nu(l,t,m),!t.demTexture)return;t.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);const _=m.dim;u.activeTexture.set(f.TEXTURE0);let v=t.hillshadeFBO;if(!v){const M=new s.T(u,{width:_,height:_,data:null},f.RGBA8);M.bind(f.LINEAR,f.CLAMP_TO_EDGE),v=t.hillshadeFBO=u.createFramebuffer(_,_,!0,"renderbuffer"),v.colorAttachment.set(M.texture)}u.bindFramebuffer.set(v.framebuffer),u.viewport.set([0,0,_,_]);const{tileBoundsBuffer:w,tileBoundsIndexBuffer:E,tileBoundsSegments:A}=l.getMercatorTileBoundsBuffers(),P=[];l.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:P}).draw(l,f.TRIANGLES,Rt.disabled,rr.disabled,Ft.unblended,Dr.disabled,((M,k)=>{const q=k.stride,V=s.bz();return s.c5(V,0,s.aj,-s.aj,0,0,1),s.bo(V,V,[0,-s.aj,0]),{u_matrix:V,u_image:1,u_dimension:[q,q],u_zoom:M.overscaledZ}})(t.tileID,m),n.id,w,E,A),t.needsHillshadePrepare=!1}class Rn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vf extends Rn{getDefault(){return s.am.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ho extends Rn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Gd extends Rn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class dh extends Rn{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fh extends Rn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ph extends Rn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Hd extends Rn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ic extends Rn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ac extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Gl extends Rn{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Kh extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Vu extends Rn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class $d extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class Wd extends Rn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Hl extends Rn{getDefault(){return s.am.transparent}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class _u extends Rn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Cc extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Mc extends Rn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class yu extends Rn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Pc=class extends Rn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class Zd extends Rn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Xd extends Rn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Yd extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Jh extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class ju extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class $l extends Rn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Kd extends Rn{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Uu extends Rn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class js extends Rn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Rc extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Wl extends Rn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class mh extends Rn{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class gp extends mh{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Qh extends mh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Zl extends mh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class qu extends Qh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const vu=(l,t,n)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:n}),Dc=(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:n,u_zoom_transition:f,u_merc_center:m,u_image0:0,u_frustum_tl:_,u_frustum_tr:v,u_frustum_br:w,u_frustum_bl:E,u_globe_pos:A,u_globe_radius:P,u_viewport:M,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9),u_skirt_height:k,u_far_z_cutoff:q});function gh(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const el=new class{constructor(){this.operations={}}newMorphing(l,t,n,u,f){if(l in this.operations){const m=this.operations[l];m.to.tileID.key!==n.tileID.key&&(m.queued=n)}else this.operations[l]={startTime:u,phase:0,duration:f,from:t,to:n,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const n=this.operations[t];for(n.phase=(l-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},pa={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Un(l,t,n){if(t===0)return 0;const u=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*u}function ro(l,t){const n=1<<l.z;return!t&&(l.x===0||l.x===n-1)||l.y===0||l.y===n-1}const wo=l=>({u_matrix:l});function Bo(l,t,n,u,f){if(f>0){const m=s.q.now(),_=(m-l.timeAdded)/f,v=t?(m-t.timeAdded)/f:-1,w=n.getSource(),E=u.coveringZoomLevel({tileSize:w.tileSize,roundZoom:w.roundZoom}),A=!t||Math.abs(t.tileID.overscaledZ-E)>Math.abs(l.tileID.overscaledZ-E),P=A&&l.refreshedUponExpiration?1:s.aD(A?_:1-v,0,1);return l.refreshedUponExpiration&&_>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-P}:{opacity:P,mix:0}}return{opacity:1,mix:0}}class ws extends Hn{constructor(t){const n={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new s.D(s.d0(),null),f=As("mock-dem",n,u,t.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class gl extends Hn{constructor(t){const n=As("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new s.D(s.d0(),null),t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,u){if(t.freezeTileCoverage)return;this.transform=t;const f=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,_)=>{if(m[_.key]="",!this._tiles[_.key]){const v=new bo(_,this._source.tileSize*_.overscaleFactor(),t.tileZoom);v.state="loaded",this._tiles[_.key]=v}return m},{});for(const m in this._tiles)m in f||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const u=Object.values(n);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xl extends s.aM{constructor(t,n,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=u}}class Ss extends s.dt{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,f,m]=function(w){const E=new s.ba,A=new s.a_,P=131;E.reserve(17161),A.reserve(33800);const M=s.aj/128,k=s.aj+M/2,q=k+M;for(let $=-M;$<q;$+=M)for(let U=-M;U<q;U+=M){const ee=U<0||U>k||$<0||$>k?24575:0,se=s.aD(Math.round(U),0,s.aj),ae=s.aD(Math.round($),0,s.aj);E.emplaceBack(se+ee,ae)}const V=($,U)=>{const ee=U*P+$;A.emplaceBack(ee+1,ee,ee+P),A.emplaceBack(ee+P,ee+P+1,ee+1)};for(let $=1;$<129;$++)for(let U=1;U<129;U++)V(U,$);return[0,129].forEach($=>{for(let U=0;U<130;U++)V(U,$),V($,U)}),[E,A,32768]}(),_=t.context;this.gridBuffer=_.createVertexBuffer(u,s.bc.members),this.gridIndexBuffer=_.createIndexBuffer(f),this.gridSegments=s.bd.simpleSegment(0,0,u.length,f.length),this.gridNoSkirtSegments=s.bd.simpleSegment(0,0,u.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new gl(n.map),this.orthoMatrix=s.bz(),s.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.aj,0,s.aj,0,1);const v=_.gl;this._overlapStencilMode=new rr({func:v.GEQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ws(n.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const f=t.terrain.properties,m=t.terrain.drapeRenderMode===0,_=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.q.now();const v=t.terrain&&t.terrain.scope,w=f.get("source"),E=m?this._mockSourceCache:t.getSourceCache(w,v);if(!E)return void s.w(`Couldn't find terrain source "${w}".`);if(this.sourceCache=E,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=_?this.calculateExaggeration(n):f.get("exaggeration"),!n.projection.requiresDraping&&_&&this._exaggeration===0)return void this._disable();this.enabled=!0;const A=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const P=this.getScaledDemTileSize();this.sourceCache.update(n,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),n.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const f=n!=null?u-n:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;const m=t.zoom,_=this._style.terrain;if(!this._previousUpdateTimestamp)return _.getExaggeration(m);let v=m-this._previousZoom;const w=this._previousUpdateTimestamp;let E=m;this._evaluationZoom!=null&&(E=this._evaluationZoom,Math.abs(m-E)>.5&&(v=.5*(m-E+v)),v*f<0&&(E+=v)),this._evaluationZoom=E;const A=_.getExaggeration(E),P=A===_.getExaggeration(Math.max(0,E-.1));if(P&&Math.abs(A-this._exaggeration)<.01)return A;let M=Math.min(.1,.00375*(this._updateTimestamp-w));return(P||A<.1||Math.abs(v)<1e-4)&&(M=Math.min(.2,4*M)),s.ai(this._exaggeration,A,M)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(s.ac.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=n.getIds().map(w=>{const E=n.getTileByID(w).tileID;return E.projMatrix=u.calculateProjMatrix(E.toUnwrapped()),E});(function(w,E){const A=E.transform.pointCoordinate(E.transform.getCameraPoint()),P=new s.P(A.x,A.y);w.sort((M,k)=>{if(k.overscaledZ-M.overscaledZ)return k.overscaledZ-M.overscaledZ;const q=new s.P(M.canonical.x+(1<<M.canonical.z)*M.wrap,M.canonical.y),V=new s.P(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),$=P.mult(1<<M.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(q)-$.distSqr(V)})})(f,this.painter);const m=this.proxyToSource||{};this.proxyToSource={},f.forEach(w=>{this.proxyToSource[w.key]={}}),this.terrainTileForTile={};const _=this._style._mergedSourceCaches;for(const w in _){const E=_[w];if(!E.used||(E!==this.sourceCache&&this.resetTileLookupCache(E.id),this._setupProxiedCoordsForOrtho(E,t[w],m),E.usedForTerrain))continue;const A=t[w];E.getSource().reparseOverscaled&&this._assignTerrainTiles(A)}this.proxiedCoords[n.id]=f.map(w=>new Xl(w,w.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1;const v={};this._visibleDemTiles=[];for(const w of this.proxyCoords){const E=this.terrainTileForTile[w.key];if(!E)continue;const A=E.tileID.key;A in v||(this._visibleDemTiles.push(E),v[A]=A)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const u=this._findTileCoveringTileID(n,this.sourceCache);u&&(this.terrainTileForTile[n.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const u in this.terrainTileForTile){const f=this.terrainTileForTile[u],m=f.dem;!m||f.demTexture&&!f.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),Nu(this.painter,f,m))}}_prepareDemTileUniforms(t,n,u,f){if(!n||n.demTexture==null)return!1;const m=t.tileID.canonical,_=Math.pow(2,n.tileID.canonical.z-m.z),v=f||"";return u[`u_dem_tl${v}`]=[m.x*_%1,m.y*_%1],u[`u_dem_scale${v}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((u,f)=>{if(!f.dem)return u;const m=f.dem.tree.minimums[0];return m>0&&t++,u+m},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const u=this._getLoadedAreaMinimum(),f=new s.du({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let m=this._emptyDEMTexture;return m?m.update(f,{premultiply:!1}):m=this._emptyDEMTexture=new s.T(t,f,n.R32F,{premultiply:!1}),m}setupElevationDraw(t,n,u){const f=this.painter.context,m=f.gl,_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};_.u_exaggeration=this.exaggeration();let v=null,w=null,E=1;if(u&&u.morphing&&this._useVertexMorphing){const k=u.morphing.srcDemTile,q=u.morphing.dstDemTile;E=u.morphing.phase,k&&q&&(this._prepareDemTileUniforms(t,k,_,"_prev")&&(w=k),this._prepareDemTileUniforms(t,q,_)&&(v=q))}const A=k=>k&&k.demTexture&&this.painter.linearFloatFilteringSupported()?m.LINEAR:m.NEAREST;let P=null;var M;if(this.enabled?w&&v?(P=v.demTexture,f.activeTexture.set(m.TEXTURE4),w.demTexture.bind(A(w),m.CLAMP_TO_EDGE),_.u_dem_lerp=E):(v=this.terrainTileForTile[t.tileID.key],P=this._prepareDemTileUniforms(t,v,_)?v.demTexture:this.emptyDEMTexture):P=this.emptyDEMTexture,f.activeTexture.set(m.TEXTURE2),P&&(_.u_dem_size=(M=P).size[0]===1?1:M.size[0]-2,P.bind(A(v),m.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,n,_),u&&u.useMeterToDem&&v){const k=(1<<v.tileID.canonical.z)*s.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=k}if(u&&u.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),n.setTerrainUniformValues(f,_),this.painter.transform.projection.name==="globe"){const k=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);n.setGlobeUniformValues(f,k)}}globeUniformValues(t,n,u){const f=t.projection;return{u_tile_tl_up:f.upVector(n,0,0),u_tile_tr_up:f.upVector(n,s.aj,0),u_tile_br_up:f.upVector(n,s.aj,s.aj),u_tile_bl_up:f.upVector(n,0,s.aj),u_tile_up_scale:u?s.dv(1):f.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,m,_,v,w){if(f.transform.projection.name==="globe")(function(E,A,P,M,k){const q=E.context,V=q.gl;let $,U;const ee=E.transform,se=s.dl(E,q,ee),ae=(ft,mt)=>{if(U===mt)return;const Bt=[pa[mt],"PROJECTION_GLOBE_VIEW"];se&&Bt.push("CUSTOM_ANTIALIASING");const je=E.isTileAffectedByFog(ft);$=E.getOrCreateProgram("globeRaster",{defines:Bt,overrideFog:je}),U=mt},xe=E.colorModeForRenderPass(),ye=new Rt(V.LEQUAL,Rt.ReadWrite,E.depthRangeFor3D);el.update(k);const me=s.dm(ee),he=[s.ay(ee.center.lng),s.aH(ee.center.lat)],Te=E.globeSharedBuffers,Ae=[ee.width*s.q.devicePixelRatio,ee.height*s.q.devicePixelRatio],rt=Float32Array.from(ee.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const ft=E.transform,mt=Un(ft.zoom,A.exaggeration(),A.sourceCache._source.tileSize);U=-1;const Bt=V.TRIANGLES;for(const je of M){const tt=P.getTile(je),Ve=rr.disabled,vt=A.prevTerrainTileForTile[je.key],it=A.terrainTileForTile[je.key];gh(vt,it)&&el.newMorphing(je.key,vt,it,k,250),q.activeTexture.set(V.TEXTURE0),tt.texture&&tt.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const Et=el.getMorphValuesForProxy(je.key),yt=Et?1:0;Et&&s.L(Ge,{morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:s.dk(Et.phase)}});const Mt=s.dn(je.canonical),Dt=s.dp(Mt.getCenter().lat),ur=s.dq(je.canonical,Mt,Dt,ft.worldSize/ft._pixelsPerMercatorPixel),gr=s.bh(s.dr(je.canonical)),Kt=Dc(ft.expandedFarZProjMatrix,rt,me,gr,s.ah(ft.zoom),he,ft.frustumCorners.TL,ft.frustumCorners.TR,ft.frustumCorners.BR,ft.frustumCorners.BL,ft.globeCenterInViewSpace,ft.globeRadius,Ae,mt,ft._farZ,ur);if(ae(je,yt),$&&(A.setupElevationDraw(tt,$,Ge),E.uploadCommonUniforms(q,$,je.toUnwrapped()),Te)){const[pr,nr,Ir]=Te.getGridBuffers(Dt,mt!==0);$.draw(E,Bt,ye,Ve,xe,Dr.backCCW,Kt,"globe_raster",pr,nr,Ir)}}}if(Te&&(E.renderDefaultNorthPole||E.renderDefaultSouthPole)){const ft=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&ft.push("CUSTOM_ANTIALIASING"),$=E.getOrCreateProgram("globeRaster",{defines:ft});for(const mt of M){const{x:Bt,y:je,z:tt}=mt.canonical,Ve=je===0,vt=je===(1<<tt)-1,[it,Et,yt,Mt]=Te.getPoleBuffers(tt,!1);if(Mt&&(Ve||vt)){const Dt=P.getTile(mt);q.activeTexture.set(V.TEXTURE0),Dt.texture&&Dt.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let ur=s.ds(tt,Bt,ee);const gr=s.bh(s.dr(mt.canonical)),Kt=(pr,nr)=>pr.draw(E,V.TRIANGLES,ye,rr.disabled,xe,Dr.disabled,Dc(ee.expandedFarZProjMatrix,ur,ur,gr,0,he,ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.globeCenterInViewSpace,ee.globeRadius,Ae,0,ee._farZ),"globe_pole_raster",nr,yt,Mt);A.setupElevationDraw(Dt,$,Ge),E.uploadCommonUniforms(q,$,mt.toUnwrapped()),Ve&&E.renderDefaultNorthPole&&Kt($,it),vt&&E.renderDefaultSouthPole&&(ur=s.cE(s.bz(),ur,[1,-1,1]),Kt($,Et))}}}})(f,m,_,v,w);else{const E=f.context,A=E.gl;let P,M;const k=f.shadowRenderer,q=Ja(f,f.longestCutoffRange),V=xe=>{if(M===xe)return;const ye=[];ye.push(pa[xe]),q.shouldRenderCutoff&&ye.push("RENDER_CUTOFF"),k&&(ye.push("RENDER_SHADOWS","DEPTH_TEXTURE"),k.useNormalOffset&&ye.push("NORMAL_OFFSET")),P=f.getOrCreateProgram("terrainRaster",{defines:ye}),M=xe},$=f.colorModeForRenderPass(),U=new Rt(A.LEQUAL,Rt.ReadWrite,f.depthRangeFor3D);el.update(w);const ee=f.transform,se=Un(ee.zoom,m.exaggeration(),m.sourceCache._source.tileSize);let ae=[0,0,0];if(k){const xe=f.style.directionalLight,ye=f.style.ambientLight;xe&&ye&&(ae=Da(f.style,xe,ye))}{M=-1;const xe=A.TRIANGLES,[ye,me]=[m.gridIndexBuffer,m.gridSegments];for(const he of v){const Te=_.getTile(he),Ae=rr.disabled,rt=m.prevTerrainTileForTile[he.key],Ge=m.terrainTileForTile[he.key];gh(rt,Ge)&&el.newMorphing(he.key,rt,Ge,w,250),E.activeTexture.set(A.TEXTURE0),Te.texture&&Te.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE);const ft=el.getMorphValuesForProxy(he.key),mt=ft?1:0;let Bt;ft&&(Bt={morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:s.dk(ft.phase)}});const je=vu(he.projMatrix,ro(he.canonical,ee.renderWorldCopies)?se/10:se,ae);if(V(mt),!P)continue;m.setupElevationDraw(Te,P,Bt);const tt=he.toUnwrapped();k&&k.setupShadows(tt,P),f.uploadCommonUniforms(E,P,tt,null,q),P.draw(f,xe,U,Ae,$,Dr.backCCW,je,"terrain_raster",m.gridBuffer,ye,me)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,u=this.painter.context,f=this.proxySourceCache,m=this.proxiedCoords[f.id],_=this._drapedRenderBatches.shift(),v=n.style.order,w=[];let E=0;for(const A of m){const P=f.getTileByID(A.proxyTileKey),M=f.proxyCachedFBO[A.key]?f.proxyCachedFBO[A.key][t]:void 0,k=M!==void 0?f.renderCache[M]:this.pool[E++],q=M!==void 0;if(P.texture=k.tex,q&&!k.dirty){w.push(P.tileID);continue}let V;u.bindFramebuffer.set(k.fb.framebuffer),this.renderedToTile=!1,k.dirty&&(u.clear({color:s.am.transparent,stencil:0}),k.dirty=!1);for(let $=_.start;$<=_.end;++$){const U=n.style._mergedLayers[v[$]];if(U.isHidden(n.transform.zoom))continue;const ee=n.style.getLayerSourceCache(U),se=ee?this.proxyToSource[A.key][ee.id]:[A];if(!se)continue;const ae=se;u.viewport.set([0,0,k.fb.width,k.fb.height]),V!==(ee?ee.id:null)&&(this._setupStencil(k,se,U,ee),V=ee?ee.id:null),n.renderLayer(n,ee,U,ae)}if(this._drapedRenderBatches.length===0)for(const $ of this._pendingGroundEffectLayers){const U=n.style._mergedLayers[v[$]];if(U.isHidden(n.transform.zoom))continue;const ee=n.style.getLayerSourceCache(U),se=ee?this.proxyToSource[A.key][ee.id]:[A];if(!se)continue;const ae=se;u.viewport.set([0,0,k.fb.width,k.fb.height]),V!==(ee?ee.id:null)&&(this._setupStencil(k,se,U,ee),V=ee?ee.id:null),n.renderLayer(n,ee,U,ae)}this.renderedToTile?(k.dirty=!0,w.push(P.tileID)):q||--E,E===5&&(E=0,this.renderToBackBuffer(w))}return this.renderToBackBuffer(w),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,n.width,n.height]),_.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let u=-1,f=n;for(let m=0;m<n;++m)this._style.isLayerDraped(t._mergedLayers[t.order[m]])?u=Math.max(u,m):f=Math.min(f,m);return f>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,u){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const _=m.tileID,v=1<<_.overscaledZ,{x:w,y:E}=_.canonical,A=w/v,P=(w+1)/v,M=E/v,k=(E+1)/v;return{minx:A,miny:M,maxx:P,maxy:k,t:m.dem.tree.raycastRoot(A,M,P,k,t,n,u),tile:m}});f.sort((m,_)=>(m.t!==null?m.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE));for(const m of f){if(m.t==null)return null;const _=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,t,n,u);if(_!=null)return _}return null}_createFBO(){const t=this.painter.context,n=t.gl,u=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const f=new s.T(t,{width:u[0],height:u[1],data:null},n.RGBA8);f.bind(n.LINEAR,n.CLAMP_TO_EDGE);const m=t.createFramebuffer(u[0],u[1],!0,null);return m.colorAttachment.set(f.texture),m.depthAttachment=new qu(t,m.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:m,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],u=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!u&&n.shouldRedrape():!u&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof mn){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const f=this._style._mergedLayers[this._style.order[u]],m=this._style.getLayerSourceCache(f);if(m&&!n[m.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof s.ab){n[m.id]=!0;for(const _ of this.proxyCoords){const v=this.proxyToSource[_.key][m.id];if(v)for(const w of v)this._clearRenderCacheForTile(m.id,w)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Is){t=!0;break}if(!t)return;const n={};for(let u=0;u<this._style.order.length;++u){const f=this._style._mergedLayers[this._style.order[u]],m=this._style.getLayerSourceCache(f);if(!m||n[m.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;const _=f.paint.get("raster-fade-duration");for(const v of this.proxyCoords){const w=this.proxyToSource[v.key][m.id];if(w)for(const E of w){const A=Bo(m.getTile(E),m.findLoadedParent(E,0),m,this.painter.transform,_);(A.opacity!==1||A.mix!==0)&&this._clearRenderCacheForTile(m.id,E)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const u=[];this._pendingGroundEffectLayers=[];let f,m=0,_=this._style._mergedLayers[t[m]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++m<n;)_=this._style._mergedLayers[t[m]];for(;m<n;++m){const v=this._style._mergedLayers[t[m]];v.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(v)?f===void 0&&(f=m):(v.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(m),f!==void 0&&(u.push({start:f,end:m-1}),f=void 0)))}if(f!==void 0&&u.push({start:f,end:m-1}),u.length!==0){const v=u[u.length-1];this._pendingGroundEffectLayers.every(w=>w>v.end)||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const _=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let v=0;v<_.length;++v){const w=Object.values(_[v]);n.renderCachePool.push(...w)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,f=this._tilesDirty;for(let _=u.length-1;_>=0;_--){const v=u[_];if(n.getTileByID(v.key),n.proxyCachedFBO[v.key]!==void 0){const w=t[v.key],E=this.proxyToSource[v.key];let A=0;for(const P in E){const M=E[P],k=w[P];if(!k||k.length!==M.length||M.some((q,V)=>q!==k[V]||f[P]&&f[P].hasOwnProperty(q.key))){A=-1;break}++A}for(const P in n.proxyCachedFBO[v.key])n.renderCache[n.proxyCachedFBO[v.key][P]].dirty=A<0||A!==Object.values(w).length}}const m=[...this._drapedRenderBatches];m.sort((_,v)=>v.end-v.start-(_.end-_.start));for(const _ of m)for(const v of u){if(n.proxyCachedFBO[v.key])continue;let w=n.renderCachePool.pop();w===void 0&&n.renderCache.length<50&&(w=n.renderCache.length,n.renderCache.push(this._createFBO())),w!==void 0&&(n.proxyCachedFBO[v.key]={},n.proxyCachedFBO[v.key][_.start]=w,n.renderCache[w].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,u,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,_=m.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let v;if(u.isTileClipped())v=n.length,this._overlapStencilMode.test={func:_.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);v=1,this._overlapStencilMode.test={func:_.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+v>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=v,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):rr.disabled}_renderTileClippingMasks(t,n){const u=this.painter,f=this.painter.context,m=f.gl;u._tileClippingMaskIDs={},f.setColorMode(Ft.disabled),f.setDepthMode(Rt.disabled);const _=u.getOrCreateProgram("clippingMask");for(const v of t){const w=u._tileClippingMaskIDs[v.key]=--n;_.draw(u,m.TRIANGLES,Rt.disabled,new rr({func:m.ALWAYS,mask:0},w,255,m.KEEP,m.KEEP,m.REPLACE),Ft.disabled,Dr.disabled,wo(v.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const u=[t.x,t.y,1,1];s.aA(u,u,n.pixelMatrixInverse),s.cw(u,u,1/u[3]),u[0]/=n.worldSize,u[1]/=n.worldSize;const f=n._camera.position,m=s.c6(1,n.center.lat),_=[f[0],f[1],f[2]/m,0],v=s.cY([],u.slice(0,3),_);s.au(v,v);const w=this.raycast(_,v,this._exaggeration);return w!==null&&w?(s.bF(_,_,v,w),_[3]=_[2],_[2]*=m,_):null}_setupProxiedCoordsForOrtho(t,n,u){if(t.getSource()instanceof s.aP)return this._setupProxiedCoordsForImageSource(t,n,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const f=this.proxiedCoords[t.id]=[],m=this.proxyCoords;for(let w=0;w<m.length;w++){const E=m[w],A=this._findTileCoveringTileID(E,t);if(A){const P=this._createProxiedId(E,A,u[E.key]&&u[E.key][t.id]);f.push(P),this.proxyToSource[E.key][t.id]=[P]}}let _=!1;const v=new Set;for(let w=0;w<n.length;w++){const E=t.getTile(n[w]);if(!E||!E.hasData())continue;const A=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==E.tileID.canonical.z){const P=this.proxyToSource[A.tileID.key][t.id],M=this._createProxiedId(A.tileID,E,u[A.tileID.key]&&u[A.tileID.key][t.id]);P?P.splice(P.length-1,0,M):this.proxyToSource[A.tileID.key][t.id]=[M];const k=this.proxyToSource[A.tileID.key][t.id];v.has(k)||v.add(k),f.push(M),_=!0}}if(this._sourceTilesOverlap[t.id]=_,_&&this._debugParams.sortTilesHiZFirst)for(const w of v)w.sort((E,A)=>A.overscaledZ-E.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,u){if(!t.getSource().loaded())return;const f=this.proxiedCoords[t.id]=[],m=this.proxyCoords,_=t.getSource(),v=_.tileID;if(!v)return;const w=new s.P(v.x,v.y)._div(1<<v.z),E=_.coordinates.map(s.ac.fromLngLat).reduce((P,M)=>(P.min.x=Math.min(P.min.x,M.x-w.x),P.min.y=Math.min(P.min.y,M.y-w.y),P.max.x=Math.max(P.max.x,M.x-w.x),P.max.y=Math.max(P.max.y,M.y-w.y),P),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(P,M)=>{const k=P.wrap+P.canonical.x/(1<<P.canonical.z),q=P.canonical.y/(1<<P.canonical.z),V=s.aj/(1<<P.canonical.z),$=M.wrap+M.canonical.x/(1<<M.canonical.z),U=M.canonical.y/(1<<M.canonical.z);return k+V<$+E.min.x||k>$+E.max.x||q+V<U+E.min.y||q>U+E.max.y};for(let P=0;P<m.length;P++){const M=m[P];for(let k=0;k<n.length;k++){const q=t.getTile(n[k]);if(!q||!q.hasData()||A(M,q.tileID))continue;const V=this._createProxiedId(M,q,u[M.key]&&u[M.key][t.id]),$=this.proxyToSource[M.key][t.id];$?$.push(V):this.proxyToSource[M.key][t.id]=[V],f.push(V)}}}_createProxiedId(t,n,u){let f=this.orthoMatrix;if(u){const m=u.find(_=>_.key===n.tileID.key);if(m)return m}if(n.tileID.key!==t.key){const m=t.canonical.z-n.tileID.canonical.z;let _,v,w;f=s.bz();const E=n.tileID.wrap-t.wrap<<t.overscaledZ;m>0?(_=s.aj>>m,v=_*((n.tileID.canonical.x<<m)-t.canonical.x+E),w=_*((n.tileID.canonical.y<<m)-t.canonical.y)):(_=s.aj<<-m,v=s.aj*(n.tileID.canonical.x-(t.canonical.x+E<<-m)),w=s.aj*(n.tileID.canonical.y-(t.canonical.y<<-m))),s.c5(f,0,_,0,_,0,1),s.bo(f,f,[v,w,0])}return new Xl(n.tileID,t.key,f)}_findTileCoveringTileID(t,n){let u=n.getTile(t);if(u&&u.hasData())return u;const f=this._findCoveringTileCache[n.id],m=f[t.key];if(u=m?n.getTileByID(m):null,u&&u.hasData()||m===null)return u;let _=u?u.tileID:t,v=_.overscaledZ;const w=n.getSource().minzoom,E=[];if(!m){const P=n.getSource().maxzoom;if(t.canonical.z>=P){const M=t.canonical.z-P;n.getSource().reparseOverscaled?(v=Math.max(t.canonical.z+2,n.transform.tileZoom),_=new s.aM(v,t.wrap,P,t.canonical.x>>M,t.canonical.y>>M)):M!==0&&(v=P,_=new s.aM(v,t.wrap,P,t.canonical.x>>M,t.canonical.y>>M))}_.key!==t.key&&(E.push(_.key),u=n.getTile(_))}const A=P=>{E.forEach(M=>{f[M]=P}),E.length=0};for(v-=1;v>=w&&(!u||!u.hasData());v--){u&&A(u.tileID.key);const P=_.calculateScaledKey(v);if(u=n.getTileByID(P),u&&u.hasData())break;const M=f[P];if(M===null)break;M===void 0?E.push(P):u=n.getTileByID(M)}return A(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[n.key]=!0}}function kc(l,t,n){const u=function(v,w,E){const A=s.bE(w,v),P=s.bE(E,[.2126,.7152,.0722]),M=(q,V,$)=>(1-$)*q+$*V,k=M(1-.3*Math.min(P,1),1,Math.min(A+1,1));return M(.92,1,Math.asin(s.aD(w[2],-1,1))/Math.PI+.5)*k}(l,[0,0,1],t),f=[0,0,0];s.b$(f,n.slice(0,3),u);const m=[0,0,0];s.b$(m,t.slice(0,3),l[2]);const _=[0,0,0];return s.cU(_,f,m),s.cX(_)}const _h=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ed=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Gu{static cacheKey(t,n,u,f){let m=`${n}${f?f.cacheKey:""}`;for(const _ of u)t.usedDefines.includes(_)&&(m+=`/${_}`);return m}constructor(t,n,u,f,m,_){const v=t.gl;this.program=v.createProgram(),this.configuration=f,this.name=n,this.fixedDefines=[..._];const w=f?f.getBinderAttributes():[],E=(u.staticAttributes||[]).concat(w);let A=f?f.defines():[];A=A.concat(_.map($=>`#define ${$}`));const P=`#version 300 es
`;let M=P+A.concat("precision mediump float;",Ec,ql.fragmentSource).join(`
`);for(const $ of u.fragmentIncludes)M+=`
${da[$]}`;M+=`
${u.fragmentSource}`;let k=P+A.concat("precision highp float;",Ec,ql.vertexSource).join(`
`);for(const $ of u.vertexIncludes)k+=`
${da[$]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(k+=`
uniform int u_instanceID;
`),k+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(k=k.replaceAll("gl_InstanceID","u_instanceID"));const q=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);v.shaderSource(q,M),v.compileShader(q),v.attachShader(this.program,q);const V=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())this.failedToCreate=!0;else{v.shaderSource(V,k),v.compileShader(V),v.attachShader(this.program,V),this.attributes={},this.numAttributes=E.length;for(let $=0;$<this.numAttributes;$++)if(E[$]){const U=E[$].startsWith("a_")?E[$]:`a_${E[$]}`;v.bindAttribLocation(this.program,$,U),this.attributes[U]=$}v.linkProgram(this.program),v.deleteShader(V),v.deleteShader(q),this.fixedUniforms=m(t),this.binderUniforms=f?f.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=($=>({u_instanceID:new s.cc($)}))(t)),(_.includes("TERRAIN")||n.indexOf("symbol")!==-1||n.indexOf("circle")!==-1)&&(this.terrainUniforms=($=>({u_dem:new s.cc($),u_dem_prev:new s.cc($),u_dem_tl:new s.c9($),u_dem_scale:new s.cb($),u_dem_tl_prev:new s.c9($),u_dem_scale_prev:new s.cb($),u_dem_size:new s.cb($),u_dem_lerp:new s.cb($),u_exaggeration:new s.cb($),u_depth:new s.cc($),u_depth_size_inv:new s.c9($),u_depth_range_unpack:new s.c9($),u_occluder_half_size:new s.cb($),u_occlusion_depth_offset:new s.cb($),u_meter_to_dem:new s.cb($),u_label_plane_matrix_inv:new s.c8($)}))(t)),_.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new s.ca($),u_tile_tr_up:new s.ca($),u_tile_br_up:new s.ca($),u_tile_bl_up:new s.ca($),u_tile_up_scale:new s.cb($)}))(t)),_.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new s.c8($),u_fog_range:new s.c9($),u_fog_color:new s.cQ($),u_fog_horizon_blend:new s.cb($),u_fog_vertical_limit:new s.c9($),u_fog_temporal_offset:new s.cb($),u_frustum_tl:new s.ca($),u_frustum_tr:new s.ca($),u_frustum_br:new s.ca($),u_frustum_bl:new s.ca($),u_globe_pos:new s.ca($),u_globe_radius:new s.cb($),u_globe_transition:new s.cb($),u_is_globe:new s.cc($),u_viewport:new s.c9($)}))(t)),_.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new s.cQ($)}))(t)),_.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new s.ca($),u_lighting_directional_dir:new s.ca($),u_lighting_directional_color:new s.ca($),u_ground_radiance:new s.ca($)}))(t)),_.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new s.c8($),u_light_matrix_1:new s.c8($),u_fade_range:new s.c9($),u_shadow_normal_offset:new s.ca($),u_shadow_intensity:new s.cb($),u_shadow_texel_size:new s.cb($),u_shadow_map_resolution:new s.cb($),u_shadow_direction:new s.ca($),u_shadow_bias:new s.ca($),u_shadowmap_0:new s.cc($),u_shadowmap_1:new s.cc($)}))(t))}}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)u[f]&&u[f].set(this.program,f,n[f])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)u[f]&&u[f].set(this.program,f,n[f])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)u[f].set(this.program,f,n[f])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)u[f].set(this.program,f,n[f])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const f in n)u[f].set(this.program,f,n[f])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const f in n)u[f].set(this.program,f,n[f])}_drawDebugWireframe(t,n,u,f,m,_,v,w,E,A){const P=t.options.wireframe;if(P.terrain===!1&&P.layers2D===!1&&P.layers3D===!1)return;const M=t.context;if(!(!(!P.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!P.layers2D||t._terrain&&t._terrain.renderingToTexture||!_h.includes(this.name))||!(!P.layers3D||!ed.includes(this.name))))return;const k=M.gl,q=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,m,M);if(!q)return;const V=[...this.fixedDefines];V.push("DEBUG_WIREFRAME");const $=t.getOrCreateProgram(this.name,{config:this.configuration,defines:V});M.program.set($.program);const U=(ae,xe,ye)=>{if(xe[ae]&&ye[ae])for(const me in xe[ae])ye[ae][me]&&ye[ae][me].set(ye.program,me,xe[ae][me].current)};E&&E.setUniforms($.program,M,$.binderUniforms,v,{zoom:w}),U("fixedUniforms",this,$),U("terrainUniforms",this,$),U("globeUniforms",this,$),U("fogUniforms",this,$),U("lightsUniforms",this,$),U("shadowUniforms",this,$),q.bind(),M.setColorMode(new Ft([k.ONE,k.ONE_MINUS_SRC_ALPHA,k.ZERO,k.ONE],s.am.transparent,[!0,!0,!0,!1])),M.setDepthMode(new Rt(n.func===k.LESS?k.LEQUAL:n.func,Rt.ReadOnly,n.range)),M.setStencilMode(rr.disabled);const ee=3*_.primitiveLength*2,se=3*_.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ae=A||1;for(let xe=0;xe<ae;++xe)$.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",xe),k.drawElements(k.LINES,ee,k.UNSIGNED_SHORT,se)}else A&&A>1?k.drawElementsInstanced(k.LINES,ee,k.UNSIGNED_SHORT,se,A):k.drawElements(k.LINES,ee,k.UNSIGNED_SHORT,se);m.bind(),M.program.set(this.program),M.setDepthMode(n),M.setStencilMode(u),M.setColorMode(f)}checkUniforms(t,n,u){if(this.fixedDefines.includes(n)){for(const f of Object.keys(u))if(!u[f].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${f} not set but required by ${n} being defined`)}}draw(t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$){const U=t.context,ee=U.gl;if(this.failedToCreate)return;U.program.set(this.program),U.setDepthMode(u),U.setStencilMode(f),U.setColorMode(m),U.setCullFace(_);for(const xe of Object.keys(this.fixedUniforms))this.fixedUniforms[xe].set(this.program,xe,v[xe]);q&&q.setUniforms(this.program,U,this.binderUniforms,M,{zoom:k});const se={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[n];this.checkUniforms(w,"RENDER_SHADOWS",this.shadowUniforms);const ae=$&&$>0?1:void 0;for(const xe of P.get()){const ye=xe.vaos||(xe.vaos={});if((ye[w]||(ye[w]=new hh)).bind(U,this,E,q?q.getPaintVertexBuffers():[],A,xe.vertexOffset,V||[],ae),this.forceManualRenderingForInstanceIDShaders){const me=$||1;for(let he=0;he<me;++he)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",he),A?ee.drawElements(n,xe.primitiveLength*se,ee.UNSIGNED_SHORT,xe.primitiveOffset*se*2):ee.drawArrays(n,xe.vertexOffset,xe.vertexLength)}else $&&$>1?ee.drawElementsInstanced(n,xe.primitiveLength*se,ee.UNSIGNED_SHORT,xe.primitiveOffset*se*2,$):A?ee.drawElements(n,xe.primitiveLength*se,ee.UNSIGNED_SHORT,xe.primitiveOffset*se*2):ee.drawArrays(n,xe.vertexOffset,xe.vertexLength);n===ee.TRIANGLES&&A&&this._drawDebugWireframe(t,u,f,m,A,xe,M,k,q,$)}}}function Lc(l,t,n=0){const u=Math.pow(2,t.tileID.overscaledZ),f=t.tileSize*Math.pow(2,l.transform.tileZoom)/u,m=f*(t.tileID.canonical.x+t.tileID.wrap*u),_=f*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.aw(t,1,l.transform.tileZoom),u_pixel_coord_upper:[m>>16,_>>16],u_pixel_coord_lower:[65535&m,65535&_],u_pattern_transition:n}}const ma={terrain:0,flat:1},yh=s.bz(),Yl=(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U)=>{const ee=t.style.light,se=ee.properties.get("position"),ae=[se.x,se.y,se.z],xe=s.dx();ee.properties.get("anchor")==="viewport"&&(s.dy(xe,-t.transform.angle),s.dz(ae,ae,xe));const ye=ee.properties.get("color"),me=t.transform,he={u_matrix:l,u_lightpos:ae,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_vertical_gradient:+n,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:yh,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ma[E],u_base_type:ma[A],u_ao:f,u_edge_radius:m,u_width_scale:_,u_flood_light_color:q,u_vertical_scale:V,u_flood_light_intensity:$,u_ground_shadow_factor:U};return me.projection.name==="globe"&&(he.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],he.u_zoom_transition=P,he.u_inv_rot_matrix=k,he.u_merc_center=M,he.u_up_dir=me.projection.upVector(new s.cp(0,0,0),M[0]*s.aj,M[1]*s.aj),he.u_height_lift=w),he},jf=(l,t,n,u,f,m)=>({u_matrix:l,u_edge_radius:t,u_width_scale:n,u_vertical_scale:u,u_height_type:ma[f],u_base_type:ma[m]}),_p=(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U)=>{const ee=Yl(l,t,n,u,f,m,_,v,E,A,P,M,k,q,V,$,1,[0,0,0]),se={u_height_factor:-Math.pow(2,v.overscaledZ)/w.tileSize/8};return s.l(ee,Lc(t,w,U),se)},Kl=(l,t,n)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:n}),Hu=(l,t,n,u,f,m=0)=>s.l(Kl(l,t,f),Lc(n,u,m)),zc=(l,t,n,u)=>({u_matrix:l,u_world:n,u_emissive_strength:t,u_ground_shadow_factor:u}),td=(l,t,n,u,f,m,_=0)=>s.l(Hu(l,t,n,u,m,_),{u_world:f}),Oc=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),Ps=(l,t,n,u,f)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:u,u_reset_depth:f}),ga=(l,t,n,u)=>{const f=s.aj/n.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/f,t.pixelsToGLUnits[1]/f]}},_a=(l,t,n=1)=>({u_matrix:l,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:n}),_l=s.bz(),yl=(l,t,n,u,f,m,_)=>{const v=l.transform,w=v.projection.name==="globe",E=w?s.dA(v.zoom,t.canonical)*v._pixelsPerMercatorPixel:s.aw(n,1,m),A={u_matrix:t.projMatrix,u_extrude_scale:E,u_intensity:_,u_inv_rot_matrix:_l,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(w){A.u_inv_rot_matrix=u,A.u_merc_center=f,A.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],A.u_zoom_transition=s.ah(v.zoom);const P=f[0]*s.aj,M=f[1]*s.aj;A.u_up_dir=v.projection.upVector(new s.cp(0,0,0),P,M)}return A};function Jl(l,[t,n,u,f],[m,_]){if(m===_)return[0,0,0,0];const v=255*(l-1)/(l*(_-m));return[t*v,n*v,u*v,f*v]}function vh(l,t,[n,u]){return n===u?0:.5/l+(t-n)*(l-1)/(l*(u-n))}const vl=(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U,ee,se,ae)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:E,u_fade_t:A.mix,u_opacity:A.opacity*P.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:P.paint.get("raster-brightness-min"),u_brightness_high:P.paint.get("raster-brightness-max"),u_saturation_factor:s.dB(P.paint.get("raster-saturation")),u_contrast_factor:s.dC(P.paint.get("raster-contrast")),u_spin_weights:rd(P.paint.get("raster-hue-rotate")),u_perspective_transform:M,u_raster_elevation:k,u_zoom_transition:_,u_merc_center:v,u_cutoff_params:w,u_colorization_mix:Jl(s.dD,V,U),u_colorization_offset:vh(s.dD,$,U),u_color_ramp:q,u_texture_offset:[se/(ee+2*se),ee/(ee+2*se)],u_texture_res:[ee+2*se,ee+2*se],u_emissive_strength:ae});function rd(l){l*=Math.PI/180;const t=Math.sin(l),n=Math.cos(l);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const fo=.05,Us=(l,t,n,u,f,m,_,v,w,E,A,P)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:u,u_grid_matrix:f,u_tl_parent:m,u_scale_parent:E,u_fade_t:A.mix,u_opacity:A.opacity,u_image0:0,u_image1:1,u_raster_elevation:P,u_zoom_transition:_,u_merc_center:v,u_cutoff_params:w}),io=(l,t,n,u,f,m,_,v,w,E)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:u,u_color_ramp:m,u_velocity_res:f,u_max_speed:_,u_uv_offset:v,u_data_scale:[255*w[0],255*w[1]],u_data_offset:E,u_particle_pos_scale:1.1,u_particle_pos_offset:[fo,fo]}),Oa=(l,t,n,u,f,m,_,v,w,E)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:u,u_max_speed:f,u_speed_factor:m,u_reset_rate:_,u_rand_seed:Math.random(),u_uv_offset:v,u_data_scale:[255*w[0],255*w[1]],u_data_offset:E,u_particle_pos_scale:1.1,u_particle_pos_offset:[fo,fo]}),id=s.bz(),xh=(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U,ee,se,ae,xe,ye)=>{const me=f.transform,he={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:me.getCameraToCenterDistance(ee),u_rotate_symbol:+n,u_aspect_ratio:me.width/me.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:_,u_coord_matrix:v,u_is_text:+E,u_elevation_from_sea:w?1:0,u_pitch_with_map:+u,u_texsize:A,u_texsize_icon:P,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:id,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:id,u_up_vector:[0,-1,0],u_color_adj_mat:ae,u_icon_transition:xe||0,u_gamma_scale:u?f.transform.getCameraToCenterDistance(ee)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:s.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ye||1,u_ground_shadow_factor:se,u_inv_matrix:s.bi(s.bz(),_)};return ee.name==="globe"&&(he.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],he.u_zoom_transition=q,he.u_inv_rot_matrix=$,he.u_merc_center=V,he.u_camera_forward=me._camera.forward(),he.u_ecef_origin=s.dE(me.globeMatrix,k.toUnwrapped()),he.u_tile_matrix=Float32Array.from(me.globeMatrix),he.u_up_vector=U),he},Fc=(l,t,n,u)=>({u_matrix:l,u_emissive_strength:t,u_opacity:n,u_color:u}),nd=(l,t,n,u,f,m,_,v,w)=>s.l(function(E,A,P,M,k,q){const{width:V,height:$}=M.imageManager.getPixelSize(A),U=Math.pow(2,q.tileID.overscaledZ),ee=q.tileSize*Math.pow(2,M.transform.tileZoom)/U,se=ee*(q.tileID.canonical.x+q.tileID.wrap*U),ae=ee*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[V,$],u_pattern_size:P.displaySize,u_pattern_units_to_pixels:k?[M.transform.width,-1*M.transform.height]:[1/s.aw(q,1,M.transform.tileZoom),1/s.aw(q,1,M.transform.tileZoom)],u_pixel_coord_upper:[se>>16,ae>>16],u_pixel_coord_lower:[65535&se,65535&ae]}}(0,m,_,u,v,w),{u_matrix:l,u_emissive_strength:t,u_opacity:n}),bh=new Float32Array(s.bx([])),xl=(l,t,n,u,f,m,_,v,w,E,A,P,M,k=[0,0,0],q)=>{const V=f.style.light,$=V.properties.get("position"),U=[-$.x,-$.y,$.z],ee=s.dx();V.properties.get("anchor")==="viewport"&&(s.dy(ee,-f.transform.angle),s.dz(U,U,ee));const se=A.alphaMode==="MASK",ae=V.properties.get("color").toRenderColor(null),xe=M.paint.get("model-ambient-occlusion-intensity"),ye=M.paint.get("model-color").constantOr(s.am.white).toRenderColor(null),me=M.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:u||bh,u_lightpos:U,u_lightintensity:V.properties.get("intensity"),u_lightcolor:[ae.r,ae.g,ae.b],u_camera_pos:k,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+se,u_alphaCutoff:A.alphaCutoff,u_baseColorFactor:[_.r,_.g,_.b,_.a],u_emissiveFactor:[v[0],v[1],v[2],1],u_metallicFactor:w,u_roughnessFactor:E,u_baseColorTexture:Ms.BaseColor,u_metallicRoughnessTexture:Ms.MetallicRoughness,u_normalTexture:Ms.Normal,u_occlusionTexture:Ms.Occlusion,u_emissionTexture:Ms.Emission,u_lutTexture:Ms.LUT,u_color_mix:[ye.r,ye.g,ye.b,me],u_aoIntensity:xe,u_emissive_strength:P,u_occlusionTextureTransform:q||[0,0,0,0]}},Jd=(l,t=bh,n=bh)=>({u_matrix:l,u_instance:t,u_node_matrix:n}),Bc={fillExtrusion:l=>({u_matrix:new s.c8(l),u_lightpos:new s.ca(l),u_lightintensity:new s.cb(l),u_lightcolor:new s.ca(l),u_vertical_gradient:new s.cb(l),u_opacity:new s.cb(l),u_edge_radius:new s.cb(l),u_width_scale:new s.cb(l),u_ao:new s.c9(l),u_height_type:new s.cc(l),u_base_type:new s.cc(l),u_tile_id:new s.ca(l),u_zoom_transition:new s.cb(l),u_inv_rot_matrix:new s.c8(l),u_merc_center:new s.c9(l),u_up_dir:new s.ca(l),u_height_lift:new s.cb(l),u_flood_light_color:new s.ca(l),u_vertical_scale:new s.cb(l),u_flood_light_intensity:new s.cb(l),u_ground_shadow_factor:new s.ca(l)}),fillExtrusionDepth:l=>({u_matrix:new s.c8(l),u_edge_radius:new s.cb(l),u_width_scale:new s.cb(l),u_vertical_scale:new s.cb(l),u_height_type:new s.cc(l),u_base_type:new s.cc(l)}),fillExtrusionPattern:l=>({u_matrix:new s.c8(l),u_lightpos:new s.ca(l),u_lightintensity:new s.cb(l),u_lightcolor:new s.ca(l),u_vertical_gradient:new s.cb(l),u_height_factor:new s.cb(l),u_edge_radius:new s.cb(l),u_width_scale:new s.cb(l),u_ao:new s.c9(l),u_height_type:new s.cc(l),u_base_type:new s.cc(l),u_tile_id:new s.ca(l),u_zoom_transition:new s.cb(l),u_inv_rot_matrix:new s.c8(l),u_merc_center:new s.c9(l),u_up_dir:new s.ca(l),u_height_lift:new s.cb(l),u_image:new s.cc(l),u_texsize:new s.c9(l),u_pixel_coord_upper:new s.c9(l),u_pixel_coord_lower:new s.c9(l),u_tile_units_to_pixels:new s.cb(l),u_opacity:new s.cb(l),u_pattern_transition:new s.cb(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new s.c8(l),u_opacity:new s.cb(l),u_ao_pass:new s.cb(l),u_meter_to_tile:new s.cb(l),u_ao:new s.c9(l),u_flood_light_intensity:new s.cb(l),u_flood_light_color:new s.ca(l),u_attenuation:new s.cb(l),u_edge_radius:new s.cb(l),u_fb:new s.cc(l),u_fb_size:new s.cb(l),u_dynamic_offset:new s.cb(l)}),fill:l=>({u_matrix:new s.c8(l),u_emissive_strength:new s.cb(l),u_ground_shadow_factor:new s.ca(l)}),fillPattern:l=>({u_matrix:new s.c8(l),u_emissive_strength:new s.cb(l),u_image:new s.cc(l),u_texsize:new s.c9(l),u_pixel_coord_upper:new s.c9(l),u_pixel_coord_lower:new s.c9(l),u_tile_units_to_pixels:new s.cb(l),u_ground_shadow_factor:new s.ca(l),u_pattern_transition:new s.cb(l)}),fillOutline:l=>({u_matrix:new s.c8(l),u_emissive_strength:new s.cb(l),u_world:new s.c9(l),u_ground_shadow_factor:new s.ca(l)}),fillOutlinePattern:l=>({u_matrix:new s.c8(l),u_emissive_strength:new s.cb(l),u_world:new s.c9(l),u_image:new s.cc(l),u_texsize:new s.c9(l),u_pixel_coord_upper:new s.c9(l),u_pixel_coord_lower:new s.c9(l),u_tile_units_to_pixels:new s.cb(l),u_ground_shadow_factor:new s.ca(l),u_pattern_transition:new s.cb(l)}),building:l=>({u_matrix:new s.c8(l),u_normal_matrix:new s.c8(l),u_opacity:new s.cb(l)}),buildingDepth:l=>({u_matrix:new s.c8(l)}),elevatedStructuresDepth:l=>({u_matrix:new s.c8(l),u_depth_bias:new s.cb(l)}),elevatedStructures:l=>({u_matrix:new s.c8(l),u_ground_shadow_factor:new s.ca(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new s.c8(l),u_camera_pos:new s.ca(l),u_depth_bias:new s.cb(l),u_height_scale:new s.cb(l),u_reset_depth:new s.cb(l)}),circle:s.dF,collisionBox:l=>({u_matrix:new s.c8(l),u_camera_to_center_distance:new s.cb(l),u_extrude_scale:new s.c9(l)}),collisionCircle:l=>({u_matrix:new s.c8(l),u_inv_matrix:new s.c8(l),u_camera_to_center_distance:new s.cb(l),u_viewport_size:new s.c9(l)}),debug:l=>({u_color:new s.di(l),u_matrix:new s.c8(l),u_overlay:new s.cc(l),u_overlay_scale:new s.cb(l)}),clippingMask:l=>({u_matrix:new s.c8(l)}),heatmap:l=>({u_extrude_scale:new s.cb(l),u_intensity:new s.cb(l),u_matrix:new s.c8(l),u_inv_rot_matrix:new s.c8(l),u_merc_center:new s.c9(l),u_tile_id:new s.ca(l),u_zoom_transition:new s.cb(l),u_up_dir:new s.ca(l)}),heatmapTexture:l=>({u_image:new s.cc(l),u_color_ramp:new s.cc(l),u_opacity:new s.cb(l)}),hillshade:l=>({u_matrix:new s.c8(l),u_image:new s.cc(l),u_latrange:new s.c9(l),u_light:new s.c9(l),u_shadow:new s.di(l),u_highlight:new s.di(l),u_emissive_strength:new s.cb(l),u_accent:new s.di(l)}),hillshadePrepare:l=>({u_matrix:new s.c8(l),u_image:new s.cc(l),u_dimension:new s.c9(l),u_zoom:new s.cb(l)}),line:s.dG,linePattern:s.dH,raster:l=>({u_matrix:new s.c8(l),u_normalize_matrix:new s.c8(l),u_globe_matrix:new s.c8(l),u_merc_matrix:new s.c8(l),u_grid_matrix:new s.dj(l),u_tl_parent:new s.c9(l),u_scale_parent:new s.cb(l),u_fade_t:new s.cb(l),u_opacity:new s.cb(l),u_image0:new s.cc(l),u_image1:new s.cc(l),u_brightness_low:new s.cb(l),u_brightness_high:new s.cb(l),u_saturation_factor:new s.cb(l),u_contrast_factor:new s.cb(l),u_spin_weights:new s.ca(l),u_perspective_transform:new s.c9(l),u_raster_elevation:new s.cb(l),u_zoom_transition:new s.cb(l),u_merc_center:new s.c9(l),u_cutoff_params:new s.cQ(l),u_colorization_mix:new s.cQ(l),u_colorization_offset:new s.cb(l),u_color_ramp:new s.cc(l),u_texture_offset:new s.c9(l),u_texture_res:new s.c9(l),u_emissive_strength:new s.cb(l)}),rasterParticle:l=>({u_matrix:new s.c8(l),u_normalize_matrix:new s.c8(l),u_globe_matrix:new s.c8(l),u_merc_matrix:new s.c8(l),u_grid_matrix:new s.dj(l),u_tl_parent:new s.c9(l),u_scale_parent:new s.cb(l),u_fade_t:new s.cb(l),u_opacity:new s.cb(l),u_image0:new s.cc(l),u_image1:new s.cc(l),u_raster_elevation:new s.cb(l),u_zoom_transition:new s.cb(l),u_merc_center:new s.c9(l),u_cutoff_params:new s.cQ(l)}),rasterParticleTexture:l=>({u_texture:new s.cc(l),u_opacity:new s.cb(l)}),rasterParticleDraw:l=>({u_particle_texture:new s.cc(l),u_particle_texture_side_len:new s.cb(l),u_tile_offset:new s.c9(l),u_velocity:new s.cc(l),u_color_ramp:new s.cc(l),u_velocity_res:new s.c9(l),u_max_speed:new s.cb(l),u_uv_offset:new s.c9(l),u_data_scale:new s.c9(l),u_data_offset:new s.cb(l),u_particle_pos_scale:new s.cb(l),u_particle_pos_offset:new s.c9(l)}),rasterParticleUpdate:l=>({u_particle_texture:new s.cc(l),u_particle_texture_side_len:new s.cb(l),u_velocity:new s.cc(l),u_velocity_res:new s.c9(l),u_max_speed:new s.cb(l),u_speed_factor:new s.cb(l),u_reset_rate:new s.cb(l),u_rand_seed:new s.cb(l),u_uv_offset:new s.c9(l),u_data_scale:new s.c9(l),u_data_offset:new s.cb(l),u_particle_pos_scale:new s.cb(l),u_particle_pos_offset:new s.c9(l)}),symbol:l=>({u_is_size_zoom_constant:new s.cc(l),u_is_size_feature_constant:new s.cc(l),u_size_t:new s.cb(l),u_size:new s.cb(l),u_camera_to_center_distance:new s.cb(l),u_rotate_symbol:new s.cc(l),u_aspect_ratio:new s.cb(l),u_fade_change:new s.cb(l),u_matrix:new s.c8(l),u_label_plane_matrix:new s.c8(l),u_coord_matrix:new s.c8(l),u_is_text:new s.cc(l),u_elevation_from_sea:new s.cc(l),u_pitch_with_map:new s.cc(l),u_texsize:new s.c9(l),u_texsize_icon:new s.c9(l),u_texture:new s.cc(l),u_texture_icon:new s.cc(l),u_gamma_scale:new s.cb(l),u_device_pixel_ratio:new s.cb(l),u_tile_id:new s.ca(l),u_zoom_transition:new s.cb(l),u_inv_rot_matrix:new s.c8(l),u_merc_center:new s.c9(l),u_camera_forward:new s.ca(l),u_tile_matrix:new s.c8(l),u_up_vector:new s.ca(l),u_ecef_origin:new s.ca(l),u_is_halo:new s.cc(l),u_icon_transition:new s.cb(l),u_color_adj_mat:new s.c8(l),u_scale_factor:new s.cb(l),u_ground_shadow_factor:new s.ca(l),u_inv_matrix:new s.c8(l)}),background:l=>({u_matrix:new s.c8(l),u_emissive_strength:new s.cb(l),u_opacity:new s.cb(l),u_color:new s.di(l)}),backgroundPattern:l=>({u_matrix:new s.c8(l),u_emissive_strength:new s.cb(l),u_opacity:new s.cb(l),u_image:new s.cc(l),u_pattern_tl:new s.c9(l),u_pattern_br:new s.c9(l),u_texsize:new s.c9(l),u_pattern_size:new s.c9(l),u_pixel_coord_upper:new s.c9(l),u_pixel_coord_lower:new s.c9(l),u_pattern_units_to_pixels:new s.c9(l)}),terrainRaster:l=>({u_matrix:new s.c8(l),u_image0:new s.cc(l),u_skirt_height:new s.cb(l),u_ground_shadow_factor:new s.ca(l)}),skybox:l=>({u_matrix:new s.c8(l),u_sun_direction:new s.ca(l),u_cubemap:new s.cc(l),u_opacity:new s.cb(l),u_temporal_offset:new s.cb(l)}),skyboxGradient:l=>({u_matrix:new s.c8(l),u_color_ramp:new s.cc(l),u_center_direction:new s.ca(l),u_radius:new s.cb(l),u_opacity:new s.cb(l),u_temporal_offset:new s.cb(l)}),skyboxCapture:l=>({u_matrix_3f:new s.dj(l),u_sun_direction:new s.ca(l),u_sun_intensity:new s.cb(l),u_color_tint_r:new s.cQ(l),u_color_tint_m:new s.cQ(l),u_luminance:new s.cb(l)}),globeRaster:l=>({u_proj_matrix:new s.c8(l),u_globe_matrix:new s.c8(l),u_normalize_matrix:new s.c8(l),u_merc_matrix:new s.c8(l),u_zoom_transition:new s.cb(l),u_merc_center:new s.c9(l),u_image0:new s.cc(l),u_grid_matrix:new s.dj(l),u_skirt_height:new s.cb(l),u_far_z_cutoff:new s.cb(l),u_frustum_tl:new s.ca(l),u_frustum_tr:new s.ca(l),u_frustum_br:new s.ca(l),u_frustum_bl:new s.ca(l),u_globe_pos:new s.ca(l),u_globe_radius:new s.cb(l),u_viewport:new s.c9(l)}),globeAtmosphere:l=>({u_frustum_tl:new s.ca(l),u_frustum_tr:new s.ca(l),u_frustum_br:new s.ca(l),u_frustum_bl:new s.ca(l),u_horizon:new s.cb(l),u_transition:new s.cb(l),u_fadeout_range:new s.cb(l),u_color:new s.cQ(l),u_high_color:new s.cQ(l),u_space_color:new s.cQ(l),u_temporal_offset:new s.cb(l),u_horizon_angle:new s.cb(l)}),model:l=>({u_matrix:new s.c8(l),u_lighting_matrix:new s.c8(l),u_normal_matrix:new s.c8(l),u_node_matrix:new s.c8(l),u_lightpos:new s.ca(l),u_lightintensity:new s.cb(l),u_lightcolor:new s.ca(l),u_camera_pos:new s.ca(l),u_opacity:new s.cb(l),u_baseColorFactor:new s.cQ(l),u_emissiveFactor:new s.cQ(l),u_metallicFactor:new s.cb(l),u_roughnessFactor:new s.cb(l),u_baseTextureIsAlpha:new s.cc(l),u_alphaMask:new s.cc(l),u_alphaCutoff:new s.cb(l),u_baseColorTexture:new s.cc(l),u_metallicRoughnessTexture:new s.cc(l),u_normalTexture:new s.cc(l),u_occlusionTexture:new s.cc(l),u_emissionTexture:new s.cc(l),u_lutTexture:new s.cc(l),u_color_mix:new s.cQ(l),u_aoIntensity:new s.cb(l),u_emissive_strength:new s.cb(l),u_occlusionTextureTransform:new s.cQ(l)}),modelDepth:l=>({u_matrix:new s.c8(l),u_instance:new s.c8(l),u_node_matrix:new s.c8(l)}),groundShadow:l=>({u_matrix:new s.c8(l),u_ground_shadow_factor:new s.ca(l)}),stars:l=>({u_matrix:new s.c8(l),u_up:new s.ca(l),u_right:new s.ca(l),u_intensity_multiplier:new s.cb(l)}),snowParticle:l=>({u_modelview:new s.c8(l),u_projection:new s.c8(l),u_time:new s.cb(l),u_cam_pos:new s.ca(l),u_velocityConeAperture:new s.cb(l),u_velocity:new s.cb(l),u_horizontalOscillationRadius:new s.cb(l),u_horizontalOscillationRate:new s.cb(l),u_boxSize:new s.cb(l),u_billboardSize:new s.cb(l),u_simpleShapeParameters:new s.c9(l),u_screenSize:new s.c9(l),u_thinningCenterPos:new s.c9(l),u_thinningShape:new s.ca(l),u_thinningAffectedRatio:new s.cb(l),u_thinningParticleOffset:new s.cb(l),u_particleColor:new s.cQ(l),u_direction:new s.ca(l)}),rainParticle:l=>({u_modelview:new s.c8(l),u_projection:new s.c8(l),u_time:new s.cb(l),u_cam_pos:new s.ca(l),u_texScreen:new s.cc(l),u_velocityConeAperture:new s.cb(l),u_velocity:new s.cb(l),u_boxSize:new s.cb(l),u_rainDropletSize:new s.c9(l),u_distortionStrength:new s.cb(l),u_rainDirection:new s.ca(l),u_color:new s.cQ(l),u_screenSize:new s.c9(l),u_thinningCenterPos:new s.c9(l),u_thinningShape:new s.ca(l),u_thinningAffectedRatio:new s.cb(l),u_thinningParticleOffset:new s.cb(l),u_shapeDirectionalPower:new s.cb(l),u_shapeNormalPower:new s.cb(l),u_mode:new s.cb(l)}),vignette:l=>({u_vignetteShape:new s.ca(l),u_vignetteColor:new s.cQ(l)}),occlusion:l=>({u_matrix:new s.c8(l),u_anchorPos:new s.ca(l),u_screenSizePx:new s.c9(l),u_occluderSizePx:new s.c9(l),u_color:new s.cQ(l)})};class tl{constructor(t,n,u,f){this.id=tl.uniqueIdxCounter,tl.uniqueIdxCounter++,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||f||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=tl.uniqueIdxCounter,tl.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}tl.uniqueIdxCounter=0;const yp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $u{constructor(t,n,u,f,m,_){this.length=n.length,this.attributes=u,this.itemSize=n.bytesPerElement,this.dynamicDraw=f,this.instanceCount=_,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),t.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||m||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let u=0;u<this.attributes.length;u++){const f=n.attributes[this.attributes[u].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,n,u){for(let f=0;f<this.attributes.length;f++){const m=this.attributes[f],_=n.attributes[m.name];_!==void 0&&t.vertexAttribPointer(_,m.components,t[yp[m.type]],!1,this.itemSize,m.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,n,u){for(let f=0;f<this.attributes.length;f++){const m=n.attributes[this.attributes[f].name];m!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(m,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wu{constructor(t,n,u,f,m){this.context=t,this.width=n,this.height=u;const _=this.framebuffer=t.gl.createFramebuffer();f&&(this.colorAttachment=new gp(t,_)),m&&(this.depthAttachmentType=m,this.depthAttachment=m==="renderbuffer"?new Qh(t,_):new Zl(t,_))}destroy(){const t=this.context.gl;if(this.colorAttachment){const n=this.colorAttachment.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class Zu{constructor(t,n){this.gl=t,this.clearColor=new Vf(this),this.clearDepth=new ho(this),this.clearStencil=new Gd(this),this.colorMask=new dh(this),this.depthMask=new fh(this),this.stencilMask=new ph(this),this.stencilFunc=new Hd(this),this.stencilOp=new Ic(this),this.stencilTest=new Ac(this),this.depthRange=new Gl(this),this.depthTest=new Kh(this),this.depthFunc=new Vu(this),this.blend=new $d(this),this.blendFunc=new Wd(this),this.blendColor=new Hl(this),this.blendEquation=new _u(this),this.cullFace=new Cc(this),this.cullFaceSide=new Mc(this),this.frontFace=new yu(this),this.program=new Pc(this),this.activeTexture=new Zd(this),this.viewport=new Xd(this),this.bindFramebuffer=new Yd(this),this.bindRenderbuffer=new Jh(this),this.bindTexture=new ju(this),this.bindVertexBuffer=new $l(this),this.bindElementBuffer=new Kd(this),this.bindVertexArrayOES=new Uu(this),this.pixelStoreUnpack=new js(this),this.pixelStoreUnpackPremultiplyAlpha=new Rc(this),this.pixelStoreUnpackFlipY=new Wl(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,u){return new tl(this,t,n,u)}createVertexBuffer(t,n,u,f,m){return new $u(this,t,n,u,f,m)}createRenderbuffer(t,n,u){const f=this.gl,m=f.createRenderbuffer();return this.bindRenderbuffer.set(m),f.renderbufferStorage(f.RENDERBUFFER,t,n,u),this.bindRenderbuffer.set(null),m}createFramebuffer(t,n,u,f){return new Wu(this,t,n,u,f)}clear({color:t,depth:n,stencil:u,colorMask:f}){const m=this.gl;let _=0;t&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(f||[!0,!0,!0,!0])),n!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),u!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),m.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bv(t.blendFunction,Ft.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let xu;function rl(l,t,n,u,f,m,_){const v=l.context,w=v.gl,E=l.transform,A=l.getOrCreateProgram("collisionBox"),P=[];let M=0,k=0;for(let ae=0;ae<u.length;ae++){const xe=u[ae],ye=t.getTile(xe),me=ye.getBucket(n);if(!me)continue;const he=Ya(xe,me,E);let Te=he;f[0]===0&&f[1]===0||(Te=l.translatePosMatrix(he,ye,f,m));const Ae=_?me.textCollisionBox:me.iconCollisionBox,rt=me.collisionCircleArray;if(rt.length>0){const Ge=s.bz(),ft=Te;s.cB(Ge,me.placementInvProjMatrix,E.glCoordMatrix),s.cB(Ge,Ge,me.placementViewportMatrix),P.push({circleArray:rt,circleOffset:k,transform:ft,invTransform:Ge,projection:me.getProjection()}),M+=rt.length/4,k=M}Ae&&(l.terrain&&l.terrain.setupElevationDraw(ye,A),A.draw(l,w.LINES,Rt.disabled,rr.disabled,l.colorModeForRenderPass(),Dr.disabled,ga(Te,E,ye,me.getProjection()),n.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,E.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!_||!P.length)return;const q=l.getOrCreateProgram("collisionCircle"),V=new s.dI;V.resize(4*M),V._trim();let $=0;for(const ae of P)for(let xe=0;xe<ae.circleArray.length/4;xe++){const ye=4*xe,me=ae.circleArray[ye+0],he=ae.circleArray[ye+1],Te=ae.circleArray[ye+2],Ae=ae.circleArray[ye+3];V.emplace($++,me,he,Te,Ae,0),V.emplace($++,me,he,Te,Ae,1),V.emplace($++,me,he,Te,Ae,2),V.emplace($++,me,he,Te,Ae,3)}(!xu||xu.length<2*M)&&(xu=function(ae){const xe=2*ae,ye=new s.a_;ye.resize(xe),ye._trim();for(let me=0;me<xe;me++){const he=6*me;ye.uint16[he+0]=4*me+0,ye.uint16[he+1]=4*me+1,ye.uint16[he+2]=4*me+2,ye.uint16[he+3]=4*me+2,ye.uint16[he+4]=4*me+3,ye.uint16[he+5]=4*me+0}return ye}(M));const U=v.createIndexBuffer(xu,!0),ee=v.createVertexBuffer(V,s.dJ.members,!0);for(const ae of P){const xe={u_matrix:ae.transform,u_inv_matrix:ae.invTransform,u_camera_to_center_distance:(se=E).getCameraToCenterDistance(ae.projection),u_viewport_size:[se.width,se.height]};q.draw(l,w.TRIANGLES,Rt.disabled,rr.disabled,l.colorModeForRenderPass(),Dr.disabled,xe,n.id,ee,U,s.bd.simpleSegment(0,2*ae.circleOffset,ae.circleArray.length,ae.circleArray.length/2),null,E.zoom)}var se;ee.destroy(),U.destroy()}const Nc=s.bz();function bu(l){const t=l._camera.getWorldToCamera(l.worldSize,1),n=s.az([],t,l.globeMatrix);s.bi(n,n);const u=[0,0,0],f=[0,1,0,0];return s.aA(f,f,n),u[0]=f[0],u[1]=f[1],u[2]=f[2],s.au(u,u),u}function Xu({width:l,height:t,anchor:n,textOffset:u,textScale:f},m){const{horizontalAlign:_,verticalAlign:v}=s.bV(n),w=-(_-.5)*l,E=-(v-.5)*t,A=s.bU(n,u);return new s.P((w/f+A[0])*m,(E/f+A[1])*m)}function wu(l,t,n,u,f,m,_,v,w,E){const A=l.text.placedSymbolArray,P=l.text.dynamicLayoutVertexArray,M=l.icon.dynamicLayoutVertexArray,k={},q=l.getProjection(),V=ua(_,q,f),$=f.elevation,U=q.upVectorScale(_.canonical,f.center.lat,f.worldSize).metersToTile;P.clear();for(let ee=0;ee<A.length;ee++){const se=A.get(ee),{tileAnchorX:ae,tileAnchorY:xe,numGlyphs:ye}=se,me=se.hidden||!se.crossTileID||l.allowVerticalPlacement&&!se.placedOrientation?null:u[se.crossTileID];if(me){let he=0,Te=0,Ae=0;if($){const vt=$?$.getAtTileOffset(_,ae,xe):0,[it,Et,yt]=q.upVector(_.canonical,ae,xe);he=vt*it*U,Te=vt*Et*U,Ae=vt*yt*U}let[rt,Ge,ft,mt]=Co(se.projectedAnchorX+he,se.projectedAnchorY+Te,se.projectedAnchorZ+Ae,n?V:m);const Bt=Ks(f.getCameraToCenterDistance(q),mt);let je=s.bJ(l.textSizeData,w,se)*Bt/s.bO;n&&(je*=l.tilePixelRatio/v);const tt=Xu(me,je);n?({x:rt,y:Ge,z:ft}=q.projectTilePoint(ae+tt.x,xe+tt.y,_.canonical),[rt,Ge,ft]=Co(rt+he,Ge+Te,ft+Ae,m)):(t&&tt._rotate(-f.angle),rt+=tt.x,Ge+=tt.y,ft=0);const Ve=l.allowVerticalPlacement&&se.placedOrientation===s.bI.vertical?Math.PI/2:0;for(let vt=0;vt<ye;vt++)s.bL(P,rt,Ge,ft,Ve);E&&se.associatedIconIndex>=0&&(k[se.associatedIconIndex]={x:rt,y:Ge,z:ft,angle:Ve})}else ai(ye,P)}if(E){M.clear();const ee=l.icon.placedSymbolArray;for(let se=0;se<ee.length;se++){const ae=ee.get(se),{numGlyphs:xe}=ae,ye=k[se];if(ae.hidden||!ye)ai(xe,M);else{const{x:me,y:he,z:Te,angle:Ae}=ye;for(let rt=0;rt<xe;rt++)s.bL(M,me,he,Te,Ae)}}l.icon.dynamicLayoutVertexBuffer.updateData(M)}l.text.dynamicLayoutVertexBuffer.updateData(P)}function Vc(l,t,n,u,f,m,_={}){const v=n.paint.get("icon-translate"),w=n.paint.get("text-translate"),E=n.paint.get("icon-translate-anchor"),A=n.paint.get("text-translate-anchor"),P=n.layout.get("icon-rotation-alignment"),M=n.layout.get("text-rotation-alignment"),k=n.layout.get("icon-pitch-alignment"),q=n.layout.get("text-pitch-alignment"),V=n.layout.get("icon-keep-upright"),$=n.layout.get("text-keep-upright"),U=n.paint.get("icon-color-saturation"),ee=n.paint.get("icon-color-contrast"),se=n.paint.get("icon-color-brightness-min"),ae=n.paint.get("icon-color-brightness-max"),xe=n.layout.get("symbol-elevation-reference")==="sea",ye=l.context,me=ye.gl,he=l.transform,Te=P==="map",Ae=M==="map",rt=k==="map",Ge=q==="map",ft=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let mt=!1;const Bt=l.depthModeForSublayer(0,Rt.ReadOnly),je=new Rt(l.context.gl.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D),tt=[s.ay(he.center.lng),s.aH(he.center.lat)],Ve=n.layout.get("text-variable-anchor"),vt=he.projection.name==="globe",it=[],Et=[0,-1,0];for(const yt of u){const Mt=t.getTile(yt),Dt=Mt.getBucket(n);if(!Dt||Dt.projection.name==="mercator"&&vt||Dt.fullyClipped)continue;const ur=Dt.projection.name==="globe",gr=ur?s.ah(he.zoom):0,Kt=ua(yt,Dt.getProjection(),he),pr=he.calculatePixelsToTileUnitsMatrix(Mt),nr=Ve&&Dt.hasTextData(),Ir=Dt.hasIconTextFit()&&nr&&Dt.hasIconData(),Ur=Dt.elevationType==="road"?je:Bt,li=Dt.getProjection().createInversionMatrix(he,yt.canonical),Xi=l.shadowRenderer,Yi=Dt.elevationType==="road"&&!!Xi&&Xi.enabled;let ei=[0,0,0];if(Yi){const Tn=l.style.directionalLight,ti=l.style.ambientLight;Tn&&ti&&(ei=Da(l.style,Tn,ti))}const Ln=Tn=>{he.depthOcclusionForSymbolsAndCircles&&(n.hasInitialOcclusionOpacityProperties||l.terrain)&&(Tn.push("DEPTH_D24"),Tn.push("DEPTH_OCCLUSION"))},_n=()=>{const Tn=Te&&n.layout.get("symbol-placement")!=="point",ti=[];Ln(ti);const cn=Tn||Ir,Li=n.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&rt&&ti.push("PITCH_WITH_MAP_TERRAIN"),ur&&(ti.push("PROJECTION_GLOBE_VIEW"),cn&&ti.push("PROJECTED_POS_ON_VIEWPORT")),Li>0&&ti.push("ICON_TRANSITION"),Dt.icon.zOffsetVertexBuffer&&ti.push("Z_OFFSET"),U===0&&ee===0&&se===0&&ae===1||ti.push("COLOR_ADJUSTMENT"),Dt.sdfIcons&&ti.push("RENDER_SDF"),Yi&&ti.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const en=Dt.icon.programConfigurations.get(n.id),Gi=l.getOrCreateProgram("symbol",{config:en,defines:ti}),on=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],To=Dt.iconSizeData,yi=s.bH(To,he.zoom),Uo=rt||he.pitch!==0,Jn=Wa(Kt,Mt.tileID.canonical,rt,Te,he,Dt.getProjection(),pr),Jo=su(Kt,Mt.tileID.canonical,rt,Te,he,Dt.getProjection(),pr),al=l.translatePosMatrix(Jo,Mt,v,E,!0),Rl=l.translatePosMatrix(Kt,Mt,v,E),Hs=cn?Nc:Jn,Ua=Te&&!rt&&!Tn;let Ro=Et;!vt&&!he.mercatorFromTransition||Te||(Ro=bu(he));const qa=ur?Ro:Et,ll=n.getColorAdjustmentMatrix(U,ee,se,ae),wa=xh(To.kind,yi,Ua,rt,l,Rl,Hs,al,xe,!1,on,[0,0],!0,yt,gr,tt,li,qa,Dt.getProjection(),ei,ll,Li),Dl=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,kl=n.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear,oc=Dt.sdfIcons||l.options.rotating||l.options.zooming||kl||Uo?me.LINEAR:me.NEAREST,Kc=Dt.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,sc=l.terrain&&rt&&Tn?s.bi(s.bz(),Jn):Nc;if(Tn&&Dt.icon){const yn=he.elevation,ku=yn?yn.getAtTileOffsetFunc(yt,he.center.lat,he.worldSize,Dt.getProjection()):null,df=Aa(Kt,Mt.tileID.canonical,rt,Te,he,Dt.getProjection(),pr);la(Dt,Kt,l,!1,df,Jo,rt,V,ku,yt)}return{program:Gi,buffers:Dt.icon,uniformValues:wa,atlasTexture:Dl,atlasTextureIcon:null,atlasInterpolation:oc,atlasInterpolationIcon:null,isSDF:Dt.sdfIcons,hasHalo:Kc,depthMode:Ur,tile:Mt,renderWithShadows:Yi,labelPlaneMatrixInv:sc}},Hr=()=>{const Tn=Ae&&n.layout.get("symbol-placement")!=="point",ti=[],cn=Tn||Ve||Ir;l.terrainRenderModeElevated()&&Ge&&ti.push("PITCH_WITH_MAP_TERRAIN"),ur&&(ti.push("PROJECTION_GLOBE_VIEW"),cn&&ti.push("PROJECTED_POS_ON_VIEWPORT")),Dt.text.zOffsetVertexBuffer&&ti.push("Z_OFFSET"),Dt.iconsInText&&ti.push("RENDER_TEXT_AND_SYMBOL"),ti.push("RENDER_SDF"),Yi&&ti.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ln(ti);const Li=Dt.text.programConfigurations.get(n.id),en=l.getOrCreateProgram("symbol",{config:Li,defines:ti});let Gi,on=[0,0],To=null;const yi=Dt.textSizeData;Dt.iconsInText&&(on=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],To=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,Gi=Ge||he.pitch!==0||l.options.rotating||l.options.zooming||yi.kind==="composite"||yi.kind==="camera"?me.LINEAR:me.NEAREST);const Uo=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture.size:[0,0],Jn=n.layout.get("text-size-scale-range"),Jo=s.aD(l.scaleFactor,Jn[0],Jn[1]),al=s.bH(yi,he.zoom,Jo),Rl=Wa(Kt,Mt.tileID.canonical,Ge,Ae,he,Dt.getProjection(),pr),Hs=su(Kt,Mt.tileID.canonical,Ge,Ae,he,Dt.getProjection(),pr),Ua=l.translatePosMatrix(Hs,Mt,w,A,!0),Ro=l.translatePosMatrix(Kt,Mt,w,A),qa=cn?Nc:Rl,ll=Ae&&!Ge&&!Tn;let wa=Et;!vt&&!he.mercatorFromTransition||Ae||(wa=bu(he));const Dl=xh(yi.kind,al,ll,Ge,l,Ro,qa,Ua,xe,!0,Uo,on,!0,yt,gr,tt,li,ur?wa:Et,Dt.getProjection(),ei,null,null,Jo),kl=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture:null,oc=me.LINEAR,Kc=n.paint.get("text-halo-width").constantOr(1)!==0,sc=l.terrain&&Ge&&Tn?s.bi(s.bz(),Rl):Nc;if(Tn&&Dt.text){const yn=he.elevation,ku=yn?yn.getAtTileOffsetFunc(yt,he.center.lat,he.worldSize,Dt.getProjection()):null,df=Aa(Kt,Mt.tileID.canonical,Ge,Ae,he,Dt.getProjection(),pr);la(Dt,Kt,l,!0,df,Hs,Ge,$,ku,yt)}return{program:en,buffers:Dt.text,uniformValues:Dl,atlasTexture:kl,atlasTextureIcon:To,atlasInterpolation:oc,atlasInterpolationIcon:Gi,isSDF:!0,hasHalo:Kc,depthMode:Ur,tile:Mt,renderWithShadows:Yi,labelPlaneMatrixInv:sc}},wi=Dt.icon.segments.get().length,Si=Dt.text.segments.get().length,Ki=wi&&!_.onlyText?_n():null,uo=Si&&!_.onlyIcons?Hr():null,zn=n.paint.get("icon-opacity").constantOr(1),Wn=n.paint.get("text-opacity").constantOr(1);if(ft&&Dt.canOverlap){mt=!0;const Tn=zn&&!_.onlyText?Dt.icon.segments.get():[],ti=Wn&&!_.onlyIcons?Dt.text.segments.get():[];for(const cn of Tn)it.push({segments:new s.bd([cn]),sortKey:cn.sortKey,state:Ki});for(const cn of ti)it.push({segments:new s.bd([cn]),sortKey:cn.sortKey,state:uo})}else _.onlyText||it.push({segments:zn?Dt.icon.segments:new s.bd([]),sortKey:0,state:Ki}),_.onlyIcons||it.push({segments:Wn?Dt.text.segments:new s.bd([]),sortKey:0,state:uo})}mt&&it.sort((yt,Mt)=>yt.sortKey-Mt.sortKey);for(const yt of it){const Mt=yt.state;if(Mt)if(l.terrain?l.terrain.setupElevationDraw(Mt.tile,Mt.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Mt.labelPlaneMatrixInv}):l.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,Mt.program),ye.activeTexture.set(me.TEXTURE0),Mt.atlasTexture&&Mt.atlasTexture.bind(Mt.atlasInterpolation,me.CLAMP_TO_EDGE,!0),Mt.atlasTextureIcon&&(ye.activeTexture.set(me.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,me.CLAMP_TO_EDGE,!0)),Mt.renderWithShadows&&l.shadowRenderer.setupShadows(Mt.tile.tileID.toUnwrapped(),Mt.program,"vector-tile",Mt.tile.tileID.overscaledZ),l.uploadCommonLightUniforms(l.context,Mt.program),Mt.hasHalo){const Dt=Mt.uniformValues;Dt.u_is_halo=1,wh(Mt.buffers,yt.segments,n,l,Mt.program,Mt.depthMode,f,m,Dt,2),Dt.u_is_halo=0}else{if(Mt.isSDF){const Dt=Mt.uniformValues;Mt.hasHalo&&(Dt.u_is_halo=1,wh(Mt.buffers,yt.segments,n,l,Mt.program,Mt.depthMode,f,m,Dt,1)),Dt.u_is_halo=0}wh(Mt.buffers,yt.segments,n,l,Mt.program,Mt.depthMode,f,m,Mt.uniformValues,1)}}}function wh(l,t,n,u,f,m,_,v,w,E){const A=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer];f.draw(u,u.context.gl.TRIANGLES,m,_,v,Dr.disabled,w,n.id,l.layoutVertexBuffer,l.indexBuffer,t,n.paint,u.transform.zoom,l.programConfigurations.get(n.id),A,E)}function Su(l,t){const n=1<<l.canonical.z,u=(t.x*n-l.canonical.x-l.wrap*n)*s.aj,f=(t.y*n-l.canonical.y)*s.aj,m=s.dS(t.z,t.y);return s.cS(u,f,m)}function Yu(l,t,n,u,f){if(!n.layout||n.layout.get("fill-elevation-reference")==="none")return;const m=l.context.gl,_=new Rt(l.context.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D),v=new Rt(l.context.gl.GREATER,Rt.ReadWrite,l.depthRangeFor3D),w=function(k){const q=s.cJ(k.pitch);let V=.01;return k.isOrthographic&&(V=s.ai(1e-4,V,s.cO(q>=jl?1:q/jl))),2*V}(l.transform),E=l.transform.getFreeCameraOptions().position,A="elevatedStructuresDepthReconstruct",P=l.getOrCreateProgram(A,{defines:["DEPTH_RECONSTRUCTION"]}),M=l.getOrCreateProgram(A);for(const k of u){const q=t.getTile(k),V=q.getBucket(n);if(!V)continue;const $=V.elevatedStructures;if(!$)continue;const U=V.elevationBufferData.heightRange,ee=Su(k.toUnwrapped(),E),se=l.translatePosMatrix(k.projMatrix,q,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));let ae,xe,ye,me;if(f==="initialize"){if(!U||U.min>=1||$.depthSegments.segments[0].primitiveLength===0)continue;ae=Ps(se,ee,w,1,0),xe=_,ye=$.depthSegments,me=P}else if(f==="reset"){if(!U||U.min>=0||$.maskSegments.segments[0].primitiveLength===0)continue;ae=Ps(se,ee,0,0,1),xe=v,ye=$.maskSegments,me=P}else if(f==="geometry"){if($.depthSegments.segments[0].primitiveLength===0)continue;ae=Ps(se,ee,w,1,0),xe=_,ye=$.depthSegments,me=M}me.draw(l,m.TRIANGLES,xe,rr.disabled,Ft.disabled,Dr.disabled,ae,n.id,$.vertexBuffer,$.indexBuffer,ye,n.paint,l.transform.zoom)}}function ir(l,t,n){const{painter:u,sourceCache:f,layer:m,coords:_,colorMode:v,elevationType:w,terrainEnabled:E,pass:A}=l,P=u.context.gl,M=m.paint.get("fill-pattern"),k=m.paint.get("fill-pattern-cross-fade"),q=M.constantOr(null);let V=w;w!=="road"||t&&!E||(V="none");const $=V==="road",U=l.painter.shadowRenderer,ee=$&&!!U&&U.enabled,se=new Rt(u.context.gl.LEQUAL,Rt.ReadOnly,u.depthRangeFor3D);let ae=[0,0,0];if(ee){const me=u.style.directionalLight,he=u.style.ambientLight;me&&he&&(ae=Da(u.style,me,he))}const xe=M&&M.constantOr(1),ye=(me,he)=>{let Te,Ae,rt,Ge,ft;he?(Te=xe&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",rt=P.LINES):(Te=xe?"fillPattern":"fill",rt=P.TRIANGLES);for(const mt of _){const Bt=f.getTile(mt);if(xe&&!Bt.patternsLoaded())continue;const je=Bt.getBucket(m);if(!je)continue;const tt=t?je.elevationBufferData:je.bufferData;if(tt.isEmpty())continue;u.prepareDrawTile();const Ve=tt.programConfigurations.get(m.id),vt=u.isTileAffectedByFog(mt),it=[],Et=[];$&&(it.push("ELEVATED_ROADS"),Et.push(tt.elevatedLayoutVertexBuffer)),ee&&it.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xe&&(u.context.activeTexture.set(P.TEXTURE0),Bt.imageAtlasTexture&&Bt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ve.updatePaintBuffers());let yt=!1;if(q&&Bt.imageAtlas){const Kt=Bt.imageAtlas,pr=s.dN.from(q),nr=pr.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),Ir=pr.getSecondary(),Ur=Kt.patternPositions.get(nr),li=Ir?Kt.patternPositions.get(Ir.scaleSelf(s.q.devicePixelRatio).toString()):null;yt=!!Ur&&!!li,Ur&&Ve.setConstantPatternPositions(Ur,li)}k>0&&(yt||Ve.getPatternTransitionVertexBuffer("fill-pattern"))&&it.push("FILL_PATTERN_TRANSITION");const Mt=u.getOrCreateProgram(Te,{config:Ve,overrideFog:vt,defines:it}),Dt=u.translatePosMatrix(mt.projMatrix,Bt,m.paint.get("fill-translate"),m.paint.get("fill-translate-anchor"));ee&&U.setupShadows(Bt.tileID.toUnwrapped(),Mt,"vector-tile",Bt.tileID.overscaledZ);const ur=m.paint.get("fill-emissive-strength");if(he){Ge=tt.lineIndexBuffer,ft=tt.lineSegments;const Kt=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[P.drawingBufferWidth,P.drawingBufferHeight];Ae=Te==="fillOutlinePattern"&&xe?td(Dt,ur,u,Bt,Kt,ae,k):zc(Dt,ur,Kt,ae)}else Ge=tt.indexBuffer,ft=tt.triangleSegments,Ae=xe?Hu(Dt,ur,u,Bt,ae,k):Kl(Dt,ur,ae);u.uploadCommonUniforms(u.context,Mt,mt.toUnwrapped());let gr=me;(w==="road"&&!E||w==="offset")&&(gr=se),Mt.draw(u,rt,gr,n||u.stencilModeForClipping(mt),v,Dr.disabled,Ae,m.id,tt.layoutVertexBuffer,Ge,ft,m.paint,u.transform.zoom,Ve,Et)}};u.renderPass===A&&ye(u.depthModeForSublayer(1,u.renderPass==="opaque"?Rt.ReadWrite:Rt.ReadOnly),!1),V==="none"&&u.renderPass==="translucent"&&m.paint.get("fill-antialias")&&ye(u.depthModeForSublayer(m.getPaintProperty("fill-outline-color")?2:0,Rt.ReadOnly),!0)}function Rs(l,t,n,u,f,m,_,v){n.resetLayerRenderingStats(l);const w=l.context,E=w.gl,A=l.transform,P=n.paint.get("fill-extrusion-pattern"),M=n.paint.get("fill-extrusion-pattern-cross-fade"),k=P.constantOr(null),q=P.constantOr(1),V=n.paint.get("fill-extrusion-opacity"),$=l.style.enable3dLights(),U=n.paint.get($&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ee=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],se=n.layout.get("fill-extrusion-edge-radius"),ae=se>0&&!n.paint.get("fill-extrusion-rounded-roof"),xe=ae?0:se,ye=A.projection.name==="globe"?s.dT():0,me=A.projection.name==="globe",he=me?s.ah(A.zoom):0,Te=[s.ay(A.center.lng),s.aH(A.center.lat)],Ae=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",rt=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(Ae?null:n.lut).toArray01().slice(0,3),Ge=n.paint.get("fill-extrusion-flood-light-intensity"),ft=n.paint.get("fill-extrusion-vertical-scale"),mt=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Bt=n.paint.get("fill-extrusion-height-alignment"),je=n.paint.get("fill-extrusion-base-alignment"),tt=Ja(l,n.paint.get("fill-extrusion-cutoff-fade-range")),Ve=[];let vt;me&&Ve.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&Ve.push("FAUX_AO"),ae&&Ve.push("ZERO_ROOF_RADIUS"),v&&Ve.push("HAS_CENTROID"),Ge>0&&Ve.push("FLOOD_LIGHT"),tt.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),mt&&Ve.push("RENDER_WALL_MODE");const it=l.renderPass==="shadow",Et=l.shadowRenderer,yt=it&&!!Et,Mt=it?Dr.disabled:Dr.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let Dt=[0,0,0];if(Et){const Kt=l.style.directionalLight,pr=l.style.ambientLight;Kt&&pr&&(Dt=Da(l.style,Kt,pr)),it||(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Et.useNormalOffset&&Ve.push("NORMAL_OFFSET")),vt=Ve.concat(["SHADOWS_SINGLE_CASCADE"])}const ur=yt?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",gr=n.getLayerRenderingStats();for(const Kt of u){const pr=t.getTile(Kt),nr=pr.getBucket(n);if(!nr||nr.projection.name!==A.projection.name)continue;let Ir=!1;Et&&(Ir=Et.getMaxCascadeForTile(Kt.toUnwrapped())===0);const Ur=l.isTileAffectedByFog(Kt),li=nr.programConfigurations.get(n.id);let Xi=!1;if(k&&pr.imageAtlas){const Si=pr.imageAtlas,Ki=s.dN.from(k),uo=Ki.getPrimary().scaleSelf(s.q.devicePixelRatio).toString(),zn=Ki.getSecondary(),Wn=Si.patternPositions.get(uo),Tn=zn?Si.patternPositions.get(zn.scaleSelf(s.q.devicePixelRatio).toString()):null;Xi=!!Wn&&!!Tn,Wn&&li.setConstantPatternPositions(Wn,Tn)}M>0&&(Xi||li.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ve.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Yi=l.getOrCreateProgram(ur,{config:li,defines:Ir?vt:Ve,overrideFog:Ur});if(l.terrain&&l.terrain.setupElevationDraw(pr,Yi,{useMeterToDem:!0}),!nr.centroidVertexBuffer){const Si=Yi.attributes.a_centroid_pos;Si!==void 0&&E.vertexAttrib2f(Si,0,0)}!it&&Et&&Et.setupShadows(pr.tileID.toUnwrapped(),Yi,"vector-tile",pr.tileID.overscaledZ),q&&(l.context.activeTexture.set(E.TEXTURE0),pr.imageAtlasTexture&&pr.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),li.updatePaintBuffers());const ei=n.paint.get("fill-extrusion-vertical-gradient"),Ln=1/nr.tileToMeter;let _n;if(it&&Et){if(Qd(pr.tileID,nr,l))continue;const Si=Et.calculateShadowPassMatrixFromTile(pr.tileID.toUnwrapped());_n=jf(Si,xe,Ln,ft,Bt,je)}else{const Si=l.translatePosMatrix(Kt.expandedProjMatrix,pr,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Ki=A.projection.createInversionMatrix(A,Kt.canonical);_n=q?_p(Si,l,ei,V,ee,xe,Ln,Kt,pr,ye,Bt,je,he,Te,Ki,rt,ft,M):Yl(Si,l,ei,V,ee,xe,Ln,Kt,ye,Bt,je,he,Te,Ki,rt,ft,Ge,Dt)}l.uploadCommonUniforms(w,Yi,Kt.toUnwrapped(),null,tt);let Hr=nr.segments;if(A.projection.name==="mercator"&&!it&&(Hr=nr.getVisibleSegments(pr.tileID,l.terrain,l.transform.getFrustum(0)),!Hr.get().length))continue;if(gr)if(it)for(const Si of Hr.get())gr.numRenderedVerticesInShadowPass+=Si.primitiveLength;else for(const Si of Hr.get())gr.numRenderedVerticesInTransparentPass+=Si.primitiveLength;const wi=[];(l.terrain||v)&&wi.push(nr.centroidVertexBuffer),me&&wi.push(nr.layoutVertexExtBuffer),mt&&wi.push(nr.wallVertexBuffer),Yi.draw(l,w.gl.TRIANGLES,f,m,_,Mt,_n,n.id,nr.layoutVertexBuffer,nr.indexBuffer,Hr,n.paint,l.transform.zoom,li,wi)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}function ya(l,t,n,u,f,m,_,v,w,E,A,P,M,k,q,V,$,U,ee){const se=l.context,ae=se.gl,xe=l.transform,ye=l.transform.zoom,me=[],he=Ja(l,n.paint.get("fill-extrusion-cutoff-fade-range"));E==="clear"?(me.push("CLEAR_SUBPASS"),ee&&(me.push("CLEAR_FROM_TEXTURE"),se.activeTexture.set(ae.TEXTURE0),ee.bind(ae.LINEAR,ae.CLAMP_TO_EDGE))):E==="sdf"&&me.push("SDF_SUBPASS"),$&&me.push("HAS_CENTROID"),he.shouldRenderCutoff&&me.push("RENDER_CUTOFF");const Te=n.layout.get("fill-extrusion-edge-radius"),Ae=(rt,Ge,ft,mt,Bt)=>{const je=Ge.programConfigurations.get(n.id),tt=l.isTileAffectedByFog(rt),Ve=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:je,defines:me,overrideFog:tt}),vt=((Et,yt,Mt,Dt,ur,gr,Kt,pr,nr,Ir,Ur)=>({u_matrix:yt,u_opacity:Mt,u_ao_pass:Dt?1:0,u_meter_to_tile:ur,u_ao:gr,u_flood_light_intensity:Kt,u_flood_light_color:pr,u_attenuation:nr,u_edge_radius:Ir,u_fb:0,u_fb_size:Ur,u_dynamic_offset:1}))(0,mt,A,w,Bt,[P,M*Bt],k,q,V,ye>=17?0:Te*Bt,ee?ee.size[0]:0),it=[];$&&it.push(Ge.hiddenByLandmarkVertexBuffer),l.uploadCommonUniforms(se,Ve,rt.toUnwrapped(),null,he),Ve.draw(l,se.gl.TRIANGLES,f,m,_,v,vt,n.id,Ge.vertexBuffer,Ge.indexBuffer,ft,n.paint,ye,je,it)};for(const rt of u){const Ge=t.getTile(rt),ft=Ge.getBucket(n);if(!ft||ft.projection.name!==xe.projection.name||!ft.groundEffect||ft.groundEffect&&!ft.groundEffect.hasData())continue;const mt=ft.groundEffect,Bt=1/ft.tileToMeter;{const je=l.translatePosMatrix(rt.projMatrix,Ge,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),tt=mt.getDefaultSegment();Ae(rt,mt,tt,je,Bt)}if(U)for(let je=0;je<4;je++){const tt=s.dU[je](rt),Ve=t.getTile(tt);if(!Ve)continue;const vt=Ve.getBucket(n);if(!vt||vt.projection.name!==xe.projection.name||!vt.groundEffect||vt.groundEffect&&!vt.groundEffect.hasData())continue;const it=vt.groundEffect;let Et,yt;je===0?(Et=[-s.aj,0,0],yt=1):je===1?(Et=[s.aj,0,0],yt=0):je===2?(Et=[0,-s.aj,0],yt=3):(Et=[0,s.aj,0],yt=2);const Mt=it.regionSegments[yt];if(!Mt)continue;const Dt=new Float32Array(16);s.bo(Dt,rt.projMatrix,Et),Ae(rt,it,Mt,l.translatePosMatrix(Dt,Ge,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Bt)}}}function bl(l,t,n,u,f,m,_){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const v=m?m.findDEMTileFor(n):null;if(!(v&&v.dem||_))return;m&&v&&v.dem&&u.selfDEMTileTimestamp!==v.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=v.dem._timestamp);const w=U=>new s.P(Math.ceil((U+s.dX)*s.dY),0),E=U=>{const ee=t.getSource().minzoom,se=xe=>{const ye=t.getTileByID(xe);if(ye&&ye.hasData())return ye.getBucket(f)},ae=[0,-1,1];for(const xe of ae){if(U.overscaledZ+xe<ee)continue;const ye=se(U.calculateScaledKey(U.overscaledZ+xe));if(ye)return ye}},A=[0,0,0],P=(U,ee)=>(A[0]=Math.min(U.min.y,ee.min.y),A[1]=Math.max(U.max.y,ee.max.y),A[2]=s.aj-ee.min.x>U.max.x?ee.min.x-s.aj:U.max.x,A),M=(U,ee)=>(A[0]=Math.min(U.min.x,ee.min.x),A[1]=Math.max(U.max.x,ee.max.x),A[2]=s.aj-ee.min.y>U.max.y?ee.min.y-s.aj:U.max.y,A),k=[(U,ee)=>P(U,ee),(U,ee)=>P(ee,U),(U,ee)=>M(U,ee),(U,ee)=>M(ee,U)],q=(U,ee,se,ae,xe,ye,me)=>{if(!m)return 0;const he=[[ye?se:U,ye?U:se,0],[ye?se:ee,ye?ee:se,0]],Te=me<0?s.aj+me:me,Ae=[ye?Te:(U+ee)/2,ye?(U+ee)/2:Te,0];return se===0&&me<0||se!==0&&me>0?m.getForTilePoints(xe,[Ae],!0,ae):he.push(Ae),m.getForTilePoints(n,he,!0,v),Math.max(he[0][2],he[1][2],Ae[2])/m.exaggeration()};for(let U=0;U<4;U++){const ee=u.borderFeatureIndices[U];if(ee.length===0)continue;const se=s.dU[U](n),ae=E(se);if(!(ae&&ae instanceof s.dV))continue;const xe=m?m.findDEMTileFor(se):null;if(!(xe&&xe.dem||_)||(m&&xe&&xe.dem&&u.borderDEMTileTimestamp[U]!==xe.dem._timestamp&&(u.borderDoneWithNeighborZ[U]=-1,u.borderDEMTileTimestamp[U]=xe.dem._timestamp),u.borderDoneWithNeighborZ[U]===ae.canonical.z))continue;ae.centroidVertexArray.length===0&&ae.createCentroidsBuffer();const ye=(U<2?1:5)-U,me=ae.borderDoneWithNeighborZ[ye]!==u.canonical.z,he=ae.borderFeatureIndices[ye];let Te=0;if(u.canonical.z!==ae.canonical.z){for(const Ae of ee)u.showCentroid(u.featuresOnBorder[Ae]);if(me)for(const Ae of he)ae.showCentroid(ae.featuresOnBorder[Ae]);u.borderDoneWithNeighborZ[U]=ae.canonical.z,ae.borderDoneWithNeighborZ[ye]=u.canonical.z}for(const Ae of ee){const rt=u.featuresOnBorder[Ae],Ge=u.centroidData[rt.centroidDataIndex],ft=rt.borders[U];let mt;for(;Te<he.length;){mt=ae.featuresOnBorder[he[Te]];const Bt=mt.borders[ye];if(Bt[1]>ft[0]+3||Bt[0]>ft[0]-3)break;ae.showCentroid(mt),Te++}if(mt&&Te<he.length){const Bt=Te;let je=0;for(;!(mt.borders[ye][0]>ft[1]-3)&&(je++,++Te!==he.length);)mt=ae.featuresOnBorder[he[Te]];mt=ae.featuresOnBorder[he[Bt]];let tt=!1;if(je>=1){const it=mt.borders[ye];Math.abs(ft[0]-it[0])<3&&Math.abs(ft[1]-it[1])<3&&(je=1,tt=!0,Te=Bt+1)}else if(je===0){u.showCentroid(rt);continue}const Ve=ae.centroidData[mt.centroidDataIndex];_&&tt&&(((V=Ge).flags|($=Ve).flags)&s.dW?(V.flags|=s.dW,$.flags|=s.dW):(V.flags&=~s.dW,$.flags&=~s.dW));const vt=rt.intersectsCount()>1||mt.intersectsCount()>1;if(je>1)Te=Bt,Ge.centroidXY=Ve.centroidXY=new s.P(0,0);else if(xe&&xe.dem&&!vt){const it=k[U](Ge,Ve),Et=U%2?s.aj-1:0,yt=q(it[0],Math.min(s.aj-1,it[1]),Et,xe,se,U<2,it[2]);Ge.centroidXY=Ve.centroidXY=w(yt)}else vt?Ge.centroidXY=Ve.centroidXY=new s.P(0,0):(Ge.centroidXY=u.encodeBorderCentroid(rt),Ve.centroidXY=ae.encodeBorderCentroid(mt));u.writeCentroidToBuffer(Ge),ae.writeCentroidToBuffer(Ve)}else u.showCentroid(rt)}u.borderDoneWithNeighborZ[U]=ae.canonical.z,ae.borderDoneWithNeighborZ[ye]=u.canonical.z}var V,$;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(l)}const Ql=[1,0,0],Pr=[0,1,0],wl=[0,0,1];function Qd(l,t,n){const u=n.transform,f=n.shadowRenderer;if(!f)return!0;const m=l.toUnwrapped(),_=u.tileSize*f._cascades[n.currentShadowCascade].scale;let v=t.maxHeight;if(u.elevation){const V=u.elevation.getMinMaxForTile(l);V&&(v+=V.max)}const w=[...f.shadowDirection];w[2]=-w[2];const E=f.computeSimplifiedTileShadowVolume(m,v,_,w);if(!E)return!1;const A=[Ql,Pr,wl,w,[w[0],0,w[2]],[0,w[1],w[2]]],P=u.projection.name==="globe",M=u.scaleZoom(_),k=s.cn.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,M,!P),q=f.getCurrentCascadeFrustum();return k.intersectsPrecise(E.vertices,E.planes,A)===0||q.intersectsPrecise(E.vertices,E.planes,A)===0}function ef(l){return[l[0]*s.dZ,l[1]*s.dZ,l[2]*s.dZ,0]}function va(l,t,n,u,f,m,_,v,w){const E=u.getSource(),A=n.globeSharedBuffers;if(!A)return;let P,M,k;if(t&&(P=u.getTile(t)),E instanceof s.aP?(M=E.texture,k=s.ds(0,0,n.transform)):P&&t&&(M=P.texture,k=s.ds(t.canonical.z,t.canonical.x,n.transform)),!M||!k)return;l||(k=s.cE(s.bz(),k,[1,-1,1]));const q=n.context,V=q.gl,$=f.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,U=n.colorModeForDrapableLayerRenderPass(m),ee=_.defines;ee.push("GLOBE_POLES");const se=new Rt(V.LEQUAL,Rt.ReadWrite,n.depthRangeFor3D),ae=Float32Array.from(n.transform.expandedFarZProjMatrix),xe=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),q.activeTexture.set(V.TEXTURE0),M.bind($,V.CLAMP_TO_EDGE),q.activeTexture.set(V.TEXTURE1),M.bind($,V.CLAMP_TO_EDGE),"useMipmap"in M&&q.extTextureFilterAnisotropic&&n.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax);const[ye,me,he,Te]=t?A.getPoleBuffers(t.canonical.z,!1):A.getPoleBuffers(0,!0),Ae=f.paint.get("raster-elevation");let rt;l?(rt=ye,n.renderDefaultNorthPole=Ae!==0):(rt=me,n.renderDefaultSouthPole=Ae!==0);const Ge=ef(_.mix),ft=((Bt,je,tt,Ve,vt,it,Et,yt,Mt,Dt,ur,gr,Kt)=>vl(Bt,je,tt,new Float32Array(16),new Float32Array(9),[0,0],Ve,[0,0],[0,0,0,0],1,{opacity:1,mix:0},it,[0,0],yt,2,Dt,ur,gr,1,0,Kt))(ae,xe,k,s.ah(n.transform.zoom),0,f,0,Ae,0,Ge,_.offset,_.range,m),mt=n.getOrCreateProgram("raster",{defines:ee});n.uploadCommonUniforms(q,mt,null),mt.draw(n,V.TRIANGLES,se,w,U,v,ft,f.id,rt,he,Te)}function eu(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),u=n-t,f=.2*l.height,m=t+f;return[t,n,(m-f-t)/u,(m-t)/u]}function od(l,t,n,u){if(l)return t instanceof na&&l instanceof ss?t.getTextureDescriptor(l,n,!0):{texture:l.texture,mix:ef(u.mix),offset:u.offset,buffer:0,tileSize:1}}var tf=s.d_([{name:"a_index",type:"Int16",components:1}]);class sd{constructor(t,n,u,f){const m={width:u[0],height:u[1],data:null},_=t.gl;this.targetColorTexture=new s.T(t,m,_.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,m,_.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,f),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,f=n.width*n.height;this.particleTexture0=new s.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,n,u.RGBA8,{premultiply:!1,useMipmap:!1});const m=new s.d$;m.reserve(f);for(let _=0;_<f;_++)m.emplaceBack(_);this.particleIndexBuffer=this.context.createVertexBuffer(m,tf.members,!0),this.particleSegment=s.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Uf(l,t,n){if(!l)return null;const u=t.getTextureDescriptor(l,n,!0);if(!u)return null;let{texture:f,mix:m,offset:_,tileSize:v,buffer:w,format:E}=u;if(!f||!E)return null;let A=!1;return E==="uint32"&&(A=!0,m[3]=0,m=Jl(s.e0,m,[0,n.paint.get("raster-particle-max-speed")]),_=vh(s.e0,_,[0,n.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[w/(v+2*w),v/(v+2*w)],tileSize:v,scalarData:A,scale:m,offset:_,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[E]]}}function Ku(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),u=n-t,f=.2*l.height,m=t+f;return[t,n,(m-f-t)/u,(m-t)/u]}const Fa=new s.am(1,0,0,1),Ju=new s.am(0,1,0,1),Qu=new s.am(0,0,1,1),No=new s.am(1,0,1,1),Sl=new s.am(0,1,1,1);function Ba(l,t,n,u,f,m,_){const v=l.context,w=l.transform,E=v.gl,A=w.projection.name==="globe",P=A?["PROJECTION_GLOBE_VIEW"]:[];let M=s.bw(n.projMatrix);if(A&&s.ah(w.zoom)>0){const Ge=s.bg(n.canonical,w),ft=s.e1(Ge);M=s.az(new Float32Array(16),w.globeMatrix,ft),s.az(M,w.projMatrix,M)}const k=s.bz();k[12]+=2*f/(s.q.devicePixelRatio*w.width),k[13]+=2*m/(s.q.devicePixelRatio*w.height),s.az(M,k,M);const q=l.getOrCreateProgram("debug",{defines:P}),V=t.getTileByID(n.key);l.terrain&&l.terrain.setupElevationDraw(V,q);const $=Rt.disabled,U=rr.disabled,ee=l.colorModeForRenderPass(),se="$debug";v.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),A?V._makeGlobeTileDebugBuffers(l.context,w):V._makeDebugTileBoundsBuffers(l.context,w.projection);const ae=V._tileDebugBuffer||l.debugBuffer,xe=V._tileDebugIndexBuffer||l.debugIndexBuffer,ye=V._tileDebugSegments||l.debugSegments;if(q.draw(l,E.LINE_STRIP,$,U,ee,Dr.disabled,_a(M,u),se,ae,xe,ye,null,null,null,[V._globeTileDebugBorderBuffer]),_){const Ge=V.latestRawTileData,ft=Math.floor((Ge&&Ge.byteLength||0)/1024);let mt=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(mt+=` => ${n.overscaledZ}`),mt+=` ${V.state}`,mt+=` ${ft}kb`,function(Bt,je){Bt.initDebugOverlayCanvas();const tt=Bt.debugOverlayCanvas,Ve=Bt.context.gl,vt=Bt.debugOverlayCanvas.getContext("2d");vt.clearRect(0,0,tt.width,tt.height),vt.shadowColor="white",vt.shadowBlur=2,vt.lineWidth=1.5,vt.strokeStyle="white",vt.textBaseline="top",vt.font="bold 36px Open Sans, sans-serif",vt.fillText(je,5,5),vt.strokeText(je,5,5),Bt.debugOverlayTexture.update(tt),Bt.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(l,mt)}const me=t.getTile(n).tileSize,he=512/Math.min(me,512)*(n.overscaledZ/w.zoom)*.5,Te=V._tileDebugTextBuffer||l.debugBuffer,Ae=V._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,rt=V._tileDebugTextSegments||l.debugSegments;q.draw(l,E.TRIANGLES,$,U,Ft.alphaBlended,Dr.disabled,_a(M,s.am.transparent,he),se,Te,Ae,rt,null,null,null,[V._globeTileDebugTextBuffer])}function Sh(l,t,n,u){Kn(l,0,t+n/2,l.transform.width,n,u)}function jc(l,t,n,u){Kn(l,t-n/2,0,n,l.transform.height,u)}function Kn(l,t,n,u,f,m){const _=l.context,v=_.gl;v.enable(v.SCISSOR_TEST),v.scissor(t*s.q.devicePixelRatio,n*s.q.devicePixelRatio,u*s.q.devicePixelRatio,f*s.q.devicePixelRatio),_.clear({color:m}),v.disable(v.SCISSOR_TEST)}const Th=s.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Js}=Th;function Zi(l,t,n,u){l.emplaceBack(t,n,u)}class Tu{constructor(t){this.vertexArray=new s.e2,this.indices=new s.a_,Zi(this.vertexArray,-1,-1,1),Zi(this.vertexArray,1,-1,1),Zi(this.vertexArray,-1,1,1),Zi(this.vertexArray,1,1,1),Zi(this.vertexArray,-1,-1,-1),Zi(this.vertexArray,1,-1,-1),Zi(this.vertexArray,-1,1,-1),Zi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Js),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bd.simpleSegment(0,0,36,12)}}function Tl(l,t,n,u,f,m){const _=l.context.gl,v=t.paint.get("sky-atmosphere-color"),w=t.paint.get("sky-atmosphere-halo-color"),E=t.paint.get("sky-atmosphere-sun-intensity"),A=((P,M,k,q,V)=>({u_matrix_3f:P,u_sun_direction:M,u_sun_intensity:k,u_color_tint_r:[q.r,q.g,q.b,q.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(s.e4(s.dx(),u),f,E,v,w);_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+m,t.skyboxTexture,0),n.draw(l,_.TRIANGLES,Rt.disabled,rr.disabled,Ft.unblended,Dr.frontCW,A,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Eu=s.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class _o{constructor(t){const n=new s.e5;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const u=new s.a_;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Eu.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=s.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Vo=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class cs{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class tu{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ft([1,Xt,1,Xt],s.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ft([1,0,1,0],s.am.transparent,[!1,!1,!1,!0]),this.params=new cs,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new _o(n);const u=this.params.sizeRange,f=this.params.intensityRange,m=function(A){const P=s.ea(30),M=[];for(let k=0;k<A;++k){const q=2*Math.PI*P(),V=Math.acos(1-2*P())-.5*Math.PI;M.push(s.cS(Math.cos(V)*Math.cos(q),Math.cos(V)*Math.sin(q),Math.sin(V)))}return M}(this.params.starsCount),_=s.ea(300),v=new s.e6,w=new s.a_;let E=0;for(let A=0;A<m.length;++A){const P=s.b$([],m[A],200),M=Math.max(0,1+.01*u*(1*_()-.5)),k=Math.max(0,1+.01*f*(1*_()-.5));v.emplaceBack(P[0],P[1],P[2],-1,-1,M,k),v.emplaceBack(P[0],P[1],P[2],1,-1,M,k),v.emplaceBack(P[0],P[1],P[2],1,1,M,k),v.emplaceBack(P[0],P[1],P[2],-1,1,M,k),w.emplaceBack(E+0,E+1,E+2),w.emplaceBack(E+0,E+2,E+3),E+=4}this.starsVx=n.createVertexBuffer(v,Vo.members),this.starsIdx=n.createIndexBuffer(w),this.starsSegments=s.bd.simpleSegment(0,0,v.length,w.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const u=t.context,f=u.gl,m=t.transform,_=new Rt(f.LEQUAL,Rt.ReadOnly,[0,1]),v=s.ah(m.zoom),w=t.style.getLut(n.scope),E=n.properties.get("color-use-theme")==="none",A=n.properties.get("color").toRenderColor(E?null:w).toArray01(),P=n.properties.get("high-color-use-theme")==="none",M=n.properties.get("high-color").toRenderColor(P?null:w).toArray01(),k=n.properties.get("space-color-use-theme")==="none",q=n.properties.get("space-color").toRenderColor(k?null:w).toArray01PremultipliedAlpha(),V=5e-4,$=s.e7(n.properties.get("horizon-blend"),0,1,V,.25),U=s.dl(t,u,m)&&$===V?m.worldSize/(2*Math.PI*1.025)-1:m.globeRadius,ee=t.frameCounter/1e3%1,se=s.ae(m.globeCenterInViewSpace),ae=Math.sqrt(Math.pow(se,2)-Math.pow(U,2)),xe=Math.acos(ae/se),ye=me=>{const he=m.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];me&&he.push("ALPHA_PASS");const Te=t.getOrCreateProgram("globeAtmosphere",{defines:he}),Ae=((Ge,ft,mt,Bt,je,tt,Ve,vt,it,Et,yt,Mt)=>({u_frustum_tl:Ge,u_frustum_tr:ft,u_frustum_br:mt,u_frustum_bl:Bt,u_horizon:je,u_transition:tt,u_fadeout_range:Ve,u_color:vt,u_high_color:it,u_space_color:Et,u_temporal_offset:yt,u_horizon_angle:Mt}))(m.frustumCorners.TL,m.frustumCorners.TR,m.frustumCorners.BR,m.frustumCorners.BL,m.frustumCorners.horizon,v,$,A,M,q,ee,xe);t.uploadCommonUniforms(u,Te);const rt=this.atmosphereBuffer;rt&&Te.draw(t,f.TRIANGLES,_,rr.disabled,me?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Dr.backCW,Ae,me?"atmosphere_glow_alpha":"atmosphere_glow",rt.vertexBuffer,rt.indexBuffer,rt.segments)};ye(!1),ye(!0)}drawStars(t,n){const u=s.aD(n.properties.get("star-intensity"),0,1);if(u===0)return;const f=t.context,m=f.gl,_=t.transform,v=t.getOrCreateProgram("stars"),w=s.bY([]);s.b_(w,w,-_._pitch),s.bZ(w,w,-_.angle),s.b_(w,w,s.al(_._center.lat)),s.e8(w,w,-s.al(_._center.lng));const E=s.c3(new Float32Array(16),w),A=s.az([],_.starsProjMatrix,E),P=s.e4([],E),M=s.e9([],P),k=[0,1,0];s.dz(k,k,M),s.b$(k,k,this.params.sizeMultiplier);const q=[1,0,0];s.dz(q,q,M),s.b$(q,q,this.params.sizeMultiplier);const V=($=k,U=q,ee=u,{u_matrix:Float32Array.from(A),u_up:$,u_right:U,u_intensity_multiplier:ee});var $,U,ee;t.uploadCommonUniforms(f,v),this.starsVx&&this.starsIdx&&v.draw(t,m.TRIANGLES,Rt.disabled,rr.disabled,this.colorModeAlphaBlendedWriteRGB,Dr.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function il(l,t){const n=[...l],u=t.cameraWorldSizeForFog/t.worldSize,f=s.bx([]);return s.cE(f,f,[u,u,1]),s.az(n,f,n),s.az(n,t.worldToFogMatrix,n),n}function Ut(l,t,n,u,f){const m=n.material,_=u.context,{baseColorTexture:v,metallicRoughnessTexture:w}=m.pbrMetallicRoughness,{normalTexture:E,occlusionTexture:A,emissionTexture:P}=m;function M(q,V,$){if(q&&(l.push(V),_.activeTexture.set(_.gl.TEXTURE0+$),q.gfxTexture)){const{minFilter:U,magFilter:ee,wrapS:se,wrapT:ae}=q.sampler;q.gfxTexture.bindExtraParam(U,ee,se,ae)}}M(v,"HAS_TEXTURE_u_baseColorTexture",Ms.BaseColor),M(w,"HAS_TEXTURE_u_metallicRoughnessTexture",Ms.MetallicRoughness),M(E,"HAS_TEXTURE_u_normalTexture",Ms.Normal),M(A,"HAS_TEXTURE_u_occlusionTexture",Ms.Occlusion),M(P,"HAS_TEXTURE_u_emissionTexture",Ms.Emission),f&&(f.texture||(f.texture=new s.ed(u.context,f.image,[f.image.height,f.image.height,f.image.height],_.gl.RGBA8)),_.activeTexture.set(_.gl.TEXTURE0+Ms.LUT),f.texture&&f.texture.bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(l.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||l.push("DIFFUSE_SHADED");const k=u.shadowRenderer;k&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),k.useNormalOffset&&l.push("NORMAL_OFFSET"))}function ar(l,t,n,u,f,m){const _=n.paint.get("model-opacity").constantOr(1),v=t.context,w=new Rt(t.context.gl.LEQUAL,Rt.ReadWrite,t.depthRangeFor3D),E=t.transform,A=l.mesh,P=A.material,M=P.pbrMetallicRoughness,k=t.style.fog;let q;q=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:s.az([],u.zScaleMatrix,l.nodeModelMatrix),s.az(q,u.negCameraPosMatrix,q);const V=s.bi([],q);s.ee(V,V);const $=n.paint.get("model-color-use-theme").constantOr("default")==="none",U=n.paint.get("model-emissive-strength").constantOr(0),ee=xl(new Float32Array(l.worldViewProjection),new Float32Array(q),new Float32Array(V),null,t,_,M.baseColorFactor.toRenderColor(null),P.emissiveFactor,M.metallicFactor,M.roughnessFactor,P,U,n),se={defines:[]},ae=[],xe=t.shadowRenderer;xe&&(xe.useNormalOffset=!1),Ut(se.defines,ae,A,t,$?null:n.lut);let ye=null;if(k){const Te=il(l.nodeModelMatrix,t.transform);if(ye=new Float32Array(Te),E.projection.name!=="globe"){const Ae=A.aabb.min,rt=A.aabb.max,[Ge,ft]=k.getOpacityForBounds(Te,Ae[0],Ae[1],rt[0],rt[1]);se.overrideFog=Ge>=Qt||ft>=Qt}}const me=Ja(t,n.paint.get("model-cutoff-fade-range"));me.shouldRenderCutoff&&se.defines.push("RENDER_CUTOFF");const he=t.getOrCreateProgram("model",se);t.uploadCommonUniforms(v,he,null,ye,me),t.renderPass!=="shadow"&&xe&&xe.setupShadowsFromMatrix(l.nodeModelMatrix,he),he.draw(t,v.gl.TRIANGLES,w,f,m,A.material.doubleSided?Dr.disabled:Dr.backCCW,ee,n.id,A.vertexBuffer,A.indexBuffer,A.segments,n.paint,t.transform.zoom,void 0,ae)}function So(l,t,n,u,f,m,_){let v;v=l.projection.name==="globe"?s.ef(n,l):[...n],s.az(v,v,t.matrix);const w=s.az([],u,v);if(t.meshes)for(const E of t.meshes){if(E.material.alphaMode!=="BLEND"){_.push({mesh:E,depth:0,modelIndex:f,worldViewProjection:w,nodeModelMatrix:v});continue}const A=s.ad([],E.centroid,w);!l.isOrthographic&&A[2]<=0||m.push({mesh:E,depth:A[2],modelIndex:f,worldViewProjection:w,nodeModelMatrix:v})}if(t.children)for(const E of t.children)So(l,E,n,u,f,m,_)}function kn(l,t,n,u){const f=n.shadowRenderer;if(!f)return;const m=f.getShadowPassDepthMode(),_=f.getShadowPassColorMode(),v=f.calculateShadowPassMatrixFromMatrix(t),w=Jd(v);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,m,rr.disabled,_,Dr.backCCW,w,u.id,l.vertexBuffer,l.indexBuffer,l.segments,u.paint,n.transform.zoom,void 0,void 0)}function Ze(l,t,n){const u=t.updateZoomBasedPaintProperties(),f=function(m,_,v){let w,E,A,P=m.terrain?m.terrain.exaggeration():0;if(m.terrain&&P>0){const M=m.terrain,k=M.findDEMTileFor(v);k&&k.dem?w=s.el.create(M,v,k):P=0}if(P===0&&(_.terrainElevationMin=0,_.terrainElevationMax=0),P===_.validForExaggeration&&(P===0||w&&w._demTile&&w._demTile.tileID===_.validForDEMTile.id&&w._dem._timestamp===_.validForDEMTile.timestamp))return!1;for(const M in _.instancesPerModel){const k=_.instancesPerModel[M];for(let q=0;q<k.instancedDataArray.length;++q){const V=(w?P*w.getElevationAt(0|k.instancedDataArray.float32[16*q],0|k.instancedDataArray.float32[16*q+1],!0,!0):0)+k.instancesEvaluatedElevation[q];k.instancedDataArray.float32[16*q+6]=V,E=E?Math.min(_.terrainElevationMin,V):V,A=A?Math.max(_.terrainElevationMax,V):V}}return _.terrainElevationMin=E||0,_.terrainElevationMax=A||0,_.validForExaggeration=P,_.validForDEMTile=w&&w._demTile?{id:w._demTile.tileID,timestamp:w._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,n);(u||f)&&(t.uploaded=!1,t.upload(l.context))}const xa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.cV([0,0,0],[s.aj,s.aj,0])};function ba(l,t){const n=1<<l.canonical.z,u=t.getFreeCameraOptions().position,f=t.elevation,m=l.canonical.x/n,_=(l.canonical.x+1)/n,v=l.canonical.y/n,w=(l.canonical.y+1)/n;let E=t._centerAltitude;if(f){const k=f.getMinMaxForTile(l);k&&k.max>E&&(E=k.max)}const A=s.aD(u.x,m,_)-u.x,P=s.aD(u.y,v,w)-u.y,M=s.c6(E,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(A*A+P*P+M*M))}function qs(l,t,n,u,f,m,_){const v=l.context,w=l.renderPass==="shadow",E=l.shadowRenderer,A=w&&E?E.getShadowPassDepthMode():new Rt(v.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D),P=l.isTileAffectedByFog(m);if(n.meshes)for(const M of n.meshes){const k=["MODEL_POSITION_ON_GPU"],q=[];let V,$,U;u.instancedDataArray.length>20&&k.push("INSTANCED_ARRAYS");const ee=Ja(l,t.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&k.push("RENDER_CUTOFF"),w&&E)V=l.getOrCreateProgram("modelDepth",{defines:k}),$=Jd(_.shadowTileMatrix,_.shadowTileMatrix,Float32Array.from(n.matrix)),U=E.getShadowPassColorMode();else{Ut(k,q,M,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),V=l.getOrCreateProgram("model",{defines:k,overrideFog:P});const ae=M.material,xe=ae.pbrMetallicRoughness,ye=t.paint.get("model-opacity").constantOr(1),me=t.paint.get("model-emissive-strength").constantOr(0);$=xl(m.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),null,l,ye,xe.baseColorFactor.toRenderColor(null),ae.emissiveFactor,xe.metallicFactor,xe.roughnessFactor,ae,me,t,f),E&&(_.shadowUniformsInitialized?V.setShadowUniformValues(v,E.getShadowUniformValues()):(E.setupShadows(m.toUnwrapped(),V,"model-tile",m.overscaledZ),_.shadowUniformsInitialized=!0)),U=ee.shouldRenderCutoff||ye<1||ae.alphaMode!=="OPAQUE"?Ft.alphaBlended:Ft.unblended}l.uploadCommonUniforms(v,V,m.toUnwrapped(),null,ee);const se=M.material.doubleSided?Dr.disabled:Dr.backCCW;if(u.instancedDataArray.length>20)q.push(u.instancedDataBuffer),V.draw(l,v.gl.TRIANGLES,A,rr.disabled,U,se,$,t.id,M.vertexBuffer,M.indexBuffer,M.segments,t.paint,l.transform.zoom,void 0,q,u.instancedDataArray.length);else{const ae=w?"u_instance":"u_normal_matrix";for(let xe=0;xe<u.instancedDataArray.length;++xe)$[ae]=new Float32Array(u.instancedDataArray.arrayBuffer,64*xe,16),V.draw(l,v.gl.TRIANGLES,A,rr.disabled,U,se,$,t.id,M.vertexBuffer,M.indexBuffer,M.segments,t.paint,l.transform.zoom,void 0,q)}}if(n.children)for(const M of n.children)qs(l,t,M,u,f,m,_)}const ec=[1,-1,1];function ad(l,t,n,u){if(!n.modelManager)return!0;const f=n.modelManager;if(!n.shadowRenderer)return!0;const m=n.shadowRenderer,_=t.aabb;let v=!0,w=l.maxHeight;if(w===0){let A=0;for(const P in l.instancesPerModel){const M=f.getModel(P,u);M?A=Math.max(A,Math.max(Math.max(M.aabb.max[0],M.aabb.max[1]),M.aabb.max[2])):v=!1}w=l.maxScale*A*1.41+l.maxVerticalOffset,v&&(l.maxHeight=w)}_.max[2]=w,_.min[2]+=l.terrainElevationMin,_.max[2]+=l.terrainElevationMax,s.ad(_.min,_.min,t.tileMatrix),s.ad(_.max,_.max,t.tileMatrix);const E=_.intersects(m.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=E===2),E===0}function ld(l,t){const n=l.uniformValues.u_cutoff_params[0],u=l.uniformValues.u_cutoff_params[1],f=l.uniformValues.u_cutoff_params[2],m=l.uniformValues.u_cutoff_params[3];return u===n||m===f?1:s.aD(((t-n)/(u-n)-f)/(m-f),0,1)}function tc(l,t,n,u){if(t.pitch<20)return 1;const f=t.getWorldToCameraMatrix();s.az(f,f,l);const m=s.ei(n.min[0],n.min[1],n.min[2],1);let _=s.aA(s.ej(),m,f),v=_,w=_;m[1]=n.max[1],_=s.aA(s.ej(),m,f),v=_[1]<v[1]?_:v,w=_[1]>w[1]?_:w,m[0]=n.max[0],_=s.aA(s.ej(),m,f),v=_[1]<v[1]?_:v,w=_[1]>w[1]?_:w,m[1]=n.min[1],_=s.aA(s.ej(),m,f),v=_[1]<v[1]?_:v,w=_[1]>w[1]?_:w;const E=s.aD(u[0],0,1),A=100*t.pixelsPerMeter*s.aD(u[1],0,1),P=s.aD(u[2],0,1),M=s.ek(s.ej(),v,w,E),k=Math.tan(.5*t.fovX),q=-M[2]*k;if(A===0)return M[1]<-Math.abs(q)?P:1;const V=(-Math.abs(q)-M[1])/A,$=(ee,se,ae)=>(1-ae)*ee+ae*se,U=s.aD($(1,P,V),P,1);return $(1,U,s.aD((t.pitch-20)/20,0,1))}class qf{}class Gf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,u){{const P=this._storage.get(n.id);if(P)return P.lastUsedFrameIdx=t,P.buf}const f=u.gl,m=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),_=new ArrayBuffer(m),v=new Int16Array(_);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(_));const w=new s.en;for(let P=0;P<m/2;P+=3){const M=v[P],k=v[P+1],q=v[P+2];w.emplaceBack(M,k),w.emplaceBack(k,q),w.emplaceBack(q,M)}const E=u.bindVertexArrayOES.current,A=new qf;return A.buf=new tl(u,w),A.lastUsedFrameIdx=t,this._storage.set(n.id,A),u.bindVertexArrayOES.set(E),A.buf}update(t){for(const[n,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class rf{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Eh=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ud{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class cd{constructor(t,n){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...n,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...n,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const nf=s.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Iu{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const _=new s.eo,v=new s.a_;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(1,1),_.emplaceBack(-1,1),v.emplaceBack(0,1,2),v.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(_,nf.members),this.vignetteIdx=t.context.createIndexBuffer(v)}const f=s.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const _={u_vignetteShape:(m={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:m.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,Rt.disabled,rr.disabled,Ft.alphaBlended,Dr.disabled,_,"vignette",this.vignetteVx,this.vignetteIdx,f)}var m}}class Uc{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const u=t.getFreeCameraOptions().position,f=u.toAltitude(),m=u.toLngLat(),_=s.al(m.lng),v=s.al(m.lat),w=t.pixelsPerMeter/n,E=_*s.eq,A=s.eq*Math.log(Math.tan(Math.PI/4+v/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const P=-this._offsetYPrev+A,M=-this._elevationPrev+f;this._accumulatedOffsetX+=(-this._offsetXPrev+E)*w,this._accumulatedOffsetY+=P*w,this._accumulatedElevation+=M*w,this._offsetXPrev=E,this._offsetYPrev=A,this._elevationPrev=f}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function El(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function qc(l){const t=s.ea(1323123451230),n=[];for(let u=0;u<l;++u){const f=2*t()-1,m=2*t()-1,_=2*t()-1;n.push(s.cS(f,m,_))}return n}function ru(l,t,n,u,f){const m=s.aD((f-n)/(u-n),0,1);return(1-m)*l+m*t}class hs{constructor(t){this._movement=new Uc,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Iu,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const f=u.starsProjMatrix,m=s.bY([]);s.b_(m,m,s.al(90)-u._pitch),s.bZ(m,m,-u.angle);const _=s.c3(new Float32Array(16),m),v=s.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),w=s.ee([],v),E=s.az([],w,_),A=Date.now()/1e3;return this._accumulatedTimeFromStart+=(A-this._prevTime)*n,this._prevTime=A,{projectionMatrix:f,modelviewMatrix:E}}}class Hf extends hs{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new cd(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=qc(this.particlesCount),f=new s.er,m=new s.a_;let _=0;const v=s.ea(1323123451230);for(let w=0;w<u.length;++w){const E=u[w],A=[2*v()-1,v(),v(),v()];f.emplaceBack(E[0],E[1],E[2],-1,-1,...A),f.emplaceBack(E[0],E[1],E[2],1,-1,...A),f.emplaceBack(E[0],E[1],E[2],1,1,...A),f.emplaceBack(E[0],E[1],E[2],-1,1,...A),m.emplaceBack(_+0,_+1,_+2),m.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=n.createVertexBuffer(f,Eh.members),this.particlesIdx=n.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(n.revealStart>u)return;const f=ru(0,1,n.revealStart,n.revealStart+n.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const m=structuredClone(this._params);let _=[-m.direction.x,m.direction.y,-100];s.au(_,_);const v=structuredClone(this._vignetteParams);v.strength*=f,m.overrideStyleParameters||(m.intensity=t.style.rain.state.density,m.timeFactor=t.style.rain.state.intensity,m.color=structuredClone(t.style.rain.state.color),_=structuredClone(t.style.rain.state.direction),m.screenThinning.intensity=t.style.rain.state.centerThinning,m.dropletSizeX=t.style.rain.state.dropletSize[0],m.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],m.distortionStrength=100*t.style.rain.state.distortionStrength,v.strength=1,v.color=structuredClone(t.style.rain.state.vignetteColor));const w=this.updateOnRender(t,m.timeFactor),E=t.context,A=E.gl,P=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(E,{width:t.width,height:t.height,data:null},A.RGBA8)),m.distortionStrength>0&&(E.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const M=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(E,M),E.activeTexture.set(A.TEXTURE0),this.screenTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE);const k=[m.color.r,m.color.g,m.color.b,m.color.a],q=(V,$)=>{const U=El(this._movement.getPosition(),V),ee=m.dropletSizeX,se=m.dropletSizeX*m.dropletSizeYScale,ae=t.width/2,xe=t.height/2,ye=ru(0,m.screenThinning.start,0,1,m.screenThinning.intensity),me=ru(.001,m.screenThinning.range,0,1,m.screenThinning.intensity),he=ru(0,m.screenThinning.particleOffset,0,1,m.screenThinning.intensity),Te=(Ae={modelview:w.modelviewMatrix,projection:w.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:U,velocityConeAperture:m.velocityConeAperture,velocity:m.velocity,boxSize:V,rainDropletSize:[ee,se],distortionStrength:m.distortionStrength,rainDirection:_,color:k,screenSize:[P.width,P.height],thinningCenterPos:[ae,xe],thinningShape:[ye,me,Math.pow(10,m.screenThinning.fadePower)],thinningAffectedRatio:m.screenThinning.affectedRatio,thinningParticleOffset:he,shapeDirectionalPower:m.shapeDirPower,shapeNormalPower:m.shapeNormalPower,mode:$?0:1},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_texScreen:0,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_boxSize:Ae.boxSize,u_rainDropletSize:Ae.rainDropletSize,u_distortionStrength:Ae.distortionStrength,u_rainDirection:Ae.rainDirection,u_color:Ae.color,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_shapeDirectionalPower:Ae.shapeDirectionalPower,u_shapeNormalPower:Ae.shapeNormalPower,u_mode:Ae.mode});var Ae;const rt=Math.round(m.intensity*this.particlesCount),Ge=s.bd.simpleSegment(0,0,4*rt,2*rt);M.draw(t,A.TRIANGLES,Rt.disabled,rr.disabled,Ft.alphaBlended,Dr.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};m.distortionStrength>0&&q(m.boxSize,!0),q(m.boxSize,!1),this._vignette.draw(t,v)}}const Gc=s.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class gn extends hs{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new cd(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const u=qc(this.particlesCount),f=new s.es,m=new s.a_;let _=0;const v=s.ea(1323123451230);for(let w=0;w<u.length;++w){const E=u[w],A=v(),P=v(),M=v(),k=[w/u.length,A,P,M],q=[v(),v()];f.emplaceBack(E[0],E[1],E[2],-1,-1,...k,...q),f.emplaceBack(E[0],E[1],E[2],1,-1,...k,...q),f.emplaceBack(E[0],E[1],E[2],1,1,...k,...q),f.emplaceBack(E[0],E[1],E[2],-1,1,...k,...q),m.emplaceBack(_+0,_+1,_+2),m.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=n.createVertexBuffer(f,Gc.members),this.particlesIdx=n.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let u=[-n.direction.x,n.direction.y,-100];s.au(u,u);const f=structuredClone(this._vignetteParams),m=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=t.transform.zoom;if(m.revealStart>_)return;const v=ru(0,1,m.revealStart,m.revealStart+m.revealRange,_);f.strength*=v,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,f.strength=1,f.color=structuredClone(t.style.snow.state.vignetteColor));const w=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const E=t.context,A=E.gl,P=t.transform,M=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(E,M),((k,q,V)=>{const $=El(this._movement.getPosition(),k),U=P.width/2,ee=P.height/2,se=ru(0,V.screenThinning.start,0,1,V.screenThinning.intensity),ae=ru(.001,V.screenThinning.range,0,1,V.screenThinning.intensity),xe=ru(0,V.screenThinning.particleOffset,0,1,V.screenThinning.intensity),ye=(me={modelview:w.modelviewMatrix,projection:w.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:$,velocityConeAperture:V.velocityConeAperture,velocity:V.velocity,horizontalOscillationRadius:V.horizontalOscillationRadius,horizontalOscillationRate:V.horizontalOscillationRate,boxSize:k,billboardSize:1*V.billboardSize,simpleShapeParameters:[V.shapeFadeStart,V.shapeFadePower],screenSize:[P.width,P.height],thinningCenterPos:[U,ee],thinningShape:[se,ae,Math.pow(10,V.screenThinning.fadePower)],thinningAffectedRatio:V.screenThinning.affectedRatio,thinningParticleOffset:xe,color:[V.color.r,V.color.g,V.color.b,V.color.a],direction:u},{u_modelview:Float32Array.from(me.modelview),u_projection:Float32Array.from(me.projection),u_time:me.time,u_cam_pos:me.camPos,u_velocityConeAperture:me.velocityConeAperture,u_velocity:me.velocity,u_horizontalOscillationRadius:me.horizontalOscillationRadius,u_horizontalOscillationRate:me.horizontalOscillationRate,u_boxSize:me.boxSize,u_billboardSize:me.billboardSize,u_simpleShapeParameters:me.simpleShapeParameters,u_screenSize:me.screenSize,u_thinningCenterPos:me.thinningCenterPos,u_thinningShape:me.thinningShape,u_thinningAffectedRatio:me.thinningAffectedRatio,u_thinningParticleOffset:me.thinningParticleOffset,u_particleColor:me.color,u_direction:me.direction});var me;const he=Math.round(V.intensity*this.particlesCount),Te=s.bd.simpleSegment(0,0,4*he,2*he);this.particlesVx&&this.particlesIdx&&M.draw(t,A.TRIANGLES,Rt.disabled,rr.disabled,Ft.alphaBlended,Dr.disabled,ye,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(n.boxSize,0,n),this._vignette.draw(t,f)}}const Fi={symbol:function(l,t,n,u,f){if(l.renderPass!=="translucent")return;const m=rr.disabled,_=l.colorModeForRenderPass(),v=n.layout.get("text-variable-anchor"),w=n.layout.get("text-size-scale-range"),E=s.aD(l.scaleFactor,w[0],w[1]);v&&function(M,k,q,V,$,U,ee,se){const ae=k.transform,xe=$==="map",ye=U==="map";for(const me of M){const he=V.getTile(me),Te=he.getBucket(q);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const Ae=s.bH(Te.textSizeData,ae.zoom,se),rt=ua(me,Te.getProjection(),ae),Ge=ae.calculatePixelsToTileUnitsMatrix(he),ft=Wa(rt,he.tileID.canonical,ye,xe,ae,Te.getProjection(),Ge),mt=Te.hasIconTextFit()&&Te.hasIconData();Ae&&wu(Te,xe,ye,ee,ae,ft,me,Math.pow(2,ae.zoom-he.tileID.overscaledZ),Ae,mt)}}(u,l,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),f,E);const A=n.paint.get("icon-opacity").constantOr(1)!==0,P=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||P)?Vc(l,t,n,u,m,_):(A&&Vc(l,t,n,u,m,_,{onlyIcons:!0}),P&&Vc(l,t,n,u,m,_,{onlyText:!0})),t.map.showCollisionBoxes&&(rl(l,t,n,u,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),rl(l,t,n,u,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,n,u){if(l.renderPass!=="translucent")return;const f=n.paint.get("circle-opacity"),m=n.paint.get("circle-stroke-width"),_=n.paint.get("circle-stroke-opacity"),v=n.layout.get("circle-sort-key").constantOr(1)!==void 0,w=n.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(m.constantOr(1)===0||_.constantOr(1)===0))return;const E=l.context,A=E.gl,P=l.transform,M=l.depthModeForSublayer(0,Rt.ReadOnly),k=rr.disabled,q=l.colorModeForDrapableLayerRenderPass(w),V=P.projection.name==="globe",$=[s.ay(P.center.lng),s.aH(P.center.lat)],U=[];for(let se=0;se<u.length;se++){const ae=u[se],xe=t.getTile(ae),ye=xe.getBucket(n);if(!ye||ye.projection.name!==P.projection.name)continue;const me=ye.programConfigurations.get(n.id),he=s.dK(n),Te=l.isTileAffectedByFog(ae);V&&he.push("PROJECTION_GLOBE_VIEW"),he.push("DEPTH_D24"),l.terrain&&P.depthOcclusionForSymbolsAndCircles&&he.push("DEPTH_OCCLUSION");const Ae=l.getOrCreateProgram("circle",{config:me,defines:he,overrideFog:Te}),rt=ye.layoutVertexBuffer,Ge=ye.globeExtVertexBuffer,ft=ye.indexBuffer,mt=P.projection.createInversionMatrix(P,ae.canonical),Bt={programConfiguration:me,program:Ae,layoutVertexBuffer:rt,globeExtVertexBuffer:Ge,indexBuffer:ft,uniformValues:s.dL(l,ae,xe,mt,$,n),tile:xe};if(v){const je=ye.segments.get();for(const tt of je)U.push({segments:new s.bd([tt]),sortKey:tt.sortKey,state:Bt})}else U.push({segments:ye.segments,sortKey:0,state:Bt})}v&&U.sort((se,ae)=>se.sortKey-ae.sortKey);const ee={useDepthForOcclusion:P.depthOcclusionForSymbolsAndCircles};for(const se of U){const{programConfiguration:ae,program:xe,layoutVertexBuffer:ye,globeExtVertexBuffer:me,indexBuffer:he,uniformValues:Te,tile:Ae}=se.state,rt=se.segments;l.terrain&&l.terrain.setupElevationDraw(Ae,xe,ee),l.uploadCommonUniforms(E,xe,Ae.tileID.toUnwrapped()),xe.draw(l,A.TRIANGLES,M,k,q,Dr.disabled,Te,n.id,ye,he,rt,n.paint,P.zoom,ae,[me])}},heatmap:function(l,t,n,u){if(n.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const f=l.context,m=f.gl,_=rr.disabled,v=new Ft([m.ONE,m.ONE,m.ONE,m.ONE],s.am.transparent,[!0,!0,!0,!0]);(function(k,q,V,$){const U=k.gl,ee=q.width*$,se=q.height*$;k.activeTexture.set(U.TEXTURE1),k.viewport.set([0,0,ee,se]);let ae=V.heatmapFbo;if(!ae||ae&&(ae.width!==ee||ae.height!==se)){ae&&ae.destroy();const xe=U.createTexture();U.bindTexture(U.TEXTURE_2D,xe),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ae=V.heatmapFbo=k.createFramebuffer(ee,se,!0,null),function(ye,me,he,Te,Ae,rt){const Ge=ye.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,ye.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Ae,rt,0,Ge.RGBA,ye.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Te.colorAttachment.set(he)}(k,0,xe,ae,ee,se)}else U.bindTexture(U.TEXTURE_2D,ae.colorAttachment.get()),k.bindFramebuffer.set(ae.framebuffer)})(f,l,n,l.transform.projection.name==="globe"?.5:.25),f.clear({color:s.am.transparent});const w=l.transform,E=w.projection.name==="globe",A=E?["PROJECTION_GLOBE_VIEW"]:[],P=E?Dr.frontCCW:Dr.disabled,M=[s.ay(w.center.lng),s.aH(w.center.lat)];for(let k=0;k<u.length;k++){const q=u[k];if(t.hasRenderableParent(q))continue;const V=t.getTile(q),$=V.getBucket(n);if(!$||$.projection.name!==w.projection.name)continue;const U=l.isTileAffectedByFog(q),ee=$.programConfigurations.get(n.id),se=l.getOrCreateProgram("heatmap",{config:ee,defines:A,overrideFog:U}),{zoom:ae}=l.transform;l.terrain&&l.terrain.setupElevationDraw(V,se),l.uploadCommonUniforms(f,se,q.toUnwrapped());const xe=w.projection.createInversionMatrix(w,q.canonical);se.draw(l,m.TRIANGLES,Rt.disabled,_,v,P,yl(l,q,V,xe,M,ae,n.paint.get("heatmap-intensity")),n.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,n.paint,l.transform.zoom,ee,E?[$.globeExtVertexBuffer]:null)}f.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(f,m){const _=f.context,v=_.gl,w=m.heatmapFbo;if(!w)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,w.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1);let E=m.colorRampTexture;E||(E=m.colorRampTexture=new s.T(_,m.colorRamp,v.RGBA8)),E.bind(v.LINEAR,v.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,v.TRIANGLES,Rt.disabled,rr.disabled,f.colorModeForRenderPass(),Dr.disabled,((A,P,M,k)=>({u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}))(0,m),m.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,m.paint,f.transform.zoom)}(l,n))},line:function(l,t,n,u){if(l.renderPass!=="translucent")return;const f=n.paint.get("line-opacity"),m=n.paint.get("line-width");if(f.constantOr(1)===0||m.constantOr(1)===0)return;const _=n.paint.get("line-emissive-strength"),v=n.paint.get("line-occlusion-opacity"),w=n.layout.get("line-elevation-reference"),E=n.layout.get("line-width-unit")==="meters",A=w==="sea",P=!(!l.terrain||!l.terrain.enabled),M=l.context,k=M.gl;if(n.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const q=n.layout.get("line-cross-slope"),V=q!==void 0,$=q<1,U=l.colorModeForDrapableLayerRenderPass(_),ee=l.terrain&&l.terrain.renderingToTexture,se=ee?1:s.q.devicePixelRatio,ae=n.paint.get("line-dasharray"),xe=ae.constantOr(1),ye=n.layout.get("line-cap"),me=ae.constantOr(null),he=ye.constantOr(null),Te=n.paint.get("line-pattern"),Ae=Te.constantOr(1),rt=n.paint.get("line-pattern-cross-fade"),Ge=Te.constantOr(null),ft=n.paint.get("line-opacity").constantOr(1);let mt=!Ae&&ft!==1||l.depthOcclusion&&v>0&&v<1;const Bt=n.paint.get("line-gradient"),je=Ae?"linePattern":"line",tt=s.dM(n);let Ve;if(ee&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(mt=!1),v!==0&&l.depthOcclusion){const yt=n.paint._values["line-opacity"];yt&&yt.value&&yt.value.kind==="constant"?Ve=yt.value:s.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}m.value.kind!=="constant"&&m.value.isLineProgressConstant===!1&&tt.push("VARIABLE_LINE_WIDTH");const vt=(yt,Mt,Dt,ur,gr,Kt)=>{for(const pr of yt){const nr=t.getTile(pr);if(Ae&&!nr.patternsLoaded())continue;const Ir=nr.getBucket(n);if(!Ir||Ir.elevationType!=="none"&&!gr||Ir.elevationType==="none"&&gr)continue;l.prepareDrawTile();const Ur=[...Mt],li=l.shadowRenderer,Xi=Ir.elevationType==="road"&&!!li&&li.enabled;let Yi=[0,0,0];if(Xi){const ti=l.style.directionalLight,cn=l.style.ambientLight;ti&&cn&&(Yi=Da(l.style,ti,cn)),Ur.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const ei=Ir.programConfigurations.get(n.id);let Ln=!1;if(Ge&&nr.imageAtlas){const ti=s.dN.from(Ge),cn=ti.getPrimary().scaleSelf(se).toString(),Li=nr.imageAtlas.patternPositions.get(cn),en=ti.getSecondary(),Gi=en?nr.imageAtlas.patternPositions.get(en.scaleSelf(se).toString()):null;Ln=!!Li&&!!Gi,Li&&ei.setConstantPatternPositions(Li,Gi)}rt>0&&(Ln||ei.getPatternTransitionVertexBuffer("line-pattern"))&&Ur.push("LINE_PATTERN_TRANSITION");const _n=l.isTileAffectedByFog(pr),Hr=l.getOrCreateProgram(je,{config:ei,defines:Ur,overrideFog:_n,overrideRtt:!gr&&void 0});if(!Ae&&me&&he&&nr.lineAtlas){const ti=nr.lineAtlas.getDash(me,he);ti&&ei.setConstantPatternPositions(ti)}Xi&&li.setupShadows(nr.tileID.toUnwrapped(),Hr,"vector-tile",nr.tileID.overscaledZ);let[wi,Si]=n.paint.get("line-trim-offset");(he==="round"||he==="square")&&wi!==Si&&(wi===0&&(wi-=1),Si===1&&(Si+=1));const Ki=ee?pr.projMatrix:null,uo=E?1/Ir.tileToMeter/s.aw(nr,1,l.transform.zoom):1,zn=E?1/Ir.tileToMeter/s.aw(nr,1,Math.floor(l.transform.zoom)):1,Wn=Ae?s.dO(l,nr,n,Ki,se,uo,zn,[wi,Si],Yi,rt):s.dP(l,nr,n,Ki,Ir.lineClipsArray.length,se,uo,zn,[wi,Si],Yi);if(Bt){const ti=Ir.gradients[n.id];let cn=ti.texture;if(n.gradientVersion!==ti.version){let Li=256;if(n.stepInterpolant){const en=t.getSource().maxzoom,Gi=pr.canonical.z===en?Math.ceil(1<<l.transform.maxZoom-pr.canonical.z):1;Li=s.aD(s.dQ(Ir.maxLineLength/s.aj*1024*Gi),256,M.maxTextureSize)}ti.gradient=s.dR({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:Li,image:ti.gradient||void 0,clips:Ir.lineClipsArray}),ti.texture?ti.texture.update(ti.gradient):ti.texture=new s.T(M,ti.gradient,k.RGBA8),ti.version=n.gradientVersion,cn=ti.texture}M.activeTexture.set(k.TEXTURE1),cn.bind(n.stepInterpolant?k.NEAREST:k.LINEAR,k.CLAMP_TO_EDGE)}xe&&(M.activeTexture.set(k.TEXTURE0),nr.lineAtlasTexture&&nr.lineAtlasTexture.bind(k.LINEAR,k.REPEAT),ei.updatePaintBuffers()),Ae&&(M.activeTexture.set(k.TEXTURE0),nr.imageAtlasTexture&&nr.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ei.updatePaintBuffers()),gr&&!A&&l.terrain.setupElevationDraw(nr,Hr),l.uploadCommonUniforms(M,Hr,pr.toUnwrapped());const Tn=ti=>{Ve!=null&&(Ve.value=ft*v),Hr.draw(l,k.TRIANGLES,Dt,ti,U,Dr.disabled,Wn,n.id,Ir.layoutVertexBuffer,Ir.indexBuffer,Ir.segments,n.paint,l.transform.zoom,ei,[Ir.layoutVertexBuffer2,Ir.patternVertexBuffer,Ir.zOffsetVertexBuffer]),Ve!=null&&(Ve.value=ft)};if(mt&&!gr){const ti=l.stencilModeForClipping(pr).ref;ti===0&&ee&&M.clear({stencil:0});const cn={func:k.EQUAL,mask:255};Wn.u_alpha_discard_threshold=.8,Tn(new rr(cn,ti,255,k.KEEP,k.KEEP,k.INVERT)),Wn.u_alpha_discard_threshold=0,Tn(new rr(cn,ti,255,k.KEEP,k.KEEP,k.KEEP))}else Wn.u_alpha_discard_threshold=mt&&gr&&Kt?.8:0,Tn(gr?ur:l.stencilModeForClipping(pr))}};let it=l.depthModeForSublayer(0,Rt.ReadOnly);const Et=new Rt(l.depthOcclusion?k.GREATER:k.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D);if(n.hasNonElevatedBuckets){const yt=!ee&&l.terrain;v!==0&&yt?s.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):yt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):vt(u,tt,it,rr.disabled,!1,!0)}if(n.hasElevatedBuckets){w==="hd-road-markup"?P||(it=Et,tt.push("ELEVATED_ROADS")):(tt.push("ELEVATED"),it=Et,V&&tt.push($?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),A&&tt.push("ELEVATION_REFERENCE_SEA"));const yt=mt?l.stencilModeFor3D():rr.disabled;l.forceTerrainMode=!0,vt(u,tt,it,yt,!0,!0),mt&&vt(u,tt,it,yt,!0,!1),l.forceTerrainMode=!1}mt&&(l.resetStencilClippingMasks(),ee&&M.clear({stencil:0})),v===0||l.depthOcclusion||ee||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,n,u){const f=n.paint.get("fill-color"),m=n.paint.get("fill-opacity");if(m.constantOr(1)===0)return;const _=n.paint.get("fill-emissive-strength"),v=l.colorModeForDrapableLayerRenderPass(_),w=n.paint.get("fill-pattern"),E=l.opaquePassEnabledForLayer()&&!w.constantOr(1)&&f.constantOr(s.am.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";let A="none";n.layout.get("fill-elevation-reference")!=="none"?A="road":n.paint.get("fill-z-offset").constantOr(1)!==0&&(A="offset");const P=!(!l.terrain||!l.terrain.enabled),M={painter:l,sourceCache:t,layer:n,coords:u,colorMode:v,elevationType:A,terrainEnabled:P,pass:E};if(l.renderPass!=="shadow")if(A!=="offset"){if(ir(M,!1),A==="road"){const k=!P&&l.renderPass==="translucent";k&&Yu(l,t,n,u,"geometry"),ir(M,!0,rr.disabled),k&&function(q){const{painter:V,sourceCache:$,layer:U,coords:ee,colorMode:se}=q,ae=V.context.gl,xe=q.painter.shadowRenderer,ye=!!xe&&xe.enabled,me=new Rt(V.context.gl.LEQUAL,Rt.ReadOnly,V.depthRangeFor3D);let he=[0,0,0];if(ye){const Te=V.style.directionalLight,Ae=V.style.ambientLight;Te&&Ae&&(he=Da(V.style,Te,Ae))}for(const Te of ee){const Ae=$.getTile(Te),rt=Ae.getBucket(U);if(!rt)continue;const Ge=rt.elevatedStructures;if(!Ge||!Ge.renderableSegments||Ge.renderableSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();const ft=rt.bufferData.programConfigurations.get(U.id),mt=V.isTileAffectedByFog(Te),Bt=[];ye&&Bt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const je=V.getOrCreateProgram("elevatedStructures",{config:ft,overrideFog:mt,defines:Bt}),tt=V.translatePosMatrix(Te.projMatrix,Ae,U.paint.get("fill-translate"),U.paint.get("fill-translate-anchor"));ye&&xe.setupShadows(Ae.tileID.toUnwrapped(),je,"vector-tile",Ae.tileID.overscaledZ);const Ve=Oc(tt,he);V.uploadCommonUniforms(V.context,je,Te.toUnwrapped()),je.draw(V,ae.TRIANGLES,me,rr.disabled,se,Dr.backCCW,Ve,U.id,Ge.vertexBuffer,Ge.indexBuffer,Ge.renderableSegments,U.paint,V.transform.zoom,ft,[Ge.vertexBufferNormal])}}(M)}}else ir(M,!1,l.stencilModeFor3D());else l.shadowRenderer&&A==="road"&&!P&&function(k){const{painter:q,sourceCache:V,layer:$,coords:U}=k,ee=q.context.gl,se=k.painter.shadowRenderer;for(const ae of U){const xe=V.getTile(ae),ye=xe.getBucket($);if(!ye)continue;const me=ye.elevatedStructures;if(!me||!me.shadowCasterSegments||me.shadowCasterSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();const he=ye.bufferData.programConfigurations.get($.id),Te=q.isTileAffectedByFog(ae),Ae=q.getOrCreateProgram("elevatedStructuresDepth",{config:he,overrideFog:Te}),rt=se.calculateShadowPassMatrixFromTile(xe.tileID.toUnwrapped());q.uploadCommonUniforms(q.context,Ae,ae.toUnwrapped());const Ge={u_matrix:rt,u_depth_bias:.001};Ae.draw(q,ee.TRIANGLES,se.getShadowPassDepthMode(),rr.disabled,se.getShadowPassColorMode(),Dr.disabled,Ge,$.id,me.vertexBuffer,me.indexBuffer,me.shadowCasterSegments,$.paint,q.transform.zoom,he)}}(M)},"fill-extrusion":function(l,t,n,u){const f=n.paint.get("fill-extrusion-opacity"),m=l.context,_=m.gl,v=l.terrain,w=v&&v.renderingToTexture;if(f===0)return;const E=l.conflationActive&&l.style.isLayerClipped(n,t.getSource()),A=l.style.order.indexOf(n.fqid);if(E&&function(P,M,k,q,V){for(const $ of q){const U=M.getTile($).getBucket(k);U&&(U.updateReplacement($,P.replacementSource,V),U.uploadCentroid(P.context))}}(l,t,n,u,A),v||E)for(const P of u){const M=t.getTile(P).getBucket(n);M&&bl(l.context,t,P,M,n,v,E)}if(l.renderPass==="shadow"&&l.shadowRenderer){const P=l.shadowRenderer;if(v&&f<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ab)return;const M=P.getShadowPassDepthMode(),k=P.getShadowPassColorMode();Rs(l,t,n,u,M,rr.disabled,k,E)}else if(l.renderPass==="translucent"){const P=!n.paint.get("fill-extrusion-pattern").constantOr(1),M=n.paint.get("fill-extrusion-color").constantOr(s.am.white);if(!w&&M.a!==0){const k=new Rt(l.context.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D);f===1&&P?Rs(l,t,n,u,k,rr.disabled,Ft.unblended,E):(Rs(l,t,n,u,k,rr.disabled,Ft.disabled,E),Rs(l,t,n,u,k,l.stencilModeFor3D(),l.colorModeForRenderPass(),E),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&P&&(!v&&l.transform.projection.name!=="globe"||w)){const k=n.paint.get("fill-extrusion-opacity"),q=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),V=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),$=n.paint.get("fill-extrusion-flood-light-intensity"),U=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ee=n.paint.get("fill-extrusion-flood-light-color").toRenderColor(U?null:n.lut).toArray01().slice(0,3),se=q>0&&V>0,ae=$>0,xe=(me,he,Te)=>(1-Te)*me+Te*he,ye=me=>{const he=l.depthModeForSublayer(1,Rt.ReadOnly,_.LEQUAL,!0),Te=n.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=xe(.1,3,Te),rt=l._showOverdrawInspector;if(!rt){const Ge=new rr({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),ft=new Ft([_.ONE,_.ONE,_.ONE,_.ONE],s.am.transparent,[!1,!1,!1,!0],_.MIN);ya(l,t,n,u,he,Ge,ft,Dr.disabled,me,"sdf",k,q,V,$,ee,Ae,E,!1)}{const Ge=rt?rr.disabled:new rr({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),ft=rt?l.colorModeForRenderPass():new Ft([_.ONE_MINUS_DST_ALPHA,_.DST_ALPHA,_.ONE,_.ONE],s.am.transparent,[!0,!0,!0,!0]);ya(l,t,n,u,he,Ge,ft,Dr.disabled,me,"color",k,q,V,$,ee,Ae,E,!1)}};if(w){const me=(he,Te,Ae)=>{const rt=l.depthModeForSublayer(1,Rt.ReadOnly,_.LEQUAL,!1),Ge=n.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ft=xe(.1,3,Ge);{const mt=new Ft([_.ONE,_.ONE,_.ONE,_.ONE],s.am.transparent,[!1,!1,!1,!0]);ya(l,t,n,u,rt,rr.disabled,mt,Dr.disabled,he,"clear",k,q,V,$,ee,ft,E,Te)}{const mt=new rr({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),Bt=new Ft([_.ONE,_.ONE,_.ONE,_.ONE],s.am.transparent,[!1,!1,!1,!0],_.MIN);ya(l,t,n,u,rt,mt,Bt,Dr.disabled,he,"sdf",k,q,V,$,ee,ft,E,Te)}{const mt=he?_.ZERO:_.ONE_MINUS_DST_ALPHA,Bt=new rr({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),je=new Ft([mt,_.DST_ALPHA,_.ONE_MINUS_DST_ALPHA,_.ZERO],s.am.transparent,[!0,!0,!0,!0]);ya(l,t,n,u,rt,Bt,je,Dr.disabled,he,"color",k,q,V,$,ee,ft,E,Te)}{const mt=new Ft([_.ONE,_.ONE,_.ONE,he?_.ZERO:_.ONE],s.am.transparent,[!1,!1,!1,!0],he?_.FUNC_ADD:_.MAX);ya(l,t,n,u,rt,rr.disabled,mt,Dr.disabled,he,"clear",k,q,V,$,ee,ft,E,Te,Ae)}};if(se||ae){let he;if(l.prepareDrawTile(),v){const Te=v.drapeBufferSize[0],Ae=v.drapeBufferSize[1];he=v.framebufferCopyTexture,he&&(!he||he.size[0]===Te&&he.size[1]===Ae)||(he&&he.destroy(),he=v.framebufferCopyTexture=new s.T(m,new s.r({width:Te,height:Ae}),_.RGBA8)),he.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,0,0,Te,Ae)}se&&me(!0,!1,he),ae&&me(!1,!0,he)}}else se&&ye(!0),ae&&ye(!1),(se||ae)&&l.resetStencilClippingMasks()}}},hillshade:function(l,t,n,u){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const f=l.context,m=l.terrain&&l.terrain.renderingToTexture,[_,v]=l.renderPass!=="translucent"||m?[{},u]:l.stencilConfigForOverlap(u);for(const w of v){const E=t.getTile(w);if(E.needsHillshadePrepare&&l.renderPass==="offscreen")qd(l,E,n);else if(l.renderPass==="translucent"){const A=l.depthModeForSublayer(0,Rt.ReadOnly),P=n.paint.get("hillshade-emissive-strength"),M=l.colorModeForDrapableLayerRenderPass(P),k=m&&l.terrain?l.terrain.stencilModeForRTTOverlap(w):_[w.overscaledZ];Nf(l,w,E,n,A,k,M)}}f.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,n,u,f,m){if(l.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const _=l.transform.projection.name==="globe",v=n.paint.get("raster-elevation")!==0,w=v&&_;if(l.renderElevatedRasterBackface&&!w)return;const E=l.context,A=E.gl,P=t.getSource(),M=function(ye,me,he,Te){const Ae=me.paint.get("raster-color"),rt=ye.type==="raster-array",Ge=[],ft=me.paint.get("raster-resampling"),mt=me.paint.get("raster-color-mix");let Bt=me.paint.get("raster-color-range");const je=[mt[0],mt[1],mt[2],0],tt=mt[3];let Ve=ft==="nearest"?Te.NEAREST:Te.LINEAR;if(rt&&(Ge.push("RASTER_ARRAY"),Ae||Ge.push("RASTER_COLOR"),ft==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),Ve=Te.NEAREST,!Bt&&ye.rasterLayers)){const vt=ye.rasterLayers.find(({id:it})=>it===me.sourceLayer);vt&&vt.fields&&vt.fields.range&&(Bt=vt.fields.range)}if(Bt=Bt||[0,1],Ae){Ge.push("RASTER_COLOR"),he.activeTexture.set(Te.TEXTURE2),me.updateColorRamp(Bt);let vt=me.colorRampTexture;vt||(vt=me.colorRampTexture=new s.T(he,me.colorRamp,Te.RGBA8)),vt.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return{mix:je,range:Bt,offset:tt,defines:Ge,resampling:Ve}}(P,n,E,A);if(P instanceof s.aP&&!u.length&&!_)return;const k=n.paint.get("raster-emissive-strength"),q=l.colorModeForDrapableLayerRenderPass(k),V=l.terrain&&l.terrain.renderingToTexture,$=!l.options.moving,U=n.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;if(P instanceof s.aP&&!u.length&&(P.onNorthPole||P.onSouthPole)){const ye=v?l.stencilModeFor3D():rr.disabled;return void va(!!P.onNorthPole,null,l,t,n,k,M,Dr.disabled,ye)}if(!u.length)return;const[ee,se]=P instanceof s.aP||V?[{},u]:l.stencilConfigForOverlap(u),ae=se[se.length-1].overscaledZ;w&&M.defines.push("PROJECTION_GLOBE_VIEW"),v&&M.defines.push("RENDER_CUTOFF");const xe=(ye,me,he)=>{for(const Te of ye){const Ae=Te.toUnwrapped(),rt=t.getTile(Te);if(V&&(!rt||!rt.hasData()))continue;E.activeTexture.set(A.TEXTURE0);const Ge=od(rt,P,n,M);if(!Ge||!Ge.texture)continue;const{texture:ft,mix:mt,offset:Bt,tileSize:je,buffer:tt}=Ge;let Ve,vt;V?(Ve=Rt.disabled,vt=Te.projMatrix):v?(Ve=new Rt(A.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D),vt=_?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(Ae,$)):(Ve=l.depthModeForSublayer(Te.overscaledZ-ae,n.paint.get("raster-opacity")===1?Rt.ReadWrite:Rt.ReadOnly,A.LESS),vt=l.transform.calculateProjMatrix(Ae,$));const it=l.terrain&&V?l.terrain.stencilModeForRTTOverlap(Te):ee[Te.overscaledZ],Et=m?0:n.paint.get("raster-fade-duration");rt.registerFadeDuration(Et);const yt=t.findLoadedParent(Te,0),Mt=Bo(rt,yt,t,l.transform,Et);let Dt,ur;l.terrain&&l.terrain.prepareDrawTile(),E.activeTexture.set(A.TEXTURE0),ft.bind(U,A.CLAMP_TO_EDGE),E.activeTexture.set(A.TEXTURE1),yt?(yt.texture&&yt.texture.bind(U,A.CLAMP_TO_EDGE),Dt=Math.pow(2,yt.tileID.overscaledZ-rt.tileID.overscaledZ),ur=[rt.tileID.canonical.x*Dt%1,rt.tileID.canonical.y*Dt%1]):ft.bind(U,A.CLAMP_TO_EDGE),"useMipmap"in ft&&E.extTextureFilterAnisotropic&&l.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const gr=l.transform;let Kt;const pr=v?eu(gr):[0,0,0,0];let nr,Ir,Ur,li,Xi,Yi=0;if(w&&P instanceof s.aP&&P.coordinates.length>3)nr=Float32Array.from(s.bh(s.dr(new s.cp(0,0,0)))),Ir=Float32Array.from(gr.globeMatrix),Ur=Float32Array.from(s.dm(gr)),li=[s.ay(gr.center.lng),s.aH(gr.center.lat)],Kt=P.elevatedGlobePerspectiveTransform,Xi=P.elevatedGlobeGridMatrix||new Float32Array(9);else if(w){const Hr=s.dn(Te.canonical);Yi=s.dp(Hr.getCenter().lat),nr=Float32Array.from(s.bh(s.dr(Te.canonical))),Ir=Float32Array.from(gr.globeMatrix),Ur=Float32Array.from(s.dm(gr)),li=[s.ay(gr.center.lng),s.aH(gr.center.lat)],Kt=[0,0],Xi=Float32Array.from(s.dq(Te.canonical,Hr,Yi,gr.worldSize/gr._pixelsPerMercatorPixel))}else Kt=P instanceof s.aP?P.perspectiveTransform:[0,0],nr=new Float32Array(16),Ir=new Float32Array(9),Ur=new Float32Array(16),li=[0,0],Xi=new Float32Array(9);const ei=vl(vt,nr,Ir,Ur,Xi,ur||[0,0],s.ah(l.transform.zoom),li,pr,Dt||1,Mt,n,Kt,v?n.paint.get("raster-elevation"):0,2,mt,Bt,M.range,je,tt,k),Ln=l.isTileAffectedByFog(Te),_n=l.getOrCreateProgram("raster",{defines:M.defines,overrideFog:Ln});if(l.uploadCommonUniforms(E,_n,Ae),P instanceof s.aP){const Hr=P.elevatedGlobeVertexBuffer,wi=P.elevatedGlobeIndexBuffer;if(V||!_)P.boundsBuffer&&P.boundsSegments&&_n.draw(l,A.TRIANGLES,Ve,rr.disabled,q,Dr.disabled,ei,n.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments);else if(Hr&&wi){const Si=gr.zoom<=s.cL?P.elevatedGlobeSegments:P.getSegmentsForLongitude(gr.center.lng);Si&&_n.draw(l,A.TRIANGLES,Ve,rr.disabled,q,me,ei,n.id,Hr,wi,Si)}}else if(w){Ve=new Rt(A.LEQUAL,Rt.ReadOnly,l.depthRangeFor3D);const Hr=l.globeSharedBuffers;if(Hr){const[wi,Si,Ki]=Hr.getGridBuffers(Yi,!1);_n.draw(l,A.TRIANGLES,Ve,he||it,l.colorModeForRenderPass(),me,ei,n.id,wi,Si,Ki)}}else{const{tileBoundsBuffer:Hr,tileBoundsIndexBuffer:wi,tileBoundsSegments:Si}=l.getTileBoundsBuffers(rt);_n.draw(l,A.TRIANGLES,Ve,it,q,Dr.disabled,ei,n.id,Hr,wi,Si)}}if(!(P instanceof s.aP)&&w)for(const Te of ye){const Ae=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&va(!0,Te,l,t,n,k,M,me,he||rr.disabled),Ae&&va(!1,Te,l,t,n,k,M,me===Dr.frontCW?Dr.backCW:Dr.frontCW,he||rr.disabled)}};w?xe(se,l.renderElevatedRasterBackface?Dr.backCW:Dr.frontCW,l.stencilModeFor3D()):xe(se,Dr.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,n,u,f,m){l.renderPass==="offscreen"&&function(_,v,w,E){if(!E.length)return;const A=_.context,P=A.gl,M=v.getSource();if(!(M instanceof na))return;const k=Math.ceil(Math.sqrt(w.paint.get("raster-particle-count")));let q=w.particlePositionRGBAImage;if(!q||q.width!==k){const se=function(ae){const xe=ae*ae,ye=new Uint8Array(4*xe),me=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let Te=0;Te<xe;Te++){const Ae=he*(me(2*Te+0)+fo),rt=he*(me(2*Te+1)+fo),Ge=255*Ae%1,ft=255*rt%1,mt=Ge,Bt=rt-ft/255,je=ft;ye[4*Te+0]=255*(Ae-Ge/255),ye[4*Te+1]=255*mt,ye[4*Te+2]=255*Bt,ye[4*Te+3]=255*je}return ye}(k);q=w.particlePositionRGBAImage=new s.r({width:k,height:k},se)}let V=w.particleFramebuffer;V?V.width!==k&&(V.destroy(),V=w.particleFramebuffer=A.createFramebuffer(k,k,!0,null)):V=w.particleFramebuffer=A.createFramebuffer(k,k,!0,null);const $=[];for(const se of E){const ae=v.getTile(se);if(!(ae instanceof ss))continue;const xe=Uf(ae,M,w);if(!xe)continue;const ye=[ae.tileSize,ae.tileSize];let me=w.tileFramebuffer;me||(me=w.tileFramebuffer=A.createFramebuffer(ye[0],ye[1],!0,null));let he=ae.rasterParticleState;he||(he=ae.rasterParticleState=new sd(A,se,ye,q));const Te=he.update(w.lastInvalidatedAt);he.particleTextureDimension!==k&&he.updateParticleTexture(se,q);const Ae=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=Ae;const rt=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=rt,$.push([se,xe,he,Te])}if($.length===0)return;const U=s.q.now(),ee=w.previousDrawTimestamp?.001*(U-w.previousDrawTimestamp):.0167;if(w.previousDrawTimestamp=U,w.hasColorMap()){A.activeTexture.set(P.TEXTURE0+2);let se=w.colorRampTexture;se||(se=w.colorRampTexture=new s.T(A,w.colorRamp,P.RGBA8)),se.bind(P.LINEAR,P.CLAMP_TO_EDGE)}A.bindFramebuffer.set(w.tileFramebuffer.framebuffer),function(se,ae,xe){const ye=se.context,me=ye.gl,he=ae.tileFramebuffer;ye.activeTexture.set(me.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(rt=ae.paint.get("raster-particle-fade-opacity-factor"))/(rt+.05)},Ae=se.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var rt;for(const Ge of xe){const[,,ft,mt]=Ge;he.colorAttachment.set(ft.targetColorTexture.texture),ye.viewport.set([0,0,he.width,he.height]),ye.clear({color:s.am.transparent}),mt&&(ft.backgroundColorTexture.bind(me.NEAREST,me.CLAMP_TO_EDGE),Ae.draw(se,me.TRIANGLES,Rt.disabled,rr.disabled,Ft.alphaBlended,Dr.disabled,Te,ae.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments))}}(_,w,$),function(se,ae,xe,ye){const me=se.context,he=me.gl,Te=xe.tileFramebuffer,Ae=se.transform.projection.name==="globe",rt=xe.paint.get("raster-particle-max-speed");for(const Ge of ye){const[ft,mt,Bt]=Ge;me.activeTexture.set(he.TEXTURE0+0),mt.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),Te.colorAttachment.set(Bt.targetColorTexture.texture);const je=se.getOrCreateProgram("rasterParticleDraw",{defines:mt.defines,overrideFog:!1});me.activeTexture.set(he.TEXTURE0+1);const tt=mt.scalarData?[]:[0,1,2,3].map(it=>s.dU[it](ft));tt.push(ft);const Ve=ft.canonical.x,vt=ft.canonical.y;for(const it of tt){const Et=ae.getTile(Ae?it.wrapped():it);if(!Et)continue;const yt=Et.rasterParticleState;if(!yt)continue;const Mt=it.canonical.x+(1<<it.canonical.z)*(it.wrap-ft.wrap),Dt=it.canonical.y;yt.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);const ur=io(1,yt.particleTexture0.size[0],[Mt-Ve,Dt-vt],0,mt.texture.size,2,rt,mt.textureOffset,mt.scale,mt.offset);je.draw(se,he.POINTS,Rt.disabled,rr.disabled,Ft.alphaBlended,Dr.disabled,ur,xe.id,yt.particleIndexBuffer,void 0,yt.particleSegment)}}}(_,v,w,$),A.bindFramebuffer.set(w.particleFramebuffer.framebuffer),function(se,ae,xe,ye){const me=se.context,he=me.gl,Te=ae.paint.get("raster-particle-max-speed"),Ae=ye*ae.paint.get("raster-particle-speed-factor")*.15,rt=function(ft){return Math.pow(ft,6)}(.01+1*ae.paint.get("raster-particle-reset-rate-factor")),Ge=ae.particleFramebuffer;me.viewport.set([0,0,Ge.width,Ge.height]);for(const ft of xe){const[,mt,Bt]=ft;me.activeTexture.set(he.TEXTURE0+0),mt.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),me.activeTexture.set(he.TEXTURE0+1);const je=Bt.particleTexture0;je.bind(he.NEAREST,he.CLAMP_TO_EDGE);const tt=Oa(1,je.size[0],0,mt.texture.size,Te,Ae,rt,mt.textureOffset,mt.scale,mt.offset);Ge.colorAttachment.set(Bt.particleTexture1.texture),me.clear({color:s.am.transparent}),se.getOrCreateProgram("rasterParticleUpdate",{defines:mt.defines}).draw(se,he.TRIANGLES,Rt.disabled,rr.disabled,Ft.unblended,Dr.disabled,tt,ae.id,se.viewportBuffer,se.quadTriangleIndexBuffer,se.viewportSegments)}}(_,w,$,ee)}(l,t,n,u),l.renderPass==="translucent"&&(function(_,v,w,E,A){const P=_.context,M=P.gl,k=v.getSource().tileSize,q=5*(1-s.af(s.cx,s.cx+1,_.transform.zoom))*k+w.paint.get("raster-particle-elevation"),V=!_.options.moving,$=_.transform.projection.name==="globe";if(!E.length)return;const[U,ee]=_.stencilConfigForOverlap(E),se=[];$&&se.push("PROJECTION_GLOBE_VIEW");const ae=_.stencilModeFor3D();for(const xe of ee){const ye=xe.toUnwrapped(),me=v.getTile(xe);if(!me.rasterParticleState)continue;const he=me.rasterParticleState,Te=100;me.registerFadeDuration(Te);const Ae=v.findLoadedParent(xe,0),rt=Bo(me,Ae,v,_.transform,Te);let Ge,ft;_.terrain&&_.terrain.prepareDrawTile(),P.activeTexture.set(M.TEXTURE0),he.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),P.activeTexture.set(M.TEXTURE1),Ae&&Ae.rasterParticleState?(Ae.rasterParticleState.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Ge=Math.pow(2,Ae.tileID.overscaledZ-me.tileID.overscaledZ),ft=[me.tileID.canonical.x*Ge%1,me.tileID.canonical.y*Ge%1]):he.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const mt=$?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(ye,V),Bt=_.transform,je=Ku(Bt),tt=s.dn(xe.canonical),Ve=s.dp(tt.getCenter().lat);let vt,it,Et,yt,Mt;$?(vt=Float32Array.from(s.bh(s.dr(xe.canonical))),it=Float32Array.from(Bt.globeMatrix),Et=Float32Array.from(s.dm(Bt)),yt=[s.ay(Bt.center.lng),s.aH(Bt.center.lat)],Mt=Float32Array.from(s.dq(xe.canonical,tt,Ve,Bt.worldSize/Bt._pixelsPerMercatorPixel))):(vt=new Float32Array(16),it=new Float32Array(9),Et=new Float32Array(16),yt=[0,0],Mt=new Float32Array(9));const Dt=Us(mt,vt,it,Et,Mt,ft||[0,0],s.ah(_.transform.zoom),yt,je,Ge||1,rt,q),ur=_.isTileAffectedByFog(xe),gr=_.getOrCreateProgram("rasterParticle",{defines:se,overrideFog:ur});if(_.uploadCommonUniforms(P,gr,ye),$){const Kt=new Rt(M.LEQUAL,Rt.ReadOnly,_.depthRangeFor3D),pr=0,nr=_.globeSharedBuffers;if(nr){const[Ir,Ur,li]=nr.getGridBuffers(Ve,pr!==0);gr.draw(_,M.TRIANGLES,Kt,ae,Ft.alphaBlended,_.renderElevatedRasterBackface?Dr.frontCCW:Dr.backCCW,Dt,w.id,Ir,Ur,li)}}else{const Kt=_.depthModeForSublayer(0,Rt.ReadOnly),pr=U[xe.overscaledZ],{tileBoundsBuffer:nr,tileBoundsIndexBuffer:Ir,tileBoundsSegments:Ur}=_.getTileBoundsBuffers(me);gr.draw(_,M.TRIANGLES,Kt,pr,Ft.alphaBlended,Dr.disabled,Dt,w.id,nr,Ir,Ur)}}_.resetStencilClippingMasks()}(l,t,n,u),l.style.map.triggerRepaint())},background:function(l,t,n,u){const f=n.paint.get("background-color"),m=n.paint.get("background-color-use-theme").constantOr("default")==="none",_=n.paint.get("background-opacity"),v=n.paint.get("background-emissive-strength"),w=n.paint.get("background-pitch-alignment")==="viewport";if(_===0)return;const E=l.context,A=E.gl,P=l.transform,M=P.tileSize,k=n.paint.get("background-pattern");let q;if(k!==void 0&&(k===null||(q=l.imageManager.getPattern(s.I.from(k.toString()),n.scope,l.style.getLut(n.scope)),!q)))return;const V=!k&&f.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==V)return;const $=rr.disabled,U=l.depthModeForSublayer(0,V==="opaque"?Rt.ReadWrite:Rt.ReadOnly),ee=l.colorModeForDrapableLayerRenderPass(v),se=k?"backgroundPattern":"background";let ae,xe=u;if(xe||(ae=l.getBackgroundTiles(),xe=Object.values(ae).map(ye=>ye.tileID)),k&&(E.activeTexture.set(A.TEXTURE0),l.imageManager.bind(l.context,n.scope)),w){const ye=l.getOrCreateProgram(se,{overrideFog:!1,overrideRtt:!0}),me=new Float32Array(s.bx([])),he=new s.aM(0,0,0,0,0),Te=k?nd(me,v,_,l,0,n.scope,q,w,{tileID:he,tileSize:M}):Fc(me,v,_,f.toRenderColor(m?null:n.lut));ye.draw(l,A.TRIANGLES,U,$,ee,Dr.disabled,Te,n.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const ye of xe){const me=l.isTileAffectedByFog(ye),he=l.getOrCreateProgram(se,{overrideFog:me}),Te=ye.toUnwrapped(),Ae=u?ye.projMatrix:l.transform.calculateProjMatrix(Te);l.prepareDrawTile();const rt=t?t.getTile(ye):ae?ae[ye.key]:new bo(ye,M,P.zoom,l),Ge=k?nd(Ae,v,_,l,0,n.scope,q,w,{tileID:ye,tileSize:M}):Fc(Ae,v,_,f.toRenderColor(m?null:n.lut));l.uploadCommonUniforms(E,he,Te);const{tileBoundsBuffer:ft,tileBoundsIndexBuffer:mt,tileBoundsSegments:Bt}=l.getTileBoundsBuffers(rt);he.draw(l,A.TRIANGLES,U,$,ee,Dr.disabled,Ge,n.id,ft,mt,Bt)}},sky:function(l,t,n){const u=l._atmosphere?s.ah(l.transform.zoom):1,f=n.paint.get("sky-opacity")*u;if(f===0)return;const m=l.context,_=n.paint.get("sky-type"),v=new Rt(m.gl.LEQUAL,Rt.ReadOnly,[0,1]),w=l.frameCounter/1e3%1;_==="atmosphere"?l.renderPass==="offscreen"?n.needsSkyboxCapture(l)&&(function(E,A,P,M){const k=E.context,q=k.gl;let V=A.skyboxFbo;if(!V){V=A.skyboxFbo=k.createFramebuffer(32,32,!0,null),A.skyboxGeometry=new Tu(k),A.skyboxTexture=k.gl.createTexture(),q.bindTexture(q.TEXTURE_CUBE_MAP,A.skyboxTexture),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR);for(let se=0;se<6;++se)q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,q.RGBA,32,32,0,q.RGBA,q.UNSIGNED_BYTE,null)}k.bindFramebuffer.set(V.framebuffer),k.viewport.set([0,0,32,32]);const $=A.getCenter(E,!0),U=E.getOrCreateProgram("skyboxCapture"),ee=new Float64Array(16);s.bx(ee),s.e3(ee,ee,.5*-Math.PI),Tl(E,A,U,ee,$,0),s.bx(ee),s.e3(ee,ee,.5*Math.PI),Tl(E,A,U,ee,$,1),s.bx(ee),s.cG(ee,ee,.5*-Math.PI),Tl(E,A,U,ee,$,2),s.bx(ee),s.cG(ee,ee,.5*Math.PI),Tl(E,A,U,ee,$,3),s.bx(ee),Tl(E,A,U,ee,$,4),s.bx(ee),s.e3(ee,ee,Math.PI),Tl(E,A,U,ee,$,5),k.viewport.set([0,0,E.width,E.height])}(l,n),n.markSkyboxValid(l)):l.renderPass==="sky"&&function(E,A,P,M,k){const q=E.context,V=q.gl,$=E.transform,U=E.getOrCreateProgram("skybox");q.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,A.skyboxTexture);const ee=((se,ae,xe,ye,me)=>({u_matrix:se,u_sun_direction:ae,u_cubemap:0,u_opacity:ye,u_temporal_offset:me}))($.skyboxMatrix,A.getCenter(E,!1),0,M,k);E.uploadCommonUniforms(q,U),U.draw(E,V.TRIANGLES,P,rr.disabled,E.colorModeForRenderPass(),Dr.backCW,ee,"skybox",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(l,n,v,f,w):_==="gradient"&&l.renderPass==="sky"&&function(E,A,P,M,k){const q=E.context,V=q.gl,$=E.transform,U=E.getOrCreateProgram("skyboxGradient");A.skyboxGeometry||(A.skyboxGeometry=new Tu(q)),q.activeTexture.set(V.TEXTURE0);let ee=A.colorRampTexture;ee||(ee=A.colorRampTexture=new s.T(q,A.colorRamp,V.RGBA8)),ee.bind(V.LINEAR,V.CLAMP_TO_EDGE);const se=((ae,xe,ye,me,he)=>({u_matrix:ae,u_color_ramp:0,u_center_direction:xe,u_radius:s.al(ye),u_opacity:me,u_temporal_offset:he}))($.skyboxMatrix,A.getCenter(E,!1),A.paint.get("sky-gradient-radius"),M,k);E.uploadCommonUniforms(q,U),U.draw(E,V.TRIANGLES,P,rr.disabled,E.colorModeForRenderPass(),Dr.backCW,se,"skyboxGradient",A.skyboxGeometry.vertexBuffer,A.skyboxGeometry.indexBuffer,A.skyboxGeometry.segment)}(l,n,v,f,w)},debug:function(l,t,n,u,f,m){for(let _=0;_<n.length;_++)if(f){const E=new s.am(u.r*.8,u.g*.8,u.b*.8,1);Ba(l,t,n[_],u,-1,-1,m),Ba(l,t,n[_],u,-1,1,m),Ba(l,t,n[_],u,1,1,m),Ba(l,t,n[_],u,1,-1,m),Ba(l,t,n[_],E,0,0,m)}else Ba(l,t,n[_],u,0,0,m)},custom:function(l,t,n,u){const f=l.context,m=n.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&n.isDraped(t)){if(l.renderPass==="offscreen"){const _=m.prerender;if(_){if(l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const v=l.transform.pointMerc;_.call(m,f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.ah(l.transform.zoom),[v.x,v.y],l.transform.pixelsPerMeterRatio)}else _.call(m,f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const v=m.renderToTile;if(v){const w=u[0].canonical,E={x:w.x+u[0].wrap*(m.wrapTileId?0:1<<w.z),y:w.y,z:w.z};f.setDepthMode(Rt.disabled),f.setStencilMode(rr.disabled),f.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),v.call(m,f.gl,E),f.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),f.setColorMode(l.colorModeForRenderPass()),f.setStencilMode(rr.disabled);const _=m.renderingMode==="3d"?new Rt(l.context.gl.LEQUAL,Rt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Rt.ReadOnly);if(f.setDepthMode(_),l.transform.projection.name==="globe"){const v=l.transform.pointMerc;m.render(f.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.ah(l.transform.zoom),[v.x,v.y],l.transform.pixelsPerMeterRatio)}else m.render(f.gl,l.transform.customLayerMatrix());f.setDirty(),l.setBaseState(),f.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,n,u){if(l.renderPass==="opaque")return;const f=n.paint.get("model-opacity").constantOr(1);if(f===0)return;const m=n.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!m||l.terrain&&f<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof s.ab))return;const _=l.shadowRenderer,v=n.paint.get("model-receive-shadows");_&&(_.useNormalOffset=!0,v||(_.enabled=!1));const w=()=>{_&&(_.useNormalOffset=!0,v||(_.enabled=!0))},E=t.getSource();if(l.renderPass==="light-beam"&&E.type!=="batched-model")return;if(E.type==="vector"||E.type==="geojson")return function(U,ee,se,ae,xe){const ye=U.transform;if(ye.projection.name!=="mercator")return void s.w(`Drawing 3D models for ${ye.projection.name} projection is not yet implemented`);const me=ye.getFreeCameraOptions().position;if(!U.modelManager)return;const he=U.modelManager;se.modelManager=he;const Te=U.shadowRenderer;if(!se._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ae=se._unevaluatedLayout._values["model-id"],rt=Object.assign({},se.layout.get("model-id").parameters),Ge=U.style.order.indexOf(se.fqid);for(const ft of ae){const mt=ee.getTile(ft).getBucket(se);if(!mt||mt.projection.name!==ye.projection.name)continue;const Bt=mt.getModelUris();Bt&&!mt.modelsRequested&&(he.addModelsFromBucket(Bt,xe),mt.modelsRequested=!0);const je=ba(ft,ye);rt.zoom=je;const tt=Ae.possiblyEvaluate(rt);if(Ze(U,mt,ft),xa.shadowUniformsInitialized=!1,xa.useSingleShadowCascade=!!Te&&Te.getMaxCascadeForTile(ft.toUnwrapped())===0,U.renderPass==="shadow"&&Te){if(U.currentShadowCascade===1&&mt.isInsideFirstShadowMapFrustum)continue;const it=ye.calculatePosMatrix(ft.toUnwrapped(),ye.worldSize);if(xa.tileMatrix.set(it),xa.shadowTileMatrix=Float32Array.from(Te.calculateShadowPassMatrixFromMatrix(it)),xa.aabb.min.fill(0),xa.aabb.max[0]=xa.aabb.max[1]=s.aj,xa.aabb.max[2]=0,ad(mt,xa,U,se.scope))continue}const Ve=1<<ft.canonical.z,vt=[((me.x-ft.wrap)*Ve-ft.canonical.x)*s.aj,(me.y*Ve-ft.canonical.y)*s.aj,me.z*Ve*s.aj];U.conflationActive&&Object.keys(mt.instancesPerModel).length>0&&U.style.isLayerClipped(se,ee.getSource())&&mt.updateReplacement(ft,U.replacementSource,Ge,xe)&&(mt.uploaded=!1,mt.upload(U.context));for(let it in mt.instancesPerModel){const Et=mt.instancesPerModel[it];Et.features.length>0&&(it=tt.evaluate(Et.features[0].feature,{}));const yt=he.getModel(it,xe);if(yt||he.hasURLBeenRequested(it)||mt.modelUris.includes(it)||(mt.modelUris.push(it),mt.modelsRequested=!1),yt&&yt.uploaded)for(const Mt of yt.nodes)qs(U,se,Mt,Et,vt,ft,xa)}}}(l,t,n,u,E.type==="vector"?n.scope:""),void w();if(!E.loaded())return;if(E.type==="batched-model")return function(U,ee,se,ae){se.resetLayerRenderingStats(U);const xe=U.context,ye=U.transform,me=U.style.fog,he=U.shadowRenderer;if(ye.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${ye.projection.name} projection is not yet implemented`);const Te=U.transform.getFreeCameraOptions().position,Ae=s.b$([],[Te.x,Te.y,Te.z],U.transform.worldSize),rt=s.eb([],Ae),Ge=s.bx([]),ft=s.ec(ye.center.lat,ye.zoom),mt=s.bn([],[1,1,1/ft]);s.bo(Ge,Ge,rt);const Bt=se.paint.get("model-opacity").constantOr(1),je=new Rt(xe.gl.LEQUAL,Rt.ReadWrite,U.depthRangeFor3D),tt=new Rt(xe.gl.LEQUAL,Rt.ReadOnly,U.depthRangeFor3D),Ve=new s.cV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),vt=U.renderPass==="shadow",it=vt&&he?he.getCurrentCascadeFrustum():ye.getFrustum(ye.scaleZoom(ye.worldSize)),Et=se.paint.get("model-front-cutoff"),yt=Et[2]<1,Mt=Ja(U,se.paint.get("model-cutoff-fade-range")),Dt=se.getLayerRenderingStats();(function(ur,gr,Kt,pr){const nr=ur.terrain?ur.terrain.exaggeration():0,Ir=ur.transform.zoom;for(const Ur of pr){const li=gr.getTile(Ur).getBucket(Kt);li&&(li.setFilter(Kt.filter),ur.conflationActive&&li.updateReplacement(Ur,ur.replacementSource),li.evaluateScale(ur,Kt),ur.terrain&&nr>0&&li.elevationUpdate(ur.terrain,nr,Ur,Kt.source),li.needsReEvaluation(ur,Ir,Kt)&&li.evaluate(Kt))}})(U,ee,se,ae),function(){let ur,gr,Kt;yt?(ur=ae.length-1,gr=-1,Kt=-1):(ur=0,gr=ae.length,Kt=1);const pr=new Float64Array(16),nr=s.eg(),Ir=new s.P(0,0);for(let Ur=ur;Ur!==gr;Ur+=Kt){const li=ae[Ur],Xi=ee.getTile(li).getBucket(se);if(!Xi||!Xi.uploaded)continue;let Yi=!1;he&&(Yi=he.getMaxCascadeForTile(li.toUnwrapped())===0);const ei=ye.calculatePosMatrix(li.toUnwrapped(),ye.worldSize),Ln=Xi.modelTraits;!vt&&yt&&(s.bi(pr,ei),s.ad(nr,Ae,pr),Ir.x=nr[0],Ir.y=nr[1]);const _n=[];Xi.setFilter(se.filter);for(const Hr of Xi.getNodesInfo()){if(Hr.hiddenByReplacement||!Hr.node.meshes)continue;const wi=Hr.node;let Si=0;U.terrain&&wi.elevation&&(Si=wi.elevation*U.terrain.exaggeration());const Ki=(()=>{const on=Hr.aabb;return Ve.min=[...on.min],Ve.max=[...on.max],Ve.min[2]+=Si,Ve.max[2]+=Si,s.ad(Ve.min,Ve.min,ei),s.ad(Ve.max,Ve.max,ei),Ve})(),uo=Hr.evaluatedScale;if(uo[0]<=1&&uo[1]<=1&&uo[2]<=1&&Ki.intersects(it)===0)continue;if(!vt&&yt){const on=.16666666666666666;Hr.cameraCollisionOpacity=Ae[0]>Ki.min[0]&&Ae[0]<Ki.max[0]&&Ae[1]>Ki.min[1]&&Ae[1]<Ki.max[1]&&Ae[2]*ft<Ki.max[2]&&wi.footprint&&s.bS(Ir,wi.footprint)?Math.max(Hr.cameraCollisionOpacity-on,0):Math.min(1,Hr.cameraCollisionOpacity+on)}const zn=[...ei],Wn=wi.anchor?wi.anchor[0]:0,Tn=wi.anchor?wi.anchor[1]:0;s.bo(zn,zn,[Wn*(uo[0]-1),Tn*(uo[1]-1),Si]),s.ci(uo,s.eh)||s.cE(zn,zn,uo);const ti=s.az([],zn,wi.matrix),cn=s.az([],ye.expandedFarZProjMatrix,ti),Li=s.az([],ye.expandedFarZProjMatrix,zn),en=s.aA([],[Wn,Tn,Si,1],cn)[2];wi.hidden=!1;let Gi=Bt;vt||(yt&&(Gi*=Hr.cameraCollisionOpacity,Gi*=tc(zn,ye,Hr.aabb,Et)),Gi*=ld(Mt,en)),Gi!==0?_n.push({nodeInfo:Hr,depth:en,opacity:Gi,wvpForNode:cn,wvpForTile:Li,nodeModelMatrix:ti,tileModelMatrix:zn}):wi.hidden=!0}vt||_n.sort((Hr,wi)=>!yt||Hr.opacity===1&&wi.opacity===1?Hr.depth<wi.depth?-1:1:Hr.opacity===1?-1:wi.opacity===1?1:Hr.depth>wi.depth?-1:1);for(const Hr of _n){const wi=Hr.nodeInfo,Si=wi.node;let Ki=s.az([],mt,Hr.tileModelMatrix);s.az(Ki,Ge,Ki);const uo=s.bi([],Ki);s.ee(uo,uo),s.cE(uo,uo,ec),Ki=s.az(Ki,Ki,Si.matrix);const zn=U.renderPass==="light-beam",Wn=se.paint.get("model-color-use-theme").constantOr("default")==="none",Tn=Ln&s.em.HasMapboxMeshFeatures,ti=Tn?0:wi.evaluatedRMEA[0][2];for(let cn=0;cn<Si.meshes.length;++cn){const Li=Si.meshes[cn],en=cn===Si.lightMeshIndex;let Gi=Hr.wvpForNode;if(en){if(!zn&&!U.terrain&&U.shadowRenderer){U.currentLayer<U.firstLightBeamLayer&&(U.firstLightBeamLayer=U.currentLayer);continue}Gi=Hr.wvpForTile}else if(zn)continue;const on={defines:[]},To=[];if(!vt&&he&&(he.useNormalOffset=!!Li.normalBuffer),Ut(on.defines,To,Li,U,Wn?null:se.lut),Tn||on.defines.push("DIFFUSE_SHADED"),Yi&&on.defines.push("SHADOWS_SINGLE_CASCADE"),Dt&&(vt?Dt.numRenderedVerticesInShadowPass+=Li.vertexArray.length:Dt.numRenderedVerticesInTransparentPass+=Li.vertexArray.length),vt){kn(Li,Hr.nodeModelMatrix,U,se);continue}let yi=null;if(me){const Hs=il(Hr.nodeModelMatrix,U.transform);if(yi=new Float32Array(Hs),ye.projection.name!=="globe"){const Ua=Li.aabb.min,Ro=Li.aabb.max,[qa,ll]=me.getOpacityForBounds(Hs,Ua[0],Ua[1],Ro[0],Ro[1]);on.overrideFog=qa>=Qt||ll>=Qt}}const Uo=Li.material;let Jn;Uo.occlusionTexture&&Uo.occlusionTexture.offsetScale&&(Jn=Uo.occlusionTexture.offsetScale,on.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Jo=U.getOrCreateProgram("model",on);!vt&&he&&he.setupShadowsFromMatrix(Hr.tileModelMatrix,Jo,he.useNormalOffset),U.uploadCommonUniforms(xe,Jo,null,yi);const al=Uo.pbrMetallicRoughness;al.metallicFactor=.9,al.roughnessFactor=.5;const Rl=xl(new Float32Array(Gi),new Float32Array(Ki),new Float32Array(uo),new Float32Array(Si.matrix),U,Hr.opacity,al.baseColorFactor.toRenderColor(null),Uo.emissiveFactor,al.metallicFactor,al.roughnessFactor,Uo,ti,se,[0,0,0],Jn);!en&&(wi.hasTranslucentParts||Hr.opacity<1)&&Jo.draw(U,xe.gl.TRIANGLES,je,rr.disabled,Ft.disabled,Dr.backCCW,Rl,se.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,se.paint,U.transform.zoom,void 0,To),Jo.draw(U,xe.gl.TRIANGLES,en?tt:je,rr.disabled,en||Hr.opacity<1||wi.hasTranslucentParts?Ft.alphaBlended:Ft.unblended,Dr.backCCW,Rl,se.id,Li.vertexBuffer,Li.indexBuffer,Li.segments,se.paint,U.transform.zoom,void 0,To)}}}}()}(l,t,n,u),void w();if(E.type!=="model")return;const A=E.getModels(),P=[],M=l.transform.getFreeCameraOptions().position,k=s.b$([],[M.x,M.y,M.z],l.transform.worldSize);s.eb(k,k);const q=[],V=[];let $=0;for(const U of A){const ee=n.paint.get("model-rotation").constantOr(null),se=n.paint.get("model-scale").constantOr(null),ae=n.paint.get("model-translation").constantOr(null);U.computeModelMatrix(l,ee,se,ae,!0,!0,!1);const xe=s.bx([]),ye=s.ec(U.position.lat,l.transform.zoom),me=s.bn([],[1,1,1/ye]);s.bo(xe,xe,k),P.push({zScaleMatrix:me,negCameraPosMatrix:xe});for(const he of U.nodes)So(l.transform,he,U.matrix,l.transform.expandedFarZProjMatrix,$,q,V);$++}if(q.sort((U,ee)=>ee.depth-U.depth),l.renderPass!=="shadow"){if(f===1)for(const U of V)ar(U,l,n,P[U.modelIndex],rr.disabled,l.colorModeForRenderPass());else{for(const U of V)ar(U,l,n,P[U.modelIndex],rr.disabled,Ft.disabled);for(const U of V)ar(U,l,n,P[U.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}for(const U of q)ar(U,l,n,P[U.modelIndex],rr.disabled,l.colorModeForRenderPass());w()}else{for(const U of V)kn(U.mesh,U.nodeModelMatrix,l,n);for(const U of q)kn(U.mesh,U.nodeModelMatrix,l,n);w()}}},Ih={line:function(l,t,n){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const f of u){const m=t.getTile(f).getBucket(l);if(m&&(m.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,n){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,u.type==="vector"?l.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const f=u.getModels();for(const m of f)m.upload(n.context)},raster:function(l,t,n){const u=t.getSource();if(!(u instanceof na&&u.loaded()))return;const f=l.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!f)return;const m=l.paint.get("raster-array-band")||u.getInitialBand(f);if(m==null)return;const _=t.getIds().map(v=>t.getTileByID(v));for(const v of _)v.updateNeeded(f,m)&&u.prepareTile(v,f,m)},"raster-particle":function(l,t,n){const u=t.getSource();if(!(u instanceof na&&u.loaded()))return;const f=l.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!f)return;const m=l.paint.get("raster-particle-array-band")||u.getInitialBand(f);if(m==null)return;const _=t.getIds().map(v=>t.getTileByID(v));for(const v of _)v.updateNeeded(f,m)&&u.prepareTile(v,f,m)}},Il={fill:Yu};class Ah{constructor(t,n,u,f,m){this.context=new Zu(t,n),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=m,this._timeStamp=s.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const _=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const w of _)this._debugParams.enabledLayers[w]=!0;m.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),m.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),m.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),m.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),m.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const w of _)m.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],w);this.occlusionParams=new rf(m),this.setup(),this.numSublayers=Hn.maxUnderzooming+Hn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new dp(this),this._wireframeDebugCache=new Gf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const v=new s.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,v,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=f}updateTerrain(t,n){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ss(this,t));const f=this._terrain;this.transform.elevation=u?f:null,f.update(t,this.transform,n),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,f]=n.getFovAdjustedRange(this.transform._fov);if(u>f)return void(this.transform.fogCullDistSq=null);const m=u+.78*(f-u);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ss(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*s.q.devicePixelRatio,this.height=n*s.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,n=new s.ba;n.emplaceBack(0,0),n.emplaceBack(s.aj,0),n.emplaceBack(0,s.aj),n.emplaceBack(s.aj,s.aj),this.tileExtentBuffer=t.createVertexBuffer(n,s.bc.members),this.tileExtentSegments=s.bd.simpleSegment(0,0,4,2);const u=new s.ba;u.emplaceBack(0,0),u.emplaceBack(s.aj,0),u.emplaceBack(0,s.aj),u.emplaceBack(s.aj,s.aj),this.debugBuffer=t.createVertexBuffer(u,s.bc.members),this.debugSegments=s.bd.simpleSegment(0,0,4,5);const f=new s.ba;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,s.bc.members),this.viewportSegments=s.bd.simpleSegment(0,0,4,2);const m=new s.aZ;m.emplaceBack(0,0,0,0),m.emplaceBack(s.aj,0,s.aj,0),m.emplaceBack(0,s.aj,0,s.aj),m.emplaceBack(s.aj,s.aj,s.aj,s.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(m,s.bf.members),this.mercatorBoundsSegments=s.bd.simpleSegment(0,0,4,2);const _=new s.a_;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const v=new s.bb;for(const E of[0,1,3,2,0])v.emplaceBack(E);this.debugIndexBuffer=t.createIndexBuffer(v),this.emptyTexture=new s.T(t,new s.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bz();const w=this.context.gl;this.stencilClearMode=new rr({func:w.ALWAYS,mask:0},0,255,w.ZERO,w.ZERO,w.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Rt.disabled,this.stencilClearMode,Ft.disabled,Dr.disabled,wo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,u){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let v=!1;for(const w of u)if(this._tileClippingMaskIDs[w.key]===void 0){v=!0;break}if(!v)return}this.currentStencilSource=n.id;const f=this.context,m=f.gl;this.nextStencilID+u.length>256&&this.clearStencil(),f.setColorMode(Ft.disabled),f.setDepthMode(Rt.disabled);const _=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of u){const w=n.getTile(v),E=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,{tileBoundsBuffer:A,tileBoundsIndexBuffer:P,tileBoundsSegments:M}=this.getTileBoundsBuffers(w);_.draw(this,m.TRIANGLES,Rt.disabled,new rr({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),Ft.disabled,Dr.disabled,wo(v.projMatrix),"$clipping",A,P,M)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new rr({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new rr({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,u=t.sort((_,v)=>v.overscaledZ-_.overscaledZ),f=u[u.length-1].overscaledZ,m=u[0].overscaledZ-f+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const _={};for(let v=0;v<m;v++)_[v+f]=new rr({func:n.GEQUAL,mask:255},v+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=m,[_,u]}return[{[f]:rr.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ft([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ft.unblended:Ft.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ft([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new s.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,n,u,f=!1){if(this.depthOcclusion)return new Rt(this.context.gl.GREATER,Rt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!f)return Rt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Rt(u||this.context.gl.LEQUAL,n,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),u=Math.ceil(this.height),f=this.context.bindFramebuffer.get(),m=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&u!==0&&(this.depthFBO=new Wu(this.context,n,u,!1,"texture"),this.depthTexture=new s.T(this.context,{width:n,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(f),t.bindTexture(t.TEXTURE_2D,m),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,u,0,0,n,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const u=s.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const f=this.style._mergedLayers,m=!(!this.terrain||!this.terrain.enabled),_=()=>this.style._getOrder(m).filter(je=>{const tt=f[je];return!(tt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[tt.type]});let v=_(),w=!1,E=!1;for(const je of v){const tt=f[je];tt.type==="circle"&&(w=!0),tt.type==="symbol"&&(tt.hasInitialOcclusionOpacityProperties?E=!0:w=!0)}let A=v.map(je=>f[je]);const P=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.q.now()),this.imageManager.beginFrame();let M=0,k=!1;for(const je in P){const tt=P[je];tt.used&&(tt.prepare(this.context),tt.getSource().usedInConflation&&++M)}let q=!1;for(const je of A)je.isHidden(this.transform.zoom)||(je.type==="clip"&&(q=!0),this.prepareLayer(je));const V={},$={},U={},ee={},se={};for(const je in P){const tt=P[je];V[je]=tt.getVisibleCoordinates(),$[je]=V[je].slice().reverse(),U[je]=tt.getVisibleCoordinates(!0).reverse(),ee[je]=tt.getShadowCasterCoordinates(),se[je]=tt.sortCoordinatesByDistance(V[je])}const ae=je=>{const tt=this.style.getLayerSourceCache(je);return tt&&tt.used?tt.getSource():null};if(M||q||this._clippingActiveLastFrame){const je=[],tt=[];let Ve=0;for(const vt of A)this.isSourceForClippingOrConflation(vt,ae(vt))&&(je.push(vt),tt.push(Ve)),Ve++;if(je&&(q||je.length>1)||this._clippingActiveLastFrame){q=!1;const vt=[];for(let it=0;it<je.length;it++){const Et=je[it],yt=tt[it],Mt=this.style.getLayerSourceCache(Et);if(!Mt||!Mt.used||!Mt.getSource().usedInConflation&&Et.type!=="clip")continue;let Dt=s.ev,ur=s.bQ.None;const gr=[];let Kt=!0;if(Et.type==="clip"){Dt=yt;for(const pr of Et.layout.get("clip-layer-types"))ur|=pr==="model"?s.bQ.Model:pr==="symbol"?s.bQ.Symbol:s.bQ.FillExtrusion;for(const pr of Et.layout.get("clip-layer-scope"))gr.push(pr);Et.isHidden(this.transform.zoom)?Kt=!1:q=!0}Kt&&vt.push({layer:Et.fqid,cache:Mt,order:Dt,clipMask:ur,clipScope:gr})}this.replacementSource.setSources(vt),k=!0}}this._clippingActiveLastFrame=q,k||this.replacementSource.clear(),this.conflationActive=k,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let je=0;je<A.length;je++){const tt=A[je],Ve=tt.cutoffRange();if(this.longestCutoffRange=Math.max(Ve,this.longestCutoffRange),Ve>0){const vt=ae(tt);vt&&(this.minCutoffZoom=Math.max(vt.minzoom,this.minCutoffZoom)),tt.minzoom&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom))}tt.is3D(m)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=je),this._lastOcclusionLayer=je)}const xe=this.style&&this.style.fog;xe?(this._fogVisible=xe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=xe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0,v=_(),A=v.map(je=>f[je]));const ye=this._shadowRenderer;if(ye){ye.updateShadowParameters(this.transform,this.style.directionalLight);for(const je in P)for(const tt of V[je]){let Ve={min:0,max:0};this.terrain&&(Ve=this.terrain.getMinMaxForTile(tt)||Ve),ye.addShadowReceiver(tt.toUnwrapped(),Ve.min,Ve.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eu(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new tu(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(me&&!this._snow&&(this._snow=new gn(this)),!me&&this._snow&&(this._snow.destroy(),delete this._snow),he&&!this._rain&&(this._rain=new Hf(this)),!he&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Xn.has(this.context.gl))return;this.renderPass="offscreen";for(const je of A){const tt=t.getLayerSourceCache(je);if(!je.hasOffscreenPass()||je.isHidden(this.transform.zoom))continue;const Ve=tt?$[tt.id]:void 0;(je.type==="custom"||je.type==="raster"||je.type==="raster-particle"||je.isSky()||Ve&&Ve.length)&&this.renderLayer(this,tt,je,Ve)}this.depthRangeFor3D=[0,1-(A.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ee)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Te=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ae=(()=>{if(n.showOverdrawInspector)return s.am.black;const je=this.style.fog;if(je&&this.transform.projection.supportsFog){const tt=this.style.getLut(je.scope);if(!Te){const Ve=je.properties.get("color-use-theme")==="none",vt=je.properties.get("color").toRenderColor(Ve?null:tt).toArray01();return new s.am(...vt)}if(Te){const Ve=je.properties.get("space-color-use-theme")==="none",vt=je.properties.get("space-color").toRenderColor(Ve?null:tt).toArray01();return new s.am(...vt)}}return s.am.transparent})();if(this.context.clear({color:Ae,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const je=A[this.currentLayer],tt=t.getLayerSourceCache(je);if(je.isSky())continue;const Ve=tt?(je.is3D(m)?se:$)[tt.id]:void 0;this._renderTileClippingMasks(je,tt,Ve),this.renderLayer(this,tt,je,Ve)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const je=A[this.currentLayer],tt=t.getLayerSourceCache(je);je.isSky()&&this.renderLayer(this,tt,je,tt?$[tt.id]:void 0)}function rt(je,tt){let Ve;return tt&&(Ve=(je.type==="symbol"?U:je.is3D(m)?se:$)[tt.id]),Ve}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<v.length;){const je=A[this.currentLayer];if(je.type==="raster"||je.type==="raster-particle"){const tt=t.getLayerSourceCache(je);this.renderLayer(this,tt,je,rt(je,tt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;ye&&(Ge=ye.getShadowCastingLayerCount());let ft=!1,mt=-1;for(let je=0;je<v.length;++je){const tt=A[je];tt.isHidden(this.transform.zoom)||tt.is3D(m)&&(mt=je)}E&&mt===-1&&(w=!0);let Bt=!1;for(;this.currentLayer<v.length;){const je=A[this.currentLayer],tt=t.getLayerSourceCache(je);if(je.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(je)){if(je.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Bt&&je.is3D(m)&&!m){const Ve=this.currentLayer,vt=it=>{for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const Et=A[this.currentLayer];if(Il[Et.type]){const yt=this.style.getLayerSourceCache(Et);Il[Et.type](this,yt,Et,rt(Et,yt),it)}}};vt("initialize"),vt("reset"),this.currentLayer=Ve,Bt=!0}if(w&&!ft&&this.terrain&&!this.transform.isOrthographic&&(ft=!0,this.blitDepth()),E&&mt!==-1&&this.currentLayer===mt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(je,tt,tt?V[tt.id]:void 0),this.renderLayer(this,tt,je,rt(je,tt)),!this.terrain&&ye&&Ge>0&&je.hasShadowPass()&&--Ge==0&&(ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Ve=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ve;this.currentLayer++){const vt=A[this.currentLayer];if(!vt.hasLightBeamPass())continue;const it=t.getLayerSourceCache(vt);this.renderLayer(this,it,vt,it?$[it.id]:void 0)}this.currentLayer=Ve,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ve=this.currentLayer;this.depthOcclusion=!0;for(const vt of this.layersWithOcclusionOpacity){this.currentLayer=vt;const it=A[this.currentLayer],Et=t.getLayerSourceCache(it),yt=Et?$[Et.id]:void 0;this.terrain||this._renderTileClippingMasks(it,Et,Et?V[Et.id]:void 0),this.renderLayer(this,Et,it,yt)}this.depthOcclusion=!1,this.currentLayer=Ve,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let je=null;A.forEach(tt=>{const Ve=t.getLayerSourceCache(tt);Ve&&!tt.isHidden(this.transform.zoom)&&Ve.getVisibleCoordinates().length&&(!je||je.getSource().maxzoom<Ve.getSource().maxzoom)&&(je=Ve)}),je&&this.options.showTileBoundaries&&Fi.debug(this,je,je.getVisibleCoordinates(),s.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Fi.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(je){const tt=je.transform.padding;Sh(je,je.transform.height-(tt.top||0),3,Fa),Sh(je,tt.bottom||0,3,Ju),jc(je,tt.left||0,3,Qu),jc(je,je.transform.width-(tt.right||0),3,No);const Ve=je.transform.centerPoint;(function(vt,it,Et,yt){Kn(vt,it-1,Et-10,2,20,yt),Kn(vt,it-10,Et-1,20,2,yt)})(je,Ve.x,je.transform.height-Ve.y,Sl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),k||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,u=!n||!n.includes(t.type);if(Ih[t.type]&&(u||this.terrain&&t.type==="custom")){const f=this.style.getLayerSourceCache(t);Ih[t.type](t,f,this)}this.gpuTimingEnd()}renderLayer(t,n,u,f){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||f&&f.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Fi[u.type](t,n,u,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,u=this.context.gl;let f=this.gpuTimers[t.id];f||(f=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),f.calls++,u.beginQuery(n.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,u=n.createQuery();this.deferredRenderGpuTimeQueries.push(u),n.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const u in t){const f=t[u],m=this.context.extTimerQuery,_=m.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;m.deleteQueryEXT(f.query),n[u]=_}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let u=0;for(const f of t)u+=n.getQueryParameter(f,n.QUERY_RESULT)/1e6,n.deleteQuery(f);return u}translatePosMatrix(t,n,u,f,m){if(!u[0]&&!u[1])return t;const _=m?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(_){const E=Math.sin(_),A=Math.cos(_);u=[u[0]*A-u[1]*E,u[0]*E+u[1]*A]}const v=[m?u[0]:s.aw(n,u[0],this.transform.zoom),m?u[1]:s.aw(n,u[1],this.transform.zoom),0],w=new Float32Array(16);return s.bo(w,t,v),w}saveTileTexture(t){const n=t.size[0],u=this._tileTextures[n];u?u.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,u){const f=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,m=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(m.push("LIGHTING_3D_MODE"),m.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||m.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||m.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(m.push("TERRAIN"),this.linearFloatFilteringSupported()&&m.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&m.push("GLOBE"),!this._fogVisible||f||n!==void 0&&!n||m.push("FOG","FOG_DITHERING"),f&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}getOrCreateProgram(t,n){this.cache=this.cache||{};const u=n&&n.defines||[],f=n&&n.config,m=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(u),_=Gu.cacheKey(gu[t],t,m,f);return this.cache[_]||(this.cache[_]=new Gu(this.context,t,gu[t],f,Bc[t],m)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const u=this.style.directionalLight,f=this.style.ambientLight;if(u&&f){const m=((_,v,w)=>{const E=_.properties.get("direction"),A=_.properties.get("color-use-theme")==="none",P=_.properties.get("color").toRenderColor(A?null:w.getLut(_.scope)).toArray01(),M=_.properties.get("intensity"),k=v.properties.get("color-use-theme")==="none",q=v.properties.get("color").toRenderColor(k?null:w.getLut(v.scope)).toArray01(),V=v.properties.get("intensity"),$=[E.x,E.y,E.z],U=s.dw(q,V),ee=s.dw(P,M);return{u_lighting_ambient_color:U,u_lighting_directional_dir:$,u_lighting_directional_color:ee,u_ground_radiance:kc($,ee,U)}})(u,f,this.style);n.setLightsUniformValues(t,m)}}}uploadCommonUniforms(t,n,u,f,m){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const v=_.getOpacity(this.transform.pitch),w=((E,A,P,M,k,q,V,$,U,ee,se,ae)=>{const xe=E.transform,ye=A.properties.get("color-use-theme")==="none",me=A.properties.get("color").toRenderColor(ye?null:E.style.getLut(A.scope)).toArray01();me[3]=M;const he=E.frameCounter/1e3%1,[Te,Ae]=A.properties.get("vertical-range");return{u_fog_matrix:P?xe.calculateFogTileMatrix(P):ae||E.identityMat,u_fog_range:A.getFovAdjustedRange(xe._fov),u_fog_color:me,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,Ae),Ae],u_fog_temporal_offset:he,u_frustum_tl:k,u_frustum_tr:q,u_frustum_br:V,u_frustum_bl:$,u_globe_pos:U,u_globe_radius:ee,u_viewport:se,u_globe_transition:s.ah(xe.zoom),u_is_globe:+(xe.projection.name==="globe")}})(this,_,u,v,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.q.devicePixelRatio,this.transform.height*s.q.devicePixelRatio],f);n.setFogUniformValues(t,w)}m&&n.setCutoffUniformValues(t,m.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const f of u)n[f.key]=t[f.key]||new bo(f,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=Qt||n[1]>=Qt}setupDepthForOcclusion(t,n,u){const f=this.context,m=f.gl,_=!!u;var v;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),f.activeTexture.set(m.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((v=this.depthRangeFor3D)[1]-v[0]),-1-2*v[0]/(v[1]-v[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),f.activeTexture.set(m.TEXTURE0),_||n.setTerrainUniformValues(f,u)}}function Au(l,t){let n=!1,u=null;const f=()=>{u=null,n&&(l(),u=setTimeout(f,t),n=!1)};return()=>(n=!0,u||f(),u)}class Hc{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Au(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=Ch(t);if(this._hashName){const u=this._hashName;let f=!1;const m=location.hash.slice(1).split("&").map(_=>{const v=_.split("=")[0];return v===u?(f=!0,`${v}=${n}`):_}).filter(_=>_);return f||m.push(`${u}=${n}`),`#${m.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(n=u)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(u=>isNaN(Number(u)))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:u,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ch(l,t){const n=l.getCenter(),u=Math.round(100*l.getZoom())/100,f=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,f),_=Math.round(n.lng*m)/m,v=Math.round(n.lat*m)/m,w=l.getBearing(),E=l.getPitch();let A=t?`/${_}/${v}/${u}`:`${u}/${v}/${_}`;return(w||E)&&(A+="/"+Math.round(10*w)/10),E&&(A+=`/${Math.round(E)}`),A}const $c={linearity:.3,easing:s.ew(0,0,.3,1)},of=s.l({deceleration:2500,maxSpeed:1400},$c),hd=s.l({deceleration:20,maxSpeed:1400},$c),nl=s.l({deceleration:1e3,maxSpeed:360},$c),Al=s.l({deceleration:1e3,maxSpeed:90},$c);class rc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=s.q.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)n.zoom+=m.zoomDelta||0,n.bearing+=m.bearingDelta||0,n.pitch+=m.pitchDelta||0,m.panDelta&&n.pan._add(m.panDelta),m.around&&(n.around=m.around),m.pinchAround&&(n.pinchAround=m.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(n.pan.mag()){const m=Wc(n.pan.mag(),u,s.l({},of,t||{}));f.offset=n.pan.mult(m.amount/n.pan.mag()),f.center=this._map.transform.center,ic(f,m)}if(n.zoom){const m=Wc(n.zoom,u,hd);f.zoom=this._map.transform.zoom+m.amount,ic(f,m)}if(n.bearing){const m=Wc(n.bearing,u,nl);f.bearing=this._map.transform.bearing+s.aD(m.amount,-179,179),ic(f,m)}if(n.pitch){const m=Wc(n.pitch,u,Al);f.pitch=this._map.transform.pitch+m.amount,ic(f,m)}if(f.zoom||f.bearing){const m=n.pinchAround===void 0?n.around:n.pinchAround;f.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function ic(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Wc(l,t,n){const{maxSpeed:u,linearity:f,deceleration:m}=n,_=s.aD(l*f/(t/1e3),-u,u),v=Math.abs(_)/(m*f);return{easing:n.easing,duration:1e3*v,amount:_*(v/2)}}class Gs extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u,f={}){const m=dr(n.getCanvasContainer(),u),_=n.unproject(m);super(t,s.l({point:m,lngLat:_,originalEvent:u},f)),this._defaultPrevented=!1,this.target=n}}class jo extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,u){const f=t==="touchend"?u.changedTouches:u.touches,m=Fr(n.getCanvasContainer(),f),_=m.map(w=>n.unproject(w)),v=m.reduce((w,E,A,P)=>w.add(E.div(P.length)),new s.P(0,0));super(t,{points:m,point:v,lngLats:_,lngLat:n.unproject(v),originalEvent:u}),this._defaultPrevented=!1}}class Mh extends s.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class ol{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Mh(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new Gs(t.type,this._map,t))}mouseup(t){this._map.fire(new Gs(t.type,this._map,t))}preclick(t){const n=s.l({},t);n.type="preclick",this._map.fire(new Gs(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Gs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Gs(t.type,this._map,t))}mouseover(t){this._map.fire(new Gs(t.type,this._map,t))}mouseout(t){this._map.fire(new Gs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new jo(t.type,this._map,t))}touchmove(t){this._map.fire(new jo(t.type,this._map,t))}touchend(t){this._map.fire(new jo(t.type,this._map,t))}touchcancel(t){this._map.fire(new jo(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dd{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Gs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Gs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ph{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(st(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const u=n,f=this._startPos,m=this._lastPos;if(!f||!m||m.equals(u)||!this._box&&u.dist(f)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(f.x,u.x),v=Math.max(f.x,u.x),w=Math.min(f.y,u.y),E=Math.max(f.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${w}px)`,this._box.style.width=v-_+"px",this._box.style.height=E-w+"px")})}mouseupWindow(t,n){if(!this._active)return;const u=this._startPos,f=n;if(u&&t.button===0){if(this.reset(),St(),u.x!==f.x||u.y!==f.y)return this._map.fire(new s.A("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(u,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$e(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new s.A(t,{originalEvent:n}))}}function Zc(l,t){const n={};for(let u=0;u<l.length;u++)n[l[u].identifier]=t[u];return n}class Rh{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(f){const m=new s.P(0,0);for(const _ of f)m._add(_);return m.div(f.length)}(n),this.touches=Zc(u,n)))}touchmove(t,n,u){if(this.aborted||!this.centroid)return;const f=Zc(u,n);for(const m in this.touches){const _=f[m];(!_||_.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,n,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class ao{constructor(t){this.singleTap=new Rh(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,u){this.singleTap.touchstart(t,n,u)}touchmove(t,n,u){this.singleTap.touchmove(t,n,u)}touchend(t,n,u){const f=this.singleTap.touchend(t,n,u);if(f){const m=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(f)<30;if(m&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Dh{constructor(){this._zoomIn=new ao({numTouches:1,numTaps:2}),this._zoomOut=new ao({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,u){this._zoomIn.touchstart(t,n,u),this._zoomOut.touchstart(t,n,u)}touchmove(t,n,u){this._zoomIn.touchmove(t,n,u),this._zoomOut.touchmove(t,n,u)}touchend(t,n,u){const f=this._zoomIn.touchend(t,n,u),m=this._zoomOut.touchend(t,n,u);return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(f)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const kh={0:1,2:2},Cu={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Xc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const u=hi(t);this._correctButton(t,u)&&(this._lastPoint=n,this._eventButton=u)}mousemoveWindow(t,n){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(f,m){const _=kh[m];return f.buttons===void 0||(f.buttons&_)!==_}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(u,n)}}mouseupWindow(t){this._lastPoint&&hi(t)===this._eventButton&&(this._moved&&St(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fd extends Xc{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class Lh extends Xc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Cu[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const u=.8*(n.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Mu extends Xc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Cu[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const u=-.5*(n.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class pd{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),s.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,n,u){return this._calculateTransform(t,n,u)}touchmove(t,n,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!s.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,u)}}touchend(t,n,u){this._calculateTransform(t,n,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,u){u.length>0&&(this._active=!0);const f=Zc(u,n),m=new s.P(0,0),_=new s.P(0,0);let v=0;for(const E in f){const A=f[E],P=this._touches[E];P&&(m._add(A),_._add(A.sub(P)),v++,f[E]=A)}if(this._touches=f,v<this._minTouches||!_.mag())return;const w=_.div(v);return this._sum._add(w),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(v),panDelta:w}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class zh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,u){return{}}touchstart(t,n,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,u){const f=this._firstTwoTouches;if(!f)return;t.preventDefault();const[m,_]=f,v=Zo(u,n,m),w=Zo(u,n,_);if(!v||!w)return;const E=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],E,t)}touchend(t,n,u){if(!this._firstTwoTouches)return;const[f,m]=this._firstTwoTouches,_=Zo(u,n,f),v=Zo(u,n,m);_&&v||(this._active&&St(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zo(l,t,n){for(let u=0;u<l.length;u++)if(l[u].identifier===n)return t[u]}function Xo(l,t){return Math.log(l/t)/Math.LN2}class md extends zh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Xo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xo(this._distance,u),pinchAround:n}}}function Oh(l,t){return 180*l.angleWith(t)/Math.PI}class sf extends zh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Oh(this._vector,u),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const f=Oh(t,u);return Math.abs(f)<n}}function Fh(l){return Math.abs(l.y)>Math.abs(l.x)}class af extends zh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Fh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,u){const f=this._lastPoints;if(!f)return;const m=t[0].sub(f[0]),_=t[1].sub(f[1]);return this._map._cooperativeGestures&&!s.ex()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(m,_,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+_.y)/2*-.5})}gestureBeginsVertically(t,n,u){if(this._valid!==void 0)return this._valid;const f=t.mag()>=2,m=n.mag()>=2;if(!f&&!m)return;if(!f||!m)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const _=t.y>0==n.y>0;return Fh(t)&&Fh(n)&&_}}const gd={panStep:100,bearingStep:15,pitchStep:10};class lf{constructor(){const t=gd;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,u=0,f=0,m=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(u=0,f=0),{cameraAnimation:v=>{const w=v.getZoom();v.easeTo({duration:300,easeId:"keyboardHandler",easing:_d,zoom:n?Math.round(w)+n*(t.shiftKey?2:1):w,bearing:v.getBearing()+u*this._bearingStep,pitch:v.getPitch()+f*this._pitchStep,offset:[-m*this._panStep,-_*this._panStep],center:v.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _d(l){return l*(2-l)}const yd=4.000244140625,uf=1/450;class vd{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=uf,s.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=s.q.now(),f=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,n!==0&&n%yd==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=dr(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>yd?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&A!==0&&(A=1/A);const P=n(),M=Math.pow(2,P),k=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):M;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(k*A))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:n(),f=this._startZoom,m=this._easing;let _,v=!1;if(this._type==="wheel"&&f&&m){const E=Math.min((s.q.now()-this._lastWheelEventTime)/200,1),A=m(E);_=s.ai(f,u,A),E<1?this._frameId||(this._frameId=!0):v=!0}else _=u,v=!0;this._active=!0,v&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let w=_-n();return w*this._lastDelta<0&&(w=0),{noInertia:!0,needsRenderFrame:!v,zoomDelta:w,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=s.ey;if(this._prevEase){const u=this._prevEase,f=(s.q.now()-u.start)/u.duration,m=u.easing(f+.01)-u.easing(f),_=.27/Math.sqrt(m*m+1e-4)*.01,v=Math.sqrt(.0729-_*_);n=s.ew(_,v,.25,1)}return this._prevEase={start:s.q.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class xd{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class cf{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bd{constructor(){this._tap=new ao({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=n[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,n,u))}touchmove(t,n,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const f=n[0],m=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,n,u)}touchend(t,n,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,n,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bh{constructor(t,n,u){this._el=t,this._mousePan=n,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vp{constructor(t,n,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $f{constructor(t,n,u,f){this._el=t,this._touchZoom=n,this._touchRotate=u,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Sn=l=>l.zoom||l.drag||l.pitch||l.rotate;class hf extends s.A{}class wd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const u=s.at([],n,t);this.radius=s.ae(u[2]<0?s.eA([],u,this.constants):[u[0],u[1],0])}projectRay(t){s.eA(t,t,this.constants),s.au(t,t),s.eB(t,t,this.constants);const n=s.b$([],t,this.radius);if(n[2]>0){const u=s.b$([],[0,0,1],s.bE(n,[0,0,1])),f=s.b$([],s.au([],[n[0],n[1],0]),this.radius),m=s.cU([],n,s.b$([],s.at([],s.cU([],f,u),n),2));n[0]=m[0],n[1]=m[1]}return n}}function Qs(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class xp{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rc(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new wd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),s.aV(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[f,m,_]of this._listeners){const v=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(m,v,_)}}destroy(){for(const[t,n,u]of this._listeners){const f=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,f,u)}}_addDefaultHandlers(t){const n=this._map,u=n.getCanvasContainer();this._add("mapEvent",new ol(n,t));const f=n.boxZoom=new Ph(n,t);this._add("boxZoom",f);const m=new Dh,_=new cf;n.doubleClickZoom=new xd(_,m),this._add("tapZoom",m),this._add("clickZoom",_);const v=new bd;this._add("tapDragZoom",v);const w=n.touchPitch=new af(n);this._add("touchPitch",w);const E=new Lh(t),A=new Mu(t);n.dragRotate=new vp(t,E,A),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);const P=new fd(t),M=new pd(n,t);n.dragPan=new Bh(u,P,M),this._add("mousePan",P),this._add("touchPan",M,["touchZoom","touchRotate"]);const k=new sf,q=new md;n.touchZoomRotate=new $f(u,q,k,v),this._add("touchRotate",k,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new dd(n));const V=n.scrollZoom=new vd(n,this);this._add("scrollZoom",V,["mousePan"]);const $=n.keyboard=new lf;this._add("keyboard",$);for(const U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[U]&&n[U].enable(t[U])}_add(t,n,u){this._handlers.push({handlerName:t,handler:n,allowed:u}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Sn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,u){for(const f in t)if(f!==u&&(!n||n.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const u of t)this._el.contains(u.target)&&n.push(u);return n}handleEvent(t,n){this._updatingCamera=!0;const u=t.type==="renderFrame",f=u?void 0:t,m={needsRenderFrame:!1},_={},v={},w=t.touches?this._getMapTouches(t.touches):void 0,E=w?Fr(this._el,w):u?void 0:dr(this._el,t);for(const{handlerName:M,handler:k,allowed:q}of this._handlers){if(!k.isEnabled())continue;let V;this._blockedByActive(v,q,M)?k.reset():k[n||t.type]&&(V=k[n||t.type](t,E,w),this.mergeHandlerResult(m,_,V,M,f),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||k.isActive())&&(v[M]=k)}const A={};for(const M in this._previousActiveHandlers)v[M]||(A[M]=f);this._previousActiveHandlers=v,(Object.keys(A).length||Qs(m))&&(this._changes.push([m,_,A]),this._triggerRenderFrame()),(Object.keys(v).length||Qs(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:P}=m;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(t,n,u,f,m){if(!u)return;s.l(t,u);const _={handlerName:f,originalEvent:u.originalEvent||m};u.zoomDelta!==void 0&&(n.zoom=_),u.panDelta!==void 0&&(n.drag=_),u.pitchDelta!==void 0&&(n.pitch=_),u.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const t={},n={},u={};for(const[f,m,_]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.aroundCoord!==void 0&&(t.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),s.l(n,m),s.l(u,_);this._updateMapTransform(t,n,u),this._changes=[]}_updateMapTransform(t,n,u){const f=this._map,m=f.transform,_=ee=>[ee.x,ee.y,ee.z];if((ee=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!Qs(t)){const ee=m.zoom;m.cameraElevationReference="sea",this._originalZoom!=null&&m._orthographicProjectionAtLowPitch&&m.projection.name!=="globe"&&m.pitch===0?(m.cameraElevationReference="ground",m.zoom=this._originalZoom):(m.recenterOnTerrain(),m.cameraElevationReference="ground"),ee!==m.zoom&&this._map._update(!0)}if(m._isCameraConstrained&&f._stop(!0),!Qs(t))return void this._fireEvents(n,u,!0);let{panDelta:v,zoomDelta:w,bearingDelta:E,pitchDelta:A,around:P,aroundCoord:M,pinchAround:k}=t;m._isCameraConstrained&&(w>0&&(w=0),m._isCameraConstrained=!1),k!==void 0&&(P=k),(w||(ee=>n[ee]&&!this._eventsInProgress[ee])("drag"))&&P&&(this._dragOrigin=_(m.pointCoordinate3D(P)),this._originalZoom=m.zoom,this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",f._stop(!0),P=P||f.transform.centerPoint,E&&(m.bearing+=E),A&&(m.pitch+=A),m._updateCameraState();const q=[0,0,0];if(v)if(m.projection.name==="mercator"){const ee=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(P).dir),se=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(P.sub(v)).dir);q[0]=se[0]-ee[0],q[1]=se[1]-ee[1]}else{const ee=m.pointCoordinate(P);if(m.projection.name==="globe"){v=v.rotate(-m.angle);const se=m._pixelsPerMercatorPixel/m.worldSize;q[0]=-v.x*s.ez(s.aY(ee.y))*se,q[1]=-v.y*s.ez(m.center.lat)*se}else{const se=m.pointCoordinate(P.sub(v));ee&&se&&(q[0]=se.x-ee.x,q[1]=se.y-ee.y)}}const V=m.zoom,$=[0,0,0];if(w){const ee=_(M||m.pointCoordinate3D(P)),se={dir:s.au([],s.at([],ee,m._camera.position))};if(se.dir[2]<0){const ae=m.zoomDeltaToMovement(ee,w);s.b$($,se.dir,ae)}}const U=s.cU(q,q,$);m._translateCameraConstrained(U),w&&Math.abs(m.zoom-V)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,u,!0)}_fireEvents(t,n,u){const f=Sn(this._eventsInProgress),m=Sn(t),_={};for(const A in t){const{originalEvent:P}=t[A];this._eventsInProgress[A]||(_[`${A}start`]=P),this._eventsInProgress[A]=t[A]}!f&&m&&this._fireEvent("movestart",m.originalEvent);for(const A in _)this._fireEvent(A,_[A]);m&&this._fireEvent("move",m.originalEvent);for(const A in t){const{originalEvent:P}=t[A];this._fireEvent(A,P)}const v={};let w;for(const A in this._eventsInProgress){const{handlerName:P,originalEvent:M}=this._eventsInProgress[A];this._handlersById[P].isActive()||(delete this._eventsInProgress[A],w=n[P]||M,v[`${A}end`]=w)}for(const A in v)this._fireEvent(A,v[A]);const E=Sn(this._eventsInProgress);if(u&&(f||m)&&!E){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=M=>M!==0&&-this._bearingSnap<M&&M<this._bearingSnap;A?(P(A.bearing||this._map.getBearing())&&(A.bearing=0),this._map.easeTo(A,{originalEvent:w})):(this._map.fire(new s.A("moveend",{originalEvent:w})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new s.A(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new hf("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const nc="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Sd extends s.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,s.aV(["_renderFrameCallback"],this)}getCenter(){return new s.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,u){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,s.l({offset:t},n),u)}panTo(t,n,u){return this.easeTo(s.l({center:t},n),u)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,u){return this.easeTo(s.l({zoom:t},n),u)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,u){return this.easeTo(s.l({bearing:t},n),u)}resetNorth(t,n){return this.rotateTo(0,s.l({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(s.l({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=s.aG.convert(t);const u=n&&n.bearing||0,f=n&&n.pitch||0,m=t.getNorthWest(),_=t.getSouthEast();return this._cameraForBounds(this.transform,m,_,u,f,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?s.l({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:s.l({},n,t)}_extendCameraOptions(t){return(t=s.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const u=n.max[0]-n.min[0],f=n.max[1]-n.min[1];return u/f>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):f/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,u,f,m,_){const v=t.clone(),w=this._extendCameraOptions(_);v.bearing=f,v.pitch=m;const E=s.cd.convert(n),A=s.cd.convert(u),P=.5*(E.lat+A.lat),M=.5*(E.lng+A.lng),k=s.eC(P,M),q=s.au([],k),V=s.au([],s.bG([],q,[0,1,0])),$=s.bG([],V,q),U=[V[0],V[1],V[2],0,$[0],$[1],$[2],0,q[0],q[1],q[2],0,0,0,0,1],ee=[k,s.eC(E.lat,E.lng),s.eC(A.lat,E.lng),s.eC(A.lat,A.lng),s.eC(E.lat,A.lng),s.eC(P,E.lng),s.eC(P,A.lng),s.eC(E.lat,M),s.eC(A.lat,M)];let se=s.cV.fromPoints(ee.map(it=>[s.bE(V,it),s.bE($,it),s.bE(q,it)]));const ae=s.ad([],se.center,U);s.eD(ae)===0&&s.eE(ae,0,0,1),s.au(ae,ae),s.b$(ae,ae,s.aE),v.center=s.eF(ae);const xe=v.getWorldToCameraMatrix(),ye=s.bi(new Float64Array(16),xe);se=s.cV.applyTransform(se,s.az([],xe,U));const me=this._extendAABB(se,v,w,f);if(!me)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");se=me,s.ad(ae,ae,xe);const he=.5*(se.max[2]-se.min[2]),Te=this._minimumAABBFrustumDistance(v,se),Ae=s.b$([],[0,0,1],he),rt=s.cU(Ae,ae,Ae),Ge=Te+(v.pitch===0?0:s.bD(ae,rt)),ft=v.globeCenterInViewSpace,mt=s.at([],ae,[ft[0],ft[1],ft[2]]);s.au(mt,mt),s.b$(mt,mt,Ge);const Bt=s.cU([],ae,mt);s.ad(Bt,Bt,ye);const je=s.eq/s.aE,tt=s.ae(Bt),Ve=s.c6(Math.max(tt*je-s.eq,Number.EPSILON),0),vt=Math.min(v.zoomFromMercatorZAdjusted(Ve),w.maxZoom);return vt>.5*(s.cL+s.cx)?(v.setProjection({name:"mercator"}),v.zoom=vt,this._cameraForBounds(v,n,u,f,m,_)):{center:v.center,zoom:vt,bearing:f,pitch:m}}_extendAABB(t,n,u,f){const m=.5*((u.padding.left||0)+(u.padding.right||0)),_=.5*((u.padding.top||0)+(u.padding.bottom||0)),v=_,w=m,E=m,A=_,P=n.width-(w+E),M=n.height-(v+A),k=s.at([],t.max,t.min),q=Math.min(P/k[0],M/k[1]),V=Math.min(n.scaleZoom(n.scale*q),u.maxZoom);if(isNaN(V))return null;const $=n.scale/n.zoomScale(V),U=new s.cV([t.min[0]-w*$,t.min[1]-A*$,t.min[2]],[t.max[0]+E*$,t.max[1]+v*$,t.max[2]]),ee=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new s.P(u.offset.x,u.offset.y):s.P.convert(u.offset)).rotate(-s.al(f));return U.center[0]-=ee.x*$,U.center[1]+=ee.y*$,U}queryTerrainElevation(t,n){const u=this.transform.elevation;return u?(n=s.l({},{exaggerated:!0},n),u.getAtPoint(s.ac.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,u,f,m,_){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,u,f,m,_);const v=t.clone(),w=this._extendCameraOptions(_);v.bearing=f,v.pitch=m;const E=s.cd.convert(n),A=s.cd.convert(u),P=new s.cd(E.lng,A.lat),M=new s.cd(A.lng,E.lat),k=v.project(E),q=v.project(A),V=this.queryTerrainElevation(E),$=this.queryTerrainElevation(A),U=this.queryTerrainElevation(P),ee=this.queryTerrainElevation(M),se=[[k.x,k.y,Math.min(V||0,$||0,U||0,ee||0)],[q.x,q.y,Math.max(V||0,$||0,U||0,ee||0)]];let ae=s.cV.fromPoints(se);const xe=v.getWorldToCameraMatrix(),ye=s.bi(new Float64Array(16),xe);ae=s.cV.applyTransform(ae,xe);const me=this._extendAABB(ae,v,w,f);if(!me)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ae=me;const he=.5*s.at([],ae.max,ae.min)[2],Te=this._minimumAABBFrustumDistance(v,ae),Ae=[0,0,1,0];s.aA(Ae,Ae,xe),s.eG(Ae,Ae);const rt=s.b$([],Ae,Te+he),Ge=s.cU([],ae.center,rt);s.ad(ae.center,ae.center,ye),s.ad(Ge,Ge,ye);const ft=v.unproject(new s.P(ae.center[0],ae.center[1])),mt=s.eH(v.projection,ft),Bt=Math.pow(2,mt),je=Math.min(v._zoomFromMercatorZ(Ge[2]*v.pixelsPerMeter*Bt/v.worldSize),w.maxZoom);return v.mercatorFromTransition&&je<.5*(s.cL+s.cx)?(v.setProjection({name:"globe"}),v.zoom=je,this._cameraForBounds(v,n,u,f,m,_)):{center:ft,zoom:je,bearing:f,pitch:m}}fitBounds(t,n,u){const f=this.cameraForBounds(t,n);return this._fitInternal(f,n,u)}fitScreenCoordinates(t,n,u,f,m){const _=s.P.convert(t),v=s.P.convert(n),w=new s.P(Math.min(_.x,v.x),Math.min(_.y,v.y)),E=new s.P(Math.max(_.x,v.x),Math.max(_.y,v.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(_,v))return this;const A=this.transform.pointLocation3D(w),P=this.transform.pointLocation3D(E),M=this.transform.pointLocation3D(new s.P(w.x,E.y)),k=this.transform.pointLocation3D(new s.P(E.x,w.y)),q=[Math.min(A.lng,P.lng,M.lng,k.lng),Math.min(A.lat,P.lat,M.lat,k.lat)],V=[Math.max(A.lng,P.lng,M.lng,k.lng),Math.max(A.lat,P.lat,M.lat,k.lat)],$=f&&f.pitch?f.pitch:this.getPitch(),U=this._cameraForBounds(this.transform,q,V,u,$,f);return this._fitInternal(U,f,m)}_fitInternal(t,n,u){return t?(n=s.l(t,n)).linear?this.easeTo(n,u):this.flyTo(n,u):this}jumpTo(t,n){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let f=!1,m=!1,_=!1;"zoom"in t&&u.zoom!==+t.zoom&&(f=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=s.cd.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(m=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(_=!0,u.pitch=+t.pitch);const v=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(v))if(t.retainPadding===!1){const w=u.clone();w.padding=v,u.setLocationAtPoint(u.center,w.centerPoint)}else u.padding=v;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new s.A("movestart",n)).fire(new s.A("move",n)),f&&this.fire(new s.A("zoomstart",n)).fire(new s.A("zoom",n)).fire(new s.A("zoomend",n)),m&&this.fire(new s.A("rotatestart",n)).fire(new s.A("rotate",n)).fire(new s.A("rotateend",n)),_&&this.fire(new s.A("pitchstart",n)).fire(new s.A("pitch",n)).fire(new s.A("pitchend",n)),this.fire(new s.A("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(nc),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const u=this.transform;if(!u.projection.supportsFreeCamera)return s.w(nc),this;this.stop();const f=u.zoom,m=u.pitch,_=u.bearing;u.setFreeCameraOptions(t);const v=f!==u.zoom,w=m!==u.pitch,E=_!==u.bearing;return this.fire(new s.A("movestart",n)).fire(new s.A("move",n)),v&&this.fire(new s.A("zoomstart",n)).fire(new s.A("zoom",n)).fire(new s.A("zoomend",n)),E&&this.fire(new s.A("rotatestart",n)).fire(new s.A("rotate",n)).fire(new s.A("rotateend",n)),w&&this.fire(new s.A("pitchstart",n)).fire(new s.A("pitch",n)).fire(new s.A("pitchend",n)),this.fire(new s.A("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=s.l({offset:[0,0],duration:500,easing:s.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,f=this.getZoom(),m=this.getBearing(),_=this.getPitch(),v=this.getPadding(),w="zoom"in t?+t.zoom:f,E="bearing"in t?this._normalizeBearing(t.bearing,m):m,A="pitch"in t?+t.pitch:_,P=this._extendPadding(t.padding),M=s.P.convert(t.offset);let k,q,V;if(u.projection.name==="globe"){const Ae=s.ac.fromLngLat(u.center),rt=M.rotate(-u.angle);Ae.x+=rt.x/u.worldSize,Ae.y+=rt.y/u.worldSize;const Ge=Ae.toLngLat(),ft=s.cd.convert(t.center||Ge);this._normalizeCenter(ft),k=u.centerPoint.add(rt),q=new s.P(Ae.x,Ae.y).mult(u.worldSize),V=new s.P(s.ay(ft.lng),s.aH(ft.lat)).mult(u.worldSize).sub(q)}else{k=u.centerPoint.add(M);const Ae=u.pointLocation(k),rt=s.cd.convert(t.center||Ae);this._normalizeCenter(rt),q=u.project(Ae),V=u.project(rt).sub(q)}const $=u.zoomScale(w-f);let U,ee;t.around&&(U=s.cd.convert(t.around),ee=u.locationPoint(U));const se=this._zooming||w!==f,ae=this._rotating||m!==E,xe=this._pitching||A!==_,ye=!u.isPaddingEqual(P),me=t.retainPadding===!1?u.clone():u,he=Ae=>rt=>{if(se&&(Ae.zoom=s.ai(f,w,rt)),ae&&(Ae.bearing=s.ai(m,E,rt)),xe&&(Ae.pitch=s.ai(_,A,rt)),ye&&(me.interpolatePadding(v,P,rt),k=me.centerPoint.add(M)),U)Ae.setLocationAtPoint(U,ee);else{const Ge=Ae.zoomScale(Ae.zoom-f),ft=w>f?Math.min(2,$):Math.max(.5,$),mt=Math.pow(ft,1-rt),Bt=Ae.unproject(q.add(V.mult(rt*mt)).mult(Ge));Ae.setLocationAtPoint(Ae.renderWorldCopies?Bt.wrap():Bt,k)}return t.preloadOnly||this._fireMoveEvents(n),Ae};if(t.preloadOnly){const Ae=this._emulate(he,t.duration,u);return this._preloadTiles(Ae),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=ae,this._pitching=xe,this._padding=ye,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,Te),this._ease(he(u),Ae=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(n,Ae)},t),this}_prepareEase(t,n,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||u.moving||this.fire(new s.A("movestart",t)),this._zooming&&!u.zooming&&this.fire(new s.A("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new s.A("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new s.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.A("move",t)),this._zooming&&this.fire(new s.A("zoom",t)),this._rotating&&this.fire(new s.A("rotate",t)),this._pitching&&this.fire(new s.A("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,f=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new s.A("zoomend",t)),f&&this.fire(new s.A("rotateend",t)),m&&this.fire(new s.A("pitchend",t)),this.fire(new s.A("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const it=s.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(it,n)}this.stop(),t=s.l({offset:[0,0],speed:1.2,curve:1.42,easing:s.ey},t);const u=this.transform,f=this.getZoom(),m=this.getBearing(),_=this.getPitch(),v=this.getPadding(),w="zoom"in t?s.aD(+t.zoom,u.minZoom,u.maxZoom):f,E="bearing"in t?this._normalizeBearing(t.bearing,m):m,A="pitch"in t?+t.pitch:_,P=this._extendPadding(t.padding),M=u.zoomScale(w-f),k=s.P.convert(t.offset);let q=u.centerPoint.add(k);const V=u.pointLocation(q),$=s.cd.convert(t.center||V);this._normalizeCenter($);const U=u.project(V),ee=u.project($).sub(U);let se=t.curve;const ae=Math.max(u.width,u.height),xe=ae/M,ye=ee.mag();if("minZoom"in t){const it=s.aD(Math.min(t.minZoom,f,w),u.minZoom,u.maxZoom),Et=ae/u.zoomScale(it-f);se=Math.sqrt(Et/ye*2)}const me=se*se;function he(it){const Et=(xe*xe-ae*ae+(it?-1:1)*me*me*ye*ye)/(2*(it?xe:ae)*me*ye);return Math.log(Math.sqrt(Et*Et+1)-Et)}function Te(it){return(Math.exp(it)-Math.exp(-it))/2}function Ae(it){return(Math.exp(it)+Math.exp(-it))/2}const rt=he(0);let Ge=function(it){return Ae(rt)/Ae(rt+se*it)},ft=function(it){return ae*((Ae(rt)*(Te(Et=rt+se*it)/Ae(Et))-Te(rt))/me)/ye;var Et},mt=(he(1)-rt)/se;if(Math.abs(ye)<1e-6||!isFinite(mt)){if(Math.abs(ae-xe)<1e-6)return this.easeTo(t,n);const it=xe<ae?-1:1;mt=Math.abs(Math.log(xe/ae))/se,ft=function(){return 0},Ge=function(Et){return Math.exp(it*se*Et)}}t.duration="duration"in t?+t.duration:1e3*mt/("screenSpeed"in t?+t.screenSpeed/se:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Bt=m!==E,je=A!==_,tt=!u.isPaddingEqual(P),Ve=t.retainPadding===!1?u.clone():u,vt=it=>Et=>{const yt=Et*mt,Mt=1/Ge(yt);it.zoom=Et===1?w:f+it.scaleZoom(Mt),Bt&&(it.bearing=s.ai(m,E,Et)),je&&(it.pitch=s.ai(_,A,Et)),tt&&(Ve.interpolatePadding(v,P,Et),q=Ve.centerPoint.add(k));const Dt=Et===1?$:it.unproject(U.add(ee.mult(ft(yt))).mult(Mt));return it.setLocationAtPoint(it.renderWorldCopies?Dt.wrap():Dt,q),it._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),it};if(t.preloadOnly){const it=this._emulate(vt,t.duration,u);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=Bt,this._pitching=je,this._padding=tt,this._prepareEase(n,!1),this._ease(vt(u),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,n)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,n,u){u.animate===!1||u.duration===0?(t(1),n()):(this._easeStart=s.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.q.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=s.bX(t,-180,180);const u=Math.abs(t-n);return Math.abs(t-360-n)<u&&(t-=360),Math.abs(t+360-n)<u&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const u=t.lng-n.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,u){const f=Math.ceil(15*n/1e3),m=[],_=t(u.clone());for(let v=0;v<=f;v++){const w=_(v/f);m.push(w.clone())}return m}_preloadTiles(t,n){}}class Nh{constructor(t={}){this.options=t,s.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Xe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const f=Xe("span","mapboxgl-ctrl-icon",this._compactButton);return f.setAttribute("aria-hidden","true"),f.setAttribute("title",u),this._innerContainer=Xe("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const u=n.reduce((f,m,_)=>(m.value&&(f+=`${m.key}=${m.value}${_<n.length-1?"&":""}`),f),"?");t.href=`${s.e.FEEDBACK_URL}/${u}#${Ch(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const n=this._map.style._mergedSourceCaches;for(const f in n){const m=n[f];if(m.used){const _=m.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t.sort((f,m)=>f.length-m.length),t=t.filter((f,m)=>{for(let _=m+1;_<t.length;_++)if(t[_].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Yc{constructor(){s.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Xe("div","mapboxgl-ctrl");const n=Xe("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const u=t[n].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class ea{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,u=n?this._queue.concat(n):this._queue;for(const f of u)if(f.id===t)return void(f.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const u of n)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Yo{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=s.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,u){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+u}}const lo={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class sl extends s.A{constructor(t,n,u,f){const{point:m,lngLat:_,originalEvent:v,target:w}=t;super(t.type,{point:m,lngLat:_,originalEvent:v,target:w}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=u,this.feature=f}}class Pu{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=n.filter;let f=n.type;u&&this.filters.set(t,s.b3(u)),f==="mouseover"&&(f="mouseenter"),f==="mouseout"&&(f="mouseleave");const m=this.interactionsByType.get(f)||new Map;f==="mouseenter"||f==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):m.size===0&&this.map.on(f,this.handleType),m.size===0&&this.interactionsByType.set(f,m),m.set(t,n),this.typeById.set(t,f)}get(t){const n=this.typeById.get(t);if(!n)return;const u=this.interactionsByType.get(n);return u?u.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(n);u&&(u.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const u=[];for(const[f,m]of n)m.target&&u.push({targetId:f,target:m.target,filter:this.filters.get(f)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const u=new Map;for(const[f,{feature:m}]of this.prevHoveredFeatures)this.hoveredFeatures.has(f)||u.set(m.id,m);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const u=Array.from(this.interactionsByType.get(t.type)).reverse(),f=!!n;n=n||this.queryTargets(t.point,u);const m=t.type==="mouseenter";let _=!1;const v=new Set;for(const w of n){for(const[E,A]of u){if(!A.target)continue;const P=w.variants?w.variants[E]:null;if(P){for(const M of P){if(Zs(M,w,v,E))continue;const k=new s.df(w,M),q=Sa(M,w,E);f&&(k.state=this.map.getFeatureState(k));const V=m?this.prevHoveredFeatures.get(q):null,$=new sl(t,E,A,k),U=V?V.stop:A.handler($);if(m&&this.hoveredFeatures.set(q,{feature:w,stop:U}),U!==!1){_=!0;break}}if(_)break}}if(_)break}if(!_)for(const[w,E]of u){const{handler:A,target:P}=E;if(!P&&A(new sl(t,w,E,null))!==!1)break}}}function Ko(l,t){if(Array.isArray(l)&&Array.isArray(t)){const n=new Set(l),u=new Set(t);return n.size===u.size&&l.every(f=>u.has(f))}return s.bv(l,t)}const Wf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Qr={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cl{constructor(t,n,u=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Lh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Mu({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),st()}move(t,n){const u=this.map,f=this.mouseRotate.mousemoveWindow(t,n),m=f&&f.bearingDelta;if(m&&u.setBearing(u.getBearing()+m),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,n),v=_&&_.pitchDelta;v&&u.setPitch(u.getPitch()+v)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$e(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(s.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),dr(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,dr(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Fr(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Fr(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Td(l,t,n){if(l=new s.cd(l.lng,l.lat),t){const u=new s.cd(l.lng-360,l.lat),f=new s.cd(l.lng+360,l.lat),m=360*Math.ceil(Math.abs(l.lng-n.center.lng)/360),_=n.locationPoint3D(l).distSqr(t),v=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint3D(u).distSqr(t)<_&&(v||Math.abs(u.lng-n.center.lng)<m)?l=u:n.locationPoint3D(f).distSqr(t)<_&&(v||Math.abs(f.lng-n.center.lng)<m)&&(l=f)}for(;Math.abs(l.lng-n.center.lng)>180;){const u=n.locationPoint3D(l);if(u.x>=0&&u.y>=0&&u.x<=n.width&&u.y<=n.height)break;l.lng>n.center.lng?l.lng-=360:l.lng+=360}return l}const Ed={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Na={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class iu extends s.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=s.l({element:t},n)),s.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:f="#3FB1CE",scale:m=1,draggable:_=!1,clickTolerance:v=0,rotation:w=Na.rotation,rotationAlignment:E=Na.rotationAlignment,pitchAlignment:A=Na.pitchAlignment,occludedOpacity:P=Na.occludedOpacity,altitude:M=Na.altitude}=t||{};this._anchor=u,this._color=f,this._scale=m,this._draggable=_,this._clickTolerance=v,this._rotation=w,this._rotationAlignment=E,this._pitchAlignment=A,this._occludedOpacity=P,this._altitude=M,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",V=>{V.preventDefault()}),this._element.addEventListener("mousedown",V=>{V.preventDefault()});const k=this._element.classList;for(const V in Ed)k.remove(`mapboxgl-marker-anchor-${V}`);k.add(`mapboxgl-marker-anchor-${this._anchor}`);const q=t&&t.className?t.className.trim().split(/\s+/):[];k.add(...q),this._popup=null}_createDefaultMarker(){const t=Xe("div"),n=We("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=We("radialGradient",{id:"shadowGradient"},We("defs",{},n));We("stop",{offset:"10%","stop-opacity":.4},u),We("stop",{offset:"100%","stop-opacity":.05},u),We("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n)}return We("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),We("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),We("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Na.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,u=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,u=this._element;this._popup&&(n===u||u.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const u=t.unproject(n,this._altitude),f=t.getFreeCameraOptions();if(!f.position)return!1;const m=f.position.toLngLat();return m.distanceTo(u)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(n,this._altitude);let f;t._showingGlobe()&&s.eK(t.transform,this._lngLat)?f=0:(f=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Ed[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,u=this.getPitchAlignment();if(!n||!t||u!=="map")return"";if(!n._showingGlobe()){const w=n.getPitch();return w?`rotateX(${w}deg)`:""}const f=s.cJ(s.eL(n.transform,this._lngLat)),m=t.sub(s.eM(n.transform)),_=Math.abs(m.x)+Math.abs(m.y);if(_===0)return"";const v=f/_;return`rotateX(${-m.y*v}deg) rotateY(${m.x*v}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let u=0;const f=this.getRotationAlignment();if(f==="map")if(n._showingGlobe()){const m=n.project(new s.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),_=n.project(new s.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(m);u=s.cJ(Math.atan2(_.y,_.x))-90}else u=-n.getBearing();else if(f==="horizon"){const m=s.af(4,6,n.getZoom()),_=s.eM(n.transform);_.y+=m*n.transform.height;const v=t.sub(_),w=s.cJ(Math.atan2(v.y,v.x));u=(w>90?w-270:w+90)*(1-m)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Td(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const u=this._pointerdownPos,f=this._positionDelta;if(u&&f){if(!this._isDragging){const m=this._clickTolerance||n._clickTolerance;if(t.point.dist(u)<m)return;this._isDragging=!0}this._pos=t.point.sub(f),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.A("dragstart"))),this.fire(new s.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.A("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,u=this._pos;n&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Na.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Na.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Na.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Na.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ru={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Du={maxWidth:100,unit:"metric"},Ml={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Va={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ja=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pl(l=new s.P(0,0),t="bottom"){if(typeof l=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new s.P(0,l);case"top-left":return new s.P(n,n);case"top-right":return new s.P(-n,n);case"bottom":return new s.P(0,-l);case"bottom-left":return new s.P(n,-n);case"bottom-right":return new s.P(-n,-n);case"left":return new s.P(l,0);case"right":return new s.P(-l,0)}return new s.P(0,0)}return l instanceof s.P||Array.isArray(l)?s.P.convert(l):s.P.convert(l[t]||[0,0])}return{version:ne,supported:ze.supported,setRTLTextPlugin:s.eN,getRTLTextPluginStatus:s.eO,Map:class extends Sd{constructor(l){fe.mark(F.create);const t=l;if((l=s.l({},Wf,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&s.eI(window)&&(l.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new hu(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new ea,this._domRenderTaskQueue=new ea,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.a$(),this._locale=s.l({},lo,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Yo(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new Tr(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const n=document.getElementById(l.container);if(!n)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=n}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,s.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new ud),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new xp(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||s.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this.indoor=new Bf(this),l.hash&&(this._hash=new Hc(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const n=l.bounds;n&&(this.resize(),this.fitBounds(n,s.l({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new Nh({customAttribution:l.customAttribution})),this._logoControl=new Yc,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new s.A(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.A(`${n.dataType}dataloading`,n))}),this._interactions=new Pu(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new s.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=l.onAdd(this);this._controls.push(l);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(n,u.firstChild):u.appendChild(n),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new s.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.A("movestart",l)).fire(new s.A("move",l)),this.fire(new s.A("resize",l)),t&&this.fire(new s.A("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(s.aG.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new s.A("zoomstart")).fire(new s.A("zoom")).fire(new s.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new s.A("pitchstart")).fire(new s.A("pitch")).fire(new s.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let n;t==="globe"&&l.zoom>=s.cx?(l.setMercatorFromTransition(),n=!0):t==="mercator"&&l.zoom<s.cx&&(l.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;return t=l.name==="globe"&&this.transform.zoom>=s.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(s.cd.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(s.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,n){const u=f=>{let m=[];if(Array.isArray(t)){const _=t.filter(v=>this.getLayer(v));m=_.length?this.queryRenderedFeatures(f,{layers:_}):[]}else m=this.queryRenderedFeatures(f,{target:t});return m};if(l==="mouseenter"||l==="mouseover"){let f=!1;return{listener:n,targets:t,delegates:{mousemove:_=>{const v=u(_.point);v.length?f||(f=!0,n.call(this,new Gs(l,this,_.originalEvent,{features:v}))):f=!1},mouseout:()=>{f=!1}}}}if(l==="mouseleave"||l==="mouseout"){let f=!1;return{listener:n,targets:t,delegates:{mousemove:v=>{u(v.point).length?f=!0:f&&(f=!1,n.call(this,new Gs(l,this,v.originalEvent)))},mouseout:v=>{f&&(f=!1,n.call(this,new Gs(l,this,v.originalEvent)))}}}}{const f=m=>{const _=u(m.point);_.length&&(m.features=_,n.call(this,m),delete m.features)};return{listener:n,targets:t,delegates:{[l]:f}}}}on(l,t,n){if(typeof t=="function"||n===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(l,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(u);for(const f in u.delegates)this.on(f,u.delegates[f]);return this}once(l,t,n){if(typeof t=="function"||n===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(l,t,n);for(const f in u.delegates)this.once(f,u.delegates[f]);return this}off(l,t,n){if(typeof t=="function"||n===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[l]:void 0;return u&&(f=>{for(let m=0;m<f.length;m++){const _=f[m];if(_.listener===n&&Ko(_.targets,t)){for(const v in _.delegates)this.off(v,_.delegates[v]);return f.splice(m,1),this}}})(u),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof s.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const m=this.style.queryRenderedFeatures(l,void 0,this.transform),_=this.style.queryRenderedFeatureset(l,void 0,this.transform);return m.concat(_)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const m of t.layers)if(!this._isValidId(m)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let f=[];return u&&(f=f.concat(this.style.queryRenderedFeatures(l,t,this.transform))),n&&(f=f.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),f}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=s.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(n,u)=>{if(n){const f=typeof n=="string"?n:n instanceof Error?n.message:n.error;s.w(`Unable to perform style diff: ${f}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else u&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const n=s.l({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new za(this,n).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new za(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new s.z(new Error("IDs can't be empty."))),!1):!s.d9(l)||(this.fire(new s.z(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,n)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:n=1,sdf:u=!1,stretchX:f,stretchY:m,content:_}={}){this._lazyInitEmptyStyle();const v=s.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:w,height:E,data:A}=s.q.getImageData(t);this.style.addImage(v,{data:new s.r({width:w,height:E},A),pixelRatio:n,stretchX:f,stretchY:m,content:_,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:w,height:E}=t,A=t;this.style.addImage(v,{data:new s.r({width:w,height:E},new Uint8Array(A.data)),pixelRatio:n,stretchX:f,stretchY:m,content:_,sdf:u,usvg:!1,version:0,userImage:A}),A.onAdd&&A.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const n=s.I.from(l),u=this.style.getImage(n);if(!u)return void this.fire(new s.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.q.getImageData(t):t,{width:m,height:_,data:v}=f;if(m===void 0||_===void 0)return void this.fire(new s.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||_!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new s.z(new Error(`The width and height of the updated image (${m}, ${_})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const w=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let E=!1;u.usvg?(u.data=new s.r({width:m,height:_},new Uint8Array(v)),u.usvg=!1,u.icon=void 0,E=!0):u.data.replace(v,w),this.style.updateImage(n,u,E)}hasImage(l){return l?!!this.style&&!!this.style.getImage(s.I.from(l)):(this.fire(new s.z(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(s.I.from(l))}loadImage(l,t){s.o(this._requestManager.transformRequest(l,s.R.Image),(n,u)=>{t(n,u instanceof HTMLImageElement?s.q.getImageData(u):u)})}listImages(){return this.style.listImages().map(l=>l.name)}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new s.z(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch(n=>this.fire(new s.z(new Error("Failed to add import",n)))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,n){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,n),this._update(!0)):this}setFilter(l,t,n={}){return this._isValidId(l)?(this.style.setFilter(l,t,n),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,n,u={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,n,u),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,n,u={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,n,u),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,n){return this.style.setConfigProperty(l,t,n),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.cd.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,u,f,m=this._container;for(;m&&(!u||!f);){const _=window.getComputedStyle(m).transform;_&&_!=="none"&&(n=_.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(u=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(f=n[3])),m=m.parentElement}this._containerWidth=u?Math.abs(l/u):l,this._containerHeight=f?Math.abs(t/f):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=Xe("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Xe("div","mapboxgl-canvas-container",l);this._canvas=Xe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=Xe("div","mapboxgl-control-container",l),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(f=>{u[f]=Xe("div",`mapboxgl-ctrl-${f}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const n=s.q.devicePixelRatio||1;this._canvas.width=n*Math.ceil(l),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=s.l({},ze.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(xo(t,!0),this.painter=new Ah(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.m.testSupport(t)):this.fire(new s.z(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.A("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.A("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new s.A("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,u=s.q.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=f.createQuery(),f.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const m=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,A=this.transform.pitch,P=s.q.now(),M=new s.aa(E,{now:P,fadeDuration:m,pitch:A,transition:this.style.transition});this.style.update(M)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(u);const v=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),v&&(this._placementDirty=v.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,fe.mark(F.load),this.fire(new s.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const E=s.q.now()-u;f.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const A=f.getQueryParameter(t,f.QUERY_RESULT)/1e6;f.deleteQuery(t),this.fire(new s.A("gpu-timing-frame",{cpuTime:E,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(E);this.fire(new s.A("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const A=this.painter.queryGpuTimeDeferredRender(E);this.fire(new s.A("gpu-timing-deferred-render",{gpuTime:A}))},50)}const w=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(w||this._repaint)this.triggerRepaint();else{const E=this.idle();if(E&&(_=this._updateAverageElevation(u,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new s.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const A=this._calculateSpeedIndex();this.fire(new s.A("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||w||(this._fullyLoaded=!0,fe.mark(F.fullLoad),this._performanceMetricsCollection&&ji(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const n=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const f=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=l;const _=Math.abs(f-m);if(_>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(m),n(m);this._averageElevation.easeTo(m,l,300)}else if(_>1e-4)return this._averageElevation.jumpTo(m),n(m)}return!!this._averageElevation.isEasing(l)&&n(this._averageElevation.getValue(l))}_authenticate(){Dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===fr||l.status===401)){const t=this.painter.context.gl;xo(t,!1),this._logoControl instanceof Yc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ai(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Gr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,u=n.createFramebuffer();function f(m){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,m,0);const _=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,_),_}return n.bindFramebuffer(n.FRAMEBUFFER,u),this._canvasPixelComparison(f(l),t.canvasCopies.map(f),t.timeStamps)}_canvasPixelComparison(l,t,n){let u=n[1]-n[0];const f=l.length/4;for(let m=0;m<t.length;m++){const _=t[m];let v=0;for(let w=0;w<_.length;w+=4)_[w]===l[w]&&_[w+1]===l[w+1]&&_[w+2]===l[w+2]&&_[w+3]===l[w+3]&&(v+=1);u+=(n[m+2]-n[m+1])*(1-v/f)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Xn.delete(this.painter.context.gl),jr.remove(),bi.remove(),this._removed=!0,this.fire(new s.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=s.q.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return s.bt(t,(n,u)=>n._preloadTiles(l,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){s.eJ(l,t)}get version(){return ne}},NavigationControl:class{constructor(l={}){this.options=s.l({},Qr,l),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(s.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=Xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),n=t===l.getMaxZoom(),u=t===l.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cl(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const n=Xe("button",l,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(l,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",n),l.firstElementChild&&l.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends s.E{constructor(l={}){super();const t=navigator.geolocation;this.options=s.l({geolocation:t},Ru,l),s.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Au(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,l(n)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),n=l.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.A("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("geolocate",l)),this._finish()}}_updateCamera(l){const t=new s.cd(l.coords.longitude,l.coords.latitude),n=l.coords.accuracy,u=this._map.getBearing(),f=s.l({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),f,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new s.cd(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=s.c6(1,l._center.lat)*l.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.A("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Xe("button","mapboxgl-ctrl-geolocate",this._container),Xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Xe("div","mapboxgl-user-location"),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new iu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new iu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.A("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Nh,ScaleControl:class{constructor(l={}){this.options=s.l({},Du,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,u=t._containerWidth/2-l/2,f=t.unproject([u,n]),m=t.unproject([u+l,n]),_=f.distanceTo(m);if(this.options.unit==="imperial"){const v=3.2808*_;v>5280?this._setScale(l,v/5280,"mile"):this._setScale(l,v,"foot")}else this.options.unit==="nautical"?this._setScale(l,_/1852,"nautical-mile"):_>=1e3?this._setScale(l,_/1e3,"kilometer"):this._setScale(l,_,"meter")}_setScale(l,t,n){this._map._requestDomTask(()=>{const u=function(m){const _=Math.pow(10,`${Math.floor(m)}`.length-1);let v=m/_;return v=v>=10?10:v>=5?5:v>=3?3:v>=2?2:v>=1?1:function(w){const E=Math.pow(10,Math.ceil(-Math.log(w)/Math.LN10));return Math.round(w*E)/E}(v),_*v}(t),f=u/t;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(u):`${u}&nbsp;${Ml[n]}`,this._container.style.width=l*f+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:s.w("Full screen control 'container' must be a DOM element.")),s.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=Xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=Xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Xe("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.E{constructor(l){super(),this.options=s.l(Object.create(Va),l),this._altitude=this.options.altitude,s.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new s.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new s.A("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=s.cd.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),n=document.createElement("body");let u;for(n.innerHTML=l;u=n.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Xe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const n=this._closeButton=Xe("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,u=this._pos;if(!t||!n||!u)return"bottom";const f=n.offsetWidth,m=n.offsetHeight,_=u.x<f/2,v=u.x>t.transform.width-f/2;if(u.y+l<m)return _?"top-left":v?"top-right":"top";if(u.y>t.transform.height-m){if(_)return"bottom-left";if(v)return"bottom-right"}return _?"left":v?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let u=this._container;if(u||(u=this._container=Xe("div","mapboxgl-popup",t.getContainer()),this._tip=Xe("div","mapboxgl-popup-tip",u),u.appendChild(n)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Td(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const f=this._pos=this._trackPointer&&l instanceof s.P?l:t.project(this._lngLat,this._altitude),m=Pl(this.options.offset),_=this._anchor=this._getAnchor(m.y),v=Pl(this.options.offset,_),w=f.add(v).round();t._requestDomTask(()=>{this._container&&_&&(this._container.style.transform=`${Ed[_]} translate(${w.x}px,${w.y}px)`)})}if(!this._marker&&t._showingGlobe()){const f=s.eK(t.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(ja);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:iu,Style:za,LngLat:s.cd,LngLatBounds:s.aG,Point:s.P,MercatorCoordinate:s.ac,FreeCameraOptions:ha,Evented:s.E,config:s.e,prewarm:s.eP,clearPrewarmedResources:s.eQ,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(l){s.e.ACCESS_TOKEN=l},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(l){s.e.API_URL=l},get workerCount(){return s.eR.workerCount},set workerCount(l){s.eR.workerCount=l},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){s.eS(l)},get workerUrl(){return s.eT.workerUrl},set workerUrl(l){s.eT.workerUrl=l},get workerClass(){return s.eT.workerClass},set workerClass(l){s.eT.workerClass=l},get workerParams(){return s.eT.workerParams},set workerParams(l){s.eT.workerParams=l},get dracoUrl(){return s.eU()},set dracoUrl(l){s.eV(l)},get meshoptUrl(){return s.eW()},set meshoptUrl(l){s.eX(l)},setNow:s.q.setNow,restoreNow:s.q.restoreNow}});var be=ue;return be})}(vg)),vg.exports}var jE=VE();const l0=rb(jE),d0="/Icon_LTS1.svg",f0="/Icon_LTS2.svg",p0="/Icon_LTS3.svg",m0="/Icon_LTS4.svg",Mb="/Text_LTS1.svg",Pb="/Text_LTS2.svg",Rb="/Text_LTS3.svg",Db="/Text_LTS4.svg",kb="/BikeStressMap.svg";console.log("Legend loaded");const UE=({colorScale:L})=>{const Y={borderColor:L[0]},Z={borderColor:L[1]},Ee={borderColor:L[2]},ue={borderColor:L[3]};return Se.jsxs("div",{className:"legend grid-container",children:[Se.jsx("div",{className:"legend-header-hover",children:Se.jsx("img",{src:kb,alt:"Legend",className:"hover-image"})}),Se.jsxs("div",{className:"legend-row",style:Y,children:[Se.jsxs("div",{className:"legend-icon",children:[Se.jsx("img",{src:d0,alt:"LTS 1",className:"default-image"}),Se.jsx("img",{src:d0,alt:"LTS 1",className:"hover-image"})]}),Se.jsx("div",{className:"legend-text",children:Se.jsx("img",{src:Mb,alt:"Carefree riding",className:"hover-image"})})]}),Se.jsxs("div",{className:"legend-row",style:Z,children:[Se.jsxs("div",{className:"legend-icon",children:[Se.jsx("img",{src:f0,alt:"LTS 2",className:"default-image"}),Se.jsx("img",{src:f0,alt:"LTS 2",className:"hover-image"})]}),Se.jsx("div",{className:"legend-text",children:Se.jsx("img",{src:Pb,alt:"Easy going riding",className:"hover-image"})})]}),Se.jsxs("div",{className:"legend-row",style:Ee,children:[Se.jsxs("div",{className:"legend-icon",children:[Se.jsx("img",{src:p0,alt:"LTS 3",className:"default-image"}),Se.jsx("img",{src:p0,alt:"LTS 3",className:"hover-image"})]}),Se.jsx("div",{className:"legend-text",children:Se.jsx("img",{src:Rb,alt:"Stressful riding",className:"hover-image"})})]}),Se.jsxs("div",{className:"legend-row",style:ue,children:[Se.jsxs("div",{className:"legend-icon",children:[Se.jsx("img",{src:m0,alt:"LTS 4",className:"default-image"}),Se.jsx("img",{src:m0,alt:"LTS 4",className:"hover-image"})]}),Se.jsx("div",{className:"legend-text",children:Se.jsx("img",{src:Db,alt:"White knuckle riding",className:"hover-image"})})]})]})},wg=({start:L,end:Y,inverse:Z=!1})=>{function Ee(ze){return ze*Math.PI/180}function ue(ze){return ze*180/Math.PI}var _e,be,s,ne;typeof L[0]=="number"?(_e=L[0],be=Y[0],s=L[1],ne=Y[1]):typeof L[0]=="object"&&(_e=L[0][0],be=Y[0][0],s=L[0][1],ne=Y[0][1]),s=Ee(s),_e=Ee(_e),ne=Ee(ne),be=Ee(be);let F=Math.sin(be-_e)*Math.cos(ne),fe=Math.cos(s)*Math.sin(ne)-Math.sin(s)*Math.cos(ne)*Math.cos(be-_e),qe=Math.atan2(F,fe),Ne=(ue(qe)+360)%360,Ye=Math.floor((Ne+22.5)/45);switch(Z&&(Ye=Ye-4),Ye){case 0:case 8:case-8:Ye="North";break;case 1:case-7:Ye="NorthEast";break;case 2:case-6:Ye="East";break;case 3:case-5:Ye="SouthEast";break;case 4:case-4:Ye="South";break;case 5:case-3:Ye="SouthWest";break;case 6:case-2:Ye="West";break;case 7:case-1:Ye="NorthWest";break}return Ye},Y1=({ltsValue:L})=>{let Y="Unknown LTS Value: "+L;switch(Number(L)){case 1:Y="1 - Carefree";break;case 2:Y="2 - Easygoing";break;case 3:Y="3 - Tense";break;case 4:Y="4 - White Knuckles";break;case 0:Y="Biking not permitted";break}return Y},up=L=>{var Y;return typeof L=="string"?Y=L:typeof L=="boolean"||typeof L=="number"?Y=L.toString():typeof L>"u"?Y="n/a":Y=typeof L,Y};console.log("InfoSimple loaded");const qE=({selectedFeature:L})=>{console.log("InfoSimple/selectedFeature:",L);const{name:Y,LTS:Z,LTS_fwd:Ee,LTS_rev:ue,bike_allowed_fwd:_e,bike_allowed_rev:be,bike_lane_fwd:s,bike_lane_rev:ne,separation_fwd:F,separation_rev:fe,oneway:qe,osmid:Ne}=L.properties,Ye=L.geometry.coordinates[0],ze=L.geometry.coordinates.at(-1);var Xe,We;typeof _e=="string"?(Xe=_e==="True",We=be==="True"):typeof _e=="boolean"&&(Xe=_e,We=be);const De=Se.jsx(wg,{start:Ye,end:ze}),Ke=Se.jsx(wg,{start:Ye,end:ze,inverse:!0});let et=up(s),st=up(ne),$e=up(F),bt=up(fe);return console.log("name:",Y,"| osmid",Ne,typeof Ne),console.log("bike_allowed_fwd:",_e,typeof _e," | bike_allowed_rev:",be,typeof be),console.log("allowed_fwd:",Xe,typeof Xe," | allowed_rev:",We,typeof We),console.log("bike_lane_fwd:",s,typeof s," | bike_lane_rev:",ne,typeof ne),console.log("separation_fwd:",F,typeof F," | separation_rev:",fe,typeof fe),console.log("LTS:",Z,typeof Z,"| LTS_fwd:",Ee,typeof Ee," | LTS_rev:",ue,typeof ue),console.log("oneway:",qe,typeof qe),Se.jsxs("div",{children:[Se.jsx("h1",{className:"tableStreetName",children:Y}),Se.jsx("div",{className:"tableContainer",children:Se.jsxs("table",{children:[Se.jsx("thead",{children:Se.jsxs("tr",{children:[We&&Se.jsx("th",{children:Ke}),Xe&&Se.jsx("th",{children:De})]})}),Se.jsxs("tbody",{className:"tableBox",children:[Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Biking Stress Level"})}),Se.jsxs("tr",{children:[We&&Se.jsx("td",{className:"tableValue",children:Se.jsx(Y1,{ltsValue:ue})}),Xe&&Se.jsx("td",{className:"tableValue",children:Se.jsx(Y1,{ltsValue:Ee})})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Bike Lane"})}),Se.jsxs("tr",{children:[We&&Se.jsx("td",{className:"tableValue",children:st}),Xe&&Se.jsx("td",{className:"tableValue",children:et})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Bike Lane Separation"})}),Se.jsxs("tr",{children:[We&&Se.jsx("td",{className:"tableValue",children:bt}),Xe&&Se.jsx("td",{className:"tableValue",children:$e})]})]})]})})]})};console.log("InfoDetail loaded");const GE=({selectedFeature:L})=>{console.log("InfoDetail/selectedFeature:",L);const{name:Y,highway:Z,LTS_fwd:Ee,LTS_rev:ue,bike_allowed_fwd:_e,bike_allowed_rev:be,osmid:s,oneway:ne,street_narrow_wide:F,width_street:fe,width_street_rule:qe,width_parking_rev:Ne,width_parking_fwd:Ye,lane_count:ze,lane_count_rule:Xe,parking_fwd:We,parking_rev:De,speed:Ke,speed_rule:et,centerline:st,centerline_rule:$e,ADT:bt,ADT_rule:St}=L.properties,dr=L.geometry.coordinates[0],Fr=L.geometry.coordinates[1],hi="https://www.openstreetmap.org/way/"+s.toString();var ht,Zt;typeof _e=="string"?(ht=_e==="True",Zt=be==="True"):typeof _e=="boolean"&&(ht=_e,Zt=be);const fr=({data:Or})=>{const{highway:ri,bike_lane_fwd:fi,bike_lane_rev:mr,separation_fwd:Lr,separation_rev:or,bike_width_fwd:dt,bike_width_rev:sr,bike_width_rule_fwd:bi,bike_width_rule_rev:Ai,buffer_fwd:qr,buffer_rev:Gr,buffer_rule_fwd:pi,buffer_rule_rev:ji,bike_reach_fwd:jr,bike_reach_rev:Dn}=Or;console.log("bike_lane_fwd:",fi,"bike_lane_rev:",mr);let Xn="";return!(fi!="no"||mr!="no")&&(ri=="footway"||ri=="cycleway"||ri=="service")?Se.jsx(Se.Fragment,{}):(Xn=Se.jsxs(Se.Fragment,{children:[Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Bike Lane"})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:up(mr)}),ht&&Se.jsx("td",{className:"tableValue",children:up(fi)})]})]}),fi=="no"&&mr=="no"&&ri!="footway"?Xn:Se.jsxs(Se.Fragment,{children:[Xn,Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"notes",children:or}),ht&&Se.jsx("td",{className:"notes",children:Lr})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Bike Lane Width"})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:Number(sr).toFixed(1)}),ht&&Se.jsx("td",{className:"tableValue",children:Number(dt).toFixed(1)})]}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"notes",children:Ai}),ht&&Se.jsx("td",{className:"notes",children:bi})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Bike Lane Buffer"})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:Number(Gr).toFixed(1)}),ht&&Se.jsx("td",{className:"tableValue",children:Number(qr).toFixed(1)})]}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"notes",children:ji}),ht&&Se.jsx("td",{className:"notes",children:pi})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Bike Lane Reach"})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:Number(Dn).toFixed(1)}),ht&&Se.jsx("td",{className:"tableValue",children:Number(jr).toFixed(1)})]})]}))},Tr=({data:Or})=>{const{LTS_bike_access_fwd:ri,LTS_bike_access_rev:fi,LTS_mixed_fwd:mr,LTS_mixed_rev:Lr,LTS_bikelane_noparking_rev:or,LTS_bikelane_noparking_fwd:dt,LTS_bikelane_yesparking_rev:sr,LTS_bikelane_yesparking_fwd:bi}=Or,Ai=["Biking Access",fi,ri],qr=["Mixed Traffic",Lr,mr],Gr=["Bike lane without street parking",or,dt],pi=["Bike lane with street parking",sr,bi];let ji=[];for(const jr of[qr,Ai,Gr,pi])console.log(jr[0],typeof jr[1]<"u",typeof jr[2]<"u"),(typeof jr[1]<"u"||typeof jr[2]<"u")&&ji.push([Se.jsxs(Se.Fragment,{children:[Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:jr[0]})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:jr[1]}),ht&&Se.jsx("td",{className:"tableValue",children:jr[2]})]})]})]);return console.log("lts row",ji),ji};return Se.jsxs("div",{children:[Se.jsx("h1",{className:"tableStreetName",children:Y}),Se.jsx("div",{className:"tableContainer",children:Se.jsxs("table",{className:"tableAdvancedMode",children:[Se.jsx("thead",{children:Se.jsxs("tr",{children:[Zt&&Se.jsx("th",{children:Se.jsx(wg,{start:dr,end:Fr,inverse:!0})}),ht&&Se.jsx("th",{children:Se.jsx(wg,{start:dr,end:Fr})})]})}),Se.jsxs("tbody",{children:[Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"LTS"})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:Se.jsx("b",{children:ue})}),ht&&Se.jsx("td",{className:"tableValue",children:Se.jsx("b",{children:Ee})})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableSection",colSpan:"2",children:"Bike Infrastructure"})}),Se.jsx(fr,{data:L.properties}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableSection",colSpan:"2",children:"Street Design for Cars"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Road Designation"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableValue",colSpan:"2",children:Z})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Oneway"})}),Se.jsx("tr",{children:Se.jsxs("td",{className:"tableValue",colSpan:"2",children:[ne," ",F]})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Street Width"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableValue",colSpan:"2",children:Number(fe).toFixed(1)})}),Se.jsx("tr",{children:Se.jsx("td",{className:"notes",colSpan:"2",children:qe})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Parking Width"})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:Number(Ne).toFixed(1)}),ht&&Se.jsx("td",{className:"tableValue",children:Number(Ye).toFixed(1)})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Lane Count"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableValue",colSpan:"2",children:ze})}),Se.jsx("tr",{children:Se.jsx("td",{className:"notes",colSpan:"2",children:Xe})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Parking"})}),Se.jsxs("tr",{children:[Zt&&Se.jsx("td",{className:"tableValue",children:De}),ht&&Se.jsx("td",{className:"tableValue",children:We})]}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Prevailing Speed"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableValue",colSpan:"2",children:Ke})}),Se.jsx("tr",{children:Se.jsx("td",{className:"notes",colSpan:"2",children:et})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Centerline"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableValue",colSpan:"2",children:st})}),Se.jsx("tr",{children:Se.jsx("td",{className:"notes",colSpan:"2",children:$e})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"Average Daily Traffic (ADT)"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableValue",colSpan:"2",children:bt})}),Se.jsx("tr",{children:Se.jsx("td",{className:"notes",colSpan:"2",children:St})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableSection",colSpan:"2",children:"LTS Calculations"})}),Se.jsx(Tr,{data:L.properties}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableSection",colSpan:"2",children:"Technical Info"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableDescription",colSpan:"2",children:"OSMid"})}),Se.jsx("tr",{children:Se.jsx("td",{className:"tableValue",colSpan:"2",children:Se.jsx("a",{href:hi,target:"_blank",children:s})})})]})]})})]})};console.log("SideBar loaded");const HE=({advancedMode:L})=>(console.log("ModeToggle/advancedMode",L),L?"Show Fewer Details":"Show Advanced Details"),$E=({selectedFeature:L,advancedMode:Y})=>(console.log("ShowSidebar/advancedMode",Y),Y?(console.log("return advanced sidebar"),Se.jsx("div",{className:"advancedMode",children:Se.jsx(GE,{selectedFeature:L})})):(console.log("return simple sidebar"),Se.jsx("div",{className:"advancedMode",children:Se.jsx(qE,{selectedFeature:L})}))),WE=({selectedFeature:L,zoom:Y,zoomLimit:Z,advancedMode:Ee=!1})=>(console.log("SideBar/selectedFeature",L),Y<Z?Se.jsx("div",{id:"sidebar",className:"sidebar",children:Se.jsx("p",{children:"Zoom in to select a street segment and learn more about it"})}):L==null?Se.jsx("div",{id:"sidebar",className:"sidebar",children:Se.jsx("p",{children:"Click a street segment to learn more about it"})}):Se.jsx("div",{id:"sidebar",className:"sidebar",children:Se.jsx($E,{selectedFeature:L,advancedMode:Ee})})),K1=[-71.0809,42.3473],J1=12,ZE=18,XE=12,YE=12,KE=[[-71.2,42.18],[-70.9,42.46]],Q1=4,mc=["#007191","#62c8d3","#f47a00","#d31f11","grey"];function JE(){const[L,Y]=cr.useState(),[Z,Ee]=cr.useState(!1);console.log("advancedMode:",Z);const[ue,_e]=cr.useState("map"),be=cr.useRef(),s=cr.useRef(),[ne,F]=cr.useState(K1),[fe,qe]=cr.useState(J1),Ne=()=>{console.log("advancedMode switched from",Z),Ee(ze=>!ze)};cr.useEffect(()=>(l0.accessToken="pk.eyJ1Ijoic2tpbGNveW5lIiwiYSI6ImNseTd2cXpwOTA5MnUya3E2ejBkN2ttOW8ifQ.TN39Bd_yu_SqMsu-IW4FKQ",be.current=new l0.Map({container:s.current,center:ne,zoom:fe,minZoom:XE,maxZoom:ZE,maxBounds:KE,style:"mapbox://styles/mapbox/standard",config:{basemap:{lightPreset:"day",showPlaceLabels:!1,showPointOfInterestLabels:!1,theme:"monochrome",show3dObjects:!1,showTransitLabels:!0,showRoadLabels:!0}}}),be.current.on("load",function(){be.current.addSource("LTS_source",{type:"vector",url:"mapbox://skilcoyne.stressmap_tiles"}),be.current.addLayer({id:"lts-layer",type:"line",source:"LTS_source","source-layer":"lts",slot:"middle",paint:{"line-color":["match",["get","LTS"],1,mc[0],2,mc[1],3,mc[2],4,mc[3],mc[4]],"line-width":Q1}}),be.current.addLayer({id:"selected-lts",type:"line",source:"LTS_source","source-layer":"lts",slot:"middle",paint:{"line-color":["match",["get","LTS"],1,mc[0],2,mc[1],3,mc[2],4,mc[3],mc[4]],"line-width":Q1*3},filter:["in","osmid",""]}),be.current.on("move",()=>{const ze=be.current.getCenter(),Xe=be.current.getZoom();F([ze.lng,ze.lat]),qe(Xe)}),be.current.on("click","lts-layer",ze=>{console.log("App/map/click/e.features[0]",ze.features[0]),console.log("App/map/click/e.features[0].geometry.coordinates",ze.features[0].geometry.coordinates),Y(ze.features[0]),be.current.setFilter("selected-lts",["in","osmid",ze.features[0].id]);const Xe=ze.features[0].geometry.coordinates.slice();if(["mercator","equirectangular"].includes(be.current.getProjection().name))for(;Math.abs(ze.lngLat.lng-Xe[0])>180;)Xe[0]+=ze.lngLat.lng>Xe[0]?360:-360}),be.current.on("mouseenter","lts-layer",()=>{be.current.getCanvas().style.cursor="pointer"}),be.current.on("mouseleave","lts-layer",()=>{be.current.getCanvas().style.cursor=""}),be.current.addControl(new l0.FullscreenControl)}),()=>{be.current.remove()}),[]);const Ye=()=>{be.current.flyTo({center:K1,zoom:J1}),Y(),be.current.setFilter("selected-lts",["in","osmid",""])};return Se.jsx(Se.Fragment,{children:Se.jsxs("div",{id:"map-container",ref:s,children:[Se.jsx(UE,{colorScale:mc}),Se.jsx("button",{className:"reset-button",onClick:Ye,children:"Reset"}),Se.jsx("button",{className:"advanced-button",onClick:Ne,children:Se.jsx(HE,{advancedMode:Z})}),Se.jsx(WE,{selectedFeature:L,zoom:fe,zoomLimit:YE,advancedMode:Z})]})})}function w0(){return Se.jsx("div",{children:Se.jsx(Di,{to:dm,children:Se.jsx("img",{src:kb,alt:"Bike Stress Map",className:"stressmap"})})})}const QE=[{title:["Welcome to the BCU Labs",Se.jsx(w0,{})],subheading:"Explore how comfortable it is to bike in Greater Boston",paragraph:[Se.jsx(Di,{to:Eg,children:"BCU Labs"})," is working to build data-backed tools to help people identify the strengths and weaknesses of the biking network in Greater Boston."]},{paragraph:"With this stress map, we aim to:",list:["Help provide the vocabulary to communicate your experience biking in Boston","Show people alternative routes that may be lower-stress","Highlight gaps in the network that could be candidates for improvements"]},{paragraph:["The Bike Stress Map is our first project, rating every street in Boston, Cambridge, ","Somerville, and Brookline based on how comfortable it is to ride a bike on. ","It is a work in progress and a community effort  read below for ways to contribute or ",Se.jsx(Di,{to:kf,children:"update the map"}),"."]}],e3=[{title:"Getting Started with this map",paragraph:"If you arent exactly sure what is going on with this map or how to use it, dont worry, this is a new concept to a lot of people."},{subheading:"How to use this map",list:["Zoom in and out by scrolling","Click on a street to see its rating, and details on infrastructure that exists there","In the bottom left of the map, click the icons to understand more about each stress rating"]},{paragraph:["There are many ways you can use this map. To start, we recommend exploring your neighborhood and places you are familiar with, like your commute."]},{paragraph:["Once you are comfortable with the tool, explore less stressful routes to your favorite destinations, plan trips to new ones,  or identify a need to  advocate for specific streets to be improved that would make your journeys better."]},{paragraph:Se.jsx(Nd,{link:sm,title:"What is Traffic Stress?"})},{subheading:"What is this map?",paragraph:["This map attempts to rate every street segment in Boston, Cambridge, Somerville, and Brookline based on how comfortable it is to bike on. ","This is based on a concept called ",Se.jsx(Di,{to:sm,children:"Level of Traffic Stress"}),", which evaluates streets based on some of the most important features that affect the biking experience. ","This includes things like bike lanes and if they have separation, but also how many cars are traveling on the street and how fast those cars are going. ","As many cyclists intuitively understand, it may be more comfortable to bike on a quiet residential street than a high-speed arterial street (e.g. Mass Ave.) with a painted bike lane. ","This system attempts to quantify that intuition into a clear rating system to be able to see the overall effective comfortable biking network, rather than just mapping where bike lanes exist."]},{paragraph:Se.jsx(Di,{to:sm,children:"Read more about our methodology here."})},{subheading:"Why is BCU Labs making this map?",paragraph:["While it is true that the City of Boston has created a ",Se.jsx(Di,{to:"https://boston.maps.arcgis.com/apps/webappviewer/index.html?id=f0be9f03ada74a028cd05e4893a22ca4",children:"Level of Traffic Stress map"}),", this is not a particularly useful tool for the cycling community. ","For example, if you wanted to bike from Allston to Jamaica Plain, two neighborhoods of Boston, you would likely want to bike through Brookline, an independent city which isnt included on the City of Bostons map."]},{paragraph:["Within Greater Boston, it is completely normal to bike through two or even three or four cities on a given day. ","BCU Labs is uniquely able to view cycling comfort at the regional level to create a tool cyclists in Boston can use for their daily trips instead of being primarily valuable for city planners."]},{paragraph:["Additionally, by utilizing ",Se.jsx(Di,{to:"https://www.openstreetmap.org",children:"OpenStreetMap (OSM)"})," as the primary data source, we are able to continuously update street ratings as the streets change or the data accuracy improves. "]},{paragraph:Se.jsx(Nd,{link:kf,title:"What is OpenStreetMap",subtitle:"and how can you improve our map data?"})},{paragraph:["Finally, by building an easy-to-use map, we hope to achieve a few things: "],list:["The general public finds this a valuable tool in bettering their daily route selection","Advocates can better communicate where and why street improvements will improve the safe bike network","Researchers are able to use our data and calculations to jumpstart more interesting analyses that may lead to better insights in the value of the bike network or how to improve the network in the most impactful way"]},{paragraph:["BCU Labs is working towards these goals too. If you want to help in any way, please:"]},{paragraph:Se.jsx(Nd,{link:"https://docs.google.com/forms/d/e/1FAIpQLSefzxEQ-CAbJd_rrt90DHvdglYvP9RLqdDUVsFq28onw9xXJQ/viewform",title:"Join BCU Labs"})},{subheading:"What if you disagree with a street segment rating?",paragraph:["If a street you ride on regularly feels more or less comfortable than how we have rated it, you are probably right! ","We use OpenStreetMap (OSM) for our data and as a data source it is incomplete. ","This forces us to make some assumptions, and we are probably wrong in some places. "]},{paragraph:["You can learn to ",Se.jsx(Di,{to:kf,children:"fix the data yourself here"}),", or fill out ",Se.jsx(Di,{to:"https://forms.gle/ytyKV7ZrnzYZToCi9",children:"this form"})," with what you know and the BCU Labs team will bike there ourselves to survey, then fix the data."]}];function t3(){return Se.jsxs("div",{id:"primary-column",children:[Se.jsx(Ig,{}),QE.map(L=>Se.jsx(lm,{title:L.title,subheading:L.subheading,paragraph:L.paragraph,list:L.list,graphic:L.graphic},L.title)),Se.jsx(JE,{}),e3.map(L=>Se.jsx(lm,{title:L.title,subheading:L.subheading,paragraph:L.paragraph,list:L.list,graphic:L.graphic},L.title)),Se.jsx(Ag,{})]})}const om=["LTS_1","LTS_2","LTS_3","LTS_4"],eb={[om[0]]:{icon:d0,text:Mb},[om[1]]:{icon:f0,text:Pb},[om[2]]:{icon:p0,text:Rb},[om[3]]:{icon:m0,text:Db}};function r3(L){const{lts_name:Y}=L;return Se.jsxs("div",{className:"lts-icon-item",children:[Se.jsx("img",{src:eb[Y].icon,alt:`${Y} icon`}),Se.jsx("img",{src:eb[Y].text,alt:`${Y} text`})]})}function i3(L){return Se.jsx("div",{className:"lts-icon-container",children:om.map(Y=>Se.jsx(r3,{lts_name:Y},Y))})}const n3="/Viz_LTS1.svg",o3="/Viz_LTS4.svg",g0=["LTS_1","LTS_4"],tb={[g0[0]]:{icon:n3,alt:"Low stress street"},[g0[1]]:{icon:o3,alt:"High stress street"}};function s3(L){const[Y,Z]=cr.useState(!1),[Ee,ue]=cr.useState(),_e=()=>{Z(!Y)},be=ne=>F=>{Z(!Y),ue(ne),console.log("Image clicked:",ne,Y)};function s(ne){const{lts_name:F}=ne;return Se.jsx("button",{className:"lts-viz-item",onClick:be(tb[F].icon),children:Se.jsx("img",{src:tb[F].icon,alt:`${F} icon`})})}return Se.jsxs("div",{children:[Se.jsx("div",{className:"lts-viz-container",children:g0.map(ne=>Se.jsx(s,{lts_name:ne},ne))}),Y&&Se.jsx("div",{className:"dialog",children:Se.jsxs("div",{className:"dialog-content",children:[Se.jsx("button",{className:"close-icon",onClick:_e,children:""}),Se.jsx("img",{className:"popup-image",src:Ee,alt:"Popup Image"})]})})]})}const a3=[{title:"What is Level of Traffic Stress?",subheading:"A method for assessing how bike-friendly a street truly is.",paragraph:["Level of Traffic Stress is a system developed in part by ",Se.jsx(Di,{to:"https://peterfurth.sites.northeastern.edu/2014/05/21/criteria-for-level-of-traffic-stress/",children:"Northeastern Universitys Professor Peter Furth"})," to capture how stressful or comfortable a street feels for cyclists. While a painted bike lane might look bike-friendly on a map, factors like fast and heavy traffic can still make it stressful. The Level of Traffic Stress system considers these elements to give cyclists and planners a clearer view of which routes are truly comfortable."]},{paragraph:"The Level of Traffic Stress system categorizes streets into the following four levels:",graphic:Se.jsx(i3,{})},{title:"How does this map work?",subheading:"The map analyzes road and traffic data to rate a street's bike friendliness.",paragraph:[Se.jsx(Di,{to:kf,children:"We use data"})," from ",Se.jsx(Di,{to:"https://www.openstreetmap.org",children:"OpenStreetMap (OSM)"}),", an open-source online map that people around the world help build and update. Each street segment is tagged with details such as speed limit, traffic, etc.. which we use to calculate a Level of Traffic Stress for each street segment."],graphic:Se.jsx(s3,{})},{title:"What can you do with this tool?",list:["Explore the connectivity of the streets in your neighborhood","Find new, more comfortable ways to travel around Greater Boston","Learn about the design elements that contribute to stress levels","Identify ways streets you (want to) use could be redesigned to be safer and less stressful"]},{paragraph:Se.jsx(Nd,{link:dm,title:"See streets in your neighborhood!"})},{title:"A deep dive into Level of Traffic Stress",paragraph:["Our Stress Map is based on a heuristic concept called ",Se.jsx(Di,{to:"https://peterfurth.sites.northeastern.edu/2014/05/21/criteria-for-level-of-traffic-stress/",children:"Level of Traffic Stress (LTS)"}),". ","This has been developed in part by Professor Peter Furth of Northeastern University (who is also a Boston Cyclists Union Board Member). ","LTS is commonly used by planning and engineering professionals."]},{paragraph:["Our implementation attempts to calculate the most current version, v2.2. ","This version uses many factors of the street design to categorize streets. ","Unfortunately, our primary data source, OSM, does not have all of the necessary data tagged for each street segment. ","Engineers could manually collect data for individual street improvement projects to accurately rate a street segment, but to achieve a regional map, we make educated assumptions on what the street looks like. ","If you see something wrong, ",Se.jsx(Di,{to:kf,children:"learn how to fix the data here"}),"."]},{paragraph:Se.jsx(Nd,{link:kf,title:"How we use OSM Data"})},{paragraph:["The big idea with LTS is that there is more to a cyclists experience on a street than whether or not there is a bike lane. ","There are numerous streets that have bike lanes that an experienced cyclist in the city may know to avoid. ","On the other hand, many quiet residential streets have no bike-specific markings and may be the exact streets that someone uses to avoid the high speed, high volume street with a bike lane. ","This means if we want to compare streets based on the comfort to ride on them, we need to look at more of the features of the street than just the presence of a bike lane."]},{paragraph:["What makes cycling dangerous is the presence, proximity, volume, and speed of cars and trucks. ","A bike lane can help position cyclists and drivers into different spaces on the street. ","But what if the bike lane is adjacent to parked cars in a way that increases the risk of getting ",Se.jsx(Di,{to:"https://en.wikipedia.org/wiki/Dooring",children:'"doored"'})," (hit by a passenger opening a vehicle door)? ","Separating a bike lane with physical barriers like concrete or flex-posts further increases the separation and therefore comfort of cycling on a street. ","For streets with high traffic volumes and high-speed traffic, increasing physical bike lane separation becomes more critical to building a street that is inviting to cycle on."]},{paragraph:["On streets where there isnt enough space to build high-quality bike lanes, the city can reduce conflicts with cars by reducing the speed that people can drive, and/or the volume of traffic. ","This is called ",Se.jsx(Di,{to:"https://en.wikipedia.org/wiki/Traffic_calming",children:"traffic calming"})," and there are numerous tools to make a street safer this way. ","A popular traffic calming option recently has been ",Se.jsx(Di,{to:"https://nacto.org/publication/urban-street-design-guide/street-design-elements/vertical-speed-control-elements/speed-hump/",children:"speed humps"}),", which Boston has been installing as part of their ",Se.jsx(Di,{to:"https://mass.streetsblog.org/2023/05/22/wu-admin-announces-safety-surge-of-traffic-calming-for-neighborhood-streets",children:"Safety Surge"})," effort."]}];function l3(){return Se.jsxs("div",{id:"primary-column",children:[Se.jsx(Ig,{}),Se.jsx(w0,{}),a3.map(L=>Se.jsx(lm,{title:L.title,subheading:L.subheading,paragraph:L.paragraph,list:L.list,graphic:L.graphic},L.title)),Se.jsx(Ag,{})]})}const u3=[{title:"What is OpenStreetMaps?",paragraph:[Se.jsx(Di,{to:"https://www.openstreetmap.org",children:"OpenStreetMap (OSM)"})," is the data source for the calculations used to rate each street segment on our ",Se.jsx(Di,{to:dm,children:"Stress Map"}),". OSM is an incredible resource, much like Wikipedia, that is volunteer-edited to add details and keep the map current to changes (e.g. new bike lanes being installed). By editing the map directly, you will make the Stress Map more accurate, and you will improve the baseline data used in most of your favorite bike and navigation apps, including ",Se.jsx(Di,{to:"https://account.bluebikes.com/map",children:"BlueBikes"}),", ",Se.jsx(Di,{to:"https://www.strava.com/",children:"Strava"}),", ",Se.jsx(Di,{to:"https://ridewithgps.com/",children:"RideWithGPS"}),", ",Se.jsx(Di,{to:"https://geovelo.app/en/route/?bike-type=own&c=-71.057045%2C42.340951&e-bike=false&z=11.07",children:"GeoVelo"}),", ",Se.jsx(Di,{to:"https://www.bikepointz.com/qr-code",children:"Pointz"}),", and many more."]},{title:"Want to help improve our map?",paragraph:["If you are interested in the type of projects we are working on, ",Se.jsx(Di,{to:"https://docs.google.com/forms/d/e/1FAIpQLSefzxEQ-CAbJd_rrt90DHvdglYvP9RLqdDUVsFq28onw9xXJQ/viewform",children:"join us at BCU Labs!"})," Any and all levels of experience are welcomed. We are always looking for new volunteers that are interested in data-backed analysis and storytelling."]},{paragraph:["If you see a data accuracy issue and want the BCU Labs to investigate and fix it, you can use ",Se.jsx(Di,{to:"https://forms.gle/ytyKV7ZrnzYZToCi9",children:"this form"})," to let us know."]},{title:"Recommended Map Editing Tools",paragraph:"These are some of the tools that the BCU Labs team has experience with to edit OpenStreetMap. Each of these tools has different strengths for different types of editing and you may find value using multiple of them.",list:[Se.jsx(Di,{to:"https://www.openstreetmap.org/",children:"OpenStreetMap.org"}),Se.jsx(Di,{to:"https://streetcomplete.app/",children:"StreetComplete (Android only, beginner friendly)"}),Se.jsx(Di,{to:"https://mapcomplete.org/",children:"MapComplete"}),Se.jsx(Di,{to:"https://overpass-turbo.eu/",children:"OverpassTurbo"}),Se.jsx(Di,{to:"https://josm.openstreetmap.de/",children:"JOSM"}),Se.jsx(Di,{to:"https://vespucci.io/",children:"Vespucci (Android only)"})]},{title:"Tags we use",paragraph:["OSM data is organized as ways (street segments) that have attributes attached to them called ",Se.jsx(Di,{to:"https://wiki.openstreetmap.org/wiki/Tags",children:"tags"}),". These tags contain a key and a value. This is the data that we are able to use to calculate the ",Se.jsx(Di,{to:sm,children:"Level of Traffic Stress (LTS)"})," of each street segment. ","You can see exactly what tags we use ",Se.jsx(Di,{to:"https://github.com/BostonCyclistsUnion/StressMap/tree/main/config",children:"here"})," and a general overview of which tags are most important for our calculations below. "]},{paragraph:["Some of the tags are on nearly every segment while others are more rare. For many segments, a tag is missing that we need to be able to calculate the LTS. In these cases we make assumptions based on the other tags. Adding the proper tags when our assumptions are wrong will result in a more accurate calculation."],list:[[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:highway",children:"highway"}),": Describes the type of road"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:cycleway",children:"cycleway"}),": Describes the type of bike lane. Sub-tags add details about bike lane, including width and separation"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:footway",children:"footway"}),": Type of pedestrian path. May have complementing tags to allow bikes"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:parking",children:"parking"}),": Is there street parking?"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:width",children:"width"}),": Width of the roadway"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:oneway",children:"oneway"}),": Is the street a oneway?"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:bicycle",children:"bicycle"}),": Are bicycles allowed on the way?"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:access",children:"access"}),": Is the public allowed here?"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:service",children:"service"}),": Alleys and driveways"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:lane_markings",children:"lane_markings"}),": Are lane lines painted? Used to estimate daily car traffic"],[Se.jsx(Di,{to:"https://wiki.openstreetmap.org/Key:lanes",children:"lanes"}),": Number of lanes"]]}];function c3(){return Se.jsxs("div",{id:"primary-column",children:[Se.jsx(Ig,{}),Se.jsx(w0,{}),u3.map(L=>Se.jsx(lm,{title:L.title,subheading:L.subheading,paragraph:L.paragraph,list:L.list,graphic:L.graphic},L.title)),Se.jsx(Ag,{})]})}function h3(){return Se.jsx("div",{id:"primary-column",children:Se.jsx(oE,{basename:"/",children:Se.jsxs(zT,{children:[Se.jsx(nm,{path:Eg,element:Se.jsx(BE,{})}),Se.jsx(nm,{path:dm,element:Se.jsx(t3,{})}),Se.jsx(nm,{path:sm,element:Se.jsx(l3,{})}),Se.jsx(nm,{path:kf,element:Se.jsx(c3,{})})]})})})}qS.createRoot(document.getElementById("root")).render(Se.jsx(cr.StrictMode,{children:Se.jsx(h3,{})}));
